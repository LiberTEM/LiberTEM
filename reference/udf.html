<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UDF API reference &mdash; LiberTEM 0.12.0.dev0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Set API" href="dataset.html" />
    <link rel="prev" title="LiberTEM Context API" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LiberTEM
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.12
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">GUI usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats.html">Loading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_datasets.html">Sample Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../udf.html">User-defined functions (UDFs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dask.html">Dask integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">LiberTEM Context API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">UDF API reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-udfs">Defining UDFs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mixins-for-processing-methods">Mixins for processing methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#base-udf-classes">Base UDF classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternative-merging-for-dask-arrays">Alternative merging for Dask arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="#meta-information">Meta information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-and-postprocessing">Pre- and postprocessing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-udfs">Running UDFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buffers">Buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#included-utility-udfs">Included utility UDFs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sum-of-frames">Sum of frames</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sum-of-log-scaled-frames">Sum of log-scaled frames</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standard-deviation">Standard deviation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sum-per-frame">Sum per frame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-masks">Apply masks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-data">Load data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#noop">NoOp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dataset.html">Data Set API</a></li>
<li class="toctree-l2"><a class="reference internal" href="io_backends.html">I/O Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="application.html">Application-specific APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="masks.html">Mask creation and manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse.html">Sparse array utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html">Internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="dask.html">Dask API</a></li>
<li class="toctree-l2"><a class="reference internal" href="corrections.html">Corrections</a></li>
<li class="toctree-l2"><a class="reference internal" href="viz.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="progress.html">Progress bar support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packages.html">Package overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../why_python.html">Why Python?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/setup.html">Setting up a development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/how-io-works.html">How does I/O work in LiberTEM?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/executors.html">LiberTEM executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorship.html">Authorship policy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LiberTEM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Python API reference</a></li>
      <li class="breadcrumb-item active">UDF API reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/reference/udf.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="udf-api-reference">
<span id="udf-reference"></span><h1>UDF API reference<a class="headerlink" href="#udf-api-reference" title="Permalink to this heading"></a></h1>
<section id="defining-udfs">
<span id="define-udf-ref"></span><h2>Defining UDFs<a class="headerlink" href="#defining-udfs" title="Permalink to this heading"></a></h2>
<p>See <a class="reference internal" href="../udf.html#user-defined-functions"><span class="std std-ref">User-defined functions (UDFs)</span></a> for an introduction and in-depth explanation.</p>
<section id="mixins-for-processing-methods">
<h3>Mixins for processing methods<a class="headerlink" href="#mixins-for-processing-methods" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFFrameMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFFrameMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFFrameMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFFrameMixin" title="Permalink to this definition"></a></dt>
<dd><p>Implement <code class="code docutils literal notranslate"><span class="pre">process_frame</span></code> for per-frame processing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFFrameMixin.process_frame">
<span class="sig-name descname"><span class="pre">process_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFFrameMixin.process_frame"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFFrameMixin.process_frame" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to process the data on a frame-by-frame manner.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite>    - the parameters of this UDF</p></li>
<li><p><cite>self.task_data</cite> - task data created by <cite>get_task_data</cite></p></li>
<li><p><cite>self.results</cite>   - the result buffer instances</p></li>
<li><p><cite>self.meta</cite>      - meta data about the current operation and data set</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>frame</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em> or </em><em>cupy.ndarray</em>) – A single frame or signal element from the dataset.
The shape is the same as <cite>dataset.shape.sig</cite>. In case of pixelated
STEM / scanning diffraction data this is 2D, for spectra 1D etc.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFTileMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFTileMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFTileMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFTileMixin" title="Permalink to this definition"></a></dt>
<dd><p>Implement <code class="code docutils literal notranslate"><span class="pre">process_tile</span></code> for per-tile processing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFTileMixin.process_tile">
<span class="sig-name descname"><span class="pre">process_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFTileMixin.process_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFTileMixin.process_tile" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to process the data in a tiled manner.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite>    - the parameters of this UDF</p></li>
<li><p><cite>self.task_data</cite> - task data created by <cite>get_task_data</cite></p></li>
<li><p><cite>self.results</cite>   - the result buffer instances</p></li>
<li><p><cite>self.meta</cite>      - meta data about the current operation and data set</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tile</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em> or </em><em>cupy.ndarray</em>) – A small number N of frames or signal elements from the dataset.
The shape is (N,) + <cite>dataset.shape.sig</cite>. In case of pixelated
STEM / scanning diffraction data this is 3D, for spectra 2D etc.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPartitionMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFPartitionMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPartitionMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPartitionMixin" title="Permalink to this definition"></a></dt>
<dd><p>Implement <code class="code docutils literal notranslate"><span class="pre">process_partition</span></code> for per-partition processing.</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPartitionMixin.process_partition">
<span class="sig-name descname"><span class="pre">process_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPartitionMixin.process_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPartitionMixin.process_partition" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to process the data partitioned into large
(100s of MiB) partitions.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite>    - the parameters of this UDF</p></li>
<li><p><cite>self.task_data</cite> - task data created by <cite>get_task_data</cite></p></li>
<li><p><cite>self.results</cite>   - the result buffer instances</p></li>
<li><p><cite>self.meta</cite>      - meta data about the current operation and data set</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only use this method if you know what you are doing; especially if
you are running a processing pipeline with multiple steps, or multiple
processing pipelines at the same time, performance may be adversely
impacted.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>partition</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em> or </em><em>cupy.ndarray</em>) – A large number N of frames or signal elements from the dataset.
The shape is (N,) + <cite>dataset.shape.sig</cite>. In case of pixelated
STEM / scanning diffraction data this is 3D, for spectra 2D etc.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="base-udf-classes">
<h3>Base UDF classes<a class="headerlink" href="#base-udf-classes" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.AuxBufferWrapper" title="libertem.common.buffers.AuxBufferWrapper"><span class="pre">AuxBufferWrapper</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF" title="Permalink to this definition"></a></dt>
<dd><p>The main user-defined functions interface. You can implement your functionality
by overriding methods on this class.</p>
<p>If you override <cite>__init__</cite>, please take care,
as it is called multiple times during evaluation of a UDF. You can handle
some pre-conditioning of parameters, but you also have to accept the results
as input again.</p>
<p>Arguments passed as <cite>**kwargs</cite> will be automatically available on <cite>self.params</cite>
when running the UDF.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyUDF</span><span class="p">(</span><span class="n">UDF</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="o">=</span><span class="s2">&quot;def2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">param1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="s2">&quot;param3&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;missing argument param3&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">param1</span><span class="o">=</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="o">=</span><span class="n">param2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – <p>Input parameters. They are scattered to the worker processes and
available as <cite>self.params</cite> from here on.</p>
<p>Values can be <cite>BufferWrapper</cite> instances, which, when accessed via
<cite>self.params.the_key_here</cite>, will automatically return a view corresponding
to the current unit of data (frame, tile, partition).</p>
</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_ALL">
<span class="sig-name descname"><span class="pre">BACKEND_ALL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('cupyx.scipy.sparse.csr_matrix',</span> <span class="pre">'cupyx.scipy.sparse.csc_matrix',</span> <span class="pre">'cupyx.scipy.sparse.coo_matrix',</span> <span class="pre">'scipy.sparse.csr_matrix',</span> <span class="pre">'scipy.sparse.csc_matrix',</span> <span class="pre">'scipy.sparse.coo_matrix',</span> <span class="pre">'cupy',</span> <span class="pre">'numpy',</span> <span class="pre">'sparse.COO',</span> <span class="pre">'sparse.GCXS')</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_ALL" title="Permalink to this definition"></a></dt>
<dd><p>Tuple with all backends in suggested priority</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_CUDA">
<span class="sig-name descname"><span class="pre">BACKEND_CUDA</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cuda'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_CUDA" title="Permalink to this definition"></a></dt>
<dd><p>NumPy array, but run on CUDA device class</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_CUPY">
<span class="sig-name descname"><span class="pre">BACKEND_CUPY</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cupy'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_CUPY" title="Permalink to this definition"></a></dt>
<dd><p>CuPy array</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_COO">
<span class="sig-name descname"><span class="pre">BACKEND_CUPY_SCIPY_COO</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cupyx.scipy.sparse.coo_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_COO" title="Permalink to this definition"></a></dt>
<dd><p>cupyx.scipy.sparse.coo_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_CSC">
<span class="sig-name descname"><span class="pre">BACKEND_CUPY_SCIPY_CSC</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cupyx.scipy.sparse.csc_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_CSC" title="Permalink to this definition"></a></dt>
<dd><p>cupyx.scipy.sparse.csc_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_CSR">
<span class="sig-name descname"><span class="pre">BACKEND_CUPY_SCIPY_CSR</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cupyx.scipy.sparse.csr_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_CUPY_SCIPY_CSR" title="Permalink to this definition"></a></dt>
<dd><p>cupyx.scipy.sparse.csr_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_NUMPY">
<span class="sig-name descname"><span class="pre">BACKEND_NUMPY</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'numpy'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_NUMPY" title="Permalink to this definition"></a></dt>
<dd><p>NumPy array</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SCIPY_COO">
<span class="sig-name descname"><span class="pre">BACKEND_SCIPY_COO</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'scipy.sparse.coo_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SCIPY_COO" title="Permalink to this definition"></a></dt>
<dd><p>scipy.sparse.coo_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SCIPY_CSC">
<span class="sig-name descname"><span class="pre">BACKEND_SCIPY_CSC</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'scipy.sparse.csc_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SCIPY_CSC" title="Permalink to this definition"></a></dt>
<dd><p>scipy.sparse.csc_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SCIPY_CSR">
<span class="sig-name descname"><span class="pre">BACKEND_SCIPY_CSR</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'scipy.sparse.csr_matrix'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SCIPY_CSR" title="Permalink to this definition"></a></dt>
<dd><p>scipy.sparse.csr_matrix</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SPARSE_COO">
<span class="sig-name descname"><span class="pre">BACKEND_SPARSE_COO</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'sparse.COO'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SPARSE_COO" title="Permalink to this definition"></a></dt>
<dd><p>sparse.COO array</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SPARSE_DOK">
<span class="sig-name descname"><span class="pre">BACKEND_SPARSE_DOK</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'sparse.DOK'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SPARSE_DOK" title="Permalink to this definition"></a></dt>
<dd><p>sparse.DOK array – not recommended since slow!</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.BACKEND_SPARSE_GCXS">
<span class="sig-name descname"><span class="pre">BACKEND_SPARSE_GCXS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'sparse.GCXS'</span></em><a class="headerlink" href="#libertem.udf.base.UDF.BACKEND_SPARSE_GCXS" title="Permalink to this definition"></a></dt>
<dd><p>sparse.GCXS array</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.TILE_DEPTH_DEFAULT">
<span class="sig-name descname"><span class="pre">TILE_DEPTH_DEFAULT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;object</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#libertem.udf.base.UDF.TILE_DEPTH_DEFAULT" title="Permalink to this definition"></a></dt>
<dd><p>Suggest using recommended tile depth</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.TILE_DEPTH_MAX">
<span class="sig-name descname"><span class="pre">TILE_DEPTH_MAX</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">inf</span></em><a class="headerlink" href="#libertem.udf.base.UDF.TILE_DEPTH_MAX" title="Permalink to this definition"></a></dt>
<dd><p>Suggest using maximum tile depth</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.TILE_SIZE_BEST_FIT">
<span class="sig-name descname"><span class="pre">TILE_SIZE_BEST_FIT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;object</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#libertem.udf.base.UDF.TILE_SIZE_BEST_FIT" title="Permalink to this definition"></a></dt>
<dd><p>Suggest using recommended tile size</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.TILE_SIZE_MAX">
<span class="sig-name descname"><span class="pre">TILE_SIZE_MAX</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">inf</span></em><a class="headerlink" href="#libertem.udf.base.UDF.TILE_SIZE_MAX" title="Permalink to this definition"></a></dt>
<dd><p>Suggest using maximum tile size</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.USE_NATIVE_DTYPE">
<span class="sig-name descname"><span class="pre">USE_NATIVE_DTYPE</span></span><a class="headerlink" href="#libertem.udf.base.UDF.USE_NATIVE_DTYPE" title="Permalink to this definition"></a></dt>
<dd><p>alias of <a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.aux_data">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">aux_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float32'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.aux_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.aux_data" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to create auxiliary data. Auxiliary data should
have a shape like <cite>(dataset.shape.nav, extra_shape)</cite> and on access,
an appropriate view will be created. For example, if you access
aux data in <cite>process_frame</cite>, you will get the auxiliary data for
the current frame you are processing.</p>
<p class="rubric">Example</p>
<p>We create a UDF to demonstrate the behavior:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyUDF</span><span class="p">(</span><span class="n">UDF</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_result_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Result buffer for debug output</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;aux_dump&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)}</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">process_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Extract value of aux data for demonstration</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">aux_dump</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">aux_data</span><span class="p">[:])</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># for each frame, provide three values from a sequential series:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aux1</span> <span class="o">=</span> <span class="n">MyUDF</span><span class="o">.</span><span class="n">aux_data</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nav</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;nav&quot;</span><span class="p">,</span> <span class="n">extra_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">MyUDF</span><span class="p">(</span><span class="n">aux_data</span><span class="o">=</span><span class="n">aux1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)</span>
</pre></div>
</div>
<p>process_frame for frame (0, 7) received a view of aux_data with values [21., 22., 23.]:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;aux_dump&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="go">&#39;[21. 22. 23.]&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.buffer">
<span class="sig-name descname"><span class="pre">buffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'nav'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sig'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'single'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.DTypeLike</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'float32'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'device'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'private'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'result_only'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.buffer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.buffer" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to create <code class="xref py py-class docutils literal notranslate"><span class="pre">BufferWrapper</span></code> objects
in <a class="reference internal" href="#libertem.udf.base.UDF.get_result_buffers" title="libertem.udf.base.UDF.get_result_buffers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_result_buffers()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> (<em>&quot;nav&quot;</em><em>, </em><em>&quot;sig&quot;</em><em> or </em><em>&quot;single&quot;</em>) – The abstract shape of the buffer, corresponding either to the navigation
or the signal dimensions of the dataset, or a single value.</p></li>
<li><p><strong>extra_shape</strong> (<em>optional</em><em>, </em><em>tuple of int</em><em> or </em><em>a Shape object</em>) – You can specify additional dimensions for your data. For example, if
you want to store 2D coords, you would specify <code class="code docutils literal notranslate"><span class="pre">(2,)</span></code> here.
If this is specified as a Shape object, it is converted to a tuple first.</p></li>
<li><p><strong>dtype</strong> (<em>string</em><em> or </em><em>numpy dtype</em>) – The dtype of this buffer</p></li>
<li><p><strong>where</strong> (<em>string</em><em> or </em><em>None</em>) – <p><code class="code docutils literal notranslate"><span class="pre">None</span></code> means NumPy array, specify <code class="code docutils literal notranslate"><span class="pre">'device'</span></code> to use a device buffer
(for example on a CUDA device)</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</p></li>
<li><p><strong>use</strong> (<em>&quot;private&quot;</em><em>, </em><em>&quot;result_only&quot;</em><em> or </em><em>None</em>) – <p>If you specify <code class="code docutils literal notranslate"><span class="pre">&quot;private&quot;</span></code> here, the result will only be made available
to internal functions, like <code class="xref py py-meth docutils literal notranslate"><span class="pre">process_frame()</span></code>, <a class="reference internal" href="#libertem.udf.base.UDF.merge" title="libertem.udf.base.UDF.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> or
<a class="reference internal" href="#libertem.udf.base.UDF.get_results" title="libertem.udf.base.UDF.get_results"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_results()</span></code></a>. It will not be available to the user of the UDF, which means
you can use this to hide implementation details that are likely to change later.</p>
<p>Specify <code class="code docutils literal notranslate"><span class="pre">&quot;result_only&quot;</span></code> here if the buffer is only used in <a class="reference internal" href="#libertem.udf.base.UDF.get_results" title="libertem.udf.base.UDF.get_results"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_results()</span></code></a>,
this means we don’t have to allocate and return it on the workers without actually
needing it.</p>
<p><code class="code docutils literal notranslate"><span class="pre">None</span></code> means the buffer is used both as a final and intermediate result.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.copy_for_partition">
<span class="sig-name descname"><span class="pre">copy_for_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="dataset.html#libertem.io.dataset.base.Partition" title="libertem.io.dataset.base.partition.Partition"><span class="pre">Partition</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><span class="pre">UDF</span></a></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.copy_for_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.copy_for_partition" title="Permalink to this definition"></a></dt>
<dd><p>create a copy of the UDF, specifically slicing aux data to the
specified pratition and roi</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.forbuf">
<span class="sig-name descname"><span class="pre">forbuf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.forbuf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.forbuf" title="Permalink to this definition"></a></dt>
<dd><p>Convert array to backend that is compatible with result buffers and
reshape.</p>
<p>This function should be wrapped around assignment to result buffers if
the array <code class="code docutils literal notranslate"><span class="pre">arr</span></code> might have an incompatible array backend and/or
have a flattened sig dimension. It converts any of the supported input
backends into the array backend of the target buffer. If the argument is
already matching the buffer or is not recognized, it is a no-op.</p>
<p>In particular, the result of array operations on a sparse input tile
can’t always be merged into dense result buffers directly since arrays
from the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sparse</span></code> package are not converted to NumPy arrays
automatically.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arr</strong> (<em>array-like</em>) – Any array-like object that is supported by the <cite>sparseconverter</cite>
package or allows the desired operation with the result buffer at
hand.</p></li>
<li><p><strong>target</strong> (<em>array-like</em>) – The LiberTEM result buffer that the desired operation targets.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">process_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tile</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">res</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># Processing result from tile</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">intensity</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbuf</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">res</span><span class="p">,</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">intensity</span>
<span class="gp">... </span>    <span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../udf/advanced.html#sparse"><span class="std std-ref">Sparse arrays</span></a> for a complete example how to use this function in the
contaxt of a UDF!</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_backends">
<span class="sig-name descname"><span class="pre">get_backends</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'numpy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'numpy.matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cuda'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.COO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.GCXS'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.DOK'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csc_matrixcupyx.scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csc_matrix'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'numpy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'numpy.matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cuda'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.COO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.GCXS'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.DOK'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csc_matrixcupyx.scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csc_matrix'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_backends"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_backends" title="Permalink to this definition"></a></dt>
<dd><p>Signal which computation back-ends the UDF can use.</p>
<p>Allowed are values in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a>.
<code class="code docutils literal notranslate"><span class="pre">(UDF.BACKEND_NUMPY,</span> <span class="pre">)</span></code> is returned by default for CPU-based computation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11.0: </span>Extended from just NumPy vs. CuPy to include more generic specification of backends,
including sparse arrays. See <a class="reference internal" href="../udf/advanced.html#sparse"><span class="std std-ref">Sparse arrays</span></a> for details! The backend specifications are
backwards-compatible with the previously supported values.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A single value or iterable containing values from the supported backends
in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>backends</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_preferred_input_dtype">
<span class="sig-name descname"><span class="pre">get_preferred_input_dtype</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">nt.DTypeLike</span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_preferred_input_dtype"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_preferred_input_dtype" title="Permalink to this definition"></a></dt>
<dd><p>Override this method to specify the preferred input dtype of the UDF.</p>
<p>The default is <code class="code docutils literal notranslate"><span class="pre">float32</span></code> since most numerical processing tasks
perform best with this dtype, namely dot products.</p>
<p>The back-end uses this preferred input dtype in combination with the
dataset`s native dtype to determine the input dtype using
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.result_type.html#numpy.result_type" title="(in NumPy v1.24)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.result_type()</span></code></a>. That means <code class="code docutils literal notranslate"><span class="pre">float</span></code> data in a dataset
switches the dtype to <code class="code docutils literal notranslate"><span class="pre">float</span></code> even if this method returns an
<code class="code docutils literal notranslate"><span class="pre">int</span></code> dtype. <code class="code docutils literal notranslate"><span class="pre">int32</span></code> or wider input data would switch from
<code class="code docutils literal notranslate"><span class="pre">float32</span></code> to <code class="code docutils literal notranslate"><span class="pre">float64</span></code>, and complex data in the dataset will
switch the input dtype kind to <code class="code docutils literal notranslate"><span class="pre">complex</span></code>, following the NumPy
casting rules.</p>
<p>In case your UDF only works with specific input dtypes, it should throw
an error or warning if incompatible dtypes are used, and/or implement a
meaningful conversion in your UDF’s <code class="code docutils literal notranslate"><span class="pre">process_&lt;...&gt;</span></code> routine.</p>
<p>If you prefer to always use the dataset’s native dtype instead of
floats, you can override this method to return
<a class="reference internal" href="#libertem.udf.base.UDF.USE_NATIVE_DTYPE" title="libertem.udf.base.UDF.USE_NATIVE_DTYPE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UDF.USE_NATIVE_DTYPE</span></code></a>, which is currently identical to
<code class="code docutils literal notranslate"><span class="pre">numpy.bool</span></code> and behaves as a neutral element in
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.result_type.html#numpy.result_type" title="(in NumPy v1.24)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.result_type()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_result_buffers">
<span class="sig-name descname"><span class="pre">get_result_buffers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Dict" title="(in Python v3.10)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_result_buffers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_result_buffers" title="Permalink to this definition"></a></dt>
<dd><p>Return result buffer declaration.</p>
<p>Values of the returned dict should be <a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferWrapper</span></code></a>
instances, which, when accessed via <code class="code docutils literal notranslate"><span class="pre">self.results.key</span></code>,
will automatically return a view corresponding to the
current unit of data (frame, tile, partition).</p>
<p>The values also need to be serializable via pickle.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">self.params</span></code> - the parameters of this UDF</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">self.meta</span></code> - relevant metadata, see <a class="reference internal" href="#libertem.udf.base.UDFMeta" title="libertem.udf.base.UDFMeta"><code class="xref py py-class docutils literal notranslate"><span class="pre">UDFMeta</span></code></a> documentation.
Please note that partition metadata will not be set when this method is
executed on the head node.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Flat dict with string keys. Keys should
be valid python identifiers, which allows
access via <cite>self.results.the_key_here</cite>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_results">
<span class="sig-name descname"><span class="pre">get_results</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Dict" title="(in Python v3.10)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_results" title="Permalink to this definition"></a></dt>
<dd><p>Get results, allowing a postprocessing step on the main node after
a result has been merged. See also: <a class="reference internal" href="#libertem.udf.base.UDFPostprocessMixin" title="libertem.udf.base.UDFPostprocessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UDFPostprocessMixin</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should return all values as numpy arrays, they will be wrapped
in <cite>BufferWrapper</cite> instances before they are returned to the user.</p>
<p>See the <a class="reference internal" href="../udf/advanced.html#udf-final-post-processing"><span class="std std-ref">Post-processing after merging</span></a> section in the documentation for
details and examples.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>results</strong> – A <cite>dict</cite> containing the final post-processed results.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_task_data">
<span class="sig-name descname"><span class="pre">get_task_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Dict" title="(in Python v3.10)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_task_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_task_data" title="Permalink to this definition"></a></dt>
<dd><p>Initialize per-task data.</p>
<p>Per-task data can be mutable. Override this function
to allocate temporary buffers, or to initialize
system resources.</p>
<p>If you want to distribute static data, use
parameters instead.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite> - the input parameters of this UDF</p></li>
<li><p><cite>self.meta</cite> - relevant metadata, see <a class="reference internal" href="#libertem.udf.base.UDFMeta" title="libertem.udf.base.UDFMeta"><code class="xref py py-class docutils literal notranslate"><span class="pre">UDFMeta</span></code></a> documentation.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Flat dict with string keys. Keys should
be valid python identifiers, which allows
access via <cite>self.task_data.the_key_here</cite>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.get_tiling_preferences">
<span class="sig-name descname"><span class="pre">get_tiling_preferences</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">TilingPreferences</span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.get_tiling_preferences"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.get_tiling_preferences" title="Permalink to this definition"></a></dt>
<dd><p>Configure tiling preferences. Return a dictionary with the
following keys:</p>
<ul class="simple">
<li><p>“depth”: number of frames/frame parts to stack on top of each other</p></li>
<li><p>“total_size”: total size of a tile in bytes</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MergeAttrMapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MergeAttrMapping</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDF.merge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDF.merge" title="Permalink to this definition"></a></dt>
<dd><p>Merge a partial result <cite>src</cite> into the current global result <cite>dest</cite>.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite> - the parameters of this UDF</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dest</strong> – global results; you can access the ndarrays for each
buffer name (from <cite>get_result_buffers</cite>) by attribute access
(<code class="code docutils literal notranslate"><span class="pre">dest.your_buffer_name</span></code>)</p></li>
<li><p><strong>src</strong> – results for a partition; you can access the ndarrays for each
buffer name (from <cite>get_result_buffers</cite>) by attribute access
(<code class="code docutils literal notranslate"><span class="pre">src.your_buffer_name</span></code>)</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is running on the main node, which means <cite>self.results</cite>
and <cite>self.task_data</cite> are not available.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.requires_custom_merge">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">requires_custom_merge</span></span><a class="headerlink" href="#libertem.udf.base.UDF.requires_custom_merge" title="Permalink to this definition"></a></dt>
<dd><p>Determine if buffers with <code class="code docutils literal notranslate"><span class="pre">kind</span> <span class="pre">!=</span> <span class="pre">'nav'</span></code> are present where
the default merge doesn’t work</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDF.xp">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">xp</span></span><a class="headerlink" href="#libertem.udf.base.UDF.xp" title="Permalink to this definition"></a></dt>
<dd><p>Compute back-end library to use.</p>
<p>Generally, use <code class="code docutils literal notranslate"><span class="pre">self.xp</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">np</span></code> to use NumPy or CuPy transparently</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="alternative-merging-for-dask-arrays">
<h3>Alternative merging for Dask arrays<a class="headerlink" href="#alternative-merging-for-dask-arrays" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMergeAllMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFMergeAllMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFMergeAllMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFMergeAllMixin" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMergeAllMixin.merge_all">
<span class="sig-name descname"><span class="pre">merge_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ordered_results</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrderedDict</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">MergeAttrMapping</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">nt.ArrayLike</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFMergeAllMixin.merge_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFMergeAllMixin.merge_all" title="Permalink to this definition"></a></dt>
<dd><p>Combine stack of ordered partial results <code class="code docutils literal notranslate"><span class="pre">ordered_results</span></code> to form complete result.</p>
<p>Combining can be more efficient than direct merging into a result buffer
for cases where the results are not NumPy arrays.
Currently this is only applicable for the
<a class="reference internal" href="../dev/executors.html#libertem.executor.delayed.DelayedJobExecutor" title="libertem.executor.delayed.DelayedJobExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.executor.delayed.DelayedJobExecutor</span></code></a>
where it provides an efficient pathway to construct Dask arrays from delayed UDF results.</p>
<p>The input and the returned arrays are in flattened navigation dimension with ROI applied.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">self.params</span></code> - the parameters of this UDF</p></li>
</ul>
<p>For UDFs with only <code class="code docutils literal notranslate"><span class="pre">kind='nav'</span></code> result buffers a default implementation
is used automatically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ordered_results</strong> – Ordered dict mapping partition slice to UDF partial result</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary mapping result buffer name to buffer content</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a>[buffername] -&gt; array_like</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is running on the main node, which means <cite>self.results</cite>
and <cite>self.task_data</cite> are not available.</p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="meta-information">
<h3>Meta information<a class="headerlink" href="#meta-information" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFMeta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_slice</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#libertem.common.shape.Shape" title="libertem.common.shape.Shape"><span class="pre">Shape</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.DTypeLike</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.DTypeLike</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tiling_scheme</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="dataset.html#libertem.io.dataset.base.TilingScheme" title="libertem.io.dataset.base.tiling_scheme.TilingScheme"><span class="pre">TilingScheme</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tiling_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.corrset.CorrectionSet"><span class="pre">CorrectionSet</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'cpu'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cuda'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads_per_worker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">array_backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'numpy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'numpy.matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cuda'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.COO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.GCXS'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.DOK'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csc_matrixcupyx.scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csc_matrix'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFMeta"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFMeta" title="Permalink to this definition"></a></dt>
<dd><p>UDF metadata. Makes all relevant metadata accessible to the UDF. Can be different
for each task/partition.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.4.0: </span>Added distinction of dataset_dtype and input_dtype</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Information on compute backend, corrections, coordinates and tiling scheme added</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9.0: </span><code class="code docutils literal notranslate"><span class="pre">tiling_scheme_idx</span></code> and <cite>sig_slice</cite> added</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11.0: </span><code class="code docutils literal notranslate"><span class="pre">array_backend</span></code> added</p>
</div>
<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.array_backend">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">array_backend</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Literal" title="(in Python v3.10)"><span class="pre">Literal</span></a><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'numpy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'numpy.matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cuda'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupy'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.COO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.GCXS'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sparse.DOK'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'scipy.sparse.csc_matrixcupyx.scipy.sparse.coo_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csr_matrix'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'cupyx.scipy.sparse.csc_matrix'</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.array_backend" title="Permalink to this definition"></a></dt>
<dd><p>Array backend, one of the constants defined in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">sparseconverter</span></code> resp. <code class="code docutils literal notranslate"><span class="pre">BACKEND_*</span></code> constants
in <a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.udf.base.UDF</span></code></a>,
or None if not known at that time.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.0.</span></p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.coordinates">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">coordinates</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.coordinates" title="Permalink to this definition"></a></dt>
<dd><p>Array of coordinates that correspond to the frames in the actual
navigation space which are part of the current tile or partition.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.corrections">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">corrections</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.corrset.CorrectionSet"><span class="pre">CorrectionSet</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.corrections" title="Permalink to this definition"></a></dt>
<dd><p>correction data that is available, either from the dataset
or specified by the user</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.CorrectionSet">CorrectionSet</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.dataset_dtype">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dataset_dtype</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">nt.DTypeLike</span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.dataset_dtype" title="Permalink to this definition"></a></dt>
<dd><p>Native dtype of the dataset</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)">numpy.dtype</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.dataset_shape">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dataset_shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#libertem.common.shape.Shape" title="libertem.common.shape.Shape"><span class="pre">Shape</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.dataset_shape" title="Permalink to this definition"></a></dt>
<dd><p>The original shape of the whole dataset, not influenced by the ROI</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="internals.html#libertem.common.shape.Shape" title="libertem.common.shape.Shape">Shape</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.device_class">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">device_class</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.device_class" title="Permalink to this definition"></a></dt>
<dd><p>Which device class is used.</p>
<p>The back-end library can be accessed as <a class="reference internal" href="#libertem.udf.base.UDF.xp" title="libertem.udf.base.UDF.xp"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.xp</span></code></a>.
This additional string information is used since that way the back-end can be probed without
importing them all and testing them against <a class="reference internal" href="#libertem.udf.base.UDF.xp" title="libertem.udf.base.UDF.xp"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.xp</span></code></a>.</p>
<p>Current values are <code class="code docutils literal notranslate"><span class="pre">cpu</span></code> (default) or <code class="code docutils literal notranslate"><span class="pre">cuda</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.input_dtype">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_dtype</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">nt.DTypeLike</span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.input_dtype" title="Permalink to this definition"></a></dt>
<dd><p>dtype of the data that will be passed to the UDF</p>
<p>This is determined from the dataset’s native dtype and
<a class="reference internal" href="#libertem.udf.base.UDF.get_preferred_input_dtype" title="libertem.udf.base.UDF.get_preferred_input_dtype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UDF.get_preferred_input_dtype()</span></code></a> using <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.result_type()</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)">numpy.dtype</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.partition_shape">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">partition_shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#libertem.common.shape.Shape" title="libertem.common.shape.Shape"><span class="pre">Shape</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.partition_shape" title="Permalink to this definition"></a></dt>
<dd><p>The shape of the partition this UDF currently works on.
If a ROI was applied, the shape will be modified accordingly.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="internals.html#libertem.common.shape.Shape" title="libertem.common.shape.Shape">Shape</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.roi">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">roi</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.roi" title="Permalink to this definition"></a></dt>
<dd><p>Boolean array which limits the elements the UDF is working on.
Has a shape of <code class="xref py py-attr docutils literal notranslate"><span class="pre">dataset_shape.nav</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.sig_slice">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sig_slice</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.sig_slice" title="Permalink to this definition"></a></dt>
<dd><p>Signal slice of the current tile.</p>
<p>Since all tiles follow the same tiling scheme, this avoids repeatedly
calculating the signal part of <a class="reference internal" href="#libertem.udf.base.UDFMeta.slice" title="libertem.udf.base.UDFMeta.slice"><code class="xref py py-attr docutils literal notranslate"><span class="pre">slice</span></code></a>. Instead, the
appropriate slice from the tiling scheme can be re-used.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.slice">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">slice</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.slice" title="Permalink to this definition"></a></dt>
<dd><p>A <a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><code class="xref py py-class docutils literal notranslate"><span class="pre">Slice</span></code></a> instance that describes the location
within the dataset with navigation dimension flattened and reduced to the ROI.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice">Slice</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.threads_per_worker">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">threads_per_worker</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.threads_per_worker" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>number of threads that a UDF is allowed to use in the <cite>process_*</cite> method.</dt><dd><p>For Numba, pyfftw, Torch, NumPy and SciPy (OMP, MKL, OpenBLAS), this limit
is set automatically; this property can be used for other cases, like manually
creating thread pools or setting limits for unsupported modules.
<code class="code docutils literal notranslate"><span class="pre">None</span></code> means no limit is set, and the UDF can use any number of threads
it deems necessary (should be limited to system limits, of course).</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.8.0: </span>Since discovery of loaded libraries can be slow with <code class="xref py py-mod docutils literal notranslate"><span class="pre">threadpoolctl</span></code>
(<a class="reference external" href="https://github.com/LiberTEM/LiberTEM/issues/1117">#1117</a>), they are cached now. In case an UDF triggers loading of a new
library or instance of a library that is supported by <code class="xref py py-mod docutils literal notranslate"><span class="pre">threadpoolctl</span></code>,
it will only be discovered in the first run on a <a class="reference internal" href="api.html#libertem.api.Context" title="libertem.api.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>.
The threading settings for such other libraries or instances can therefore depend on the
execution order. In such cases the thread count for affected libraries should be
set in the UDF based on <code class="code docutils literal notranslate"><span class="pre">threads_per_worker</span></code>. Numba, pyfftw, Torch, NumPy
and SciPy should not be affected since they are loaded before the first discovery.</p>
</div>
<p>See also: <code class="xref py py-func docutils literal notranslate"><span class="pre">libertem.common.threading.set_num_threads()</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)">int</a> or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.tiling_scheme">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tiling_scheme</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="dataset.html#libertem.io.dataset.base.TilingScheme" title="libertem.io.dataset.base.tiling_scheme.TilingScheme"><span class="pre">TilingScheme</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.tiling_scheme" title="Permalink to this definition"></a></dt>
<dd><p>the tiling scheme that was negotiated</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="dataset.html#libertem.io.dataset.base.TilingScheme" title="libertem.io.dataset.base.TilingScheme">TilingScheme</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.udf.base.UDFMeta.tiling_scheme_idx">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tiling_scheme_idx</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></em><a class="headerlink" href="#libertem.udf.base.UDFMeta.tiling_scheme_idx" title="Permalink to this definition"></a></dt>
<dd><p>Index of the current tile in <a class="reference internal" href="#libertem.udf.base.UDFMeta.tiling_scheme" title="libertem.udf.base.UDFMeta.tiling_scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tiling_scheme</span></code></a>.</p>
</dd></dl>

</dd></dl>

</section>
<section id="pre-and-postprocessing">
<h3>Pre- and postprocessing<a class="headerlink" href="#pre-and-postprocessing" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPreprocessMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFPreprocessMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPreprocessMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPreprocessMixin" title="Permalink to this definition"></a></dt>
<dd><p>Implement <code class="code docutils literal notranslate"><span class="pre">preprocess</span></code> to initialize the result buffers of a partition on the worker
before the partition data is processed.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.0.</span></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPreprocessMixin.preprocess">
<span class="sig-name descname"><span class="pre">preprocess</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPreprocessMixin.preprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPreprocessMixin.preprocess" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to preprocess the result data for a partition.</p>
<p>This can be useful to initialize arrays of
<code class="code docutils literal notranslate"><span class="pre">dtype='object'</span></code> with the correct container types, for example.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite>    - the parameters of this UDF</p></li>
<li><p><cite>self.task_data</cite> - task data created by <cite>get_task_data</cite></p></li>
<li><p><cite>self.results</cite>   - the result buffer instances</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPostprocessMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFPostprocessMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPostprocessMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPostprocessMixin" title="Permalink to this definition"></a></dt>
<dd><p>Implement <code class="code docutils literal notranslate"><span class="pre">postprocess</span></code> to modify the resulf buffers of a partition on the worker
after the partition data has been completely processed, but before it is returned to the
main node for the final merging step.</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.UDFPostprocessMixin.postprocess">
<span class="sig-name descname"><span class="pre">postprocess</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFPostprocessMixin.postprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFPostprocessMixin.postprocess" title="Permalink to this definition"></a></dt>
<dd><p>Implement this method to postprocess the result data for a partition.</p>
<p>This can be useful in combination with process_tile() to implement
a postprocessing step that requires the reduced results for whole frames.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite>    - the parameters of this UDF</p></li>
<li><p><cite>self.task_data</cite> - task data created by <cite>get_task_data</cite></p></li>
<li><p><cite>self.results</cite>   - the result buffer instances</p></li>
</ul>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="running-udfs">
<span id="run-udf-ref"></span><h2>Running UDFs<a class="headerlink" href="#running-udfs" title="Permalink to this heading"></a></h2>
<p>Three methods of <a class="reference internal" href="api.html#libertem.api.Context" title="libertem.api.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.api.Context</span></code></a> are relevant for running user-defined functions:</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.api.</span></span><span class="sig-name descname"><span class="pre">Context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">executor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../dev/executors.html#libertem.common.executor.JobExecutor" title="libertem.common.executor.JobExecutor"><span class="pre">JobExecutor</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_class</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/api.html#Context"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Context is the main entry point of the LiberTEM API. It contains
methods for loading datasets, creating analyses on them and running
them. In the background, instantiating a Context creates a suitable
executor and spins up a local Dask cluster unless the executor is
passed to the constructor.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7.0: </span>Removed deprecated methods <code class="code docutils literal notranslate"><span class="pre">create_mask_job</span></code>, <code class="code docutils literal notranslate"><span class="pre">create_pick_job</span></code></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>executor</strong> (<a class="reference internal" href="../dev/executors.html#libertem.common.executor.JobExecutor" title="libertem.common.executor.JobExecutor"><em>JobExecutor</em></a><em> or </em><em>None</em>) – If None, create a local dask.distributed cluster and client using
<a class="reference internal" href="../dev/executors.html#libertem.executor.dask.DaskJobExecutor.make_local" title="libertem.executor.dask.DaskJobExecutor.make_local"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_local()</span></code></a> with optimal configuration
for LiberTEM. It uses all cores and compatible GPUs
on the local system, but is not set as default Dask scheduler to not interfere
with other uses of Dask.</p></li>
<li><p><strong>plot_class</strong> (<a class="reference internal" href="viz.html#libertem.viz.base.Live2DPlot" title="libertem.viz.base.Live2DPlot"><em>libertem.viz.base.Live2DPlot</em></a>) – <p>Default plot class for live plotting.
Defaults to <a class="reference internal" href="viz.html#libertem.viz.mpl.MPLLive2DPlot" title="libertem.viz.mpl.MPLLive2DPlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.viz.mpl.MPLLive2DPlot</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">plot_class</span></span></dt>
<dd><p>Default plot class for live plotting.
Defaults to <a class="reference internal" href="viz.html#libertem.viz.mpl.MPLLive2DPlot" title="libertem.viz.mpl.MPLLive2DPlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.viz.mpl.MPLLive2DPlot</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="viz.html#libertem.viz.base.Live2DPlot" title="libertem.viz.base.Live2DPlot">libertem.viz.base.Live2DPlot</a></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">libertem</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>  
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a Context using an inline executor for debugging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># See also Context.make_with() for a more convenient interface!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">libertem.executor.inline</span> <span class="kn">import</span> <span class="n">InlineJobExecutor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">debug_ctx</span> <span class="o">=</span> <span class="n">libertem</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">InlineJobExecutor</span><span class="p">())</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="dataset.html#libertem.io.dataset.base.DataSet" title="libertem.io.dataset.base.dataset.DataSet"><span class="pre">DataSet</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">spmatrix</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><span class="pre">ProgressReporter</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.corrset.CorrectionSet"><span class="pre">CorrectionSet</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backends</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a></span></span><a class="reference internal" href="../_modules/libertem/api.html#Context.map"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Create an <code class="xref py py-class docutils literal notranslate"><span class="pre">AutoUDF</span></code> with function <code class="xref py py-meth docutils literal notranslate"><span class="pre">f()</span></code> and run it on <code class="code docutils literal notranslate"><span class="pre">dataset</span></code></p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Added the <code class="code docutils literal notranslate"><span class="pre">progress</span></code> parameter</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Added the <code class="code docutils literal notranslate"><span class="pre">corrections</span></code> and <code class="code docutils literal notranslate"><span class="pre">backends</span></code> parameter</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – The dataset to work on</p></li>
<li><p><strong>f</strong> – Function that accepts a frame as the only parameter. It should return a strongly
reduced output compared to the size of a frame.</p></li>
<li><p><strong>roi</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em>, </em><em>sparse array</em><em> or </em><em>coordinate tuple</em><em>(</em><em>s</em><em>)</em><em>, </em><em>optional</em>) – Region of interest as bool mask over the navigation axes of the dataset.
See <a class="reference internal" href="../udf/basic.html#udf-roi"><span class="std std-ref">Regions of interest</span></a>.</p></li>
<li><p><strong>progress</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em> | </em><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><em>ProgressReporter</em></a>) – Show progress bar. Toggle with boolean flag or supply instance of
<a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.common.progress.ProgressReporter</span></code></a> for custom
handling of progress display.</p></li>
<li><p><strong>corrections</strong> – Corrections to apply while running the function. If none are given,
the corrections that are part of the <code class="code docutils literal notranslate"><span class="pre">DataSet</span></code> are used,
if there are any. See also <a class="reference internal" href="corrections.html#corrections"><span class="std std-ref">Corrections</span></a>.</p></li>
<li><p><strong>backends</strong> (<em>None</em><em> or </em><em>iterable containing 'numpy'</em><em>, </em><em>'cupy' and/or 'cuda'</em>) – Restrict the back-end to a subset of the capabilities of the UDF.
This can be useful for testing hybrid UDFs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>BufferWrapper</strong> – The result of the UDF. Access the underlying numpy array using the
<a class="reference internal" href="#libertem.common.buffers.BufferWrapper.data" title="libertem.common.buffers.BufferWrapper.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a> property.
Shape and dtype is inferred automatically from <code class="code docutils literal notranslate"><span class="pre">f</span></code>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper">libertem.common.buffers.BufferWrapper</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">run_udf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="dataset.html#libertem.io.dataset.base.DataSet" title="libertem.io.dataset.base.dataset.DataSet"><span class="pre">DataSet</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">udf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><span class="pre">UDF</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><span class="pre">UDF</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">spmatrix</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.corrset.CorrectionSet"><span class="pre">CorrectionSet</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><span class="pre">ProgressReporter</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backends</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.List" title="(in Python v3.10)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Coroutine" title="(in Python v3.10)"><span class="pre">Coroutine</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Coroutine" title="(in Python v3.10)"><span class="pre">Coroutine</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.List" title="(in Python v3.10)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/api.html#Context.run_udf"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run <code class="code docutils literal notranslate"><span class="pre">udf</span></code> on <code class="code docutils literal notranslate"><span class="pre">dataset</span></code>, restricted to the region of interest <code class="code docutils literal notranslate"><span class="pre">roi</span></code>.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Added the <code class="code docutils literal notranslate"><span class="pre">progress</span></code> parameter</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Added the <code class="code docutils literal notranslate"><span class="pre">corrections</span></code> and <code class="code docutils literal notranslate"><span class="pre">backends</span></code> parameter</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7.0: </span>Added the <code class="code docutils literal notranslate"><span class="pre">plots</span></code> and <code class="code docutils literal notranslate"><span class="pre">sync</span></code> parameters,
and the ability to run multiple UDFs on the same data in a single pass.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – The dataset to work on</p></li>
<li><p><strong>udf</strong> – UDF instance you want to run, or a list of UDF instances</p></li>
<li><p><strong>roi</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em>, </em><em>sparse array</em><em> or </em><em>coordinate tuple</em><em>(</em><em>s</em><em>)</em><em>, </em><em>optional</em>) – Region of interest as bool mask over the navigation axes of the dataset.
See <a class="reference internal" href="../udf/basic.html#udf-roi"><span class="std std-ref">Regions of interest</span></a>.</p></li>
<li><p><strong>progress</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em> | </em><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><em>ProgressReporter</em></a>) – Show progress bar. Toggle with boolean flag or supply instance of
<a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.common.progress.ProgressReporter</span></code></a> for custom
handling of progress display.</p></li>
<li><p><strong>corrections</strong> – Corrections to apply while running the UDF. If none are given,
the corrections that are part of the <code class="code docutils literal notranslate"><span class="pre">DataSet</span></code> are used,
if there are any. See also <a class="reference internal" href="corrections.html#corrections"><span class="std std-ref">Corrections</span></a>.</p></li>
<li><p><strong>backends</strong> (<em>None</em><em> or </em><em>iterable containing 'numpy'</em><em>, </em><em>'cupy' and/or 'cuda'</em>) – Restrict the back-end to a subset of the capabilities of the UDF.
This can be useful for testing hybrid UDFs.</p></li>
<li><p><strong>plots</strong> (<em>None</em><em> or </em><em>True</em><em> or </em><em>List</em><em>[</em><em>List</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Callable</em><em>]</em><em>]</em><em>]</em><em>] or </em><em>List</em><em>[</em><em>LivePlot</em><em>]</em>) – <ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">None</span></code>: don’t plot anything (default)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">True</span></code>: plot all 2D UDF result buffers</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">List[List[...]]</span></code>: plot the named UDF buffers. Pass a list of names or
(name, callable) tuples for each UDF you want to plot. If the callable is specified,
it is applied to the UDF buffer before plotting.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">List[LivePlot]</span></code>: <code class="xref py py-class docutils literal notranslate"><span class="pre">LivePlot</span></code> instance for each
channel you want to plot</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</p></li>
<li><p><strong>sync</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – <p>By default, <cite>run_udf</cite> is a synchronous method. If <cite>sync</cite> is set to <cite>False</cite>,
it is awaitable instead.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Return value of the UDF containing the result buffers of
type <a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.common.buffers.BufferWrapper</span></code></a>. Note that a
<a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferWrapper</span></code></a> can be used like
a <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> in many cases because it implements
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__array__()</span></code>. You can access the underlying numpy array using the
<a class="reference internal" href="#libertem.common.buffers.BufferWrapper.data" title="libertem.common.buffers.BufferWrapper.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a> property.</p>
<p>If a list of UDFs was passed in, the returned type is
a Tuple[dict[str,BufferWrapper]].</p>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a> or Tuple[<a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a>]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run the <a class="reference internal" href="#libertem.udf.sum.SumUDF" title="libertem.udf.sum.SumUDF"><code class="xref py py-class docutils literal notranslate"><span class="pre">SumUDF</span></code></a> on a data set:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">libertem.udf.sum</span> <span class="kn">import</span> <span class="n">SumUDF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">SumUDF</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(32, 32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># intensity is the name of the result buffer, defined in the SumUDF</span>
</pre></div>
</div>
<p>Running a UDF on a subset of data:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">libertem.udf.sumsigudf</span> <span class="kn">import</span> <span class="n">SumSigUDF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nav</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">SumSigUDF</span><span class="p">(),</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># to get the full navigation-shaped results, with NaNs where the `roi` was False:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(16, 16)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># to only get the selected results as a flat array:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1,)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">run_udf_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="dataset.html#libertem.io.dataset.base.DataSet" title="libertem.io.dataset.base.dataset.DataSet"><span class="pre">DataSet</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">udf</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><span class="pre">UDF</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDF" title="libertem.udf.base.UDF"><span class="pre">UDF</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">SparseArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">spmatrix</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="corrections.html#libertem.io.corrections.CorrectionSet" title="libertem.io.corrections.corrset.CorrectionSet"><span class="pre">CorrectionSet</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><span class="pre">bool</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><span class="pre">ProgressReporter</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backends</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Generator" title="(in Python v3.10)"><span class="pre">Generator</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDFResults" title="libertem.udf.base.UDFResults"><span class="pre">UDFResults</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.AsyncGenerator" title="(in Python v3.10)"><span class="pre">AsyncGenerator</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#libertem.udf.base.UDFResults" title="libertem.udf.base.UDFResults"><span class="pre">UDFResults</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/libertem/api.html#Context.run_udf_iter"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run <code class="code docutils literal notranslate"><span class="pre">udf</span></code> on <code class="code docutils literal notranslate"><span class="pre">dataset</span></code>, restricted to the region of interest <code class="code docutils literal notranslate"><span class="pre">roi</span></code>.
Yields partial results after each merge operation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – The dataset to work on</p></li>
<li><p><strong>udf</strong> – UDF instance you want to run, or a list of UDF instances</p></li>
<li><p><strong>roi</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a><em>, </em><em>sparse array</em><em> or </em><em>coordinate tuple</em><em>(</em><em>s</em><em>)</em><em>, </em><em>optional</em>) – Region of interest as bool mask over the navigation axes of the dataset.
See <a class="reference internal" href="../udf/basic.html#udf-roi"><span class="std std-ref">Regions of interest</span></a>.</p></li>
<li><p><strong>progress</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em> | </em><a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><em>ProgressReporter</em></a>) – Show progress bar. Toggle with boolean flag or supply instance of
<a class="reference internal" href="progress.html#libertem.common.progress.ProgressReporter" title="libertem.common.progress.ProgressReporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.common.progress.ProgressReporter</span></code></a> for custom
handling of progress display.</p></li>
<li><p><strong>corrections</strong> – Corrections to apply while running the UDF. If none are given,
the corrections that are part of the <code class="code docutils literal notranslate"><span class="pre">DataSet</span></code> are used,
if there are any. See also <a class="reference internal" href="corrections.html#corrections"><span class="std std-ref">Corrections</span></a>.</p></li>
<li><p><strong>backends</strong> (<em>None</em><em> or </em><em>iterable containing 'numpy'</em><em>, </em><em>'cupy' and/or 'cuda'</em>) – Restrict the back-end to a subset of the capabilities of the UDF.
This can be useful for testing hybrid UDFs.</p></li>
<li><p><strong>plots</strong> (<em>None</em><em> or </em><em>True</em><em> or </em><em>List</em><em>[</em><em>List</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>Callable</em><em>]</em><em>]</em><em>]</em><em>] or </em><em>List</em><em>[</em><em>LivePlot</em><em>]</em>) – <ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">None</span></code>: don’t plot anything (default)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">True</span></code>: plot all 2D UDF result buffers</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">List[List[...]]</span></code>: plot the named UDF buffers. Pass a list of names or
(name, callable) tuples for each UDF you want to plot. If the callable is specified,
it is applied to the UDF buffer before plotting.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">List[LivePlot]</span></code>: <code class="xref py py-class docutils literal notranslate"><span class="pre">LivePlot</span></code> instance for each
channel you want to plot</p></li>
</ul>
</p></li>
<li><p><strong>sync</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – By default, <cite>run_udf_iter</cite> is a synchronous method. If <cite>sync</cite> is set to <cite>False</cite>,
an async generator will be returned instead.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Generator of <a class="reference internal" href="#libertem.udf.base.UDFResults" title="libertem.udf.base.UDFResults"><code class="xref py py-class docutils literal notranslate"><span class="pre">UDFResults</span></code></a> container objects.
Their attribute <code class="code docutils literal notranslate"><span class="pre">buffers</span></code> is the list of result buffer dictionaries for the UDFs.
Attribute <code class="code docutils literal notranslate"><span class="pre">damage</span></code> is a <a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferWrapper</span></code></a>
of <code class="code docutils literal notranslate"><span class="pre">kind='nav'</span></code>, <code class="code docutils literal notranslate"><span class="pre">dtype=bool</span></code> indicating the positions
in nav space that have been processed already.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Generator[<a class="reference internal" href="#libertem.udf.base.UDFResults" title="libertem.udf.base.UDFResults">UDFResults</a>]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run the <a class="reference internal" href="#libertem.udf.sum.SumUDF" title="libertem.udf.sum.SumUDF"><code class="xref py py-class docutils literal notranslate"><span class="pre">SumUDF</span></code></a> on a data set:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">libertem.udf.sum</span> <span class="kn">import</span> <span class="n">SumUDF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf_iter</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">SumUDF</span><span class="p">()):</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(32, 32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># intensity is the name of the result buffer, defined in the SumUDF</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<p>Result type for UDF result iterators:</p>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.UDFResults">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">UDFResults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Mapping" title="(in Python v3.10)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">damage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><span class="pre">BufferWrapper</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#UDFResults"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.UDFResults" title="Permalink to this definition"></a></dt>
<dd><p>Container class to combine UDF results with additional information.</p>
<p>This class allows to return additional information from UDF execution
together with UDF result buffers. This is currently used to pass
“damage” information when running UDFs as an iterator using
<a class="reference internal" href="api.html#libertem.api.Context.run_udf_iter" title="libertem.api.Context.run_udf_iter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">libertem.api.Context.run_udf_iter()</span></code></a>. “Damage” is
a map of the nav space that is set to <code class="code docutils literal notranslate"><span class="pre">True</span></code>
for all positions that have already been processed.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buffers</strong> – Iterable containing the result buffer dictionaries for each of the UDFs being executed</p></li>
<li><p><strong>damage</strong> (<a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><em>BufferWrapper</em></a>) – <a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">libertem.common.buffers.BufferWrapper</span></code></a> of <code class="code docutils literal notranslate"><span class="pre">kind='nav'</span></code>, <code class="code docutils literal notranslate"><span class="pre">dtype=bool</span></code>.
It is set to <code class="code docutils literal notranslate"><span class="pre">True</span></code> for all positions in nav space that have been processed already.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="buffers">
<span id="buffer-udf-ref"></span><h2>Buffers<a class="headerlink" href="#buffers" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferWrapper</span></code></a> objects are used to manage data in the context of user-defined functions.</p>
<span class="target" id="module-libertem.common.buffers"></span><dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.AuxBufferWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">AuxBufferWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float32'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#AuxBufferWrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.AuxBufferWrapper" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.AuxBufferWrapper.get_view_for_dataset">
<span class="sig-name descname"><span class="pre">get_view_for_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#AuxBufferWrapper.get_view_for_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.AuxBufferWrapper.get_view_for_dataset" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.AuxBufferWrapper.new_for_partition">
<span class="sig-name descname"><span class="pre">new_for_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#AuxBufferWrapper.new_for_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.AuxBufferWrapper.new_for_partition" title="Permalink to this definition"></a></dt>
<dd><p>Return a new AuxBufferWrapper for a specific partition,
slicing the data accordingly and reducing it to the selected roi.</p>
<p>This assumes to be called on an AuxBufferWrapper that was not created
by this method, that is, it should have global coordinates without
having the ROI applied.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.AuxBufferWrapper.set_buffer">
<span class="sig-name descname"><span class="pre">set_buffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_global</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#AuxBufferWrapper.set_buffer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.AuxBufferWrapper.set_buffer" title="Permalink to this definition"></a></dt>
<dd><p>Set the underlying buffer to an existing numpy array.</p>
<p>If is_global is True, the shape must match with the shape of nav or sig
of the dataset, plus extra_shape, as determined by the <cite>kind</cite> and
<cite>extra_shape</cite> constructor arguments.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">BufferPool</span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool" title="Permalink to this definition"></a></dt>
<dd><p>allocation pool for explicitly re-using (aligned) allocations</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool.bytes">
<span class="sig-name descname"><span class="pre">bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool.bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool.bytes" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool.checkin_bytes">
<span class="sig-name descname"><span class="pre">checkin_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool.checkin_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool.checkin_bytes" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool.checkout_bytes">
<span class="sig-name descname"><span class="pre">checkout_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool.checkout_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool.checkout_bytes" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool.empty">
<span class="sig-name descname"><span class="pre">empty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool.empty"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool.empty" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferPool.zeros">
<span class="sig-name descname"><span class="pre">zeros</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferPool.zeros"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferPool.zeros" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">BufferWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float32'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper" title="Permalink to this definition"></a></dt>
<dd><p>Helper class to automatically allocate buffers, either for partitions or
the whole dataset, and create views for partitions or single frames.</p>
<p>This is used as a helper to allow easy merging of results without needing
to manually handle indexing.</p>
<p>Usually, as a user, you only need to instantiate this class, specifying <cite>kind</cite>,
<cite>dtype</cite> and sometimes <cite>extra_shape</cite> parameters. Most methods are meant to be called
from LiberTEM-internal code, for example the UDF functionality.</p>
<p>This class is array_like, so you can directly use it, for example, as argument
for numpy functions.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Add option to specify backend, for example CuPy</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> (<em>&quot;nav&quot;</em><em>, </em><em>&quot;sig&quot;</em><em> or </em><em>&quot;single&quot;</em>) – The abstract shape of the buffer, corresponding either to the navigation
or the signal dimensions of the dataset, or a single value.</p></li>
<li><p><strong>extra_shape</strong> (<em>optional</em><em>, </em><em>tuple of int</em><em> or </em><em>a Shape object</em>) – You can specify additional dimensions for your data. For example, if
you want to store 2D coords, you would specify (2,) here.
For a Shape object, sig_dims is discarded and the entire shape is used.</p></li>
<li><p><strong>dtype</strong> (<em>string</em><em> or </em><em>numpy dtype</em>) – The dtype of this buffer</p></li>
<li><p><strong>where</strong> (<em>string</em><em> or </em><em>None</em>) – <p><code class="code docutils literal notranslate"><span class="pre">None</span></code> means NumPy array, <code class="code docutils literal notranslate"><span class="pre">device</span></code> to use a back-end specified
in <a class="reference internal" href="#libertem.common.buffers.BufferWrapper.allocate" title="libertem.common.buffers.BufferWrapper.allocate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">allocate()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</p></li>
<li><p><strong>use</strong> (<em>&quot;private&quot;</em><em>, </em><em>&quot;result_only&quot;</em><em> or </em><em>None</em>) – <p>If you specify <code class="code docutils literal notranslate"><span class="pre">&quot;private&quot;</span></code> here, the result will only be made available
to internal functions, like <code class="xref py py-meth docutils literal notranslate"><span class="pre">process_frame()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code> or
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get_results()</span></code>. It will not be available to the user of the UDF, which means
you can use this to hide implementation details that are likely to change later.</p>
<p>Specify <code class="code docutils literal notranslate"><span class="pre">&quot;result_only&quot;</span></code> here if the buffer is only used in <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_results()</span></code>,
this means we don’t have to allocate and return it on the workers without actually
needing it.</p>
<p><code class="code docutils literal notranslate"><span class="pre">None</span></code> means the buffer is used both as a final and intermediate result.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.add_partitions">
<span class="sig-name descname"><span class="pre">add_partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partitions</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.add_partitions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.add_partitions" title="Permalink to this definition"></a></dt>
<dd><p>Add a list of dataset partitions to the buffer such that
self.allocate() can make use of the structure</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.allocate">
<span class="sig-name descname"><span class="pre">allocate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lib</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.allocate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.allocate" title="Permalink to this definition"></a></dt>
<dd><p>Allocate a new buffer, in the shape previously set
via one of the <cite>set_shape_*</cite> methods.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Support for allocating on device</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.data" title="Permalink to this definition"></a></dt>
<dd><p>Get the buffer contents in shape that corresponds to the
original dataset shape. If a ROI is set, embed the result into a new
array; unset values have NaN value for floating point types,
False for boolean, 0 for integer types and structs,
‘’ for string types and None for objects.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7.0: </span>Better initialization values for dtypes other than floating point.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.dtype">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dtype</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.dtype" title="Permalink to this definition"></a></dt>
<dd><p>Get the declared dtype of this buffer.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.export">
<span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.export" title="Permalink to this definition"></a></dt>
<dd><p>Convert device array to NumPy array for pickling and merging</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.extra_shape">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">extra_shape</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.extra_shape" title="Permalink to this definition"></a></dt>
<dd><p>Get the <code class="code docutils literal notranslate"><span class="pre">extra_shape</span></code> of this buffer.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.flush">
<span class="sig-name descname"><span class="pre">flush</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.flush"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.flush" title="Permalink to this definition"></a></dt>
<dd><p>Write back any cached contiguous copies</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.get_contiguous_view_for_tile">
<span class="sig-name descname"><span class="pre">get_contiguous_view_for_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.get_contiguous_view_for_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.get_contiguous_view_for_tile" title="Permalink to this definition"></a></dt>
<dd><p>Make a cached contiguous copy of the view for a single tile
if necessary.</p>
<p>Currently this is only necessary for <code class="code docutils literal notranslate"><span class="pre">kind=&quot;sig&quot;</span></code> buffers.
Use <a class="reference internal" href="#libertem.common.buffers.BufferWrapper.flush" title="libertem.common.buffers.BufferWrapper.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code></a> to write back the cache.</p>
<p>Boundary condition: <code class="code docutils literal notranslate"><span class="pre">tile.tile_slice.get(sig_only=True)</span></code>
does not overlap for different tiles while the cache is active,
i.e. the tiles follow LiberTEM slicing for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">libertem.udf.base.UDFTileMixing.process_tile()</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>view</strong> – View into data or contiguous copy if necessary</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.get_view_for_dataset">
<span class="sig-name descname"><span class="pre">get_view_for_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.get_view_for_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.get_view_for_dataset" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.get_view_for_frame">
<span class="sig-name descname"><span class="pre">get_view_for_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame_idx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.get_view_for_frame"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.get_view_for_frame" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single frame in a partition- or dataset-sized buffer
(partition-sized here means the reduced result for a whole partition,
not the partition itself!)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.get_view_for_partition">
<span class="sig-name descname"><span class="pre">get_view_for_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.get_view_for_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.get_view_for_partition" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single partition in a whole-result-sized buffer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.get_view_for_tile">
<span class="sig-name descname"><span class="pre">get_view_for_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.get_view_for_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.get_view_for_tile" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single tile in a partition-sized buffer
(partition-sized here means the reduced result for a whole partition,
not the partition itself!)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.has_data">
<span class="sig-name descname"><span class="pre">has_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.has_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.has_data" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.kind">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">kind</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.kind" title="Permalink to this definition"></a></dt>
<dd><p>Get the kind of this buffer.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.raw_data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">raw_data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="(in Python v3.10)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.raw_data" title="Permalink to this definition"></a></dt>
<dd><p>Get the raw data underlying this buffer, which is flattened and
may be even filtered to a ROI</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.replace_array">
<span class="sig-name descname"><span class="pre">replace_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.ArrayLike</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a></span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.replace_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.replace_array" title="Permalink to this definition"></a></dt>
<dd><p>Set the data backing the BufferWrapper even if the BufferWrapper
already has self._data allocated</p>
<p>data should be any array-like object</p>
<p>Will perform checking for shape and dtype.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.result_buffer_type">
<span class="sig-name descname"><span class="pre">result_buffer_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.result_buffer_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.result_buffer_type" title="Permalink to this definition"></a></dt>
<dd><p>Define the type of Buffer used to return final UDF results</p>
<p>More specialised buffers can override this</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.roi_is_zero">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">roi_is_zero</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.roi_is_zero" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.set_roi">
<span class="sig-name descname"><span class="pre">set_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roi</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.set_roi"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.set_roi" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.set_shape_ds">
<span class="sig-name descname"><span class="pre">set_shape_ds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.set_shape_ds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.set_shape_ds" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.set_shape_partition">
<span class="sig-name descname"><span class="pre">set_shape_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#BufferWrapper.set_shape_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.set_shape_partition" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.shape">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.shape" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.BufferWrapper.where">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">where</span></span><a class="headerlink" href="#libertem.common.buffers.BufferWrapper.where" title="Permalink to this definition"></a></dt>
<dd><p>Get the place where this buffer is to be allocated.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.ManagedBuffer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">ManagedBuffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alignment</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#ManagedBuffer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.ManagedBuffer" title="Permalink to this definition"></a></dt>
<dd><p>Allocate <cite>size</cite> bytes from <cite>pool</cite>, and return them to the pool once we are GC’d</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">PlaceholderBufferWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float32'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper" title="Permalink to this definition"></a></dt>
<dd><p>A declaration-only version of <code class="code docutils literal notranslate"><span class="pre">BufferWrapper</span></code> that doesn’t
actually allocate a buffer. Meant as a placeholder for results
that are only materialized in <code class="code docutils literal notranslate"><span class="pre">UDF.get_results</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.allocate">
<span class="sig-name descname"><span class="pre">allocate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lib</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.allocate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.allocate" title="Permalink to this definition"></a></dt>
<dd><p>Allocate a new buffer, in the shape previously set
via one of the <cite>set_shape_*</cite> methods.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6.0: </span>Support for allocating on device</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.data" title="Permalink to this definition"></a></dt>
<dd><p>Get the buffer contents in shape that corresponds to the
original dataset shape. If a ROI is set, embed the result into a new
array; unset values have NaN value for floating point types,
False for boolean, 0 for integer types and structs,
‘’ for string types and None for objects.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7.0: </span>Better initialization values for dtypes other than floating point.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.export">
<span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.export"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.export" title="Permalink to this definition"></a></dt>
<dd><p>Convert device array to NumPy array for pickling and merging</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.get_contiguous_view_for_tile">
<span class="sig-name descname"><span class="pre">get_contiguous_view_for_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.get_contiguous_view_for_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.get_contiguous_view_for_tile" title="Permalink to this definition"></a></dt>
<dd><p>Make a cached contiguous copy of the view for a single tile
if necessary.</p>
<p>Currently this is only necessary for <code class="code docutils literal notranslate"><span class="pre">kind=&quot;sig&quot;</span></code> buffers.
Use <code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code> to write back the cache.</p>
<p>Boundary condition: <code class="code docutils literal notranslate"><span class="pre">tile.tile_slice.get(sig_only=True)</span></code>
does not overlap for different tiles while the cache is active,
i.e. the tiles follow LiberTEM slicing for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">libertem.udf.base.UDFTileMixing.process_tile()</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>view</strong> – View into data or contiguous copy if necessary</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_frame">
<span class="sig-name descname"><span class="pre">get_view_for_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame_idx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.get_view_for_frame"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_frame" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single frame in a partition- or dataset-sized buffer
(partition-sized here means the reduced result for a whole partition,
not the partition itself!)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_partition">
<span class="sig-name descname"><span class="pre">get_view_for_partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.get_view_for_partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_partition" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single partition in a whole-result-sized buffer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_tile">
<span class="sig-name descname"><span class="pre">get_view_for_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.get_view_for_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.get_view_for_tile" title="Permalink to this definition"></a></dt>
<dd><p>get a view for a single tile in a partition-sized buffer
(partition-sized here means the reduced result for a whole partition,
not the partition itself!)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.has_data">
<span class="sig-name descname"><span class="pre">has_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PlaceholderBufferWrapper.has_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.has_data" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="libertem.common.buffers.PlaceholderBufferWrapper.raw_data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">raw_data</span></span><a class="headerlink" href="#libertem.common.buffers.PlaceholderBufferWrapper.raw_data" title="Permalink to this definition"></a></dt>
<dd><p>Get the raw data underlying this buffer, which is flattened and
may be even filtered to a ROI</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="libertem.common.buffers.PreallocBufferWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">PreallocBufferWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#PreallocBufferWrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.PreallocBufferWrapper" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.bytes_aligned">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">bytes_aligned</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#memoryview" title="(in Python v3.10)"><span class="pre">memoryview</span></a></span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#bytes_aligned"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.bytes_aligned" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.disjoint">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">disjoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">slices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Iterable" title="(in Python v3.10)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="internals.html#libertem.common.slice.Slice" title="libertem.common.slice.Slice"><span class="pre">Slice</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#disjoint"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.disjoint" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.empty_aligned">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">empty_aligned</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.DTypeLike</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#empty_aligned"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.empty_aligned" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.reshaped_view">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">reshaped_view</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/common/buffers.html#reshaped_view"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.reshaped_view" title="Permalink to this definition"></a></dt>
<dd><p>Like <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.reshape.html#numpy.ndarray.reshape" title="(in NumPy v1.24)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.ndarray.reshape()</span></code></a>, just guaranteed to
return a view or throw an <a class="reference external" href="https://docs.python.org/3.10/library/exceptions.html#AttributeError" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeError</span></code></a> if
no view can be created.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a>) – Array to create a view of</p></li>
<li><p><strong>shape</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#tuple" title="(in Python v3.10)"><em>tuple</em></a>) – Shape of the view to create</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>view</strong> – View into <code class="code docutils literal notranslate"><span class="pre">a</span></code> with shape <code class="code docutils literal notranslate"><span class="pre">shape</span></code></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.to_numpy">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">to_numpy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#to_numpy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.to_numpy" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.common.buffers.zeros_aligned">
<span class="sig-prename descclassname"><span class="pre">libertem.common.buffers.</span></span><span class="sig-name descname"><span class="pre">zeros_aligned</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="(in Python v3.10)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nt.DTypeLike</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="../_modules/libertem/common/buffers.html#zeros_aligned"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.common.buffers.zeros_aligned" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="included-utility-udfs">
<span id="utilify-udfs"></span><h2>Included utility UDFs<a class="headerlink" href="#included-utility-udfs" title="Permalink to this heading"></a></h2>
<p>Some generally useful UDFs are included with LiberTEM:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="application.html#application-api"><span class="std std-ref">Application-specific APIs</span></a> for application-specific UDFs and analyses.</p>
</div>
<section id="sum-of-frames">
<span id="sum-udf"></span><h3>Sum of frames<a class="headerlink" href="#sum-of-frames" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.sum.SumUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.sum.</span></span><span class="sig-name descname"><span class="pre">SumUDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float32'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/sum.html#SumUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.sum.SumUDF" title="Permalink to this definition"></a></dt>
<dd><p>Sum up frames, preserving the signal dimension</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dtype</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)"><em>numpy.dtype</em></a><em>, </em><em>optional</em>) – Preferred dtype for computation, default ‘float32’. The actual dtype will be determined
from this value and the dataset’s dtype using <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.result_type()</span></code>.
See also <a class="reference internal" href="../udf/advanced.html#udf-dtype"><span class="std std-ref">Preferred input dtype</span></a>.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">SumUDF</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(32, 32)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="sum-of-log-scaled-frames">
<span id="logsum-udf"></span><h3>Sum of log-scaled frames<a class="headerlink" href="#sum-of-log-scaled-frames" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.logsum.LogsumUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.logsum.</span></span><span class="sig-name descname"><span class="pre">LogsumUDF</span></span><a class="reference internal" href="../_modules/libertem/udf/logsum.html#LogsumUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.logsum.LogsumUDF" title="Permalink to this definition"></a></dt>
<dd><p>Sum up logscaled frames</p>
<p>In comparison to log-scaling the sum, this highlights regions with slightly higher
intensity that appear in many frames in relation to very high intensity in a few frames.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">LogsumUDF</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;logsum&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(32, 32)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.logsum.LogsumUDF.get_backends">
<span class="sig-name descname"><span class="pre">get_backends</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/logsum.html#LogsumUDF.get_backends"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.logsum.LogsumUDF.get_backends" title="Permalink to this definition"></a></dt>
<dd><p>Signal which computation back-ends the UDF can use.</p>
<p>Allowed are values in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a>.
<code class="code docutils literal notranslate"><span class="pre">(UDF.BACKEND_NUMPY,</span> <span class="pre">)</span></code> is returned by default for CPU-based computation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11.0: </span>Extended from just NumPy vs. CuPy to include more generic specification of backends,
including sparse arrays. See <a class="reference internal" href="../udf/advanced.html#sparse"><span class="std std-ref">Sparse arrays</span></a> for details! The backend specifications are
backwards-compatible with the previously supported values.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A single value or iterable containing values from the supported backends
in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>backends</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="standard-deviation">
<span id="stddev-udf"></span><h3>Standard deviation<a class="headerlink" href="#standard-deviation" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.stddev.StdDevUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.stddev.</span></span><span class="sig-name descname"><span class="pre">StdDevUDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_numba</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/stddev.html#StdDevUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.stddev.StdDevUDF" title="Permalink to this definition"></a></dt>
<dd><p>Compute sum of variances and sum of pixels from the given dataset</p>
<p>The one-pass algorithm used in this code is taken from the following
paper: <span id="id1">[<a class="reference internal" href="../index.html#id111" title="Erich Schubert and Michael Gertz. Numerically stable parallel computation of (co-)variance. In Proceedings of the 30th International Conference on Scientific and Statistical Database Management - SSDBM 18. ACM Press, 2018. doi:10.1145/3221269.3223036.">SG18</a>]</span>.</p>
<dl class="simple">
<dt>..versionchanged:: 0.5.0</dt><dd><p>Result buffers have been renamed</p>
</dd>
<dt>..versionchanged:: 0.7.0</dt><dd><p><code class="code docutils literal notranslate"><span class="pre">var</span></code>, <code class="code docutils literal notranslate"><span class="pre">mean</span></code>, and <code class="code docutils literal notranslate"><span class="pre">std</span></code> are now returned directly
from the UDF via <code class="code docutils literal notranslate"><span class="pre">get_results</span></code>.</p>
</dd>
<dt>..versionchanged:: 0.11</dt><dd><p>added dtype and use_numba parameters, added support for sparse input.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dtype</strong> – Base dtype to determine numerical precision.</p></li>
<li><p><strong>use_numba</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Use the Numba-accelerated version if input array format and backend allow.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">StdDevUDF</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;varsum&quot;</span><span class="p">])</span>        <span class="c1"># variance times number of frames</span>
<span class="go">array(...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">])</span>  <span class="c1"># number of frames for each tile</span>
<span class="go">array(...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">])</span>  <span class="c1"># sum of all frames</span>
<span class="go">array(...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">])</span>
<span class="go">array(...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>
<span class="go">array(...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">])</span>
<span class="go">array(...)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.stddev.StdDevUDF.get_backends">
<span class="sig-name descname"><span class="pre">get_backends</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/stddev.html#StdDevUDF.get_backends"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.stddev.StdDevUDF.get_backends" title="Permalink to this definition"></a></dt>
<dd><p>Signal which computation back-ends the UDF can use.</p>
<p>Allowed are values in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a>.
<code class="code docutils literal notranslate"><span class="pre">(UDF.BACKEND_NUMPY,</span> <span class="pre">)</span></code> is returned by default for CPU-based computation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11.0: </span>Extended from just NumPy vs. CuPy to include more generic specification of backends,
including sparse arrays. See <a class="reference internal" href="../udf/advanced.html#sparse"><span class="std std-ref">Sparse arrays</span></a> for details! The backend specifications are
backwards-compatible with the previously supported values.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A single value or iterable containing values from the supported backends
in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>backends</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.stddev.StdDevUDF.get_task_data">
<span class="sig-name descname"><span class="pre">get_task_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/stddev.html#StdDevUDF.get_task_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.stddev.StdDevUDF.get_task_data" title="Permalink to this definition"></a></dt>
<dd><p>Initialize per-task data.</p>
<p>Per-task data can be mutable. Override this function
to allocate temporary buffers, or to initialize
system resources.</p>
<p>If you want to distribute static data, use
parameters instead.</p>
<p>Data available in this method:</p>
<ul class="simple">
<li><p><cite>self.params</cite> - the input parameters of this UDF</p></li>
<li><p><cite>self.meta</cite> - relevant metadata, see <code class="xref py py-class docutils literal notranslate"><span class="pre">UDFMeta</span></code> documentation.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Flat dict with string keys. Keys should
be valid python identifiers, which allows
access via <cite>self.task_data.the_key_here</cite>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.udf.stddev.run_stddev">
<span class="sig-prename descclassname"><span class="pre">libertem.udf.stddev.</span></span><span class="sig-name descname"><span class="pre">run_stddev</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_numba</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/stddev.html#run_stddev"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.stddev.run_stddev" title="Permalink to this definition"></a></dt>
<dd><p>Compute sum of variances and sum of pixels from the given dataset</p>
<p>One-pass algorithm used in this code is taken from the following paper:
<span id="id2">[<a class="reference internal" href="../index.html#id111" title="Erich Schubert and Michael Gertz. Numerically stable parallel computation of (co-)variance. In Proceedings of the 30th International Conference on Scientific and Statistical Database Management - SSDBM 18. ACM Press, 2018. doi:10.1145/3221269.3223036.">SG18</a>]</span>.</p>
<dl class="simple">
<dt>..versionchanged:: 0.5.0</dt><dd><p>Result buffers have been renamed</p>
</dd>
<dt>..versionchanged:: 0.5.0</dt><dd><p>Added <code class="code docutils literal notranslate"><span class="pre">progress</span></code> parameter for progress bar</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> (<a class="reference internal" href="api.html#libertem.api.Context" title="libertem.api.Context"><em>libertem.api.Context</em></a>) – </p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="dataset.html#libertem.io.dataset.base.DataSet" title="libertem.io.dataset.base.DataSet"><em>libertem.io.dataset.base.DataSet</em></a>) – dataset to work on</p></li>
<li><p><strong>roi</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>numpy.ndarray</em></a>) – Region of interest, see <a class="reference internal" href="../udf/basic.html#udf-roi"><span class="std std-ref">Regions of interest</span></a> for more information.</p></li>
<li><p><strong>progress</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – Show progress bar. Default is <code class="code docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>use_numba</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – Use the Numba backend if available, otherwise use ndarray based implementation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>pass_results</em> – A dictionary of narrays that contains sum of variances, sum of pixels,
and number of frames used to compute the above statistic</p></li>
<li><p><em>To retrieve statistic, using the following commands</em></p></li>
<li><p><strong>variance</strong> (<code class="code docutils literal notranslate"><span class="pre">pass_results['var']</span></code>)</p></li>
<li><p><strong>standard deviation</strong> (<code class="code docutils literal notranslate"><span class="pre">pass_results['std']</span></code>)</p></li>
<li><p><strong>sum of pixels</strong> (<code class="code docutils literal notranslate"><span class="pre">pass_results['sum']</span></code>)</p></li>
<li><p><strong>mean</strong> (<code class="code docutils literal notranslate"><span class="pre">pass_results['mean']</span></code>)</p></li>
<li><p><strong>number of frames</strong> (<code class="code docutils literal notranslate"><span class="pre">pass_results['num_frames']</span></code>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="libertem.udf.stddev.consolidate_result">
<span class="sig-prename descclassname"><span class="pre">libertem.udf.stddev.</span></span><span class="sig-name descname"><span class="pre">consolidate_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">udf_result</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/stddev.html#consolidate_result"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.stddev.consolidate_result" title="Permalink to this definition"></a></dt>
<dd><p>Calculate variance, mean and standard deviation
from raw UDF results and consolidate the per-tile frame counter
into a single value. Convert all result arrays to <cite>ndarray</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is mostly here for backwards-compatability - nowadays, ‘var’, ‘std’,
and ‘mean’ are already calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">StdDevUDF.get_results()</span></code>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>udf_result</strong> (<em>Dict</em><em>[</em><a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><a class="reference internal" href="#libertem.common.buffers.BufferWrapper" title="libertem.common.buffers.BufferWrapper"><em>BufferWrapper</em></a><em>]</em>) – UDF result with keys ‘sum’, ‘varsum’, ‘num_frames’, ‘var’, ‘std’, ‘mean’</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>pass_results</strong> – Result dictionary with keys <code class="code docutils literal notranslate"><span class="pre">'sum',</span> <span class="pre">'varsum',</span> <span class="pre">'var',</span> <span class="pre">'std',</span> <span class="pre">'mean'</span></code> as
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>, and <code class="code docutils literal notranslate"><span class="pre">'num_frames'</span></code> as <code class="code docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[<a class="reference external" href="https://docs.python.org/3.10/library/stdtypes.html#str" title="(in Python v3.10)">str</a>, Union[<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>, <a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)">int</a>]]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="sum-per-frame">
<span id="sumsig-udf"></span><h3>Sum per frame<a class="headerlink" href="#sum-per-frame" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.sumsigudf.SumSigUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.sumsigudf.</span></span><span class="sig-name descname"><span class="pre">SumSigUDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Union" title="(in Python v3.10)"><span class="pre">Union</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="(in Python v3.10)"><span class="pre">Any</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#libertem.common.buffers.AuxBufferWrapper" title="libertem.common.buffers.AuxBufferWrapper"><span class="pre">AuxBufferWrapper</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/sumsigudf.html#SumSigUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.sumsigudf.SumSigUDF" title="Permalink to this definition"></a></dt>
<dd><p>Sum over the signal axes. For each navigation position, the sum of all pixels is calculated.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">SumSigUDF</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(16, 16)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.sumsigudf.SumSigUDF.get_backends">
<span class="sig-name descname"><span class="pre">get_backends</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/sumsigudf.html#SumSigUDF.get_backends"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.sumsigudf.SumSigUDF.get_backends" title="Permalink to this definition"></a></dt>
<dd><p>Signal which computation back-ends the UDF can use.</p>
<p>Allowed are values in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a>.
<code class="code docutils literal notranslate"><span class="pre">(UDF.BACKEND_NUMPY,</span> <span class="pre">)</span></code> is returned by default for CPU-based computation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.0.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11.0: </span>Extended from just NumPy vs. CuPy to include more generic specification of backends,
including sparse arrays. See <a class="reference internal" href="../udf/advanced.html#sparse"><span class="std std-ref">Sparse arrays</span></a> for details! The backend specifications are
backwards-compatible with the previously supported values.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A single value or iterable containing values from the supported backends
in <a class="reference internal" href="#libertem.udf.base.UDF.BACKEND_ALL" title="libertem.udf.base.UDF.BACKEND_ALL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">libertem.udf.base.UDF.BACKEND_ALL</span></code></a></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>backends</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="apply-masks">
<span id="masks-udf"></span><h3>Apply masks<a class="headerlink" href="#apply-masks" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.masks.ApplyMasksUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.masks.</span></span><span class="sig-name descname"><span class="pre">ApplyMasksUDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask_factories</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_torch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_sparse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preferred_dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backends</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/masks.html#ApplyMasksUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.masks.ApplyMasksUDF" title="Permalink to this definition"></a></dt>
<dd><p>Apply masks to signals/frames in the dataset. This can not only be used to integrate
over regions with a binary mask - the integration can be weighted by using
float or complex valued masks.</p>
<p>The result will be returned in a single sig-shaped buffer called intensity.
Its shape will be <code class="code docutils literal notranslate"><span class="pre">(*nav_shape,</span> <span class="pre">len(masks))</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask_factories</strong> (<em>Union</em><em>[</em><em>Callable</em><em>[</em><em>[</em><em>]</em><em>, </em><em>array_like</em><em>]</em><em>, </em><em>Iterable</em><em>[</em><em>Callable</em><em>[</em><em>[</em><em>]</em><em>, </em><em>array_like</em><em>]</em><em>]</em><em>]</em>) – Function or list of functions that take no arguments and create masks. The returned
masks can be
numpy arrays, scipy.sparse or sparse <a class="reference external" href="https://sparse.pydata.org/">https://sparse.pydata.org/</a> matrices. The mask
factories should not reference large objects because they can create significant
overheads when they are pickled and unpickled. Each factory function should, when
called, return a numpy array with the same shape as frames in the dataset
(so dataset.shape.sig).</p></li>
<li><p><strong>use_torch</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – Use pytorch back-end if available. Default True</p></li>
<li><p><strong>use_sparse</strong> (<em>Union</em><em>[</em><em>None</em><em>, </em><em>False</em><em>, </em><em>True</em><em>, </em><em>'scipy.sparse'</em><em>, </em><em>'scipy.sparse.csc'</em><em>,             </em><em>'sparse.pydata'</em><em>]</em><em>, </em><em>optional</em>) – Which sparse back-end to use.
* None (default): Use sparse matrix multiplication if all factory functions return a             sparse mask, otherwise convert all masks to dense matrices and use dense matrix             multiplication
* True: Convert all masks to sparse matrices and use default sparse back-end.
* False: Convert all masks to dense matrices.
* ‘scipy.sparse’: Use scipy.sparse.csr_matrix (default sparse)
* ‘scipy.sparse.csc’: Use scipy.sparse.csc_matrix
* ‘sparse.pydata’: Use sparse.pydata COO matrix</p></li>
<li><p><strong>mask_count</strong> (<a class="reference external" href="https://docs.python.org/3.10/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a><em>, </em><em>optional</em>) – Specify the number of masks if a single factory function is used so that the
number of masks can be determined without calling the factory function.</p></li>
<li><p><strong>mask_dtype</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)"><em>numpy.dtype</em></a><em>, </em><em>optional</em>) – Specify the dtype of the masks so that mask dtype
can be determined without calling the mask factory functions. This can be used to
override the mask dtype in the result dtype determination. As an example, setting
this to np.float32 means that masks of type float64 will not switch the calculation
and result dtype to float64 or complex128.</p></li>
<li><p><strong>preferred_dtype</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)"><em>numpy.dtype</em></a><em>, </em><em>optional</em>) – Let <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_preferred_input_dtype()</span></code> return the specified type instead of the
default <cite>float32</cite>. This can perform the calculation with integer types if both input
data and mask data are compatible with this.</p></li>
<li><p><strong>backends</strong> (<em>Iterable containing strings &quot;numpy&quot; and/or &quot;cupy&quot;</em><em>, or </em><em>None</em>) – Control which back-ends are used. Default is numpy and cupy</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(16, 16, 32, 32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_masks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">ApplyMasksUDF</span><span class="p">(</span><span class="n">mask_factories</span><span class="o">=</span><span class="n">my_masks</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(16, 16, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># same order as in the mask factory</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Mask factories can also return all masks as a single array, stacked on the first axis:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_masks_2</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">masks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">masks</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">masks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">ApplyMasksUDF</span><span class="p">(</span><span class="n">mask_factories</span><span class="o">=</span><span class="n">my_masks_2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res_2</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">)[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">res_2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.0.</span></p>
</div>
</dd></dl>

</section>
<section id="load-data">
<span id="pick-udf"></span><h3>Load data<a class="headerlink" href="#load-data" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.raw.PickUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.raw.</span></span><span class="sig-name descname"><span class="pre">PickUDF</span></span><a class="reference internal" href="../_modules/libertem/udf/raw.html#PickUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.raw.PickUDF" title="Permalink to this definition"></a></dt>
<dd><p>Load raw data from ROI</p>
<p>This UDF is meant for frame picking with a very small ROI, usually a single frame.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.0.</span></p>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">udf</span> <span class="o">=</span> <span class="n">PickUDF</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nav</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run_udf</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">udf</span><span class="o">=</span><span class="n">udf</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(32, 32)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="noop">
<h3>NoOp<a class="headerlink" href="#noop" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="libertem.udf.base.NoOpUDF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">libertem.udf.base.</span></span><span class="sig-name descname"><span class="pre">NoOpUDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">preferred_input_dtype=&lt;class</span> <span class="pre">'bool'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#NoOpUDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.NoOpUDF" title="Permalink to this definition"></a></dt>
<dd><p>A UDF that does nothing and returns nothing.</p>
<p>This is useful for testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>preferred_input_dtype</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.24)"><em>numpy.dtype</em></a>) – Perform dtype conversion. By default, this is <a class="reference internal" href="#libertem.udf.base.UDF.USE_NATIVE_DTYPE" title="libertem.udf.base.UDF.USE_NATIVE_DTYPE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UDF.USE_NATIVE_DTYPE</span></code></a>.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.NoOpUDF.get_preferred_input_dtype">
<span class="sig-name descname"><span class="pre">get_preferred_input_dtype</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#NoOpUDF.get_preferred_input_dtype"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.NoOpUDF.get_preferred_input_dtype" title="Permalink to this definition"></a></dt>
<dd><p>Return the value passed in the constructor.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.NoOpUDF.get_result_buffers">
<span class="sig-name descname"><span class="pre">get_result_buffers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#NoOpUDF.get_result_buffers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.NoOpUDF.get_result_buffers" title="Permalink to this definition"></a></dt>
<dd><p>No result buffers.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="libertem.udf.base.NoOpUDF.process_tile">
<span class="sig-name descname"><span class="pre">process_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/libertem/udf/base.html#NoOpUDF.process_tile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#libertem.udf.base.NoOpUDF.process_tile" title="Permalink to this definition"></a></dt>
<dd><p>Do nothing.</p>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="LiberTEM Context API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dataset.html" class="btn btn-neutral float-right" title="Data Set API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, LiberTEM Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>