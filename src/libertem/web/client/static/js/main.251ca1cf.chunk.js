(this["webpackJsonplibertem-client"]=this["webpackJsonplibertem-client"]||[]).push([[0],{238:function(e,t,n){e.exports={default:"ResultImage_default__1X7FO",fallback:"ResultImage_fallback__kO3cw"}},386:function(e,t,n){e.exports=n.p+"static/media/LiberTEM logo-medium.7999e0dc.png"},401:function(e,t,n){e.exports=n(704)},704:function(e,t,n){"use strict";n.r(t);n(402),n(414),n(424);var a,r=n(0),c=n.n(r),s=n(63),o=n(11),i=n(54),l=n(89),u=n(32),d=n(33),m=n(36),p=n(35),f=(n(485),n(718)),E=n(723),h=n(243);function b(e,t,n){return void 0===n&&void 0===t?{type:e}:void 0===n?{type:e,payload:t}:{type:e,payload:t,meta:n}}!function(e){e.NOT_CONNECTED="CLUSTER_NOT_CONNECTED",e.CONNECT="CLUSTER_CONNECT",e.CONNECTING="CLUSTER_CONNECTING",e.CONNECTED="CLUSTER_CONNECTED",e.ERROR="CLUSTER_ERROR"}(a||(a={}));var y={notConnected:function(){return b(a.NOT_CONNECTED)},connect:function(e){return b(a.CONNECT,{params:e})},connecting:function(){return b(a.CONNECTING)},connected:function(e){return b(a.CONNECTED,{params:e})},error:function(e,t,n){return b(a.ERROR,{msg:e,timestamp:t,id:n})}},g=n(170),v=n.n(g);function O(e){throw new Error(e)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return g.debounce(e,t,{maxWait:t})}function x(e){return Object.keys(e)}var C,_,A=n(27);!function(e){e.LOCAL="LOCAL",e.TCP="TCP"}(_||(_={}));var j,R,T,w=(C={},Object(A.a)(C,_.LOCAL,{label:"Create local cluster"}),Object(A.a)(C,_.TCP,{label:"Connect to cluster",helpText:"can be either local or remote, connection via TCP"}),C);!function(e){e.HDF5="HDF5",e.RAW="RAW",e.MIB="MIB",e.BLO="BLO",e.K2IS="K2IS",e.SER="SER",e.FRMS6="FRMS6",e.EMPAD="EMPAD",e.SEQ="SEQ",e.MRC="MRC"}(j||(j={})),function(e){e.OPEN="OPEN",e.OPENING="OPENING",e.DELETING="DELETING"}(R||(R={})),function(e){e.APPLY_RING_MASK="APPLY_RING_MASK",e.APPLY_DISK_MASK="APPLY_DISK_MASK",e.APPLY_POINT_SELECTOR="APPLY_POINT_SELECTOR",e.CENTER_OF_MASS="CENTER_OF_MASS",e.SUM_FRAMES="SUM_FRAMES",e.SD_FRAMES="SD_FRAMES",e.PICK_FRAME="PICK_FRAME",e.PICK_FFT_FRAME="PICK_FFT_FRAME",e.APPLY_FFT_MASK="APPLY_FFT_MASK",e.FFTSUM_FRAMES="FFTSUM_FRAMES",e.RADIAL_FOURIER="RADIAL_FOURIER",e.FEM="FEM",e.CLUST="CLUST",e.SUM_SIG="SUM_SIG"}(T||(T={}));var D,I=n(18),k=n(22),L=n(719),N=n(720),F=n(67),M=n(705),P=n(727),H=function(e){var t=e.config,n=e.name,a=e.value,c=e.setFieldValue,s=t.devices.cudas.map((function(e){return{key:e,value:e,text:"GPU ".concat(e)}})),o=t.devices.has_cupy,i=t.devices.cudas.length>0,l=!o||!i,u=!o&&i;return r.createElement(r.Fragment,null,u?r.createElement(P.a,{warning:!0,visible:!0},r.createElement(P.a.Header,null,"No cupy installation found"),r.createElement("p",null,"To make use of the built-in GPU support, make sure to install ",r.createElement("a",{href:"https://cupy.chainer.org/",rel:"noreferrer noopener",target:"_blank"},"cupy"))):"",r.createElement(E.a,{onChange:function(e,t){c(n,t.value)},disabled:l,placeholder:"Select CUDA devices",fluid:!0,multiple:!0,selection:!0,value:a,options:s}))},U=Object(k.c)({mapPropsToValues:function(e){return{numWorkers:e.config.localCores,cudas:[]}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(I.a)({type:_.LOCAL},e))}})((function(e){var t=e.config,n=e.values,a=e.touched,c=e.errors,s=(e.dirty,e.isSubmitting),o=e.handleChange,i=e.handleBlur,l=e.handleSubmit,u=e.setFieldValue;e.handleReset;return r.useEffect((function(){u("cudas",t.devices.cudas)}),[]),r.createElement(L.a,{onSubmit:l},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"numWorkers"},"Number of Workers:"),r.createElement("input",{type:"number",name:"numWorkers",value:n.numWorkers,onChange:o,onBlur:i}),c.numWorkers&&a.numWorkers&&c.numWorkers),r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"cudas"},"CUDA devices to use"," ",r.createElement(N.a,{trigger:r.createElement(F.a,{name:"info circle",link:!0})},r.createElement(N.a.Header,null,"CUDA information"),r.createElement(N.a.Content,null,r.createElement("p",null,"For some operations, LiberTEM can automatically make use of your graphics card, if it supports CUDA."),r.createElement("ul",null,r.createElement("li",null,"Number of CUDA devices found: ",t.devices.cudas.length),r.createElement("li",null,"cupy installation found:"," ",t.devices.has_cupy?"Yes":"No")),r.createElement("p",null,"cupy needs to be installed to make use of any CUDA devices on your system. Also, the matching cuda libraries and graphics drivers need to be installed. Please refer to"," ",r.createElement("a",{href:"https://docs-cupy.chainer.org/en/stable/install.html",target:"_blank",rel:"noopener noreferrer"},"the cupy documentation")," ","for more information.")))),r.createElement(H,{name:"cudas",value:n.cudas,config:t,setFieldValue:u})),r.createElement(M.a,{primary:!0,type:"submit",disabled:s},"Connect"))})),W=Object(k.c)({mapPropsToValues:function(e){return{address:e.config.lastConnection.address}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(I.a)({type:_.TCP},e))}})((function(e){var t=e.values,n=e.touched,a=e.errors,c=(e.dirty,e.isSubmitting),s=e.handleChange,o=e.handleBlur,i=e.handleSubmit;e.handleReset;return r.createElement(L.a,{onSubmit:i},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"address"},"Scheduler URI"),r.createElement("input",{type:"text",name:"address",value:t.address,onChange:s,onBlur:o}),a.address&&n.address&&a.address),r.createElement(M.a,{primary:!0,type:"submit",disabled:c},"Connect"))})),B={connectToCluster:y.connect},V=x(_).map((function(e){return{text:w[_[e]].label,value:_[e]}})),G=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={clusterType:e.props.lastConnectionType},e.setType=function(t){e.setState({clusterType:t})},e.handleChange=function(t,n){var a=n.value;e.setType(a)},e.handleSubmit=function(t){e.props.connectToCluster(t)},e}return Object(d.a)(n,[{key:"renderForm",value:function(){var e=this.state.clusterType,t=this.props.config;switch(e){case _.LOCAL:return r.createElement(U,{config:t,onSubmit:this.handleSubmit});case _.TCP:return r.createElement(W,{config:t,onSubmit:this.handleSubmit})}}},{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(E.a,{inline:!0,options:V,value:this.state.clusterType,onChange:this.handleChange})),r.createElement(h.a,null,this.renderForm()))}}]),n}(r.Component),Y=Object(o.b)((function(e){return{config:e.config,lastConnectionType:e.config.lastConnection.type}}),B)(G),J=function(e){var t=e.msg;return r.createElement(P.a,{icon:!0},r.createElement(F.a,{name:"cog",loading:!0}),r.createElement(P.a.Content,null,r.createElement(P.a.Header,null,"Connecting to LiberTEM"),t))},K=function(){return r.createElement(P.a,{negative:!0,icon:!0},r.createElement(F.a,{name:"shutdown"}),r.createElement(P.a.Content,null,r.createElement(P.a.Header,null,"Connection is closed"),r.createElement("p",null,"please close the tab")))},z={waiting:"Waiting...",connecting:"Connecting..."},Q="Connected, waiting for initial state...",X="Connected, fetching cluster status...",q="Connecting to cluster",$=function(){var e=Object(o.d)((function(e){return e.config.haveConfig})),t=Object(o.d)((function(e){return e.clusterConnection}));return e?"disconnected"===t.status?r.createElement(Y,null):"connected"===t.status?r.createElement(J,{msg:Q}):"unknown"===t.status?r.createElement(J,{msg:X}):"connecting"===t.status?r.createElement(J,{msg:q}):void O("should not happen"):r.createElement(J,{msg:"waiting for configuration..."})},Z=function(e){var t=e.children,n=Object(o.d)((function(e){return e.channelStatus}));switch(n.status){case"waiting":case"connecting":return r.createElement(J,{msg:z[n.status]});case"connected":return r.createElement($,null);case"ready":return r.createElement(r.Fragment,null,t);case"disconnected":return r.createElement(K,null);default:O("should not happen")}};!function(e){e.LIST_DIRECTORY="BROWSER_LIST_DIRECTORY",e.LIST_FULL_PATH="BROWSER_LIST_DIRECTORY_FULL",e.DIRECTORY_LISTING="BROWSER_DIRECTORY_LISTING",e.DETECT_PARAMS="BROWSER_DETECT_PARAMS",e.PARAMS_DETECTED="BROWSER_PARAMS_DETECTED",e.ERROR="BROWSER_ERROR",e.OPEN="BROWSER_OPEN",e.CANCEL="BROWSER_CANCEL",e.SELECT="BROWSER_SELECT",e.SELECT_FULL_PATH="BROWSER_SELECT_FULL_PATH"}(D||(D={}));var ee={list:function(e,t){return b(D.LIST_DIRECTORY,{path:e,name:t})},dirListing:function(e,t,n,a,r){return b(D.DIRECTORY_LISTING,{path:e,dirs:t,files:n,drives:a,places:r})},open:function(){return b(D.OPEN)},cancel:function(){return b(D.CANCEL)},select:function(e,t){return b(D.SELECT,{path:e,name:t})},selectFullPath:function(e){return b(D.SELECT_FULL_PATH,{path:e})},error:function(e,t,n){return b(D.ERROR,{msg:e,timestamp:t,id:n})},detectParams:function(e){return b(D.DETECT_PARAMS,{path:e})},paramsDetected:function(e,t){return b(D.PARAMS_DETECTED,{path:e,params:t})}},te=n(389),ne=n(728),ae=function(e){var t=e.ts,n=new Date(1e3*t),a=n.toLocaleDateString(),c=n.toLocaleTimeString(),s="".concat(a," ").concat(c);return r.createElement("div",{style:{display:"flex",whiteSpace:"nowrap"},title:s},r.createElement("div",{style:{width:"50%",marginRight:"10px"}},a),r.createElement("div",{style:{width:"45%"}},c))};var re,ce=function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?1e3:1024;if(Math.abs(e)<n)return{size:e,unit:"B"};var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=n,++r}while(Math.abs(e)>=n&&r<a.length-1);return{size:e.toFixed(1),unit:a[r]}}(e.size,e.si);return r.createElement("div",{style:{textAlign:"right"}},t.size," ",t.unit)},se=function(e){var t=e.children,n=e.title;return r.createElement("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginRight:"10px"},title:n},t)},oe=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).onClick=function(t){var n=e.props.onClick;n&&n()},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.icon,c=Object(I.a)({cursor:"pointer"},n),s={textAlign:"right"};return r.createElement("div",{onClick:this.onClick,style:c},r.createElement("div",{style:{display:"flex",paddingRight:"10px"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(se,{title:t.name},a&&r.createElement(F.a,{name:a}),t.name)),r.createElement("div",{style:{width:"10%"}},r.createElement(se,null,r.createElement(ce,{size:t.size,si:!1}))),r.createElement("div",{style:{width:"10%"}},r.createElement(se,null,t.owner)),r.createElement("div",{style:Object(I.a)({width:"18%"},s)},r.createElement(se,null,r.createElement(ae,{ts:t.ctime}))),r.createElement("div",{style:Object(I.a)({width:"18%"},s)},r.createElement(se,null,r.createElement(ae,{ts:t.mtime})))))}}]),n}(r.Component),ie=function(){var e={textAlign:"right"};return r.createElement("div",{style:{paddingRight:"20px",paddingBottom:"10px"}},r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(se,null,"Name")),r.createElement("div",{style:Object(I.a)({width:"10%"},e)},r.createElement(se,null,"Size")),r.createElement("div",{style:{width:"10%"}},r.createElement(se,null,"Owner")),r.createElement("div",{style:Object(I.a)({width:"18%"},e)},r.createElement(se,null,"Created")),r.createElement("div",{style:Object(I.a)({width:"18%"},e)},r.createElement(se,null,"Modified"))))},le=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.select;return r.createElement(oe,{onClick:a,style:n,details:t,icon:"file outline"})}}]),n}(r.Component),ue=Object(o.b)(null,(function(e,t){return{select:function(){return e(ee.select(t.path,t.details.name))}}}))(le),de=Object(o.b)(null,(function(e,t){return{list:function(){e(ee.list(t.path,t.details.name)),window.setTimeout((function(){return t.onChange()}),0)}}}))((function(e){var t=e.list,n=e.details,a=e.style;e.onChange;return r.createElement(oe,{onClick:t,style:a,details:n,icon:"folder"})})),me=n(388);!function(e){e.FETCHED="CONFIG_FETCHED",e.FETCH="CONFIG_FETCH",e.FETCH_FAILED="CONFIG_FETCH_FAILED",e.TOGGLE_STAR="CONFIG_TOGGLE_STAR"}(re||(re={}));var pe=function(){return b(re.FETCH)},fe=function(e){return b(re.FETCHED,{config:e})},Ee=function(e,t,n){return b(re.FETCH_FAILED,{msg:e,timestamp:t,id:n})},he=function(e){return b(re.TOGGLE_STAR,{path:e})},be=n(176),ye=Object(o.b)(null,(function(e,t){return{list:function(){void 0!==t.value&&(e(ee.list(t.value.toString())),window.setTimeout((function(){return t.onChange()}),0))}}}))((function(e){var t=e.list,n=Object(be.a)(e,["list"]),a=Object(I.a)({onClick:t},n);return r.createElement(E.a.Item,a)})),ge=n(715),ve=Object(k.c)({mapPropsToValues:function(e){return{path:e.initialPath}},handleSubmit:function(e,t){(0,t.props.onChange)(e.path)},enableReinitialize:!0})((function(e){var t=e.values,n=(e.touched,e.errors,e.dirty,e.isSubmitting,e.handleChange),a=e.handleBlur,c=e.handleSubmit;e.handleReset;return r.createElement(L.a,{onSubmit:c,style:{flexGrow:1}},r.createElement(L.a.Field,null,r.createElement(ge.a,{autoComplete:"off",onBlur:a,onChange:n,value:t.path,name:"path"})))})),Oe=Object(o.b)((function(e){return{lastOpened:e.config.lastOpened,fileHistory:e.config.fileHistory,separator:e.config.separator}}),(function(e){return{select:function(t){return e(ee.selectFullPath(t))}}}))((function(e){var t=e.lastOpened,n=e.fileHistory,a=e.select,c=n.filter((function(e){return t[e]})).map((function(e){var n=t[e];return{text:n.path,value:{type:n.type,path:n.path}}})),s=function(e,t){return t.value&&a(t.value.toString())};return r.createElement(E.a,{item:!0,text:"Recent",floating:!0},r.createElement(E.a.Menu,null,r.createElement(E.a.Header,{content:"recent datasets"}),c.map((function(e,t){return r.createElement(E.a.Item,{key:t,value:e.value.path,content:e.text,onClick:s})}))))})),Se=Object(o.b)(null,(function(e,t){return{refresh:function(){e(ee.list(t.currentPath)),window.setTimeout((function(){return t.onChange()}),0)},handleInputChange:function(n){e(ee.list(n)),window.setTimeout((function(){return t.onChange()}),0)},goUp:function(){e(ee.list(t.currentPath,"..")),window.setTimeout((function(){return t.onChange()}),0)},toggleStar:function(){e(he(t.currentPath))}}}))((function(e){var t=e.currentPath,n=e.drives,a=e.places,c=e.starred,s=e.onChange,o=e.refresh,i=e.goUp,l=e.handleInputChange,u=e.toggleStar,d=n.map((function(e){return{key:e,text:e}})),m=Object.keys(a).map((function(e){return{key:a[e].path,text:a[e].title}})),p=c.map((function(e){return{key:e,text:e}})),f=c.includes(t),h=f?"star":"star outline",b=f?"Remove from bookmarks":"Bookmark this location";return r.createElement(me.a,null,r.createElement(Oe,null),r.createElement(E.a,{text:"Go to...",floating:!0,item:!0},r.createElement(E.a.Menu,null,r.createElement(E.a.Header,{content:"Drives"}),d.map((function(e){return r.createElement(ye,{key:e.key,value:e.key,content:e.text,onChange:s})})),r.createElement(E.a.Header,{content:"Places"}),m.map((function(e){return r.createElement(ye,{key:e.key,value:e.key,content:e.text,onChange:s})})),r.createElement(E.a.Header,{content:"Starred"}),0===p.length&&r.createElement(E.a.Item,{key:"empty",value:"empty",content:"No bookmarks yet"}),p.map((function(e){return r.createElement(ye,{key:e.key,value:e.key,content:e.text,onChange:s})})))),r.createElement(me.a.Item,{title:b,icon:h,onClick:u}),r.createElement(me.a.Item,{icon:"arrow up",onClick:i}),r.createElement(me.a.Item,{style:{flexGrow:1}},r.createElement(ve,{onChange:l,initialPath:t})),r.createElement(me.a.Item,{icon:"refresh",onClick:o}))})),xe=r.createRef(),Ce=function(){null!==xe.current&&xe.current.scrollToItem(0)};function _e(e,t){return e.sort((function(e,n){var a=t(e),r=t(n);return a<r?-1:a>r?1:0}))}var Ae,je,Re=Object(o.b)((function(e){var t=e.browser,n=e.config;return{files:t.files,dirs:t.dirs,path:t.path,drives:t.drives,places:t.places,isLoading:t.isLoading,starred:n.starred}}),(function(e){return{cancel:function(){return e(ee.cancel())}}}))((function(e){var t=e.files,n=e.dirs,a=e.path,c=e.drives,s=e.places,o=e.starred,i=e.cancel,l=e.isLoading,u=function(e){return e.name.toLowerCase()},d=_e(n,u).map((function(e){return function(t){return r.createElement(de,{style:t,onChange:Ce,path:a,details:e})}})),m=_e(t,u).map((function(e){return function(t){return r.createElement(ue,{style:t,path:a,details:e})}})),p=d.concat(m),f=function(e){var t=e.index,n=e.style;return p[t](n)},E=r.createElement(te.a,{style:{overflowY:"scroll"},ref:xe,height:300,width:"100%",itemCount:p.length,itemSize:35},f);return l&&(E=r.createElement(h.a,{loading:!0,style:{height:"300px"}})),r.createElement(h.a.Group,null,r.createElement(h.a,null,r.createElement(ne.a,{as:"h2"},"Open dataset")),r.createElement(h.a,null,r.createElement(Se,{currentPath:a,drives:c,places:s,starred:o,onChange:Ce})),r.createElement(h.a,null,r.createElement(ie,null),E),r.createElement(h.a,null,r.createElement(M.a,{onClick:i},"Cancel")))})),Te={open:ee.open},we=Object(o.b)((function(e){return{isOpen:e.browser.isOpen,busy:e.openDataset.busy,formVisible:e.openDataset.formVisible}}),Te)((function(e){var t=e.formVisible,n=e.isOpen,a=e.open,c=e.busy;return t||c?null:n?r.createElement(Re,null):r.createElement(M.a,{icon:!0,labelPosition:"left",onClick:a},r.createElement(F.a,{name:"add"}),"Browse")})),De=n(722),Ie=n(10);!function(e){e.CREATING="CREATING",e.RUNNING="RUNNING",e.DONE="DONE"}(Ae||(Ae={})),function(e){e.CREATING="CREATING",e.IN_PROGRESS="IN_PROGRESS",e.CANCELLED="CANCELLED",e.SUCCESS="SUCCESS",e.ERROR="ERROR"}(je||(je={}));var ke=n(31),Le=n(78),Ne=n(79),Fe=function(){return r.createElement(F.a,{name:"cog",loading:!0,style:{margin:0,padding:0,position:"absolute",bottom:"10px",right:"10px",color:"white",opacity:.7,filter:"drop-shadow(0 0 3px #000)"}})},Me=function(e){var t=e.children,n=e.busy;return r.createElement("div",{style:{position:"relative"}},t,n&&r.createElement(Fe,null))},Pe=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).currentHandle=void 0,e.handleDragStart=function(t){e.currentHandle=t},e.handleDrop=function(){e.currentHandle=void 0},e.handleMouseMove=function(t){if(e.currentHandle)return e.currentHandle.externalMouseMove(t)},e.handleMouseLeave=function(t){e.currentHandle&&e.currentHandle.externalLeave(t)},e.handleMouseUp=function(t){e.currentHandle&&e.currentHandle.externalMouseUp(t)},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return r.createElement("g",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp,onKeyDown:this.props.onKeyboardEvent,style:{outline:"1px dashed black"},tabIndex:0},r.createElement("rect",{style:{fill:"transparent"},x:0,y:0,width:t,height:n}),this.renderHandles())}},{key:"renderHandles",value:function(){var e=this,t=this.props,n=t.handles,a=t.onKeyboardEvent;return n.map((function(t,n){var c=t(e.handleDragStart,e.handleDrop,a);return r.isValidElement(c)?r.cloneElement(c,{key:n}):null}))}}]),n}(r.Component),He=n(238),Ue=n.n(He),We=function(e){var t=e.job,n=e.channel,a=e.width,c=e.height,s=t.results[n];return void 0===s?r.createElement("svg",{className:Ue.a.fallback,width:a,height:c,viewBox:"0 0 ".concat(a," ").concat(c),key:-1}):r.createElement("image",{className:Ue.a.default,xlinkHref:s.imageURL,width:a,height:c})};function Be(){var e=Object(Le.a)(["\n    display: block;\n    border: 1px solid black;\n    width: 100%;\n    height: auto;\n"]);return Be=function(){return e},e}var Ve=Ne.a.svg(Be()),Ge=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"renderHandles",value:function(){var e=this.props,t=e.width,n=e.height,a=e.extraHandles,c=[];return a&&(c=[].concat(Object(ke.a)(c),[a])),r.createElement(Pe,{width:t,height:n,handles:c})}},{key:"render",value:function(){var e=this.props,t=e.job,n=e.channel,a=e.width,c=e.height,s=e.extraWidgets,o=t.running!==Ae.DONE;return r.createElement(Me,{busy:o},r.createElement(Ve,{width:a,height:c,viewBox:"0 0 ".concat(a," ").concat(c)},r.createElement(We,{job:t,channel:n,width:a,height:c}),s,this.renderHandles()))}}]),n}(r.Component),Ye=Object(o.b)(null,null)(Ge);function Je(){var e=Object(Le.a)(["\n    display: flex;\n    & > * {\n        margin-right: 10px;\n    }\n"]);return Je=function(){return e},e}var Ke=Ne.a.div(Je()),ze=function(e){var t=e.width,n=e.height;return r.createElement("svg",{style:{display:"block",border:"1px solid black",width:"100%",height:"auto"},width:t,height:n,viewBox:"0 0 ".concat(t," ").concat(n),key:-1})},Qe=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={selectedChannel:0},e.selectChannel=function(t,n){var a=n.value;e.setState({selectedChannel:a})},e}return Object(d.a)(n,[{key:"getJob",value:function(){var e=this.props,t=e.analysis,n=e.jobsById;if(t&&t.displayedJob&&n[t.displayedJob])return n[t.displayedJob]}},{key:"getMsg",value:function(e){if(!e)return r.createElement(r.Fragment,null,"\xa0");if(e.running===Ae.DONE){var t=(e.endTimestamp-e.startTimestamp)/1e3;return r.createElement(r.Fragment,null,"Analysis done in ",t.toFixed(3),"s")}return r.createElement(r.Fragment,null,"Analysis running...")}},{key:"genericRender",value:function(e,t){var n=this.props,a=n.subtitle,c=n.children,s=n.selectors,o=this.getMsg(t);return r.createElement("div",null,e,c,r.createElement(Ke,null,r.createElement(Xe,{job:t,handleChange:this.selectChannel,selectedImg:this.state.selectedChannel}),s),r.createElement("p",null,a," ",o))}},{key:"render",value:function(){var e=this.getJob(),t=this.props,n=t.width,a=t.height,c=t.extraHandles,s=t.extraWidgets;return e?this.genericRender(r.createElement(Ye,{job:e,extraHandles:c,extraWidgets:s,width:n,height:a,channel:this.state.selectedChannel}),e):this.genericRender(r.createElement(ze,{width:n,height:a}),e)}}]),n}(r.Component),Xe=function(e){var t=e.job,n=e.handleChange,a=e.selectedImg;if(!t)return null;var c=t.results.map((function(e,t){return{text:e.description.title,value:t}}));return r.createElement(r.Fragment,null,r.createElement("div",null,"Channel:"," ",r.createElement(E.a,{inline:!0,options:c,value:a,onChange:n})))},qe=Object(o.b)((function(e,t){var n=e.compoundAnalyses.byId[t.compoundAnalysis],a=e.analyses.byId[n.details.analyses[t.analysisIndex]];return{jobsById:e.jobs.byId,analysis:a,compoundAnalysis:n,analysisIndex:t.analysisIndex}}))(Qe),$e=function(e,t){return function(n){return{x:Math.max(0,Math.min(e-1,n.x)),y:Math.max(0,Math.min(t-1,n.y))}}},Ze=function(e,t,n){return function(a,r){return n&&n(function(e,t,n,a){var r=e-n,c=t-a;return Math.sqrt(r*r+c*c)}(e,t,a,r))}},et=function(e){return function(t){return{x:t.x,y:e}}},tt=function(e,t){return function(n){return(a=e,function(e){return{x:a>e.x?a:e.x,y:e.y}})(et(t)(n));var a}},nt=function(e,t){return function(n){return(a=e,function(e){return{x:a<e.x?a:e.x,y:e.y}})(et(t)(n));var a}},at=function(e){return{fillOpacity:.3,fill:"red",strokeOpacity:.7,stroke:"red",strokeWidth:e/128/3}},rt=function(e){var t=e.imageWidth,n=(e.imageHeight,e.cx),a=e.cy,c=e.r;return r.createElement("circle",{cx:n+.5,cy:a+.5,r:c,style:Object(I.a)({},at(t))})},ct=n(169);function st(){var e=Object(Le.a)(["\n    &:focus { outline: none; }\n"]);return st=function(){return e},e}function ot(){var e=Object(Le.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return ot=function(){return e},e}function it(){var e=Object(Le.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return it=function(){return e},e}var lt=Ne.a.circle(it()),ut=Ne.a.path(ot()),dt=Ne.a.g(st()),mt=function(e){var t=e.scale,n=e.x,a=e.y,c=e.withCross,s=e.focusRef,o=Object(be.a)(e,["scale","x","y","withCross","focusRef"]),i={transform:"matrix(".concat(t,", 0, 0, ").concat(t,", ").concat(n-t*n,", ").concat(a-t*a,")")},l="\n        M".concat(n-4-1.5," ").concat(a," L ").concat(n-1.5," ").concat(a," M").concat(n+1.5," ").concat(a," L ").concat(n+4+1.5," ").concat(a,"\n        M").concat(n," ").concat(a-4-1.5," L ").concat(n," ").concat(a-1.5," M").concat(n," ").concat(a+1.5," L ").concat(n," ").concat(a+4+1.5,"\n    "),u=c?r.createElement(ut,{d:l,style:i}):null;return r.createElement(dt,Object.assign({},o,{ref:s}),r.createElement(lt,{cx:n,cy:a,r:3,style:i}),u)};function pt(e,t){var n=function(e){var t=e.ownerSVGElement;if(null===t)throw new Error("no owner SVG element?");var n=t.getAttribute("width");if(null===n)throw new Error("no width on SVG element?");var a=+n;return t.getBoundingClientRect().width/a}(t),a=t.getBoundingClientRect();return{x:(e.pageX-(a.left+window.pageXOffset))/n,y:(e.pageY-(a.top+window.pageYOffset))/n}}var ft,Et=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).posRef=void 0,a.focusRef=void 0,a.state={dragging:!1,drag:{x:0,y:0}},a.externalMouseMove=function(e){a.move(e)},a.externalLeave=function(e){a.stopDrag(e)},a.externalMouseUp=function(e){a.stopDrag(e)},a.applyConstraint=function(e){var t=a.props.constraint;return t?t(e):e},a.startDrag=function(e){e.preventDefault();var t=a.props.parentOnDragStart;if(!a.posRef.current)throw new Error("startDrag without posRef");a.setState({dragging:!0,drag:a.applyConstraint(pt(e,a.posRef.current))}),t&&t(Object(ct.a)(a)),a.focusRef.current&&a.focusRef.current.focus&&a.focusRef.current.focus()},a.move=function(e){var t=a.props.onDragMove;if(a.state.dragging){if(!a.posRef.current)throw new Error("move without posRef");a.setState({drag:a.applyConstraint(pt(e,a.posRef.current))},(function(){if(t){var e=a.applyConstraint(a.state.drag);t(e.x,e.y)}}))}},a.stopDrag=function(e){var t=a.props.parentOnDrop,n=a.state,r=n.dragging,c=n.drag;r&&(a.setState({dragging:!1}),t&&t(c.x,c.y))},a.handleKeyDown=function(e){!function(e,t){var n=1;switch(e.shiftKey&&(n=10),e.key){case"ArrowUp":t((function(e,t){return{x:e,y:t-n}}));break;case"ArrowDown":t((function(e,t){return{x:e,y:t+n}}));break;case"ArrowLeft":t((function(e,t){return{x:e-n,y:t}}));break;case"ArrowRight":t((function(e,t){return{x:e+n,y:t}}));break;default:return}e.preventDefault()}(e,(function(e){var t=a.props,n=t.x,r=t.y,c=t.onDragMove,s=e(n,r),o=a.applyConstraint(s);c&&c(o.x,o.y)}))},a.posRef=r.createRef(),a.focusRef=r.createRef(),a}return Object(d.a)(n,[{key:"renderCommon",value:function(e,t){var n=this.props.imageWidth,a=void 0===n?1:n/128;return r.createElement("g",null,r.createElement("rect",{style:{visibility:"hidden"},ref:this.posRef,x:0,y:0,width:0,height:0}),r.createElement(mt,{scale:a,x:e+.5,y:t+.5,withCross:this.props.withCross,focusRef:this.focusRef,onMouseUp:this.stopDrag,onMouseMove:this.move,onMouseDown:this.startDrag,onKeyDown:this.handleKeyDown,tabIndex:0}))}},{key:"renderDragging",value:function(){var e=this.state.drag,t=e.x,n=e.y;return this.renderCommon(t,n)}},{key:"render",value:function(){var e=this.props,t=e.x,n=e.y;return this.state.dragging?this.renderDragging():this.renderCommon(t,n)}}]),n}(r.Component),ht=Et;!function(e){e.CREATE="COMPOUND_ANALYSIS_CREATE",e.CREATED="COMPOUND_ANALYSIS_CREATED",e.UPDATED="COMPOUND_ANALYSIS_UPDATED",e.RUN="COMPOUND_ANALYSIS_RUN",e.RUNNING="COMPOUND_ANALYSIS_RUNNING",e.REMOVE="COMPOUND_ANALYSIS_REMOVE",e.REMOVED="COMPOUND_ANALYSIS_REMOVED",e.ERROR="COMPOUND_ANALYSIS_ERROR",e.ENABLE_AUTOSTART="COMPOUND_ANALYSIS_ENABLE_AUTOSTART"}(ft||(ft={}));var bt,yt,gt=function(e,t){return b(ft.CREATE,{dataset:e,analysisType:t})},vt=function(e,t){return b(ft.CREATED,{compoundAnalysis:e,autoStart:t})},Ot=function(e){return b(ft.ENABLE_AUTOSTART,{compoundAnalysisId:e})},St=function(e,t,n){return b(ft.RUN,{id:e,analysisIndex:t,details:n})},xt=function(e,t,n){return b(ft.RUNNING,{id:e,job:t,jobIndex:n})},Ct=function(e){return b(ft.REMOVE,{id:e})},_t=function(e){return b(ft.REMOVED,{id:e})},At=function(e,t,n){return b(ft.ERROR,{msg:e,timestamp:t,id:n})},jt=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.analysisIndex,s=e.compoundAnalysisId,i=e.cx,l=e.cy,u=e.setCx,d=e.setCy,m=Object(o.c)();c.a.useEffect((function(){if(t){var e={x:i,y:l};m(St(s,r,{analysisType:T.PICK_FRAME,parameters:e}))}}),[s,i,l,t,r,m]);var p=function(e,t){var n=Math.round(e),a=Math.round(t);i===n&&l===a||(u(n),d(a))};return{coords:{cx:i,cy:l},handles:function(e,t){return c.a.createElement(ht,{x:i,y:l,withCross:!0,imageWidth:n,onDragMove:p,parentOnDragStart:e,parentOnDrop:t,constraint:$e(n,a)})}}},Rt=function(e){var t=e.modes,n=e.currentMode,a=e.onModeChange,c=e.label;return r.createElement(r.Fragment,null,r.createElement("div",null,c,":"," ",r.createElement(E.a,{inline:!0,options:t,value:n,onChange:function(e,t){a(t.value)}})))},Tt=function(e){var t,n,a=e.imageWidth,c=(e.imageHeight,e.x),s=e.y,o=e.width,i=e.height;return i*o>0?(t=Math.min(s,s+i),n=Math.min(c,c+o)):i>0&&o<0?(t=s,n=c+o):(t=s+i,n=c),r.createElement("rect",{x:n+.5,y:t+.5,width:Math.abs(o),height:Math.abs(i),style:Object(I.a)({},at(a))})},wt=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),c=Object(r.useState)(t/2),s=Object(Ie.a)(c,2),o=s[0],i=s[1],l=Object(r.useState)(n/2),u=Object(Ie.a)(l,2),d=u[0],m=u[1],p=Object(r.useState)(a/8),f=Object(Ie.a)(p,2),E=f[0],h=f[1],b=Object(r.useState)(a/8),y=Object(Ie.a)(b,2),g=y[0],v=y[1],O=function(e,t){i(e),m(t)},S=function(e,t){h(e-o),v(t-d)},x={x:o+E,y:d+g};return{rectRoiParameters:{roi:{shape:"rect",x:o,y:d,width:E,height:g}},rectRoiHandles:function(e,n){return r.createElement(r.Fragment,null,r.createElement(ht,{x:o,y:d,imageWidth:t,onDragMove:O,parentOnDragStart:e,parentOnDrop:n}),r.createElement(ht,{x:x.x,y:x.y,imageWidth:t,onDragMove:S,parentOnDragStart:e,parentOnDrop:n}))},rectRoiWidgets:r.createElement(Tt,{x:o,y:d,width:E,height:g,imageWidth:t,imageHeight:n})}},Dt=function(e){var t=e.compoundAnalysisId,n=e.enabled,a=e.analysisIndex,c=e.roiParameters,s=e.analysisType,i=Object(o.c)();return r.useEffect((function(){var e=setTimeout((function(){n&&i(St(t,a,{analysisType:s,parameters:c}))}),100);return function(){return clearTimeout(e)}}),[s,t,n,a,JSON.stringify(c),i]),{}};!function(e){e.SUM="SUM",e.SD="SD",e.PICK="PICK"}(bt||(bt={})),function(e){e.ALL="ALL",e.DISK="DISK",e.RECT="RECT"}(yt||(yt={}));var It=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.compoundAnalysisId,c=e.doAutoStart,s=[{text:"Average",value:bt.SUM},{text:"Standard Deviation",value:bt.SD},{text:"Pick",value:bt.PICK}],i=[{text:"All",value:yt.ALL},{text:"Disk",value:yt.DISK},{text:"Rect",value:yt.RECT}],l=Object(r.useState)(bt.SUM),u=Object(Ie.a)(l,2),d=u[0],m=u[1],p=Object(r.useState)(yt.ALL),f=Object(Ie.a)(p,2),E=f[0],h=f[1],b=Object(o.c)(),y=r.createElement(Rt,{modes:s,currentMode:d,onModeChange:function(e){b(Ot(a)),m(e)},label:"Mode"}),g=r.createElement(Rt,{modes:i,currentMode:E,onModeChange:function(e){b(Ot(a)),h(e)},label:"ROI"});d===bt.PICK&&(g=r.createElement(r.Fragment,null));var v,O=r.useState(Math.round(t/2)),S=Object(Ie.a)(O,2),x=S[0],C=S[1],_=r.useState(Math.round(n/2)),A=Object(Ie.a)(_,2),j=A[0],R=A[1],w=jt({enabled:d===bt.PICK,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,cx:x,cy:j,setCx:C,setCy:R}),D=w.coords,I=w.handles,k=wt({scanHeight:n,scanWidth:t}),L=k.rectRoiHandles,N=k.rectRoiWidgets,F=k.rectRoiParameters,M=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),c=Object(r.useState)(t/2),s=Object(Ie.a)(c,2),o=s[0],i=s[1],l=Object(r.useState)(n/2),u=Object(Ie.a)(l,2),d=u[0],m=u[1],p=Object(r.useState)(a/8),f=Object(Ie.a)(p,2),E=f[0],h=f[1],b=function(e,t){i(e),m(t)},y=function(e){h(e)},g={x:o-E,y:d};return{diskRoiParameters:{roi:{shape:"disk",cx:o,cy:d,r:E}},diskRoiHandles:function(e,a){return r.createElement(r.Fragment,null,r.createElement(ht,{x:o,y:d,imageWidth:t,onDragMove:b,parentOnDragStart:e,parentOnDrop:a,constraint:$e(t,n)}),r.createElement(ht,{x:g.x,y:g.y,imageWidth:t,onDragMove:Ze(o,d,y),parentOnDragStart:e,parentOnDrop:a,constraint:et(d)}))},diskRoiWidgets:r.createElement(rt,{cx:o,cy:d,r:E,imageWidth:t,imageHeight:n})}}({scanHeight:n,scanWidth:t}),P=M.diskRoiHandles,H=M.diskRoiWidgets,U=M.diskRoiParameters,W=function(e,t){return null},B={roi:{}};switch(E){case yt.DISK:W=P,v=H,B=U;break;case yt.RECT:W=L,v=N,B=F}switch(d){case bt.PICK:W=I,v=void 0}return Dt({enabled:d===bt.SD&&c,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,roiParameters:B,analysisType:T.SD_FRAMES}),Dt({enabled:d===bt.SUM&&c,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,roiParameters:B,analysisType:T.SUM_FRAMES}),{frameViewTitle:d!==bt.PICK?null:r.createElement(r.Fragment,null,"Pick: x=",D.cx,", y=",D.cy," \u2003"),frameModeSelector:r.createElement(r.Fragment,null,y," ",g),roiSelector:g,handles:W,widgets:v}},kt=n(390),Lt=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.right,s=e.toolbar;return r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h3",attached:"top"},r.createElement(F.a,{name:"cog"}),r.createElement(ne.a.Content,null,t)),r.createElement(h.a,{attached:!0},r.createElement(kt.a,{columns:2},r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,null,a,r.createElement("p",null,n)),r.createElement(kt.a.Column,null,c)))),s)},Nt=n(7),Ft=n.n(Nt),Mt=n(24),Pt=n(730);function Ht(){var e=window.location.pathname;return e.endsWith("/")?"".concat(e,"api/"):"".concat(e,"/api/")}function Ut(e){return Wt.apply(this,arguments)}function Wt(){return(Wt=Object(Mt.a)(Ft.a.mark((function e(t){var n,a;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ht(),e.next=3,fetch("".concat(n).concat(t),{credentials:"same-origin",method:"DELETE"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(e,t){return Vt.apply(this,arguments)}function Vt(){return(Vt=Object(Mt.a)(Ft.a.mark((function e(t,n){var a,r;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Ht(),e.next=3,fetch("".concat(a).concat(t),{body:JSON.stringify(n),credentials:"same-origin",method:"PUT"});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gt(e,t,n,a){return Yt.apply(this,arguments)}function Yt(){return(Yt=Object(Mt.a)(Ft.a.mark((function e(t,n,a,r){var c;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={dataset:a,details:r},e.next=3,Bt("compoundAnalyses/".concat(t,"/analyses/").concat(n,"/"),c);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e,t){return Kt.apply(this,arguments)}function Kt(){return(Kt=Object(Mt.a)(Ft.a.mark((function e(t,n){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut("compoundAnalyses/".concat(t,"/analyses/").concat(n,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(e,t,n){return Qt.apply(this,arguments)}function Qt(){return(Qt=Object(Mt.a)(Ft.a.mark((function e(t,n,a){var r;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={dataset:n,details:a},e.next=3,Bt("compoundAnalyses/".concat(t,"/"),r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e){return qt.apply(this,arguments)}function qt(){return(qt=Object(Mt.a)(Ft.a.mark((function e(t){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut("compoundAnalyses/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $t(e){return Zt.apply(this,arguments)}function Zt(){return(Zt=Object(Mt.a)(Ft.a.mark((function e(t){var n,a,r;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ht(),a="".concat(n,"compoundAnalyses/").concat(t,"/copy/notebook/"),e.next=4,fetch(a,{method:"GET",credentials:"same-origin"});case 4:return r=e.sent,e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var en=function(e){var t=T[e];return _n[t]},tn=function(e){var t=e.compoundAnalysis,n=e.currentFormat,a=Ht(),c=Object(o.d)((function(e){return e.analyses.byId})),s=Object(o.d)((function(e){return e.jobs.byId})),i=t.details.analyses.map((function(e){return c[e]})).filter((function(e){return e.jobs.some((function(e){return s[e].status===je.SUCCESS}))}));return r.createElement("ul",null,i.map((function(e){return r.createElement("li",{key:e.id},r.createElement("a",{href:(c=e.id,"".concat(a,"compoundAnalyses/").concat(t.compoundAnalysis,"/analyses/").concat(c,"/download/").concat(n,"/"))},function(e){return en(e.details.analysisType).desc}(e)," (channels: ",function(e){return e.displayedJob?s[e.displayedJob].results.filter((function(e){return e.description.includeInDownload})).map((function(e){return e.description.title})):[]}(e).join(", "),")"));var c})))},nn=function(e){var t=e.compoundAnalysis,n=Object(r.useState)({dependency:"",initial_setup:"",ctx:"",dataset:"",analysis:[{analysis:"",plot:[""]}]}),a=Object(Ie.a)(n,2),c=a[0],s=a[1],o=function(e){return r.createElement(h.a,{padded:!0},r.createElement(M.a,{floated:"right",icon:"copy",onClick:function(){navigator.clipboard.writeText(e)}}),r.createElement("pre",null,e))};return Object(r.useEffect)((function(){(function(){var e=Object(Mt.a)(Ft.a.mark((function e(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$t(t.compoundAnalysis).then((function(e){s({dependency:e.dependency,initial_setup:e.initial_setup,ctx:e.ctx,dataset:e.dataset,analysis:e.analysis})}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t.compoundAnalysis]),r.createElement(r.Fragment,null,r.createElement(h.a,{clearing:!0},r.createElement(ne.a,{floated:"left"},"Notebook"),r.createElement(M.a,{icon:!0,labelPosition:"left",floated:"right",onClick:function(){var e=[c.dependency,c.initial_setup,c.ctx,c.dataset].join("\n\n"),t=c.analysis.map((function(e){return"".concat(e.analysis,"\n").concat(e.plot.join("\n\n"))})).join("\n\n");navigator.clipboard.writeText("".concat(e,"\n\n").concat(t))}},r.createElement(F.a,{name:"copy"}),"Complete notebook")),r.createElement(N.a.Content,{scrolling:!0},[c.dependency,c.initial_setup,c.ctx,c.dataset].map(o),c.analysis.map((function(e){return r.createElement(r.Fragment,null,o(e.analysis),e.plot.map(o))}))))},an=function(e){var t=e.compoundAnalysis,n=Ht(),a="".concat(n,"compoundAnalyses/").concat(t.compoundAnalysis,"/download/notebook/");return r.createElement("ul",null,r.createElement("li",null,r.createElement("a",{href:a},"notebook corresponding to analysis")))},rn=function(e){var t,n=e.compoundAnalysis,a=Object(o.d)((function(e){return e.config.resultFileFormats})),c=Object.keys(a).map((function(e){return{value:e,text:a[e].description}})),s=Object(r.useState)(null===(t=c[0])||void 0===t?void 0:t.value),i=Object(Ie.a)(s,2),l=i[0],u=i[1];r.useEffect((function(){0===c.length||l||u(c[0].value)}),[c,l]);var d=function(e,t){u(t.value)},m=[{menuItem:"Download result",render:function(){return r.createElement(Pt.a.Pane,null,r.createElement(ne.a,null,"Download Results, format: ",r.createElement(E.a,{inline:!0,options:c,onChange:d,value:l})),r.createElement(ne.a,{as:"h3"},"Available results:"),r.createElement(tn,{compoundAnalysis:n,currentFormat:l}))}},{menuItem:"Download notebook",render:function(){return r.createElement(Pt.a.Pane,null,r.createElement(ne.a,{as:"h3"},"Available scripts: "),r.createElement(an,{compoundAnalysis:n}))}},{menuItem:"Copy notebook",render:function(){return r.createElement(Pt.a.Pane,null,r.createElement(nn,{compoundAnalysis:n}))}}];return r.createElement(N.a,{trigger:r.createElement(M.a,{icon:!0},r.createElement(F.a,{name:"download"}),"Download")},r.createElement(Pt.a,{panes:m}))},cn=function(e){var t=e.busyIdxs,n=e.onApply,a=e.compoundAnalysis,c=Object(o.c)(),s=Object(o.d)((function(e){return e.analyses})),i=Object(o.d)((function(e){return e.jobs})),l="busy"===function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=e.details.analyses;return a.length>0&&(r=r.filter((function(e,t){return-1!==a.indexOf(t)}))),r.reduce((function(e,a){var r=t.byId[a];return r?r.jobs.every((function(e){return n.byId[e].running===Ae.DONE}))?e:"busy":e}),"idle")}(a,s,i,t)?{name:"cog",loading:!0}:{name:"check"};return r.createElement(h.a,{attached:"bottom"},r.createElement(M.a.Group,null,r.createElement(M.a,{primary:!0,onClick:n,icon:!0},r.createElement(F.a,l),"Apply"),r.createElement(rn,{compoundAnalysis:a}),r.createElement(M.a,{onClick:function(){return c(Ct(a.compoundAnalysis))},icon:!0},r.createElement(F.a,{name:"remove"}),"Remove")))},sn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(o.c)(),_={x:p-O,y:b},A=S((function(e,t){f(e),y(t)})),j=S(x),R=r.createElement(rt,{cx:p,cy:b,r:O,imageWidth:l,imageHeight:i}),w=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),D=w.frameViewTitle,I=w.frameModeSelector,k=w.handles,L=w.widgets,N=r.createElement(r.Fragment,null,D," Disk: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), r=",O.toFixed(2)),F=r.createElement(cn,{compoundAnalysis:t,onApply:function(){C(St(t.compoundAnalysis,1,{analysisType:T.CENTER_OF_MASS,parameters:{shape:"com",cx:p,cy:b,r:O}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"COM analysis",subtitle:N,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(Et,{x:p,y:b,imageWidth:l,onDragMove:A,parentOnDragStart:e,parentOnDrop:t,constraint:$e(l,i)}),r.createElement(Et,{x:_.x,y:_.y,imageWidth:l,onDragMove:Ze(p,b,j),parentOnDragStart:e,parentOnDrop:t,constraint:et(b)}))},extraWidgets:R,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:I})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:k,extraWidgets:L})),toolbar:F})},on=n(726);function ln(e,t,n,a){n===t&&(n+=360);var r=n-t;r=r<0?r+360:r;var c=[];return c.push(un(t,a,e)),c.push(un(t+r/3,a,e)),c.push(un(t+2*r/3,a,e)),c.push(un(n,a,e)),function(e,t,n){return["M",e[0].x,e[0].y,"A",t,t,0,0,n,e[1].x,e[1].y,"A",t,t,0,0,n,e[2].x,e[2].y,"A",t,t,0,0,n,e[3].x,e[3].y].join(" ")}(c,a,r<180?0:1)}function un(e,t,n){var a=e*Math.PI/180;return{x:Math.cos(a)*t+n.x,y:Math.sin(a)*t+n.y}}var dn,mn=function(e){var t=e.imageWidth,n=e.cx,a=e.cy,c=e.ri,s=[ln({x:n+.5,y:a+.5},90,90,e.ro),ln({x:n+.5,y:a+.5},90,90,c)].join(" ");return r.createElement("path",{d:s,fillRule:"evenodd",style:Object(I.a)({},at(t))})},pn=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.mid,s=e.right,o=e.toolbar,i=e.clustparams,l=e.title1,u=e.title2,d=e.title3;return r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h3",attached:"top"},r.createElement(F.a,{name:"cog"}),r.createElement(ne.a.Content,null,t)),r.createElement(h.a,{attached:!0},r.createElement(kt.a,{columns:3},r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:4},r.createElement("p",null,l)),r.createElement(kt.a.Column,{width:6},r.createElement("p",null,u)),r.createElement(kt.a.Column,{width:6},r.createElement("p",null,d))),r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:4},a),r.createElement(kt.a.Column,{width:6},c),r.createElement(kt.a.Column,{width:6},s)),r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:16},r.createElement("div",null,i),r.createElement("p",null,n))))),o)},fn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(r.useState)(u/2),_=Object(Ie.a)(C,2),A=_[0],j=_[1],R={x:p-O,y:b},w={x:p-A,y:b},D=r.useState(1),I=Object(Ie.a)(D,2),k=I[0],N=I[1],M=r.useState(500),P=Object(Ie.a)(M,2),H=P[0],U=P[1],W=r.useState(20),B=Object(Ie.a)(W,2),V=B[0],G=B[1],Y=S((function(e,t){f(e),y(t)})),J=S(x),K=S(j),z=r.createElement(mn,{cx:p,cy:b,ri:O,ro:A,imageWidth:l}),Q=Object(o.c)(),X=wt({scanWidth:s,scanHeight:c}),q=X.rectRoiParameters,$=X.rectRoiHandles,Z=X.rectRoiWidgets;r.useEffect((function(){t.doAutoStart&&Q(St(t.compoundAnalysis,1,{analysisType:T.SUM_SIG,parameters:{}}))}),[t.compoundAnalysis,Q,t.doAutoStart]);var ee=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),te=ee.frameViewTitle,ne=ee.frameModeSelector,ae=ee.handles,re=ee.widgets,ce=r.createElement(r.Fragment,null,te," Ring: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), ri=",O.toFixed(2),", ro=",A.toFixed(2)),se=r.createElement(cn,{compoundAnalysis:t,onApply:function(){Q(St(t.compoundAnalysis,2,{analysisType:T.CLUST,parameters:{roi:q.roi,cx:p,cy:b,ri:O,ro:A,n_clust:V,n_peaks:H,min_dist:k}}))},busyIdxs:[2]}),oe=r.useState(!1),ie=Object(Ie.a)(oe,2),le=ie[0],ue=ie[1],de=r.createElement(on.a,null,r.createElement(on.a.Title,{active:le,index:0,onClick:function(e){ue(!le)}},r.createElement(F.a,{name:"dropdown"}),"Parameters"),r.createElement(on.a.Content,{active:le},r.createElement(L.a,null,r.createElement(L.a.Field,null,r.createElement("label",null," Number of clusters  ",r.createElement("input",{type:"number",value:V,step:"1",min:"2",max:"100",onChange:function(e){G(e.target.valueAsNumber)}})," ")),r.createElement(L.a.Field,null,r.createElement("label",null,"  Maximal number of possible peak positions to detect (better put higher value, the output is limited to the number of peaks the algorithm could find)  ",r.createElement("input",{type:"number",value:H,step:"1",min:"5",max:"200",onChange:function(e){U(e.target.valueAsNumber)}})," ")),r.createElement(L.a.Field,null,r.createElement("label",null,"  Minimal distance in pixels between peaks  ",r.createElement("input",{type:"number",value:k,step:"1",min:"0",max:"100",onChange:function(e){N(e.target.valueAsNumber)}}),"  ")))));return r.createElement(pn,{title:"Region clustering",subtitle:ce,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:b,imageWidth:l,onDragMove:Y,parentOnDrop:t,parentOnDragStart:e,constraint:$e(l,i)}),r.createElement(ht,{x:w.x,y:w.y,imageWidth:l,onDragMove:Ze(p,b,K),parentOnDrop:t,parentOnDragStart:e,constraint:nt(R.x,b)}),r.createElement(ht,{x:R.x,y:R.y,imageWidth:l,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ze(p,b,J),constraint:tt(w.x,b)}))},extraWidgets:z,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:ne})),mid:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:$,extraWidgets:Z})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:2,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:ae,extraWidgets:re})),toolbar:se,clustparams:de,title1:"Peaks inside the ring will be considered",title2:"Choose specimen region",title3:"Clustering result"})},En=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],S=v[1],x=function(e,t){f(e),y(t)},C=S,_={x:p-O,y:b},A=r.createElement(rt,{cx:p,cy:b,r:O,imageWidth:l,imageHeight:i}),j=Object(o.c)(),R=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),w=R.frameViewTitle,D=R.frameModeSelector,I=R.handles,k=R.widgets,L=r.createElement(r.Fragment,null,w," Disk: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), r=",O.toFixed(2)),N=r.createElement(cn,{compoundAnalysis:t,onApply:function(){j(St(t.compoundAnalysis,1,{analysisType:T.APPLY_DISK_MASK,parameters:{shape:"disk",cx:p,cy:b,r:O}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"Disk analysis",subtitle:L,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:b,imageWidth:l,onDragMove:x,parentOnDragStart:e,parentOnDrop:t,constraint:$e(l,i)}),r.createElement(ht,{x:_.x,y:_.y,imageWidth:l,onDragMove:Ze(p,b,C),parentOnDragStart:e,parentOnDrop:t,constraint:et(b)}))},extraWidgets:A,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:D})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:I,extraWidgets:k})),toolbar:N})},hn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(r.useState)(u/2),_=Object(Ie.a)(C,2),A=_[0],j=_[1],R={x:p-O,y:b},w={x:p-A,y:b},D=S((function(e,t){f(e),y(t)})),I=S(x),k=S(j),L=r.createElement(mn,{cx:p,cy:b,ri:O,ro:A,imageWidth:l}),N=Object(o.c)(),F=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),M=F.frameViewTitle,P=F.frameModeSelector,H=F.handles,U=F.widgets,W=r.createElement(r.Fragment,null,M," Ring: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), ri=",O.toFixed(2),", ro=",A.toFixed(2)),B=r.createElement(cn,{compoundAnalysis:t,onApply:function(){N(St(t.compoundAnalysis,1,{analysisType:T.FEM,parameters:{shape:"ring",cx:p,cy:b,ri:O,ro:A}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"Fluctuation EM (SD over Ring analysis)",subtitle:W,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:b,imageWidth:l,onDragMove:D,parentOnDrop:t,parentOnDragStart:e,constraint:$e(l,i)}),r.createElement(ht,{x:w.x,y:w.y,imageWidth:l,onDragMove:Ze(p,b,k),parentOnDrop:t,parentOnDragStart:e,constraint:nt(R.x,b)}),r.createElement(ht,{x:R.x,y:R.y,imageWidth:l,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ze(p,b,I),constraint:tt(w.x,b)}))},extraWidgets:L,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:P})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:H,extraWidgets:U})),toolbar:B})},bn=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.analysisIndex,s=e.compoundAnalysisId,i=e.cx,l=e.cy,u=e.real_rad,d=e.real_centerx,m=e.real_centery,p=e.setCx,f=e.setCy,E=Object(o.c)();c.a.useEffect((function(){t&&E(St(s,r,{analysisType:T.PICK_FFT_FRAME,parameters:{x:i,y:l,real_rad:u,real_centerx:d,real_centery:m}}))}),[s,i,l,t,r,u,d,m,E]);var h=function(e,t){var n=Math.round(e),a=Math.round(t);i===n&&l===a||(p(n),f(a))};return{coords:{cx:i,cy:l},handles:function(e,t){return c.a.createElement(ht,{x:i,y:l,withCross:!0,imageWidth:n,onDragMove:h,parentOnDragStart:e,parentOnDrop:t,constraint:$e(n,a)})}}},yn=function(e){var t=e.enabled,n=e.analysisIndex,a=e.compoundAnalysisId,r=e.real_rad,s=e.real_centerx,i=e.real_centery,l=Object(o.c)();c.a.useEffect((function(){t&&l(St(a,n,{analysisType:T.FFTSUM_FRAMES,parameters:{real_rad:r,real_centerx:s,real_centery:i}}))}),[a,t,n,r,s,i,l])},gn=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.compoundAnalysisId,c=e.real_rad,s=e.real_centerx,i=e.real_centery,l=e.doAutoStart,u=[{text:"Pick",value:T.PICK_FRAME},{text:"Average",value:T.SUM_FRAMES}],d=Object(r.useState)(T.SUM_FRAMES),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(o.c)(),h=r.createElement(Rt,{modes:u,currentMode:p,onModeChange:function(e){E(Ot(a)),f(e)},label:"Mode"}),b=r.useState(Math.round(t/2)),y=Object(Ie.a)(b,2),g=y[0],v=y[1],O=r.useState(Math.round(n/2)),S=Object(Ie.a)(O,2),x=S[0],C=S[1],_=jt({enabled:p===T.PICK_FRAME&&l,scanWidth:t,scanHeight:n,analysisIndex:1,compoundAnalysisId:a,cx:g,cy:x,setCx:v,setCy:C}),A=_.coords,j=_.handles;bn({enabled:p===T.PICK_FRAME&&l,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,cx:g,cy:x,setCx:v,setCy:C,real_rad:c,real_centerx:s,real_centery:i}),Dt({enabled:p===T.SUM_FRAMES&&l,analysisIndex:1,compoundAnalysisId:a,scanWidth:t,scanHeight:n,roiParameters:{roi:{}},analysisType:T.SUM_FRAMES}),yn({enabled:p===T.SUM_FRAMES&&l,analysisIndex:0,compoundAnalysisId:a,real_rad:c,real_centerx:s,real_centery:i});return{frameViewTitle:p!==T.PICK_FRAME?null:r.createElement(r.Fragment,null,"Pick: x=",A.cx,", y=",A.cy," \u2003"),handles:p!==T.PICK_FRAME?function(e,t){return null}:j,frameModeSelector:h}},vn=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.mid,s=e.right,o=e.toolbar,i=e.title1,l=e.title2,u=e.title3;return r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h3",attached:"top"},r.createElement(F.a,{name:"cog"}),r.createElement(ne.a.Content,null,t)),r.createElement(h.a,{attached:!0},r.createElement(kt.a,{columns:3},r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:5},r.createElement("p",null,i)),r.createElement(kt.a.Column,{width:5},r.createElement("p",null,l)),r.createElement(kt.a.Column,{width:6},r.createElement("p",null,u))),r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:5},a),r.createElement(kt.a.Column,{width:5},c),r.createElement(kt.a.Column,{width:6},s)),r.createElement(kt.a.Row,null,r.createElement(kt.a.Column,{width:10},r.createElement("p",null,n)),r.createElement(kt.a.Column,{width:6})))),o)},On=function(e){var t,n,a=e.compoundAnalysis,c=e.dataset.params.shape,s=Object(Ie.a)(c,4),i=s[0],l=s[1],u=s[2],d=s[3],m=Math.min(d,u),p=d/2,f=u/2,E=Object(r.useState)(m/4),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(m/2),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(o.c)(),_={x:p-b,y:f},A={x:p-O,y:f},j=S(y),R=S(x),w=r.createElement(mn,{cx:p,cy:f,ri:b,ro:O,imageWidth:d}),D=r.useState(!0),I=Object(Ie.a)(D,2),k=I[0],L=I[1],N=Object(r.useState)(d/2),F=Object(Ie.a)(N,2),M=F[0],P=F[1],H=Object(r.useState)(u/2),U=Object(Ie.a)(H,2),W=U[0],B=U[1],V=Object(r.useState)(m/4),G=Object(Ie.a)(V,2),Y=G[0],J=G[1],K=S((function(e,t){C(Ot(a.compoundAnalysis)),P(e),B(t)})),z=S(J),Q={x:M-Y,y:W},X=r.createElement(rt,{cx:M,cy:W,r:Y,imageWidth:d,imageHeight:u}),q=gn({scanWidth:l,scanHeight:i,compoundAnalysisId:a.compoundAnalysis,real_rad:k?Y:null,real_centerx:k?M:null,real_centery:k?W:null,doAutoStart:a.doAutoStart}),$=q.frameViewTitle,Z=q.frameModeSelector,ee=q.handles,te=r.createElement(cn,{compoundAnalysis:a,onApply:function(){C(St(a.compoundAnalysis,2,{analysisType:T.APPLY_FFT_MASK,parameters:{rad_in:b,rad_out:O,real_rad:k?Y:null,real_centerx:k?M:null,real_centery:k?W:null}}))},busyIdxs:[2]});return k?(n=r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:M,y:W,imageWidth:d,onDragMove:K,parentOnDragStart:e,parentOnDrop:t,constraint:$e(d,u)}),r.createElement(ht,{x:Q.x,y:Q.y,imageWidth:d,onDragMove:Ze(M,W,z),parentOnDragStart:e,parentOnDrop:t,constraint:et(W)}))},extraWidgets:X,analysisIndex:1,compoundAnalysis:a.compoundAnalysis,width:d,height:u,selectors:Z})),t=r.createElement(r.Fragment,null,$," real_rad=",b.toFixed(2),", real_center=(x=",M.toFixed(2),", y=",W.toFixed(2),"), fourier_rad_in=",b.toFixed(2),", fourier_rad_out=",O.toFixed(2))):(n=r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:a.compoundAnalysis,width:d,height:u,selectors:Z})),t=r.createElement(r.Fragment,null,$," fourier_rad_in=",b.toFixed(2),", fourier_rad_out=",O.toFixed(2))),r.createElement(vn,{title:"FFT analysis",subtitle:t,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:A.x,y:A.y,imageWidth:d,onDragMove:Ze(p,f,R),parentOnDrop:t,parentOnDragStart:e,constraint:nt(_.x,f)}),r.createElement(ht,{x:_.x,y:_.y,imageWidth:d,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ze(p,f,j),constraint:tt(A.x,f)}))},extraWidgets:w,analysisIndex:0,compoundAnalysis:a.compoundAnalysis,width:d,height:u})),mid:n,right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:2,compoundAnalysis:a.compoundAnalysis,width:l,height:i,extraHandles:ee})),toolbar:te,title2:r.createElement(r.Fragment,null,r.createElement("label",null," Masking out of zero order diffraction peak ",r.createElement("input",{type:"checkbox",name:"check",onChange:function(e){C(Ot(a.compoundAnalysis)),L(e.target.checked)},checked:k})," ")),title1:"Masking of integration region in Fourier space",title3:"Result of analysis"})},Sn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Object(r.useState)(l/2),d=Object(Ie.a)(u,2),m=d[0],p=d[1],f=Object(r.useState)(i/2),E=Object(Ie.a)(f,2),h=E[0],b=E[1],y=S((function(e,t){var n=Math.round(e),a=Math.round(t);m===n&&h===a||(p(n),b(a))})),g=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),v=g.frameViewTitle,O=g.frameModeSelector,x=g.handles,C=g.widgets,_=r.createElement(r.Fragment,null,v," Point: center=(x=",m.toFixed(2),", y=",h.toFixed(2),")"),A=Object(o.c)(),j=r.createElement(cn,{compoundAnalysis:t,onApply:function(){A(St(t.compoundAnalysis,1,{analysisType:T.APPLY_POINT_SELECTOR,parameters:{shape:"point",cx:m,cy:h}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"Point analysis",subtitle:_,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:m,y:h,withCross:!0,onDragMove:y,imageWidth:l,parentOnDragStart:e,parentOnDrop:t,constraint:$e(l,i)}))},analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:O})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:x,extraWidgets:C})),toolbar:j})},xn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(r.useState)(u/2),_=Object(Ie.a)(C,2),A=_[0],j=_[1],R=Object(r.useState)(1),w=Object(Ie.a)(R,1)[0],D=Object(r.useState)(8),I=Object(Ie.a)(D,1)[0],k={x:p-O,y:b},L={x:p-A,y:b},N=S((function(e,t){f(e),y(t)})),F=S(x),M=S(j),P=r.createElement(mn,{cx:p,cy:b,ri:O,ro:A,imageWidth:l}),H=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),U=H.frameViewTitle,W=H.frameModeSelector,B=H.handles,V=H.widgets,G=r.createElement(r.Fragment,null,U," Ring: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), ri=",O.toFixed(2),", ro=",A.toFixed(2)),Y=Object(o.c)(),J=r.createElement(cn,{compoundAnalysis:t,onApply:function(){Y(St(t.compoundAnalysis,1,{analysisType:T.RADIAL_FOURIER,parameters:{shape:"radial_fourier",cx:p,cy:b,ri:O,ro:A,n_bins:w,max_order:I}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"Radial Fourier analysis",subtitle:G,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:b,imageWidth:l,onDragMove:N,parentOnDrop:t,parentOnDragStart:e,constraint:$e(l,i)}),r.createElement(ht,{x:L.x,y:L.y,imageWidth:l,onDragMove:Ze(p,b,M),parentOnDrop:t,parentOnDragStart:e,constraint:nt(k.x,b)}),r.createElement(ht,{x:k.x,y:k.y,imageWidth:l,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ze(p,b,F),constraint:tt(L.x,b)}))},extraWidgets:P,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:W})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:B,extraWidgets:V})),toolbar:J})},Cn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],s=a[1],i=a[2],l=a[3],u=Math.min(l,i),d=Object(r.useState)(l/2),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=Object(r.useState)(i/2),h=Object(Ie.a)(E,2),b=h[0],y=h[1],g=Object(r.useState)(u/4),v=Object(Ie.a)(g,2),O=v[0],x=v[1],C=Object(r.useState)(u/2),_=Object(Ie.a)(C,2),A=_[0],j=_[1],R={x:p-O,y:b},w={x:p-A,y:b},D=S((function(e,t){f(e),y(t)})),I=S(x),k=S(j),L=r.createElement(mn,{cx:p,cy:b,ri:O,ro:A,imageWidth:l}),N=Object(o.c)(),F=It({scanWidth:s,scanHeight:c,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),M=F.frameViewTitle,P=F.frameModeSelector,H=F.handles,U=F.widgets,W=r.createElement(r.Fragment,null,M," Ring: center=(x=",p.toFixed(2),", y=",b.toFixed(2),"), ri=",O.toFixed(2),", ro=",A.toFixed(2)),B=r.createElement(cn,{compoundAnalysis:t,onApply:function(){N(St(t.compoundAnalysis,1,{analysisType:T.APPLY_RING_MASK,parameters:{shape:"ring",cx:p,cy:b,ri:O,ro:A}}))},busyIdxs:[1]});return r.createElement(Lt,{title:"Ring analysis",subtitle:W,left:r.createElement(r.Fragment,null,r.createElement(qe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:b,imageWidth:l,onDragMove:D,parentOnDrop:t,parentOnDragStart:e,constraint:$e(l,i)}),r.createElement(ht,{x:w.x,y:w.y,imageWidth:l,onDragMove:Ze(p,b,k),parentOnDrop:t,parentOnDragStart:e,constraint:nt(R.x,b)}),r.createElement(ht,{x:R.x,y:R.y,imageWidth:l,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ze(p,b,I),constraint:tt(w.x,b)}))},extraWidgets:L,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:l,height:i,selectors:P})),right:r.createElement(r.Fragment,null,r.createElement(qe,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:s,height:c,extraHandles:H,extraWidgets:U})),toolbar:B})},_n=(dn={},Object(A.a)(dn,T.APPLY_RING_MASK,{desc:"Application of a ring mask",title:"Ring",component:Cn}),Object(A.a)(dn,T.APPLY_DISK_MASK,{desc:"Application of a disk mask",title:"Disk",component:En}),Object(A.a)(dn,T.FEM,{desc:"Application of a ring mask",title:"FEM (SD over Ring)",component:hn}),Object(A.a)(dn,T.CENTER_OF_MASS,{desc:"The center of mass of all diffraction images",title:"Center of mass",component:sn}),Object(A.a)(dn,T.APPLY_POINT_SELECTOR,{desc:"Image from a single pixel selected in the detector",title:"Point selection",component:Sn}),Object(A.a)(dn,T.SUM_FRAMES,{desc:"A sum of all (or selected) detector frames",title:"Sum all frames"}),Object(A.a)(dn,T.SD_FRAMES,{desc:"A SD of all (or selected) detector frames",title:"SD all frames"}),Object(A.a)(dn,T.PICK_FRAME,{desc:"A single picked frame",title:"Pick frame"}),Object(A.a)(dn,T.PICK_FFT_FRAME,{desc:"Fourier transform of a picked frame",title:"Pick frame"}),Object(A.a)(dn,T.APPLY_FFT_MASK,{desc:"Application of a ring mask in Fourier space",title:"FFT analysis",component:On}),Object(A.a)(dn,T.FFTSUM_FRAMES,{desc:"Fourier transform of sum of all detector frames",title:"FFT of Sum all frames"}),Object(A.a)(dn,T.RADIAL_FOURIER,{desc:"Radial Fourier analysis over the selected ring",title:"Radial Fourier",component:xn}),Object(A.a)(dn,T.CLUST,{desc:"Region clustering based on non-zero order diffraction peaks positions",title:"Clustering",component:fn}),Object(A.a)(dn,T.SUM_SIG,{desc:"Frame integration",title:"Sum"}),dn),An=function(e){var t=e.analysis,n=Object(o.d)((function(e){return e.datasets.byId[t.dataset]}));if(n.status!==R.OPEN)return null;var a=_n[t.details.mainType].component;if(!a)throw new Error("unknown analysis type");return r.createElement(a,{dataset:n,compoundAnalysis:t})},jn=function(e){var t=e.analyses;return r.createElement(r.Fragment,null,t.ids.map((function(e){return r.createElement(An,{key:e,analysis:t.byId[e]})})))};function Rn(e,t,n){var a=Object.assign({},e.byId[t],n),r=Object.assign({},e.byId,Object(A.a)({},t,a));return Object.assign({},e,{byId:r})}function Tn(e,t,n){return{byId:Object.assign({},e.byId,Object(A.a)({},t,n)),ids:[].concat(Object(ke.a)(e.ids),[t])}}function wn(e,t){return e.reduce((function(e,n){return Object.assign(e,Object(A.a)({},t(n),n))}),{})}function Dn(e,t){return{byId:e.ids.reduce((function(n,a){return Object.assign(n,Object(A.a)({},a,t(e.byId[a])))}),{}),ids:e.ids}}function In(e,t){var n=e.ids.filter((function(n){return t(e.byId[n])}));return{byId:n.reduce((function(t,n){return Object.assign(t,Object(A.a)({},n,e.byId[n]))}),{}),ids:n}}function kn(e,t){return e.includes(t)?e.filter((function(e){return e!==t})):[t].concat(Object(ke.a)(e))}var Ln,Nn=x(T).filter((function(e){return void 0!==en(e).component})).map((function(e){return{text:en(e).title,value:T[e]}})),Fn=function(e){var t=e.onClick,n=e.label;return r.createElement(E.a,{text:n,icon:"add",floating:!0,labeled:!0,button:!0,className:"icon"},r.createElement(E.a.Menu,null,r.createElement(E.a.Header,{content:"implemented analyses"}),Nn.map((function(e){return r.createElement(E.a.Item,Object.assign({key:e.value,onClick:(n=t,function(e,t){return n(t.value)})},e));var n}))))},Mn=Object(o.b)(null,(function(e,t){return{handleAddAnalysis:function(n){e(gt(t.dataset.id,n))}}}))((function(e){var t=e.handleAddAnalysis;return r.createElement(Fn,{onClick:t,label:"Add analysis"})})),Pn=n(724),Hn=function(e,t,n){return r.createElement(Pn.a.Row,{key:n},r.createElement(Pn.a.Cell,null,t),r.createElement(Pn.a.Cell,null,(a=e[t])instanceof Array?"(".concat(a.join(","),")"):a));var a},Un=function(e){var t,n=e.dataset;return r.createElement(Pn.a,null,r.createElement(Pn.a.Header,null,r.createElement(Pn.a.Row,null,r.createElement(Pn.a.HeaderCell,null,"Parameter"),r.createElement(Pn.a.HeaderCell,null,"Value"))),r.createElement(Pn.a.Body,null,(t=n.params,Object.keys(t).map((function(e,n){return"object"!==typeof t[e]||t[e]instanceof Array?Hn(t,e,n):Object.keys(t[e]).map((function(n,a){return Hn(t[e],n,a)}))})))))},Wn=function(e){var t=e.elem;return r.createElement(Pn.a.Row,null,r.createElement(Pn.a.Cell,null,t.name),r.createElement(Pn.a.Cell,null,function(e){return e.value instanceof Array?r.createElement(Bn,{diagnostics:e.value}):e.value}(t)))},Bn=function(e){var t=e.diagnostics;return 0===t.length?null:r.createElement(Pn.a,null,r.createElement(Pn.a.Header,null,r.createElement(Pn.a.Row,null,r.createElement(Pn.a.HeaderCell,null,"Name"),r.createElement(Pn.a.HeaderCell,null,"Value"))),r.createElement(Pn.a.Body,null,t.map((function(e,t){return r.createElement(Wn,{elem:e,key:t})}))))},Vn=function(e){var t=e.dataset;return r.createElement(r.Fragment,null,r.createElement(Un,{dataset:t}),r.createElement(Bn,{diagnostics:t.diagnostics}))};!function(e){e.OPEN="DATASET_OPEN",e.CANCEL_OPEN="DATASET_CANCEL_OPEN",e.CREATE="DATASET_CREATE",e.CREATED="DATASET_CREATED",e.ERROR="DATASET_ERROR",e.DELETE="DATASET_DELETE",e.DELETED="DATASET_DELETED",e.DETECT="DATASET_DETECT",e.DETECTED="DATASET_DETECTED",e.DETECT_FAILED="DATASET_DETECT_FAILED"}(Ln||(Ln={}));var Gn=function(e,t,n,a){return b(Ln.OPEN,{path:e,cachedParams:t,detectedParams:n,detectedInfo:a})},Yn=function(){return b(Ln.CANCEL_OPEN)},Jn=function(e){return b(Ln.CREATE,{dataset:e})},Kn=function(e){return b(Ln.CREATED,{dataset:e})},zn=function(e,t,n,a){return b(Ln.ERROR,{dataset:e,msg:t,timestamp:n,id:a})},Qn=function(e){return b(Ln.DELETE,{dataset:e})},Xn=function(e){return b(Ln.DELETED,{dataset:e})},qn=function(e){return b(Ln.DETECT,{path:e})},$n=function(e,t,n){return b(Ln.DETECTED,{path:e,params:t,info:n})},Zn=function(e){return b(Ln.DETECT_FAILED,{path:e})},ea=Object(o.b)(null,(function(e,t){return{handleRemoveDataset:function(){e(Qn(t.dataset.id))}}}))((function(e){e.dataset;var t=e.handleRemoveDataset;return r.createElement(r.Fragment,null,r.createElement(M.a,{icon:"remove",labelPosition:"left",onClick:t,content:"Close Dataset"}))})),ta=Object(o.b)((function(e,t){return{analyses:In(e.compoundAnalyses,(function(e){return e.dataset===t.dataset.id}))}}))((function(e){var t,n=e.dataset,a=e.analyses,c=(t={},Object(A.a)(t,R.OPENING,"Opening dataset ".concat(n.params.name)),Object(A.a)(t,R.DELETING,"Closing dataset ".concat(n.params.name)),t);return n.status===R.OPENING||n.status===R.DELETING?r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h2",dividing:!0},n.params.name),r.createElement(P.a,{icon:!0},r.createElement(F.a,{name:"cog",loading:!0}),r.createElement(P.a.Content,null,r.createElement(P.a.Header,null,c[n.status])))):r.createElement(h.a.Group,{style:{marginTop:"3em",marginBottom:"3em"}},r.createElement(h.a.Group,{horizontal:!0},r.createElement(h.a,null,r.createElement(ne.a,{as:"h2"},r.createElement(F.a,{name:"database"}),r.createElement(N.a,{trigger:r.createElement(ne.a.Content,null,n.params.name," ",r.createElement(F.a,{name:"info circle",size:"small",link:!0}))},r.createElement(De.a.Header,null,n.params.type," Dataset ",n.params.name),r.createElement(De.a.Content,null,r.createElement(Vn,{dataset:n}))))),r.createElement(h.a,{style:{flexShrink:1,flexGrow:0}},r.createElement(ea,{dataset:n}))),a.ids.length>0?r.createElement(r.Fragment,null,r.createElement(h.a,null,r.createElement(jn,{analyses:a}))):null,r.createElement(h.a,{textAlign:"center"},r.createElement(Mn,{dataset:n})))})),na=n(30),aa=n.n(na),ra=n(242),ca=n(385),sa=n.n(ca);function oa(e,t){return ia.apply(this,arguments)}function ia(){return(ia=Object(Mt.a)(Ft.a.mark((function e(t,n){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bt("datasets/".concat(t,"/"),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function la(e){return ua.apply(this,arguments)}function ua(){return(ua=Object(Mt.a)(Ft.a.mark((function e(t){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut("datasets/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function da(e){return ma.apply(this,arguments)}function ma(){return(ma=Object(Mt.a)(Ft.a.mark((function e(t){var n,a;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ht(),e.next=3,fetch("".concat(n,"datasets/detect/?path=").concat(encodeURIComponent(t)),{credentials:"same-origin",method:"GET"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pa={};function fa(e){return Ea.apply(this,arguments)}function Ea(){return(Ea=Object(Mt.a)(Ft.a.mark((function e(t){var n,a,r,c;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ht(),!(a=pa[t])){e.next=6;break}return e.abrupt("return",new Promise((function(e){return e(a)})));case 6:return e.next=8,fetch("".concat(n,"datasets/schema/?type=").concat(encodeURIComponent(t)),{credentials:"same-origin",method:"GET"});case 8:return r=e.sent,e.next=11,r.json();case 11:return c=e.sent,pa[t]=c,e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ha(e){var t={};return e.forEach((function(e){var n=e.dataPath.replace(/^\.([^[]+)(\[[^]+\])?$/,(function(e,t){return t}));t[n]=e.message})),t}function ba(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e||t){var n=e?Object(I.a)(Object(I.a)({},ha(e)),{},{customValidateErrors:t}):t;throw n}throw new Error("unspecified error while validating fields")}function ya(){return(ya=Object(Mt.a)(Ft.a.mark((function e(t,n,a){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fa(t).then((function(e){if("error"===e.status)throw new Error(e.msg);var t=e.schema,r=(new sa.a).compile(t);r(n)&&!a||ba(r.errors,a)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ga(e){return e.split(",").filter((function(e){return""!==e.trim()})).map((function(e){return+e}))}function va(e){return ga(e).reduce((function(e,t){return e*t}),1)}function Oa(e,t,n,a){var r={};return e&&!function(e,t){return va(e)===va(t)}(t,e.toString())&&(r.sig_shape="must be of size: ".concat(va(e.toString()))),a&&!function(e,t){return-t<e&&e<t}(n,a)&&(r.sync_offset="must be in (-".concat(a,", ").concat(a,")")),r}function Sa(e,t,n){return n&&void 0!==n[e]?n[e]:t}function xa(e,t,n){return n&&void 0!==n[e]?n[e]:ra.basename(t)}function Ca(e){return!!Object.keys(j).some((function(t){return t===e}))}function _a(e){return Object(k.c)({mapPropsToValues:e.mapPropsToValues,handleSubmit:function(t,n){var a=n.props,r=a.onSubmit,c=a.path;r(e.formToJson(t,c)),n.setSubmitting(!1)},validate:function(t,n){var a;return function(e,t,n){return ya.apply(this,arguments)}(e.type,e.formToJson(t,n.path),null===(a=e.customValidation)||void 0===a?void 0:a.call(e,t,n))},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0})}var Aa,ja=function(e){var t=e.name,n=e.id,a=e.tupleKey,c=e.tupleInputChangeHandle,s=e.value,o=e.commaPressHandle,i=e.tupleRef;return r.createElement("input",{type:"number",name:t,id:n,key:a,onChange:function(e){c(a,e.target.value)},value:s,onKeyDown:function(e){188===e.keyCode&&o(a)},ref:i})},Ra=function(e){var t=e.value,n=e.minLen,a=e.maxLen,c=e.fieldName,s=e.setFieldValue,o=function(e,t,n){var a=new Array(t).fill("");if(e){var r=e.split(",");t>r.length?a=[].concat(Object(ke.a)(r),Object(ke.a)(Array(t-r.length).fill(""))):(r=r.slice(0,n),a=Object(ke.a)(r))}return a}(t,n,a),i=r.useRef([]),l=function(e,t){var n=Object(ke.a)(o);n[e]=t,s(c,n.toString())},u=function(e){e===o.length-1?d():i.current[e+1].focus()},d=function(){if(o.length<a){var e=Object(ke.a)(o);e.push(""),s(c,e.toString())}};return r.createElement(r.Fragment,null,r.createElement(L.a.Group,null,o.map((function(e,t){return r.createElement(L.a.Field,{width:2,key:t},r.createElement(ja,{tupleKey:t,name:c+"_"+t,id:"id_"+c+"_"+t,value:e,tupleRef:function(e){i.current[t]=e},tupleInputChangeHandle:l,commaPressHandle:u}))})),r.createElement(L.a.Field,{hidden:n===a},r.createElement(M.a,{onClick:d,disabled:o.length===a,type:"button",icon:"add",title:"Add dimension",basic:!1}),r.createElement(M.a,{onClick:function(){if(o.length>n){var e=Object(ke.a)(o);e.pop(),s(c,e.toString()),i.current[o.length-2].focus()}},disabled:o.length===n,type:"button",icon:"minus",title:"Remove dimension",basic:!1}))))},Ta=function(e){var t=e.navShape,n=e.sigShape,a=e.syncOffset,c=e.imageCount,s=void 0===c?0:c,o=e.hideInfo,i=void 0!==o&&o,l=e.setFieldValue,u=void 0!==t?t:"0",d=void 0!==n?n:"0",m=va(t),p=r.useState(a.toString()),f=Object(Ie.a)(p,2),E=f[0],h=f[1],b=parseInt(E,10);r.useEffect((function(){h(a.toString())}),[a]);var y=function(e,t,n){return{framesSkippedStart:Math.max(0,e),framesIgnoredEnd:Math.max(0,n-t-e),framesInsertedStart:Math.abs(Math.min(0,e)),framesInsertedEnd:Math.max(0,t-n+e)}}(b,m,s),g=y.framesSkippedStart,v=y.framesIgnoredEnd,O=y.framesInsertedStart,S=y.framesInsertedEnd;return r.createElement("div",{style:{paddingBottom:5}},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_nav_shape_0"},"Nav Shape:"),r.createElement("div",{style:{color:"red"}},r.createElement(k.a,{name:"nav_shape"})),r.createElement(Ra,{value:u,minLen:2,maxLen:2,fieldName:"nav_shape",setFieldValue:l}),r.createElement("label",{htmlFor:"id_sig_shape_0"},"Sig Shape:"),r.createElement("div",{style:{color:"red"}},r.createElement(k.a,{name:"sig_shape"})),r.createElement(Ra,{value:d,minLen:2,maxLen:2,fieldName:"sig_shape",setFieldValue:l})),r.createElement(L.a.Field,{width:4},r.createElement("label",{htmlFor:"id_sync_offset"},"Sync Offset (frames):"),r.createElement("div",{style:{color:"red"}},r.createElement(k.a,{name:"sync_offset"})),r.createElement(ge.a,{type:"number",required:!0,name:"sync_offset",id:"id_sync_offset",value:E,onChange:function(e){var t=e.target.value;h(t),l("sync_offset",parseInt(t,10))}})),r.createElement(L.a.Field,{hidden:i},r.createElement("label",null,"Number of frames skipped at the beginning: ",g),r.createElement("label",null,"Number of blank frames inserted at the beginning: ",O),r.createElement("label",null,"Number of frames ignored at the end: ",v),r.createElement("label",null,"Number of blank frames inserted at the end: ",S)))},wa=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.BLO,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.BLO})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.isValidating,i=e.onCancel,l=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:l}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a||o},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:i},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Da=x(j).map((function(e){return{text:j[e],value:j[e]}})),Ia=function(e){var t=e.currentType,n=e.onClick;return r.createElement(r.Fragment,null,r.createElement(E.a,{inline:!0,options:Da,value:t,onChange:n}))},ka=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.EMPAD,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.EMPAD})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.onCancel,i=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:o},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),La=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.FRMS6,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.FRMS6})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.onCancel,i=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:o},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Na=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),ds_path:Sa("ds_path","",n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.HDF5,name:e.name,ds_path:e.ds_path,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},type:j.HDF5})((function(e){var t,n=e.values,a=e.info,c=(e.touched,e.errors,e.dirty,e.isSubmitting),s=(e.handleChange,e.handleBlur,e.handleSubmit),o=e.handleReset,i=e.onCancel,l=e.setFieldValue,u=null===a||void 0===a?void 0:a.dataset_paths.map((function(e){return{key:e,text:e,value:e}}));return t=0===(null===a||void 0===a?void 0:a.dataset_paths.length)?r.createElement(k.b,{name:"ds_path",id:"id_ds_path"}):r.createElement(E.a,{name:"ds_path",id:"id_ds_path",placeholder:"Select dataset",fluid:!0,search:!0,selection:!0,defaultValue:n.ds_path,onChange:function(e,t){var n=t.value;n&&l("ds_path",n.toString())},options:u}),r.createElement(L.a,{onSubmit:s},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_ds_path"},"HDF5 Dataset Path:"),r.createElement(k.a,{name:"ds_path"}),t),r.createElement(M.a,{primary:!0,type:"submit",disabled:c},"Load Dataset"),r.createElement(M.a,{onClick:i},"Cancel"),r.createElement(M.a,{type:"button",onClick:o},"Reset"))})),Fa=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.K2IS,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},type:j.K2IS})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;e.setFieldValue;return r.createElement(L.a,{onSubmit:n},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(M.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:c},"Cancel"),r.createElement(M.a,{type:"button",onClick:a},"Reset"))})),Ma=_a({formToJson:function(e,t){return{path:t,type:j.MIB,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.MIB})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.isValidating,i=e.onCancel,l=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:l}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a||o},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:i},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Pa=_a({formToJson:function(e,t){return{path:t,type:j.MRC,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.MRC})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.isValidating,i=e.onCancel,l=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:l}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a||o},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:i},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Ha=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),enable_direct:Sa("enable_direct",!1,n),dtype:Sa("dtype","float32",n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.RAW,name:e.name,dtype:e.dtype,enable_direct:e.enable_direct,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},type:j.RAW})((function(e){var t=e.values,n=(e.touched,e.errors,e.dirty,e.isSubmitting),a=(e.handleChange,e.handleBlur,e.handleSubmit),c=e.handleReset,s=e.onCancel,o=e.setFieldValue;return r.createElement(L.a,{onSubmit:a},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_dtype"},"Datatype (uint16, uint32, float32, float64, >u2, ..., can be anything that is ",r.createElement("a",{href:"https://numpy.org/doc/stable/reference/arrays.dtypes.html"},"understood by numpy as a dtype"),"):"),r.createElement(k.a,{name:"dtype"}),r.createElement(k.b,{name:"dtype",id:"id_dtype"})),r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_enable_direct"},"Enable Direct I/O (for usage with fast SSDs and files much larger than RAM):"),r.createElement(k.a,{name:"enable_direct"}),r.createElement(k.b,{type:"checkbox",name:"enable_direct",checked:t.enable_direct,id:"id_enable_direct"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,hideInfo:!0,setFieldValue:o}),r.createElement(M.a,{primary:!0,type:"submit",disabled:n},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:s},"Cancel"),r.createElement(M.a,{type:"button",onClick:c},"Reset"))})),Ua=_a({formToJson:function(e,t){return{path:t,type:j.SEQ,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.SEQ})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.isValidating,i=e.onCancel,l=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:l}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a||o},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:i},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Wa=_a({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:xa("name",t,n),nav_shape:Sa("nav_shape","",n).toString(),sig_shape:Sa("sig_shape","",n).toString(),sync_offset:Sa("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:j.SER,name:e.name,nav_shape:ga(e.nav_shape),sig_shape:ga(e.sig_shape),sync_offset:e.sync_offset}},customValidation:function(e,t){var n=t.info;return Oa(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:j.SER})((function(e){var t=e.values,n=e.info,a=(e.touched,e.errors,e.dirty,e.isSubmitting),c=(e.handleChange,e.handleBlur,e.handleSubmit),s=e.handleReset,o=e.onCancel,i=e.setFieldValue;return r.createElement(L.a,{onSubmit:c},r.createElement(L.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(k.a,{name:"name"}),r.createElement(k.b,{name:"name",id:"id_name"})),r.createElement(Ta,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i}),r.createElement(M.a,{primary:!0,type:"submit",disabled:a},"Load Dataset"),r.createElement(M.a,{type:"button",onClick:o},"Cancel"),r.createElement(M.a,{type:"button",onClick:s},"Reset"))})),Ba=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;return e?a?a.type:j.RAW:n?n.type:a?a.type:j.RAW},Va=function(){var e=Object(o.c)(),t=Object(o.d)((function(e){return e.openDataset})),n=r.useState(!1),a=Object(Ie.a)(n,2),c=a[0],s=a[1],i=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;if(e)return a?Object(I.a)(Object(I.a)({},a),{},{name:n?n.name:""}):void 0;if(n){var r=n;return n.scan_size&&(r=Object(I.a)(Object(I.a)({},r),{},{nav_shape:n.scan_size,scan_size:[]})),n.detector_size&&(r=Object(I.a)(Object(I.a)({},r),{},{sig_shape:n.detector_size,detector_size:[]})),n.nav_shape||(r=Object(I.a)(Object(I.a)({},r),{},{nav_shape:a?a.nav_shape:[]})),n.sig_shape||(r=Object(I.a)(Object(I.a)({},r),{},{sig_shape:a?a.sig_shape:[]})),r}return a}(c,t),l=function(e){var t=e.formDetectedInfo;if(t)return t}(t),u=Ba(c,t),d=r.useState(u),m=Object(Ie.a)(d,2),p=m[0],f=m[1],E=function(e,t){return f(t.value)},b=function(e){return r.createElement(h.a,null,"Type: ",r.createElement(Ia,{onClick:E,currentType:p}),r.createElement(ne.a,{as:"h2"},"Open: ",t.formPath),e)},y={path:t.formPath,onSubmit:function(t){e(Jn({id:aa()(),params:t}))},onCancel:function(){return e(Yn())},onReset:function(){s(!0),f(Ba(!0,t))}};switch(p){case j.HDF5:var g=i&&p===i.type?i:void 0,v=l&&p===l.type?l:void 0;return b(r.createElement(Na,Object.assign({},y,{initial:g,info:v})));case j.RAW:var S=i&&p===i.type?i:void 0,x=l&&p===l.type?l:void 0;return b(r.createElement(Ha,Object.assign({},y,{initial:S,info:x})));case j.MIB:var C=i&&p===i.type?i:void 0,_=l&&p===l.type?l:void 0;return b(r.createElement(Ma,Object.assign({},y,{initial:C,info:_})));case j.BLO:var A=i&&p===i.type?i:void 0,R=l&&p===l.type?l:void 0;return b(r.createElement(wa,Object.assign({},y,{initial:A,info:R})));case j.K2IS:var T=i&&p===i.type?i:void 0,w=l&&p===l.type?l:void 0;return b(r.createElement(Fa,Object.assign({},y,{initial:T,info:w})));case j.SER:var D=i&&p===i.type?i:void 0,k=l&&p===l.type?l:void 0;return b(r.createElement(Wa,Object.assign({},y,{initial:D,info:k})));case j.FRMS6:var L=i&&p===i.type?i:void 0,N=l&&p===l.type?l:void 0;return b(r.createElement(La,Object.assign({},y,{initial:L,info:N})));case j.EMPAD:var F=i&&p===i.type?i:void 0,M=l&&p===l.type?l:void 0;return b(r.createElement(ka,Object.assign({},y,{initial:F,info:M})));case j.SEQ:var P=i&&p===i.type?i:void 0,H=l&&p===l.type?l:void 0;return b(r.createElement(Ua,Object.assign({},y,{initial:P,info:H})));case j.MRC:var U=i&&p===i.type?i:void 0,W=l&&p===l.type?l:void 0;return b(r.createElement(Pa,Object.assign({},y,{initial:U,info:W})))}return O("unknown dataset type")},Ga=Object(o.b)((function(e){return{busy:e.openDataset.busy,path:e.openDataset.busyPath}}))((function(e){var t=e.busy,n=e.path;return t?r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h2",dividing:!0},"Loading..."),r.createElement(P.a,{icon:!0},r.createElement(F.a,{name:"cog",loading:!0}),r.createElement(P.a.Content,null,r.createElement(P.a.Header,null,"Detecting parameters for ",n)))):null})),Ya=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.formVisible,n=e.datasets;return r.createElement(r.Fragment,null,n.ids.map((function(e){return r.createElement(ta,{dataset:n.byId[e],key:e})})),r.createElement(Ga,null),t&&r.createElement(Va,null),r.createElement(we,null))}}]),n}(r.Component),Ja=Object(o.b)((function(e){return{datasets:e.datasets,formVisible:e.openDataset.formVisible,formPath:e.openDataset.formPath}}))(Ya);!function(e){e.DISMISS="ERROR_DISMISS",e.DISMISS_ALL="ERROR_DISMISS_ALL"}(Aa||(Aa={}));var Ka=function(e){return b(Aa.DISMISS,{id:e})},za=function(){return b(Aa.DISMISS_ALL)},Qa=Object(o.b)(null,(function(e,t){return{dismiss:function(){return e(Ka(t.error.id))}}}))((function(e){var t=e.dismiss,n=e.error;return r.createElement(P.a,{negative:!0,onDismiss:t},n.msg)})),Xa=Object(o.b)((function(e){return{errors:e.errors,channelConnected:"connected"===e.channelStatus.status||"ready"===e.channelStatus.status}}))((function(e){var t,n=e.errors,a=e.channelConnected,s=n.ids.slice(Math.max(0,n.ids.length-3)),i=n.ids.length>0&&a,l=Object(o.c)();return t=function(){l(za())},c.a.useEffect((function(){var e=function(e){"Escape"!==e.code&&27!==e.keyCode||t()};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}})),r.createElement(N.a,{open:i},s.map((function(e){return r.createElement(Qa,{error:n.byId[e],key:e})})))})),qa=n(386),$a=n.n(qa),Za=n(725),er=Object(o.b)((function(e){return{version:e.config.version,revision:e.config.revision}}))((function(e){var t=e.version,n=e.revision;return r.createElement(r.Fragment,null,r.createElement(ne.a,{as:"h3"},"This is LiberTEM version ",t," (revision ",n.slice(0,8),")"),r.createElement(Za.a,null,r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"github"}),r.createElement(Za.a.Content,null,"Find us on ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM"},"GitHub"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"bug"}),r.createElement(Za.a.Content,null,"Found a bug? Got a feature request? Please ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/issues/new"},"open an issue!"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"legal"}),r.createElement(Za.a.Content,null,"LiberTEM is licensed under the ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE"},"GNU General Public License v3.0"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"book"}),r.createElement(Za.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/"},"the documentation"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"user"}),r.createElement(Za.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/acknowledgments.html"},"the acknowledgments"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"gitter"}),r.createElement(Za.a.Content,null,"Join our ",r.createElement("a",{href:"https://gitter.im/LiberTEM/Lobby"},"chat on gitter!"))),r.createElement(Za.a.Item,null,r.createElement(Za.a.Icon,{name:"linkify"}),r.createElement(Za.a.Content,null,r.createElement("a",{href:"https://doi.org/10.5281/zenodo.1477847"},r.createElement("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.1477847.svg",alt:"doi.org/10.5281/zenodo.1477847"}))))))}));function tr(){return nr.apply(this,arguments)}function nr(){return(nr=Object(Mt.a)(Ft.a.mark((function e(){var t,n,a;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ht(),n="".concat(t,"config/cluster/"),e.next=4,fetch(n,{method:"GET",credentials:"same-origin"});case 4:return a=e.sent,e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ar,rr=function(e){var t,n=e.localCore,a=e.cudas,c=Object(r.useState)([{host:"",cpu:0,cuda:0,service:0}]),s=Object(Ie.a)(c,2),o=s[0],i=s[1];if(Object(r.useEffect)((function(){(function(){var e=Object(Mt.a)(Ft.a.mark((function e(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tr().then((function(e){i(e.details)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),0===a.length)t="None selected";else{var l=a.map((function(e){return" ".concat(e)})).join(",");t="GPU ".concat(l)}return r.createElement(N.a.Content,null,r.createElement(Za.a,null,r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,{as:"h4"},"Connected to local cluster")),r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Number of local core : ",n)),r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Number of CPU workers : ",o[0].cpu," ")),r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Number of CUDA workers : ",o[0].cuda)),r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Selected CUDA devices : ",t))))},cr=function(){return r.createElement(N.a.Content,null,r.createElement(Za.a,null,r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Not Connected"))))},sr=function(e){var t=e.address,n=["import libertem.api as lt","import distributed as dd","from libertem.executor.dask import DaskJobExecutor\n",'client = dd.Client("URI")',"executor = DaskJobExecutor(client)\n","ctx = lt.Context(executor=executor)"].join("\n").replace("URI",t),a=Object(r.useState)([]),c=Object(Ie.a)(a,2),s=c[0],o=c[1];return Object(r.useEffect)((function(){(function(){var e=Object(Mt.a)(Ft.a.mark((function e(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tr().then((function(e){o(e.details)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.createElement(N.a.Content,null,r.createElement(Za.a,null,r.createElement(ne.a,{as:"h4",attached:"top"},"Connected to ",t),r.createElement(h.a.Group,null,function(e){var t=Object(r.useState)({host:0,cpu:0,cuda:0}),n=Object(Ie.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(!1),o=Object(Ie.a)(s,2),i=o[0],l=o[1],u=Object(r.useState)("More Info"),d=Object(Ie.a)(u,2),m=d[0],p=d[1];Object(r.useEffect)((function(){var t={host:0,cpu:0,cuda:0};e.forEach((function(e){t.host+=1,t.cpu+=e.cpu,t.cuda+=e.cuda})),c(t)}),[e]);var f=e.map((function(e){return r.createElement(h.a,{key:e.host},r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Host : ",e.host),r.createElement(Za.a.Content,null,"Number of CPU workers : ",e.cpu),r.createElement(Za.a.Content,null,"Number of CUDA workers : ",e.cuda)))}));return r.createElement(r.Fragment,null,r.createElement(h.a,null,r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,"Number of hosts : ",a.host),r.createElement(Za.a.Content,null,"Number of CPU workers : ",a.cpu),r.createElement(Za.a.Content,null,"Number of CUDA workers : ",a.cuda))),r.createElement(on.a,null,r.createElement(on.a.Title,{active:i,onClick:function(){l(!i),p("More Info"===m?"Less Info":"More Info")}},r.createElement(F.a,{name:"dropdown"}),m),r.createElement(on.a.Content,{active:i},r.createElement(h.a.Group,null,f))))}(s)),r.createElement(Za.a.Item,null,r.createElement(Za.a.Content,null,r.createElement(h.a.Group,null,r.createElement(h.a,{as:"h5"},"Connection code"),r.createElement(h.a,null,r.createElement(M.a,{floated:"right",icon:"copy",onClick:function(){navigator.clipboard.writeText(n)}}),r.createElement("pre",null,r.createElement("code",null,n))))))))},or=Object(o.b)((function(e){return{clusterConnection:e.clusterConnection,channelStatus:e.channelStatus.status,type:e.config.lastConnection.type,localcore:e.config.localCores,cudas:e.config.lastConnection.cudas,address:e.config.lastConnection.address}}))((function(e){var t,n=e.clusterConnection,a=e.channelStatus,c=e.type,s=e.localcore,o=e.cudas,i=e.address;!function(e){e.blue="blue",e.grey="grey"}(t||(t={}));var l=Object(r.useState)(t.grey),u=Object(Ie.a)(l,2),d=u[0],m=u[1],p=Object(r.useState)(n.status),f=Object(Ie.a)(p,2),E=f[0],h=f[1],b=Object(r.useState)(!0),y=Object(Ie.a)(b,2),g=y[0],v=y[1];Object(r.useEffect)((function(){"connected"===a||"ready"===a?(h(n.status),v(!1),"connected"===n.status?m(t.blue):m(t.grey)):(v(!0),h("unknown"),m(t.grey))}),[n,a,t]);return r.createElement(N.a,{trigger:r.createElement(M.a,{color:d,content:"Cluster info",icon:"plug",labelPosition:"left",disabled:g,label:{as:"a",basic:!0,content:E}}),size:"small"},r.createElement(De.a.Header,null,"Connection Info"),r.createElement(De.a.Content,null,"connected"===n.status?"LOCAL"===c?r.createElement(rr,{cudas:o,localCore:s}):r.createElement(sr,{address:i}):r.createElement(cr,null)))}));!function(e){e.INITIAL_STATE="CHANNEL_INITIAL_STATE",e.JOB_STARTED="CHANNEL_JOB_STARTED",e.FINISH_JOB="CHANNEL_FINISH_JOB",e.TASK_RESULT="CHANNEL_TASK_RESULT",e.JOB_ERROR="CHANNEL_JOB_ERROR",e.OPEN="CHANNEL_OPEN",e.CLOSE="CHANNEL_CLOSE",e.ERROR="CHANNEL_ERROR",e.CANCELLED="CANCELLED",e.CANCEL_JOB_FAILED="CANCEL_JOB_FAILED",e.SHUTDOWN="CHANNEL_SHUTDOWN",e.CLOSE_LOOP="CHANNEL_LOOP_CLOSE",e.ANALYSIS_CREATED="ANALYSIS_CREATED",e.ANALYSIS_UPDATED="ANALYSIS_UPDATED",e.ANALYSIS_REMOVED="ANALYSIS_REMOVED"}(ar||(ar={}));var ir={initialState:function(e,t,n,a,r){return b(ar.INITIAL_STATE,{jobs:e,datasets:t,timestamp:r,compoundAnalyses:n,analyses:a})},jobStarted:function(e,t,n){return b(ar.JOB_STARTED,{job:e,timestamp:n,dataset:t})},finishJob:function(e,t,n){return b(ar.FINISH_JOB,{job:e,results:t,timestamp:n})},taskResult:function(e,t,n){return b(ar.TASK_RESULT,{job:e,results:t,timestamp:n})},jobError:function(e,t,n,a){return b(ar.JOB_ERROR,{job:e,msg:t,id:n,timestamp:a})},open:function(e){return b(ar.OPEN,{timestamp:e})},close:function(e){return b(ar.CLOSE,{timestamp:e})},error:function(e,t,n){return b(ar.ERROR,{msg:e,timestamp:t,id:n})},shutdown:function(e){return b(ar.SHUTDOWN,{timestamp:e})},closeloop:function(e){return b(ar.CLOSE_LOOP,{timestamp:e})},cancelled:function(e){return b(ar.CANCELLED,{job:e})},cancelFailed:function(e){return b(ar.CANCEL_JOB_FAILED,{job:e})},analysisCreated:function(e,t,n){return b(ar.ANALYSIS_CREATED,{dataset:t,analysis:e,details:n})},analysisUpdated:function(e,t,n){return b(ar.ANALYSIS_UPDATED,{dataset:t,analysis:e,details:n})},analysisRemoved:function(e){return b(ar.ANALYSIS_REMOVED,{analysis:e})}};function lr(){return ur.apply(this,arguments)}function ur(){return(ur=Object(Mt.a)(Ft.a.mark((function e(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut("shutdown/");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dr={closeLoopAction:ir.closeloop,shutdownAction:ir.shutdown},mr=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={modal:!1,shutdown:!1},e.modalOpen=function(){e.setState({modal:!0})},e.modalClose=function(){e.setState({modal:!1})},e.handleShutdown=function(){e.setState({shutdown:!0}),lr().then((function(t){var n=Date.now();e.props.closeLoopAction(n)}))},e}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(){if("waiting"===this.props.channel&&this.state.shutdown){var e=Date.now();this.modalClose(),this.props.shutdownAction(e)}}},{key:"render",value:function(){return r.createElement(N.a,{trigger:r.createElement(M.a,{content:"Shutdown",icon:"shutdown",onClick:this.modalOpen,disabled:this.state.shutdown,labelPosition:"left",floated:"right"}),open:this.state.modal,closeOnDimmerClick:!1,onClose:this.modalClose,size:"mini"},r.createElement(ne.a,{icon:"shutdown",content:"Confirm shutdown"}),r.createElement(N.a.Content,null,r.createElement("p",null,"Do you want to shutdown ?")),r.createElement(N.a.Actions,null,r.createElement(M.a,{onClick:this.modalClose,disabled:this.state.shutdown},r.createElement(F.a,{name:"remove"})," Cancel"),r.createElement(M.a,{primary:!0,loading:this.state.shutdown,disabled:this.state.shutdown,onClick:this.handleShutdown},r.createElement(F.a,{name:"checkmark"})," Shutdown")))}}]),n}(r.Component),pr=Object(o.b)((function(e){return{channel:e.channelStatus.status}}),dr)(mr),fr=function(){return c.a.createElement(me.a,{fixed:"top"},c.a.createElement(me.a.Item,null,c.a.createElement(N.a,{trigger:c.a.createElement(M.a,{content:"About"})},c.a.createElement(De.a.Header,null,"About LiberTEM"),c.a.createElement(De.a.Content,null,c.a.createElement(er,null)))),c.a.createElement(me.a.Menu,{position:"right"},c.a.createElement(me.a.Item,null,c.a.createElement(or,null)),c.a.createElement(me.a.Item,null,c.a.createElement(pr,null))))},Er=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement(fr,null),r.createElement(f.a,{style:{margin:"5em 1em 5em 1em"}},r.createElement("div",{style:{display:"flex"}},r.createElement("img",{src:$a.a,width:"200",height:"46",alt:"LiberTEM",style:{marginBottom:"20px"}})),r.createElement(Xa,null),r.createElement(Z,null,r.createElement(Ja,null))))}}]),n}(r.Component),hr=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function br(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var yr=n(6);function gr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=function(t){return t.replace(new RegExp("".concat(v.a.escapeRegExp(e.separator),"$")),"")};return(n=[r(n[0])].concat(Object(ke.a)(n.slice(1)))).map((function(e){return e.trim()})).join(e.separator)}function vr(e){var t=window.localStorage.getItem("LiberTEM.config");if(null===t)return Object.assign({},Sr(),e);var n=JSON.parse(t),a=Sr();return Object.assign({},a,e,n)}function Or(e){var t={cwd:e.cwd,lastOpened:e.lastOpened,fileHistory:e.fileHistory,lastConnection:e.lastConnection,starred:e.starred};window.localStorage.setItem("LiberTEM.config",JSON.stringify(t))}function Sr(){return{lastOpened:{},fileHistory:[],cwd:"/",lastConnection:{type:_.LOCAL,address:"tcp://localhost:8786",cudas:[]},starred:[]}}function xr(e){return e.reduce((function(e,t){return-1===e.indexOf(t)?[].concat(Object(ke.a)(e),[t]):e}),[])}function Cr(e){return _r.apply(this,arguments)}function _r(){return(_r=Object(Mt.a)(Ft.a.mark((function e(t){var n,a,r;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ht(),a="".concat(n,"browse/localfs/?path=").concat(encodeURIComponent(t)),e.next=4,fetch(a,{method:"GET",credentials:"same-origin"});case 4:return r=e.sent,e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ar,jr=Ft.a.mark(Dr),Rr=Ft.a.mark(Ir),Tr=Ft.a.mark(kr),wr=Ft.a.mark(Lr);function Dr(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.f)(Ir);case 2:return e.next=4,Object(yr.f)(Lr);case 4:case"end":return e.stop()}}),jr)}function Ir(){var e,t,n,a,r,c;return Ft.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=3,Object(yr.i)(D.LIST_DIRECTORY);case 3:return e=s.sent,t=e.payload,n=t.name,a=t.path,s.next=7,Object(yr.h)((function(e){return e.config}));case 7:return r=s.sent,c=void 0!==n?gr(r,a,n):a,s.next=11,Object(yr.f)(kr,c);case 11:s.next=0;break;case 13:case"end":return s.stop()}}),Rr)}function kr(e){var t,n,a,r,c,s,o,i;return Ft.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,Object(yr.c)(Cr,e);case 3:if("ok"!==(t=l.sent).status){l.next=9;break}return l.next=7,Object(yr.g)(ee.dirListing(t.path,t.dirs,t.files,t.drives,t.places));case 7:l.next=24;break;case 9:if("error"!==t.status){l.next=24;break}return l.next=12,Object(yr.h)((function(e){return e.browser}));case 12:return n=l.sent,a=Date.now(),r=aa()(),c=t.alternative?t.alternative:n.places.home.path,l.next=18,Object(yr.h)((function(e){return e.config}));case 18:if(l.sent.cwd===e){l.next=22;break}return l.next=22,Object(yr.g)(ee.error("Error browsing directory: ".concat(t.msg),a,r));case 22:return l.next=24,Object(yr.g)(ee.list(c));case 24:l.next=37;break;case 26:return l.prev=26,l.t0=l.catch(0),l.next=30,Object(yr.h)((function(e){return e.browser}));case 30:return s=l.sent,o=Date.now(),i=aa()(),l.next=35,Object(yr.g)(ee.error("Error browsing directory: ".concat(l.t0.toString()),o,i));case 35:return l.next=37,Object(yr.g)(ee.list(s.places.home.path));case 37:case"end":return l.stop()}}),Tr,null,[[0,26]])}function Lr(){var e;return Ft.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.i)(D.OPEN);case 3:return t.next=5,Object(yr.h)((function(e){return e.config}));case 5:return e=t.sent,t.next=8,Object(yr.g)(ee.list(e.cwd));case 8:t.next=0;break;case 10:case"end":return t.stop()}}),wr)}function Nr(e,t){return Object.assign({messageType:e},t)}!function(e){e.INITIAL_STATE="INITIAL_STATE",e.JOB_STARTED="JOB_STARTED",e.FINISH_JOB="FINISH_JOB",e.TASK_RESULT="TASK_RESULT",e.JOB_ERROR="JOB_ERROR",e.BINARY="BINARY",e.OPEN="OPEN",e.CLOSE="CLOSE",e.ERROR="ERROR",e.DELETE_DATASET="DELETE_DATASET",e.CREATE_DATASET="CREATE_DATASET",e.CANCEL_JOB_DONE="CANCEL_JOB_DONE",e.CANCEL_JOB_FAILED="CANCEL_JOB_FAILED",e.ANALYSIS_CREATED="ANALYSIS_CREATED",e.ANALYSIS_UPDATED="ANALYSIS_UPDATED",e.ANALYSIS_REMOVED="ANALYSIS_REMOVED",e.COMPOUND_ANALYSIS_CREATED="COMPOUND_ANALYSIS_CREATED",e.COMPOUND_ANALYSIS_UPDATED="COMPOUND_ANALYSIS_UPDATED",e.COMPOUND_ANALYSIS_REMOVED="COMPOUND_ANALYSIS_REMOVED"}(Ar||(Ar={}));var Fr=function(e){return Nr(Ar.BINARY,{objectURL:e})},Mr=function(){return Nr(Ar.OPEN,{})},Pr=function(){return Nr(Ar.CLOSE,{})},Hr=function(e){return Nr(Ar.ERROR,{msg:e})},Ur=Ft.a.mark(Jr),Wr=Ft.a.mark(Kr),Br=Ft.a.mark(zr),Vr=Ft.a.mark(Qr),Gr=Ft.a.mark(Xr);function Yr(){return Object(l.d)((function(e){function t(t){if(t.data instanceof Blob)e(Fr(URL.createObjectURL(t.data)));else{var n=JSON.parse(t.data);e(n)}}function n(){e(Mr())}function a(){e(Pr()),e(l.a)}function r(t){e(Hr("Error in weboscket connection"))}var c=new WebSocket(function(){var e=Ht();return"ws://".concat(window.location.hostname,":").concat(window.location.port).concat(e,"events/")}());return c.addEventListener("message",t),c.addEventListener("open",n),c.addEventListener("close",a),c.addEventListener("error",r),function(){c.removeEventListener("message",t),c.removeEventListener("open",n),c.removeEventListener("close",a),c.removeEventListener("error",r)}}))}function Jr(){var e;return Ft.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.c)(Yr);case 3:return e=t.sent,t.next=6,Object(yr.f)(Kr,e);case 6:return t.next=8,Object(yr.i)([ar.OPEN,ar.CLOSE]);case 8:if(t.sent.type!==ar.OPEN){t.next=15;break}return t.next=12,Object(yr.i)([ar.CLOSE,ar.ERROR,ar.CLOSE_LOOP]);case 12:if(t.sent.type!==ar.CLOSE_LOOP){t.next=15;break}return t.abrupt("break",19);case 15:return t.next=17,Object(yr.e)(1e3);case 17:t.next=0;break;case 19:case"end":return t.stop()}}),Ur)}function Kr(e){var t,n,a,r;return Ft.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:c.prev=0;case 1:return c.next=4,Object(yr.i)(e);case 4:t=c.sent,n=Date.now(),c.t0=t.messageType,c.next=c.t0===Ar.OPEN?9:c.t0===Ar.CLOSE?12:c.t0===Ar.ERROR?15:c.t0===Ar.INITIAL_STATE?19:c.t0===Ar.JOB_STARTED?22:c.t0===Ar.FINISH_JOB?25:c.t0===Ar.TASK_RESULT?28:c.t0===Ar.CREATE_DATASET?31:c.t0===Ar.DELETE_DATASET?34:c.t0===Ar.JOB_ERROR?37:c.t0===Ar.CANCEL_JOB_DONE?41:c.t0===Ar.CANCEL_JOB_FAILED?44:46;break;case 9:return c.next=11,Object(yr.g)(ir.open(n));case 11:return c.abrupt("break",46);case 12:return c.next=14,Object(yr.g)(ir.close(n));case 14:return c.abrupt("break",46);case 15:return a=aa()(),c.next=18,Object(yr.g)(ir.error(t.msg,n,a));case 18:return c.abrupt("break",46);case 19:return c.next=21,Object(yr.g)(ir.initialState(t.jobs,t.datasets,t.compoundAnalyses,t.analyses,n));case 21:return c.abrupt("break",46);case 22:return c.next=24,Object(yr.g)(ir.jobStarted(t.job,t.details.dataset,n));case 24:return c.abrupt("break",46);case 25:return c.next=27,Object(yr.c)(Xr,t,e,n);case 27:return c.abrupt("break",46);case 28:return c.next=30,Object(yr.c)(Qr,t,e,n);case 30:return c.abrupt("break",46);case 31:return c.next=33,Object(yr.g)(Kn(t.details));case 33:return c.abrupt("break",46);case 34:return c.next=36,Object(yr.g)(Xn(t.dataset));case 36:return c.abrupt("break",46);case 37:return r=aa()(),c.next=40,Object(yr.g)(ir.jobError(t.job,t.msg,r,n));case 40:return c.abrupt("break",46);case 41:return c.next=43,Object(yr.g)(ir.cancelled(t.job));case 43:return c.abrupt("break",46);case 44:return c.next=46,Object(yr.g)(ir.cancelFailed(t.job));case 46:c.next=1;break;case 48:return c.prev=48,c.finish(48);case 50:case"end":return c.stop()}}),Wr,null,[[0,,48,50]])}function zr(e,t){var n,a;return Ft.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=[];case 1:if(!(n.length<e)){r.next=8;break}return r.next=4,Object(yr.i)(t);case 4:a=r.sent,n.push(a),r.next=1;break;case 8:return r.abrupt("return",n);case 9:case"end":return r.stop()}}),Br)}function Qr(e,t,n){var a,r;return Ft.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Object(yr.c)(zr,e.followup.numMessages,t);case 2:return a=c.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),c.next=6,Object(yr.g)(ir.taskResult(e.job,r,n));case 6:case"end":return c.stop()}}),Vr)}function Xr(e,t,n){var a,r;return Ft.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Object(yr.c)(zr,e.followup.numMessages,t);case 2:return a=c.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),c.next=6,Object(yr.g)(ir.finishJob(e.job,r,n));case 6:case"end":return c.stop()}}),Gr)}function qr(e){return $r.apply(this,arguments)}function $r(){return($r=Object(Mt.a)(Ft.a.mark((function e(t){var n;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={connection:t},e.next=3,Bt("config/connection/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zr(){return ec.apply(this,arguments)}function ec(){return(ec=Object(Mt.a)(Ft.a.mark((function e(){var t,n;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ht(),e.next=3,fetch("".concat(t,"config/connection/"),{method:"GET"});case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tc=Ft.a.mark(cc),nc=Ft.a.mark(sc),ac=Ft.a.mark(oc),rc=Ft.a.mark(ic);function cc(e){var t;return Ft.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(yr.g)(y.connecting());case 2:return n.next=4,Object(yr.c)(qr,e.payload.params);case 4:return t=n.sent,n.next=7,Object(yr.c)(sc,t);case 7:case"end":return n.stop()}}),tc)}function sc(e){var t,n;return Ft.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("ok"!==e.status){a.next=5;break}return a.next=3,Object(yr.g)(y.connected(e.connection.connection));case 3:a.next=16;break;case 5:if("error"!==e.status){a.next=14;break}return a.next=8,Object(yr.g)(y.notConnected());case 8:return t=Date.now(),n=aa()(),a.next=12,Object(yr.g)(y.error("error connecting to cluster: ".concat(e.msg),t,n));case 12:a.next=16;break;case 14:return a.next=16,Object(yr.g)(y.notConnected());case 16:case"end":return a.stop()}}),nc)}function oc(){var e;return Ft.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.i)(ar.OPEN);case 3:return t.next=5,Object(yr.c)(Zr);case 5:return e=t.sent,t.next=8,Object(yr.c)(sc,e);case 8:t.next=0;break;case 10:case"end":return t.stop()}}),ac)}function ic(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(a.CONNECT,cc);case 2:return e.next=4,Object(yr.b)([oc()]);case 4:case"end":return e.stop()}}),rc)}var lc,uc=n(132);!function(e){e.CREATE="ANALYSIS_CREATE",e.CREATED="ANALYSIS_CREATED",e.UPDATED="ANALYSIS_UPDATED",e.REMOVE="ANALYSIS_REMOVE",e.REMOVED="ANALYSIS_REMOVED",e.ERROR="ANALYSIS_ERROR"}(lc||(lc={}));var dc,mc=function(e,t,n){return b(lc.CREATED,{analysis:e,compoundAnalysis:t,analysisIndex:n})},pc=function(e,t){return b(lc.UPDATED,{id:e,details:t})},fc=function(e){return b(lc.REMOVED,{id:e})};!function(e){e.CREATE="JOB_CREATE"}(dc||(dc={}));var Ec=function(e,t,n){return b(dc.CREATE,{id:e,analysis:t,timestamp:n})};function hc(e,t){return bc.apply(this,arguments)}function bc(){return(bc=Object(Mt.a)(Ft.a.mark((function e(t,n){var a;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={job:{analysis:n}},e.next=3,Bt("jobs/".concat(t,"/"),a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yc(e){return gc.apply(this,arguments)}function gc(){return(gc=Object(Mt.a)(Ft.a.mark((function e(t){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut("jobs/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var vc=Ft.a.mark(Ic),Oc=Ft.a.mark(kc),Sc=Ft.a.mark(Lc),xc=Ft.a.mark(Nc),Cc=Ft.a.mark(Fc),_c=Ft.a.mark(Mc),Ac=Ft.a.mark(Pc),jc=Ft.a.mark(Hc);function Rc(e,t){return e.datasets.byId[t]}function Tc(e,t){return e.compoundAnalyses.byId[t]}function wc(e,t){return e.analyses.byId[t]}function Dc(e,t){return e.jobs.byId[t]}function Ic(e,t){return Ft.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(yr.i)(ft.REMOVE);case 3:if(n.sent.payload.id!==e.compoundAnalysis){n.next=7;break}return n.next=7,Object(yr.d)(t);case 7:n.next=0;break;case 9:case"end":return n.stop()}}),vc)}function kc(e){var t,n,a,r;return Ft.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(yr.h)(Rc,e.payload.dataset);case 3:if(c.sent.status===R.OPEN){c.next=6;break}throw new Error("invalid dataset status");case 6:return t={compoundAnalysis:aa()(),dataset:e.payload.dataset,details:{mainType:e.payload.analysisType,analyses:[]}},c.next=9,Object(yr.c)(zt,t.compoundAnalysis,t.dataset,t.details);case 9:return c.next=11,Object(yr.f)(Fc,t.compoundAnalysis,{doAutoStart:!0});case 11:return n=c.sent,c.next=14,Object(yr.g)(vt(t,!0));case 14:return c.next=16,Object(yr.f)(Ic,t,n);case 16:c.next=24;break;case 18:return c.prev=18,c.t0=c.catch(0),a=Date.now(),r=aa()(),c.next=24,Object(yr.g)(At("Error creating analysis: ".concat(c.t0.toString()),a,r));case 24:case"end":return c.stop()}}),Oc,null,[[0,18]])}function Lc(e){var t,n,a,r,c;return Ft.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=Object(uc.a)(e.payload.compoundAnalyses),s.prev=1,t.s();case 3:if((n=t.n()).done){s.next=15;break}return a=n.value,s.next=7,Object(yr.h)(Tc,a.compoundAnalysis);case 7:return r=s.sent,s.next=10,Object(yr.f)(Fc,r.compoundAnalysis,{doAutoStart:!1});case 10:return c=s.sent,s.next=13,Object(yr.f)(Ic,r,c);case 13:s.next=3;break;case 15:s.next=20;break;case 17:s.prev=17,s.t0=s.catch(1),t.e(s.t0);case 20:return s.prev=20,t.f(),s.finish(20);case 23:case"end":return s.stop()}}),Sc,null,[[1,17,20,23]])}function Nc(e,t,n,a){var r,c,s,o,i,l,u,d;return Ft.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:if(!t){m.next=33;break}return m.next=3,Object(yr.c)(Gt,e.compoundAnalysis,t,e.dataset,a);case 3:return m.next=5,Object(yr.g)(pc(t,a));case 5:return m.next=7,Object(yr.h)(wc,t);case 7:r=m.sent,c=r.jobs?r.jobs:[],s=Object(uc.a)(c),m.prev=10,s.s();case 12:if((o=s.n()).done){m.next=22;break}return i=o.value,m.next=16,Object(yr.h)(Dc,i);case 16:if(!(l=m.sent)||"DONE"===l.running){m.next=20;break}return m.next=20,Object(yr.c)(yc,i);case 20:m.next=12;break;case 22:m.next=27;break;case 24:m.prev=24,m.t0=m.catch(10),s.e(m.t0);case 27:return m.prev=27,s.f(),m.finish(27);case 30:return m.abrupt("return",t);case 33:return u=aa()(),m.next=36,Object(yr.c)(Gt,e.compoundAnalysis,u,e.dataset,a);case 36:return m.next=38,Object(yr.g)(mc({id:u,dataset:e.dataset,details:a,jobs:[]},e.compoundAnalysis,n));case 38:return m.next=40,Object(yr.h)(Tc,e.compoundAnalysis);case 40:return d=m.sent,m.next=43,Object(yr.c)(zt,d.compoundAnalysis,d.dataset,d.details);case 43:return m.abrupt("return",u);case 44:case"end":return m.stop()}}),xc,null,[[10,24,27,30]])}function Fc(e,t){var n,a,r,c,s,o,i,u,d,m,p;return Ft.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(yr.a)(ft.RUN,l.b.sliding(2));case 2:n=t.sent;case 3:return t.prev=4,t.next=7,Object(yr.i)(n);case 7:if((a=t.sent).payload.id===e){t.next=10;break}return t.abrupt("continue",3);case 10:return t.next=12,Object(yr.h)(Tc,e);case 12:return r=t.sent,c=a.payload,s=c.analysisIndex,o=c.details,i=r.details.analyses[s],t.next=17,Object(yr.c)(Nc,r,i,s,o);case 17:return u=t.sent,d=aa()(),t.next=21,Object(yr.g)(Ec(d,u,Date.now()));case 21:return t.next=23,Object(yr.c)(hc,d,u);case 23:return t.next=25,Object(yr.g)(xt(r.compoundAnalysis,d,s));case 25:t.next=33;break;case 27:return t.prev=27,t.t0=t.catch(4),m=Date.now(),p=aa()(),t.next=33,Object(yr.g)(At("Error running analysis: ".concat(t.t0.toString()),m,p));case 33:t.next=3;break;case 35:case"end":return t.stop()}}),Cc,null,[[4,27]])}function Mc(e){var t,n,a,r;return Ft.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=Object(uc.a)(e.jobs),c.prev=1,t.s();case 3:if((n=t.n()).done){c.next=13;break}return a=n.value,c.next=7,Object(yr.h)(Dc,a);case 7:if(!(r=c.sent)||"DONE"===r.running){c.next=11;break}return c.next=11,Object(yr.c)(yc,a);case 11:c.next=3;break;case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(1),t.e(c.t0);case 18:return c.prev=18,t.f(),c.finish(18);case 21:case"end":return c.stop()}}),_c,null,[[1,15,18,21]])}function Pc(e){var t,n,a,r,c;return Ft.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(yr.h)(Tc,e.payload.id);case 2:t=s.sent,s.prev=3,n=Object(uc.a)(t.details.analyses),s.prev=5,n.s();case 7:if((a=n.n()).done){s.next=20;break}return r=a.value,s.next=11,Object(yr.h)(wc,r);case 11:return c=s.sent,s.next=14,Object(yr.c)(Mc,c);case 14:return s.next=16,Object(yr.c)(Jt,t.compoundAnalysis,r);case 16:return s.next=18,Object(yr.g)(fc(r));case 18:s.next=7;break;case 20:s.next=25;break;case 22:s.prev=22,s.t0=s.catch(5),n.e(s.t0);case 25:return s.prev=25,n.f(),s.finish(25);case 28:return s.next=30,Object(yr.c)(Xt,e.payload.id);case 30:return s.prev=30,s.next=33,Object(yr.g)(_t(e.payload.id));case 33:return s.finish(30);case 34:case"end":return s.stop()}}),Ac,null,[[3,,30,34],[5,22,25,28]])}function Hc(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(ft.CREATE,kc);case 2:return e.next=4,Object(yr.j)(ft.REMOVE,Pc);case 4:return e.next=6,Object(yr.j)(ar.INITIAL_STATE,Lc);case 6:case"end":return e.stop()}}),jc)}function Uc(){return Wc.apply(this,arguments)}function Wc(){return(Wc=Object(Mt.a)(Ft.a.mark((function e(){var t,n;return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ht(),e.next=3,fetch("".concat(t,"config/"),{method:"GET",credentials:"same-origin"});case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Bc=Ft.a.mark(Kc),Vc=Ft.a.mark(zc),Gc=Ft.a.mark(Qc),Yc=Ft.a.mark(Xc),Jc=Ft.a.mark(qc);function Kc(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(ar.OPEN,zc);case 2:case"end":return e.stop()}}),Bc)}function zc(){var e,t,n;return Ft.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(yr.g)(pe());case 2:return a.next=4,Object(yr.c)(Uc);case 4:return e=a.sent,a.prev=5,t=vr(e.config),a.next=9,Object(yr.g)(fe(t));case 9:a.next=17;break;case 11:a.prev=11,a.t0=a.catch(5);try{window.localStorage.removeItem("LiberTEM.config")}catch(r){}return n=Object.assign({},e.config,Sr()),a.next=17,Object(yr.g)(fe(n));case 17:case"end":return a.stop()}}),Vc,null,[[5,11]])}function Qc(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(yr.i)([Ln.CREATE,D.DIRECTORY_LISTING,a.CONNECTED,re.TOGGLE_STAR]);case 3:return e.next=5,Object(yr.h)((function(e){return e.config}));case 5:Or(e.sent),e.next=0;break;case 9:case"end":return e.stop()}}),Gc)}function Xc(){var e,t;return Ft.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(yr.c)(zc);case 3:n.next=11;break;case 5:return n.prev=5,n.t0=n.catch(0),e=Date.now(),t=aa()(),n.next=11,Object(yr.g)(Ee("failed to fetch config: ".concat(n.t0.toString()),e,t));case 11:case"end":return n.stop()}}),Yc,null,[[0,5]])}function qc(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.f)(Xc);case 2:return e.next=4,Object(yr.f)(Kc);case 4:return e.next=6,Object(yr.f)(Qc);case 6:case"end":return e.stop()}}),Jc)}var $c=Ft.a.mark(cs),Zc=Ft.a.mark(ss),es=Ft.a.mark(os),ts=Ft.a.mark(is),ns=Ft.a.mark(ls),as=Ft.a.mark(us),rs=Ft.a.mark(ds);function cs(e){var t,n,a,r,c;return Ft.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(yr.c)(oa,e.payload.dataset.id,{dataset:e.payload.dataset});case 3:if("ok"!==(t=s.sent).status){s.next=9;break}return s.next=7,Object(yr.g)(Kn(t.details));case 7:s.next=14;break;case 9:if("error"!==t.status){s.next=14;break}return n=Date.now(),a=aa()(),s.next=14,Object(yr.g)(zn(t.dataset,t.msg,n,a));case 14:s.next=22;break;case 16:return s.prev=16,s.t0=s.catch(0),r=Date.now(),c=aa()(),s.next=22,Object(yr.g)(zn(e.payload.dataset.id,"Error loading dataset: ".concat(s.t0.toString()),r,c));case 22:case"end":return s.stop()}}),$c,null,[[0,16]])}function ss(e){var t,n;return Ft.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(yr.c)(la,e.payload.dataset);case 3:a.next=11;break;case 5:return a.prev=5,a.t0=a.catch(0),t=Date.now(),n=aa()(),a.next=11,Object(yr.g)(zn(e.payload.dataset,"Error closing dataset: ".concat(a.t0.toString()),t,n));case 11:case"end":return a.stop()}}),Zc,null,[[0,5]])}function os(e){var t,n,a,r,c,s;return Ft.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(yr.g)(qn(e));case 2:return o.next=4,Object(yr.c)(da,e);case 4:if(t=o.sent,r=!0,"ok"!==t.status){o.next=23;break}if(!Ca(t.datasetParams.type)){o.next=14;break}return n=t.datasetParams,a=t.datasetInfo,o.next=12,Object(yr.g)($n(e,n,a));case 12:o.next=21;break;case 14:return c=Date.now(),s=aa()(),o.next=18,Object(yr.g)(Zn(e));case 18:return r=!1,o.next=21,Object(yr.g)(zn(s,t.datasetParams.type+" dataset type is currently not supported in the GUI",c,s));case 21:o.next=25;break;case 23:return o.next=25,Object(yr.g)(Zn(e));case 25:return o.abrupt("return",[n,r,a]);case 26:case"end":return o.stop()}}),es)}function is(e){var t,n,a,r,c,s;return Ft.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(yr.h)((function(e){return e.config}));case 2:return t=o.sent,n=t.lastOpened[e],c=!0,o.prev=5,o.next=8,Object(yr.c)(os,e);case 8:s=o.sent,a=s[0],c=s[1],r=s[2],o.next=18;break;case 14:return o.prev=14,o.t0=o.catch(5),o.next=18,Object(yr.g)(Zn(e));case 18:if(!c){o.next=21;break}return o.next=21,Object(yr.g)(Gn(e,n,a,r));case 21:case"end":return o.stop()}}),ts,null,[[5,14]])}function ls(e){var t;return Ft.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.payload.path,n.next=3,Object(yr.c)(is,t);case 3:case"end":return n.stop()}}),ns)}function us(e){var t,n;return Ft.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(yr.h)((function(e){return e.config}));case 2:return t=a.sent,n=gr(t,e.payload.path,e.payload.name),a.next=6,Object(yr.c)(is,n);case 6:case"end":return a.stop()}}),as)}function ds(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(Ln.CREATE,cs);case 2:return e.next=4,Object(yr.j)(Ln.DELETE,ss);case 4:return e.next=6,Object(yr.j)(D.SELECT,us);case 6:return e.next=8,Object(yr.j)(D.SELECT_FULL_PATH,ls);case 8:case"end":return e.stop()}}),rs)}var ms=Ft.a.mark(ps);function ps(){return Ft.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.b)([qc(),Jr(),Hc(),ds(),ic(),Dr()]);case 2:case"end":return e.stop()}}),ms)}var fs={byId:{},ids:[]};var Es,hs={isOpen:!1,isLoading:!0,path:"/",drives:[],places:{},files:[],dirs:[]};!function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.READY="ready",e.WAITING="waiting",e.DISCONNECTED="disconnected"}(Es||(Es={}));var bs={status:Es.WAITING};var ys={status:"unknown"};var gs={byId:{},ids:[]};var vs={version:"",revision:"",localCores:0,devices:{cpus:[],cudas:[],has_cupy:!1},cwd:"/",separator:"/",lastOpened:{},resultFileFormats:{},fileHistory:[],haveConfig:!1,lastConnection:{type:_.LOCAL,address:"tcp://localhost:8786",cudas:[]},starred:[]};var Os={byId:{},ids:[]};var Ss={busy:!1,busyPath:"",formVisible:!1,formPath:"/",formCachedParams:void 0,formDetectedParams:void 0,formDetectedInfo:void 0};var xs={byId:{},ids:[]};var Cs={byId:{},ids:[]};var _s=Object(i.c)({compoundAnalyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ft.CREATED:var n=Object(I.a)({doAutoStart:t.payload.autoStart},t.payload.compoundAnalysis);return Tn(e,t.payload.compoundAnalysis.compoundAnalysis,n);case ft.REMOVED:return In(e,(function(e){return e.compoundAnalysis!==t.payload.id}));case ft.ENABLE_AUTOSTART:return Rn(e,t.payload.compoundAnalysisId,{doAutoStart:!0});case Ln.DELETE:return In(e,(function(e){return e.dataset!==t.payload.dataset}));case lc.CREATED:var a=e.byId[t.payload.compoundAnalysis],r=Object(ke.a)(a.details.analyses);return r[t.payload.analysisIndex]=t.payload.analysis.id,Rn(e,t.payload.compoundAnalysis,{details:{analyses:r,mainType:a.details.mainType}});case ar.INITIAL_STATE:var c=t.payload.compoundAnalyses.map((function(e){return Object(I.a)({doAutoStart:!1},e)}));return{byId:wn(c,(function(e){return e.compoundAnalysis})),ids:c.map((function(e){return e.compoundAnalysis}))}}return e},analyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case lc.CREATED:return Tn(e,t.payload.analysis.id,t.payload.analysis);case lc.REMOVED:return In(e,(function(e){return e.id!==t.payload.id}));case lc.UPDATED:return Rn(e,t.payload.id,{details:t.payload.details});case dc.CREATE:var n=e.byId[t.payload.analysis],a=n.jobs?n.jobs:[];return Rn(e,t.payload.analysis,{jobs:[t.payload.id].concat(Object(ke.a)(a))});case ar.CANCEL_JOB_FAILED:case ar.CANCELLED:return Dn(e,(function(e){return Object(I.a)(Object(I.a)({},e),{},{jobs:e.jobs.filter((function(e){return e!==t.payload.job}))})}));case ar.INITIAL_STATE:var r=t.payload.analyses.map((function(e){return{doAutoStart:!1,id:e.analysis,dataset:e.dataset,details:e.details,jobs:e.jobs}}));return{byId:wn(r,(function(e){return e.id})),ids:t.payload.analyses.map((function(e){return e.analysis}))};case ar.FINISH_JOB:case ar.TASK_RESULT:var c=e.ids.find((function(n){var a=e.byId[n];return(a.jobs?a.jobs:[]).some((function(e){return e===t.payload.job}))}));return c?Rn(e,c,{displayedJob:t.payload.job}):e}return e},channelStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ar.OPEN:return{status:Es.CONNECTED};case ar.INITIAL_STATE:return{status:Es.READY};case ar.CLOSE:return{status:Es.WAITING};case ar.SHUTDOWN:return{status:Es.DISCONNECTED}}return e},clusterConnection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ys,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.NOT_CONNECTED:return{status:"disconnected"};case a.CONNECTED:return{status:"connected",params:t.payload.params};case a.CONNECTING:return{status:"connecting"}}return e},datasets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ar.INITIAL_STATE:var n=t.payload.datasets.map((function(e){return Object.assign({},e,{status:R.OPEN})}));return{byId:wn(n,(function(e){return e.id})),ids:n.map((function(e){return e.id}))};case Ln.CREATE:var a=Object(I.a)(Object(I.a)({},t.payload.dataset),{},{status:R.OPENING});return Tn(e,t.payload.dataset.id,a);case Ln.CREATED:var r=Object.assign({},t.payload.dataset,{status:R.OPEN});return e.byId[t.payload.dataset.id]?Rn(e,t.payload.dataset.id,r):Tn(e,t.payload.dataset.id,r);case Ln.ERROR:return In(e,(function(e){return e.id!==t.payload.dataset}));case Ln.DELETE:return Rn(e,t.payload.dataset,{status:R.DELETING});case Ln.DELETED:return In(e,(function(e){return e.id!==t.payload.dataset}))}return e},openDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ss,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ln.OPEN:return Object(I.a)(Object(I.a)({},e),{},{formVisible:!0,formPath:t.payload.path,formCachedParams:t.payload.cachedParams,formDetectedParams:t.payload.detectedParams,formDetectedInfo:t.payload.detectedInfo});case Ln.CANCEL_OPEN:case Ln.CREATE:return Object(I.a)(Object(I.a)({},e),{},{formVisible:!1});case Ln.DETECT:return Object(I.a)(Object(I.a)({},e),{},{busyPath:t.payload.path,busy:!0});case Ln.DETECTED:case Ln.DETECT_FAILED:return Object(I.a)(Object(I.a)({},e),{},{busyPath:"",busy:!1})}return e},jobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case dc.CREATE:var n=Tn(e,t.payload.id,{id:t.payload.id,analysis:t.payload.analysis,running:Ae.CREATING,status:je.CREATING,results:[],startTimestamp:t.payload.timestamp});return n;case ar.JOB_STARTED:return Rn(e,t.payload.job,{running:Ae.RUNNING,status:je.IN_PROGRESS,startTimestamp:t.payload.timestamp});case ar.TASK_RESULT:return Rn(e,t.payload.job,{results:t.payload.results});case ar.FINISH_JOB:var a=t.payload,r=a.job,c=a.timestamp,s=a.results;return Rn(e,r,{running:Ae.DONE,status:je.SUCCESS,results:s,endTimestamp:c});case ar.JOB_ERROR:var o=t.payload,i=o.job,l=o.timestamp;return Rn(e,i,{running:Ae.DONE,status:je.ERROR,endTimestamp:l});case ar.INITIAL_STATE:var u=t.payload.jobs,d=u.map((function(e){return{id:e.id,analysis:e.analysis,status:je.SUCCESS,startTimestamp:0,results:[],running:Ae.DONE,endTimestamp:0}}));return{byId:wn(d,(function(e){return e.id})),ids:d.map((function(e){return e.id}))}}return e},errors:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.ERROR:case Ln.ERROR:case ar.ERROR:case a.ERROR:case ft.ERROR:case ar.JOB_ERROR:return Tn(e,t.payload.id,{id:t.payload.id,msg:t.payload.msg,timestamp:t.payload.timestamp});case ar.OPEN:return xs;case Aa.DISMISS:return In(e,(function(e){return e.id!==t.payload.id}));case Aa.DISMISS_ALL:return xs}return e},config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case re.FETCHED:return Object.assign({},t.payload.config,{haveConfig:!0});case D.DIRECTORY_LISTING:return Object.assign({},e,{cwd:t.payload.path});case Ln.CREATE:var n=Object.assign({},e.lastOpened,Object(A.a)({},t.payload.dataset.params.path,t.payload.dataset.params)),r=xr([t.payload.dataset.params.path].concat(Object(ke.a)(e.fileHistory))).slice(0,11);return Object.assign({},e,{lastOpened:n,fileHistory:r});case a.CONNECT:if(t.payload.params.type===_.LOCAL){var c=Object.assign({},e.lastConnection,{type:_.LOCAL,cudas:t.payload.params.cudas});return Object.assign({},e,{lastConnection:c})}var s=Object.assign({},e.lastConnection,{type:_.TCP,address:t.payload.params.address});return Object.assign({},e,{lastConnection:s});case re.TOGGLE_STAR:var o=t.payload.path;return Object(I.a)(Object(I.a)({},e),{},{starred:kn(e.starred,o)})}return e},browser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hs,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case re.FETCHED:return Object.assign({},e,{path:t.payload.config.cwd});case D.OPEN:return Object.assign({},e,{isOpen:!0});case D.CANCEL:return Object.assign({},e,{isOpen:!1});case D.LIST_DIRECTORY:return Object.assign({},e,{isLoading:!0});case D.DIRECTORY_LISTING:var n=t.payload.places.reduce((function(e,t){return Object.assign({},e,Object(A.a)({},t.key,t))}),{});return Object.assign({},e,{isLoading:!1,path:t.payload.path,files:t.payload.files,dirs:t.payload.dirs,drives:t.payload.drives,places:n});case D.SELECT_FULL_PATH:case D.SELECT:return Object.assign({},e,{isLoading:!1,isOpen:!1})}return e}}),As=Object(l.c)(),js=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.d,Rs=Object(i.e)(_s,js(Object(i.a)(As)));s.render(r.createElement(o.a,{store:Rs},r.createElement(Er,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("./static",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("./static","/service-worker.js");hr?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):br(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):br(e)}))}}(),As.run(ps)}},[[401,1,2]]]);
//# sourceMappingURL=main.251ca1cf.chunk.js.map