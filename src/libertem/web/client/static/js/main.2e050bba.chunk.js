(this["webpackJsonplibertem-client"]=this["webpackJsonplibertem-client"]||[]).push([[0],{181:function(e,t,n){e.exports={default:"ResultImage_default__1X7FO",fallback:"ResultImage_fallback__kO3cw"}},301:function(e,t,n){"use strict";n.r(t);var a,r=n(61),s=n(9),c=n(81),i=n(80),o=(n(238),n(318)),u=n(1),d=n.n(u),l=n(33),j=n(34),b=n(38),h=n(37),p=n(320),O=n(183);function f(e,t,n){return void 0===n&&void 0===t?{type:e}:void 0===n?{type:e,payload:t}:{type:e,payload:t,meta:n}}!function(e){e.NOT_CONNECTED="CLUSTER_NOT_CONNECTED",e.CONNECT="CLUSTER_CONNECT",e.CONNECTING="CLUSTER_CONNECTING",e.CONNECTED="CLUSTER_CONNECTED",e.ERROR="CLUSTER_ERROR"}(a||(a={}));var x,m={notConnected:function(){return f(a.NOT_CONNECTED)},connect:function(e){return f(a.CONNECT,{params:e})},connecting:function(){return f(a.CONNECTING)},connected:function(e){return f(a.CONNECTED,{params:e})},error:function(e,t,n){return f(a.ERROR,{msg:e,timestamp:t,id:n})}},y=n(138),g=n.n(y),v=n(327);!function(e){e.GENERIC="ERROR_GENERIC",e.DISMISS="ERROR_DISMISS",e.DISMISS_ALL="ERROR_DISMISS_ALL"}(x||(x={}));var _,E,S=function(e){return f(x.DISMISS,{id:e})},A=function(){return f(x.DISMISS_ALL)},C=function(e,t,n){return f(x.GENERIC,{id:e,msg:t,timestamp:n})},T=function(e,t){var n=Object(v.a)(),a=Date.now();t(C(n,"could not write to clipboard",a))},I=function(e){throw new Error(e)},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return y.debounce(e,t,{maxWait:t})},D=function(e){return Object.keys(e)},w=function(e,t){navigator.clipboard.writeText(e).catch((function(){return T(0,t)}))},k=n(20);!function(e){e.LOCAL="LOCAL",e.TCP="TCP"}(E||(E={}));var F,N,L=(_={},Object(k.a)(_,E.LOCAL,{label:"Create local cluster"}),Object(k.a)(_,E.TCP,{label:"Connect to cluster",helpText:"can be either local or remote, connection via TCP"}),_);!function(e){e.HDF5="HDF5",e.RAW="RAW",e.MIB="MIB",e.BLO="BLO",e.K2IS="K2IS",e.SER="SER",e.FRMS6="FRMS6",e.EMPAD="EMPAD",e.SEQ="SEQ",e.MRC="MRC",e.TVIPS="TVIPS"}(F||(F={})),function(e){e.OPEN="OPEN",e.OPENING="OPENING",e.DELETING="DELETING"}(N||(N={}));var M,P,H={mmap:{label:"MMAP I/O backend (default on Linux)"},buffered:{label:"Buffered I/O backend, useful for slow HDD storage (default on Windows)"},direct:{label:"Direct I/O backend, useful for very large data on fast storage"}};!function(e){e[e.NAV_SHAPE_MIN_LENGTH=2]="NAV_SHAPE_MIN_LENGTH",e[e.NAV_SHAPE_MAX_LENGTH=2]="NAV_SHAPE_MAX_LENGTH",e[e.SIG_SHAPE_MIN_LENGTH=2]="SIG_SHAPE_MIN_LENGTH",e[e.SIG_SHAPE_MAX_LENGTH=2]="SIG_SHAPE_MAX_LENGTH"}(M||(M={})),function(e){e.APPLY_RING_MASK="APPLY_RING_MASK",e.APPLY_DISK_MASK="APPLY_DISK_MASK",e.APPLY_POINT_SELECTOR="APPLY_POINT_SELECTOR",e.CENTER_OF_MASS="CENTER_OF_MASS",e.SUM_FRAMES="SUM_FRAMES",e.SD_FRAMES="SD_FRAMES",e.PICK_FRAME="PICK_FRAME",e.PICK_FFT_FRAME="PICK_FFT_FRAME",e.APPLY_FFT_MASK="APPLY_FFT_MASK",e.FFTSUM_FRAMES="FFTSUM_FRAMES",e.RADIAL_FOURIER="RADIAL_FOURIER",e.FEM="FEM",e.CLUST="CLUST",e.SUM_SIG="SUM_SIG"}(P||(P={}));var U,V=n(12),W=n(13),G=n(321),B=n(322),Y=n(63),J=n(302),K=n(328),z=n(0),X=function(e){var t=e.config,n=e.name,a=e.value,r=e.setFieldValue,s=t.devices.cudas.map((function(e){return{key:e,value:e,text:"GPU ".concat(e)}})),c=t.devices.has_cupy,i=t.devices.cudas.length>0,o=!c||!i,u=!c&&i;return Object(z.jsxs)(z.Fragment,{children:[u?Object(z.jsxs)(K.a,{warning:!0,visible:!0,children:[Object(z.jsx)(K.a.Header,{children:"No cupy installation found"}),Object(z.jsxs)("p",{children:["To make use of the built-in GPU support, make sure to install ",Object(z.jsx)("a",{href:"https://cupy.dev/",rel:"noreferrer noopener",target:"_blank",children:"cupy"})]})]}):"",Object(z.jsx)(p.a,{onChange:function(e,t){r(n,t.value)},disabled:o,placeholder:"Select CUDA devices",fluid:!0,multiple:!0,selection:!0,value:a,options:s})]})},Q=Object(W.c)({mapPropsToValues:function(e){return{numWorkers:e.config.localCores,cudas:[]}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(V.a)({type:E.LOCAL},e))}})((function(e){var t=e.config,n=e.values,a=e.touched,r=e.errors,s=e.isSubmitting,c=e.handleChange,i=e.handleBlur,o=e.handleSubmit,d=e.setFieldValue;return u.useEffect((function(){d("cudas",t.devices.cudas)}),[t.devices.cudas,d]),Object(z.jsxs)(G.a,{onSubmit:o,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"numWorkers",children:"Number of Workers:"}),Object(z.jsx)("input",{type:"number",name:"numWorkers",value:n.numWorkers,onChange:c,onBlur:i}),r.numWorkers&&a.numWorkers&&r.numWorkers]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsxs)("label",{htmlFor:"cudas",children:["CUDA devices to use"," ",Object(z.jsxs)(B.a,{trigger:Object(z.jsx)(Y.a,{name:"info circle",link:!0}),children:[Object(z.jsx)(B.a.Header,{children:"CUDA information"}),Object(z.jsxs)(B.a.Content,{children:[Object(z.jsx)("p",{children:"For some operations, LiberTEM can automatically make use of your graphics card, if it supports CUDA."}),Object(z.jsxs)("ul",{children:[Object(z.jsxs)("li",{children:["Number of CUDA devices found: ",t.devices.cudas.length]}),Object(z.jsxs)("li",{children:["cupy installation found:"," ",t.devices.has_cupy?"Yes":"No"]})]}),Object(z.jsxs)("p",{children:["cupy needs to be installed to make use of any CUDA devices on your system. Also, the matching cuda libraries and graphics drivers need to be installed. Please refer to"," ",Object(z.jsx)("a",{href:"https://docs.cupy.dev/en/stable/install.html",target:"_blank",rel:"noopener noreferrer",children:"the cupy documentation"})," ","for more information."]})]})]})]}),Object(z.jsx)(X,{name:"cudas",value:n.cudas,config:t,setFieldValue:d})]}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:s,children:"Connect"})]})})),q=Object(W.c)({mapPropsToValues:function(e){return{address:e.config.lastConnection.address}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(V.a)({type:E.TCP},e))}})((function(e){var t=e.values,n=e.touched,a=e.errors,r=e.isSubmitting,s=e.handleChange,c=e.handleBlur,i=e.handleSubmit;return Object(z.jsxs)(G.a,{onSubmit:i,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"address",children:"Scheduler URI"}),Object(z.jsx)("input",{type:"text",name:"address",value:t.address,onChange:s,onBlur:c}),a.address&&n.address&&a.address]}),Object(z.jsx)(J.a,{primarytype:"submit",disabled:r,children:"Connect"})]})})),$={connectToCluster:m.connect},Z=D(E).map((function(e){return{text:L[E[e]].label,value:E[e]}})),ee=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={clusterType:e.props.lastConnectionType},e.setType=function(t){e.setState({clusterType:t})},e.handleChange=function(t,n){var a=n.value;e.setType(a)},e.handleSubmit=function(t){e.props.connectToCluster(t)},e}return Object(j.a)(n,[{key:"renderForm",value:function(){var e=this.state.clusterType,t=this.props.config;switch(e){case E.LOCAL:return Object(z.jsx)(Q,{config:t,onSubmit:this.handleSubmit});case E.TCP:return Object(z.jsx)(q,{config:t,onSubmit:this.handleSubmit})}}},{key:"render",value:function(){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)("div",{children:Object(z.jsx)(p.a,{inline:!0,options:Z,value:this.state.clusterType,onChange:this.handleChange})}),Object(z.jsx)(O.a,{children:this.renderForm()})]})}}]),n}(u.Component),te=Object(s.b)((function(e){return{config:e.config,lastConnectionType:e.config.lastConnection.type}}),$)(ee),ne=function(e){var t=e.msg;return Object(z.jsxs)(K.a,{icon:!0,children:[Object(z.jsx)(Y.a,{name:"cog",loading:!0}),Object(z.jsxs)(K.a.Content,{children:[Object(z.jsx)(K.a.Header,{children:"Connecting to LiberTEM"}),t]})]})},ae=function(){return Object(z.jsxs)(K.a,{negative:!0,icon:!0,children:[Object(z.jsx)(Y.a,{name:"shutdown"}),Object(z.jsxs)(K.a.Content,{children:[Object(z.jsx)(K.a.Header,{children:"Connection is closed"}),Object(z.jsx)("p",{children:"please close the tab"})]})]})},re={waiting:"Waiting...",connecting:"Connecting..."},se="Connected, waiting for initial state...",ce="Connected, fetching cluster status...",ie="Connecting to cluster",oe=function(){var e=Object(s.d)((function(e){return e.config.haveConfig})),t=Object(s.d)((function(e){return e.clusterConnection}));return e?"disconnected"===t.status?Object(z.jsx)(te,{}):"connected"===t.status?Object(z.jsx)(ne,{msg:se}):"unknown"===t.status?Object(z.jsx)(ne,{msg:ce}):"connecting"===t.status?Object(z.jsx)(ne,{msg:ie}):(I("should not happen"),null):Object(z.jsx)(ne,{msg:"waiting for configuration..."})},ue=function(e){var t=e.children,n=Object(s.d)((function(e){return e.channelStatus}));switch(n.status){case"waiting":case"connecting":return Object(z.jsx)(ne,{msg:re[n.status]});case"connected":return Object(z.jsx)(oe,{});case"ready":return Object(z.jsx)(z.Fragment,{children:t});case"disconnected":return Object(z.jsx)(ae,{});default:return I("should not happen"),null}};!function(e){e.LIST_DIRECTORY="BROWSER_LIST_DIRECTORY",e.LIST_FULL_PATH="BROWSER_LIST_DIRECTORY_FULL",e.DIRECTORY_LISTING="BROWSER_DIRECTORY_LISTING",e.DETECT_PARAMS="BROWSER_DETECT_PARAMS",e.PARAMS_DETECTED="BROWSER_PARAMS_DETECTED",e.ERROR="BROWSER_ERROR",e.OPEN="BROWSER_OPEN",e.CANCEL="BROWSER_CANCEL",e.SELECT="BROWSER_SELECT",e.SELECT_FULL_PATH="BROWSER_SELECT_FULL_PATH"}(U||(U={}));var de,le={list:function(e,t){return f(U.LIST_DIRECTORY,{path:e,name:t})},dirListing:function(e,t,n,a,r){return f(U.DIRECTORY_LISTING,{path:e,dirs:t,files:n,drives:a,places:r})},open:function(){return f(U.OPEN)},cancel:function(){return f(U.CANCEL)},select:function(e,t){return f(U.SELECT,{path:e,name:t})},selectFullPath:function(e){return f(U.SELECT_FULL_PATH,{path:e})},error:function(e,t,n){return f(U.ERROR,{msg:e,timestamp:t,id:n})},detectParams:function(e){return f(U.DETECT_PARAMS,{path:e})},paramsDetected:function(e,t){return f(U.PARAMS_DETECTED,{path:e,params:t})}},je=n(217),be=n(329),he=function(e){var t=e.ts,n=new Date(1e3*t),a=n.toLocaleDateString(),r=n.toLocaleTimeString(),s="".concat(a," ").concat(r);return Object(z.jsxs)("div",{style:{display:"flex",whiteSpace:"nowrap"},title:s,children:[Object(z.jsx)("div",{style:{width:"50%",marginRight:"10px"},children:a}),Object(z.jsx)("div",{style:{width:"45%"},children:r})]})},pe=function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?1e3:1024;if(Math.abs(e)<n)return{size:e,unit:"B"};var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=n,++r}while(Math.abs(e)>=n&&r<a.length-1);return{size:e.toFixed(1),unit:a[r]}}(e.size,e.si);return Object(z.jsxs)("div",{style:{textAlign:"right"},children:[t.size," ",t.unit]})},Oe=function(e){var t=e.children,n=e.title;return Object(z.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginRight:"10px"},title:n,children:t})},fe=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).onClick=function(){var t=e.props.onClick;t&&t()},e}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.icon,r=Object(V.a)({cursor:"pointer"},n),s={textAlign:"right"};return Object(z.jsx)("div",{onClick:this.onClick,style:r,children:Object(z.jsxs)("div",{style:{display:"flex",paddingRight:"10px"},children:[Object(z.jsx)("div",{style:{width:"20%",flexGrow:1},children:Object(z.jsxs)(Oe,{title:t.name,children:[a&&Object(z.jsx)(Y.a,{name:a}),t.name]})}),Object(z.jsx)("div",{style:{width:"10%"},children:Object(z.jsx)(Oe,{children:Object(z.jsx)(pe,{size:t.size,si:!1})})}),Object(z.jsx)("div",{style:{width:"10%"},children:Object(z.jsx)(Oe,{children:t.owner})}),Object(z.jsx)("div",{style:Object(V.a)({width:"18%"},s),children:Object(z.jsx)(Oe,{children:Object(z.jsx)(he,{ts:t.ctime})})}),Object(z.jsx)("div",{style:Object(V.a)({width:"18%"},s),children:Object(z.jsx)(Oe,{children:Object(z.jsx)(he,{ts:t.mtime})})})]})})}}]),n}(u.Component),xe=function(){var e={textAlign:"right"};return Object(z.jsx)("div",{style:{paddingRight:"20px",paddingBottom:"10px"},children:Object(z.jsxs)("div",{style:{display:"flex"},children:[Object(z.jsx)("div",{style:{width:"20%",flexGrow:1},children:Object(z.jsx)(Oe,{children:"Name"})}),Object(z.jsx)("div",{style:Object(V.a)({width:"10%"},e),children:Object(z.jsx)(Oe,{children:"Size"})}),Object(z.jsx)("div",{style:{width:"10%"},children:Object(z.jsx)(Oe,{children:"Owner"})}),Object(z.jsx)("div",{style:Object(V.a)({width:"18%"},e),children:Object(z.jsx)(Oe,{children:"Created"})}),Object(z.jsx)("div",{style:Object(V.a)({width:"18%"},e),children:Object(z.jsx)(Oe,{children:"Modified"})})]})})},me=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.select;return Object(z.jsx)(fe,{onClick:a,style:n,details:t,icon:"file outline"})}}]),n}(u.Component),ye=Object(s.b)(null,(function(e,t){return{select:function(){return e(le.select(t.path,t.details.name))}}}))(me),ge=Object(s.b)(null,(function(e,t){return{list:function(){e(le.list(t.path,t.details.name)),window.setTimeout((function(){return t.onChange()}),0)}}}))((function(e){var t=e.list,n=e.details,a=e.style;return Object(z.jsx)(fe,{onClick:t,style:a,details:n,icon:"folder"})})),ve=n(216);!function(e){e.FETCHED="CONFIG_FETCHED",e.FETCH="CONFIG_FETCH",e.FETCH_FAILED="CONFIG_FETCH_FAILED",e.TOGGLE_STAR="CONFIG_TOGGLE_STAR"}(de||(de={}));var _e,Ee,Se=function(){return f(de.FETCH)},Ae=function(e){return f(de.FETCHED,{config:e})},Ce=function(e,t,n){return f(de.FETCH_FAILED,{msg:e,timestamp:t,id:n})},Te=function(e){return f(de.TOGGLE_STAR,{path:e})},Ie=n(168),Re=["list"],De=Object(s.b)(null,(function(e,t){return{list:function(){void 0!==t.value&&(e(le.list(t.value.toString())),window.setTimeout((function(){return t.onChange()}),0))}}}))((function(e){var t=e.list,n=Object(Ie.a)(e,Re),a=Object(V.a)({onClick:t},n);return Object(z.jsx)(p.a.Item,Object(V.a)({},a))})),we=n(317),ke=Object(W.c)({mapPropsToValues:function(e){return{path:e.initialPath}},handleSubmit:function(e,t){(0,t.props.onChange)(e.path)},enableReinitialize:!0})((function(e){var t=e.values,n=e.handleChange,a=e.handleBlur,r=e.handleSubmit;return Object(z.jsx)(G.a,{onSubmit:r,style:{flexGrow:1},children:Object(z.jsx)(G.a.Field,{children:Object(z.jsx)(we.a,{autoComplete:"off",onBlur:a,onChange:n,value:t.path,name:"path"})})})})),Fe=Object(s.b)((function(e){return{lastOpened:e.config.lastOpened,fileHistory:e.config.fileHistory,separator:e.config.separator}}),(function(e){return{select:function(t){return e(le.selectFullPath(t))}}}))((function(e){var t=e.lastOpened,n=e.fileHistory,a=e.select,r=n.filter((function(e){return t[e]})).map((function(e){var n=t[e];return{text:n.path,value:{type:n.type,path:n.path}}})),s=function(e,t){return t.value&&a(t.value.toString())};return Object(z.jsx)(p.a,{item:!0,text:"Recent",floating:!0,children:Object(z.jsxs)(p.a.Menu,{children:[Object(z.jsx)(p.a.Header,{content:"recent datasets"}),r.map((function(e,t){return Object(z.jsx)(p.a.Item,{value:e.value.path,content:e.text,onClick:s},t)}))]})})})),Ne=Object(s.b)(null,(function(e,t){return{refresh:function(){e(le.list(t.currentPath)),window.setTimeout((function(){return t.onChange()}),0)},handleInputChange:function(n){e(le.list(n)),window.setTimeout((function(){return t.onChange()}),0)},goUp:function(){e(le.list(t.currentPath,"..")),window.setTimeout((function(){return t.onChange()}),0)},toggleStar:function(){e(Te(t.currentPath))}}}))((function(e){var t=e.currentPath,n=e.drives,a=e.places,r=e.starred,s=e.onChange,c=e.refresh,i=e.goUp,o=e.handleInputChange,u=e.toggleStar,d=n.map((function(e){return{key:e,text:e}})),l=Object.keys(a).map((function(e){return{key:a[e].path,text:a[e].title}})),j=r.map((function(e){return{key:e,text:e}})),b=r.includes(t),h=b?"star":"star outline",O=b?"Remove from bookmarks":"Bookmark this location";return Object(z.jsxs)(ve.a,{children:[Object(z.jsx)(Fe,{}),Object(z.jsx)(p.a,{text:"Go to...",floating:!0,item:!0,children:Object(z.jsxs)(p.a.Menu,{children:[Object(z.jsx)(p.a.Header,{content:"Drives"}),d.map((function(e){return Object(z.jsx)(De,{value:e.key,content:e.text,onChange:s},e.key)})),Object(z.jsx)(p.a.Header,{content:"Places"}),l.map((function(e){return Object(z.jsx)(De,{value:e.key,content:e.text,onChange:s},e.key)})),Object(z.jsx)(p.a.Header,{content:"Starred"}),0===j.length&&Object(z.jsx)(p.a.Item,{value:"empty",content:"No bookmarks yet"},"empty"),j.map((function(e){return Object(z.jsx)(De,{value:e.key,content:e.text,onChange:s},e.key)}))]})}),Object(z.jsx)(ve.a.Item,{title:O,icon:h,onClick:u}),Object(z.jsx)(ve.a.Item,{icon:"arrow up",onClick:i}),Object(z.jsx)(ve.a.Item,{style:{flexGrow:1},children:Object(z.jsx)(ke,{onChange:o,initialPath:t})}),Object(z.jsx)(ve.a.Item,{icon:"refresh",onClick:c})]})})),Le=u.createRef(),Me=function(){null!==Le.current&&Le.current.scrollToItem(0)},Pe=function(e,t){return e.sort((function(e,n){var a=t(e),r=t(n);return a<r?-1:a>r?1:0}))},He=Object(s.b)((function(e){var t=e.browser,n=e.config;return{files:t.files,dirs:t.dirs,path:t.path,drives:t.drives,places:t.places,isLoading:t.isLoading,starred:n.starred}}),(function(e){return{cancel:function(){return e(le.cancel())}}}))((function(e){var t=e.files,n=e.dirs,a=e.path,r=e.drives,s=e.places,c=e.starred,i=e.cancel,o=e.isLoading,u=function(e){return e.name.toLowerCase()},d=Pe(n,u).map((function(e){return function(t){return Object(z.jsx)(ge,{style:t,onChange:Me,path:a,details:e})}})),l=Pe(t,u).map((function(e){return function(t){return Object(z.jsx)(ye,{style:t,path:a,details:e})}})),j=d.concat(l),b=Object(z.jsx)(je.a,{style:{overflowY:"scroll"},ref:Le,height:300,width:"100%",itemCount:j.length,itemSize:35,children:function(e){var t=e.index,n=e.style;return j[t](n)}});return o&&(b=Object(z.jsx)(O.a,{loading:!0,style:{height:"300px"}})),Object(z.jsxs)(O.a.Group,{children:[Object(z.jsx)(O.a,{children:Object(z.jsx)(be.a,{as:"h2",children:"Open dataset"})}),Object(z.jsx)(O.a,{children:Object(z.jsx)(Ne,{currentPath:a,drives:r,places:s,starred:c,onChange:Me})}),Object(z.jsxs)(O.a,{children:[Object(z.jsx)(xe,{}),b]}),Object(z.jsx)(O.a,{children:Object(z.jsx)(J.a,{onClick:i,children:"Cancel"})})]})})),Ue={open:le.open},Ve=Object(s.b)((function(e){return{isOpen:e.browser.isOpen,busy:e.openDataset.busy,formVisible:e.openDataset.formVisible}}),Ue)((function(e){var t=e.formVisible,n=e.isOpen,a=e.open,r=e.busy;return t||r?null:n?Object(z.jsx)(He,{}):Object(z.jsxs)(J.a,{icon:!0,labelPosition:"left",onClick:a,children:[Object(z.jsx)(Y.a,{name:"add"}),"Browse"]})})),We=n(319),Ge=n(10),Be=n(323),Ye=n(332),Je=n(6),Ke=n.n(Je),ze=n(25),Xe=function(){var e=window.location.pathname;return e.endsWith("/")?"".concat(e,"api/"):"".concat(e,"/api/")},Qe=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){var n,a;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xe(),e.next=3,fetch("".concat(n).concat(t),{credentials:"same-origin",method:"DELETE"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n){var a,r;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Xe(),e.next=3,fetch("".concat(a).concat(t),{body:JSON.stringify(n),credentials:"same-origin",method:"PUT"});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();!function(e){e.CREATING="CREATING",e.RUNNING="RUNNING",e.DONE="DONE"}(_e||(_e={})),function(e){e.CREATING="CREATING",e.IN_PROGRESS="IN_PROGRESS",e.CANCELLED="CANCELLED",e.SUCCESS="SUCCESS",e.ERROR="ERROR"}(Ee||(Ee={}));var $e,Ze,et,tt,nt,at,rt=n(27),st=n(78),ct=n(79),it=function(){return Object(z.jsx)(Y.a,{name:"cog",loading:!0,style:{margin:0,padding:0,position:"absolute",bottom:"10px",right:"10px",color:"white",opacity:.7,filter:"drop-shadow(0 0 3px #000)"}})},ot=function(e){var t=e.children,n=e.busy;return Object(z.jsxs)("div",{style:{position:"relative"},children:[t,n&&Object(z.jsx)(it,{})]})},ut=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).currentHandle=void 0,e.handleDragStart=function(t){e.currentHandle=t},e.handleDrop=function(){e.currentHandle=void 0},e.handleMouseMove=function(t){if(e.currentHandle)return e.currentHandle.externalMouseMove(t)},e.handleMouseLeave=function(){e.currentHandle&&e.currentHandle.externalLeave()},e.handleMouseUp=function(){e.currentHandle&&e.currentHandle.externalMouseUp()},e}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return Object(z.jsxs)("g",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp,onKeyDown:this.props.onKeyboardEvent,style:{outline:"1px dashed black"},tabIndex:0,children:[Object(z.jsx)("rect",{style:{fill:"transparent"},x:0,y:0,width:t,height:n}),this.renderHandles()]})}},{key:"renderHandles",value:function(){var e=this,t=this.props,n=t.handles,a=t.onKeyboardEvent;return n.map((function(t,n){var r=t(e.handleDragStart,e.handleDrop,a);return u.isValidElement(r)?u.cloneElement(r,{key:n}):null}))}}]),n}(u.Component),dt=n(181),lt=n.n(dt),jt=function(e){var t=e.job,n=e.channel,a=e.width,r=e.height,s=t.results[n];return void 0===s?Object(z.jsx)("svg",{className:lt.a.fallback,width:a,height:r,viewBox:"0 0 ".concat(a," ").concat(r)},-1):Object(z.jsx)("image",{className:lt.a.default,xlinkHref:s.imageURL,width:a,height:r})},bt=ct.a.svg($e||($e=Object(st.a)(["\n    display: block;\n    border: 1px solid black;\n    width: 100%;\n    height: auto;\n"]))),ht=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"renderHandles",value:function(){var e=this.props,t=e.width,n=e.height,a=e.extraHandles,r=[];return a&&(r=[].concat(Object(rt.a)(r),[a])),Object(z.jsx)(ut,{width:t,height:n,handles:r})}},{key:"render",value:function(){var e=this.props,t=e.job,n=e.channel,a=e.width,r=e.height,s=e.extraWidgets,c=t.running!==_e.DONE;return Object(z.jsx)(ot,{busy:c,children:Object(z.jsxs)(bt,{width:a,height:r,viewBox:"0 0 ".concat(a," ").concat(r),children:[Object(z.jsx)(jt,{job:t,channel:n,width:a,height:r}),s,this.renderHandles()]})})}}]),n}(u.Component),pt=Object(s.b)(null,null)(ht),Ot=ct.a.div(Ze||(Ze=Object(st.a)(["\n    display: flex;\n    & > * {\n        margin-right: 10px;\n    }\n"]))),ft=function(e){var t=e.width,n=e.height;return Object(z.jsx)("svg",{style:{display:"block",border:"1px solid black",width:"100%",height:"auto"},width:t,height:n,viewBox:"0 0 ".concat(t," ").concat(n)},-1)},xt=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={selectedChannel:0},e.selectChannel=function(t,n){var a=n.value;e.setState({selectedChannel:a})},e}return Object(j.a)(n,[{key:"getJob",value:function(){var e=this.props,t=e.analysis,n=e.jobsById;if(t&&t.displayedJob&&n[t.displayedJob])return n[t.displayedJob]}},{key:"getMsg",value:function(e){if(!e)return Object(z.jsx)(z.Fragment,{children:"\xa0"});if(e.running===_e.DONE){var t=(e.endTimestamp-e.startTimestamp)/1e3;return Object(z.jsxs)(z.Fragment,{children:["Analysis done in ",t.toFixed(3),"s"]})}return Object(z.jsx)(z.Fragment,{children:"Analysis running..."})}},{key:"genericRender",value:function(e,t){var n=this.props,a=n.subtitle,r=n.children,s=n.selectors,c=this.getMsg(t);return Object(z.jsxs)("div",{children:[e,r,Object(z.jsxs)(Ot,{children:[Object(z.jsx)(mt,{job:t,handleChange:this.selectChannel,selectedImg:this.state.selectedChannel}),s]}),Object(z.jsxs)("p",{children:[a," ",c]})]})}},{key:"render",value:function(){var e=this.getJob(),t=this.props,n=t.width,a=t.height,r=t.extraHandles,s=t.extraWidgets;return e?this.genericRender(Object(z.jsx)(pt,{job:e,extraHandles:r,extraWidgets:s,width:n,height:a,channel:this.state.selectedChannel}),e):this.genericRender(Object(z.jsx)(ft,{width:n,height:a}),e)}}]),n}(u.Component),mt=function(e){var t=e.job,n=e.handleChange,a=e.selectedImg;if(!t)return null;var r=t.results.map((function(e,t){return{text:e.description.title,value:t}}));return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("div",{children:["Channel:"," ",Object(z.jsx)(p.a,{inline:!0,options:r,value:a,onChange:n})]})})},yt=Object(s.b)((function(e,t){var n=e.compoundAnalyses.byId[t.compoundAnalysis],a=e.analyses.byId[n.details.analyses[t.analysisIndex]];return{jobsById:e.jobs.byId,analysis:a,compoundAnalysis:n,analysisIndex:t.analysisIndex}}))(xt),gt=function(e,t){return function(n){return{x:Math.max(0,Math.min(e-1,n.x)),y:Math.max(0,Math.min(t-1,n.y))}}},vt=function(e,t,n){return function(a,r){return n&&n(function(e,t,n,a){var r=e-n,s=t-a;return Math.sqrt(r*r+s*s)}(e,t,a,r))}},_t=function(e){return function(t){return{x:t.x,y:e}}},Et=function(e,t){return function(n){return(a=e,function(e){return{x:a>e.x?a:e.x,y:e.y}})(_t(t)(n));var a}},St=function(e,t){return function(n){return(a=e,function(e){return{x:a<e.x?a:e.x,y:e.y}})(_t(t)(n));var a}},At=function(e){return{fillOpacity:.3,fill:"red",strokeOpacity:.7,stroke:"red",strokeWidth:e/128/3}},Ct=function(e){var t=e.imageWidth,n=e.cx,a=e.cy,r=e.r;return Object(z.jsx)("circle",{cx:n+.5,cy:a+.5,r:r,style:Object(V.a)({},At(t))})},Tt=n(137),It=["scale","x","y","withCross","focusRef"],Rt=ct.a.circle(et||(et=Object(st.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]))),Dt=ct.a.path(tt||(tt=Object(st.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]))),wt=ct.a.g(nt||(nt=Object(st.a)(["\n    &:focus { outline: none; }\n"]))),kt=function(e){var t=e.scale,n=e.x,a=e.y,r=e.withCross,s=e.focusRef,c=Object(Ie.a)(e,It),i={transform:"matrix(".concat(t,", 0, 0, ").concat(t,", ").concat(n-t*n,", ").concat(a-t*a,")")},o="\n        M".concat(n-4-1.5," ").concat(a," L ").concat(n-1.5," ").concat(a," M").concat(n+1.5," ").concat(a," L ").concat(n+4+1.5," ").concat(a,"\n        M").concat(n," ").concat(a-4-1.5," L ").concat(n," ").concat(a-1.5," M").concat(n," ").concat(a+1.5," L ").concat(n," ").concat(a+4+1.5,"\n    "),u=r?Object(z.jsx)(Dt,{d:o,style:i}):null;return Object(z.jsxs)(wt,Object(V.a)(Object(V.a)({},c),{},{ref:s,children:[Object(z.jsx)(Rt,{cx:n,cy:a,r:3,style:i}),u]}))},Ft=function(e,t){var n=function(e){var t=e.ownerSVGElement;if(null===t)throw new Error("no owner SVG element?");var n=t.getAttribute("width");if(null===n)throw new Error("no width on SVG element?");var a=+n;return t.getBoundingClientRect().width/a}(t),a=t.getBoundingClientRect();return{x:(e.pageX-(a.left+window.pageXOffset))/n,y:(e.pageY-(a.top+window.pageYOffset))/n}},Nt=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).posRef=void 0,a.focusRef=void 0,a.state={dragging:!1,drag:{x:0,y:0}},a.externalMouseMove=function(e){a.move(e)},a.externalLeave=function(){a.stopDrag()},a.externalMouseUp=function(){a.stopDrag()},a.applyConstraint=function(e){var t=a.props.constraint;return t?t(e):e},a.startDrag=function(e){e.preventDefault();var t=a.props.parentOnDragStart;if(!a.posRef.current)throw new Error("startDrag without posRef");a.setState({dragging:!0,drag:a.applyConstraint(Ft(e,a.posRef.current))}),t&&t(Object(Tt.a)(a)),a.focusRef.current&&a.focusRef.current.focus&&a.focusRef.current.focus()},a.move=function(e){var t=a.props.onDragMove;if(a.state.dragging){if(!a.posRef.current)throw new Error("move without posRef");a.setState({drag:a.applyConstraint(Ft(e,a.posRef.current))},(function(){if(t){var e=a.applyConstraint(a.state.drag);t(e.x,e.y)}}))}},a.stopDrag=function(){var e=a.props.parentOnDrop,t=a.state,n=t.dragging,r=t.drag;n&&(a.setState({dragging:!1}),e&&e(r.x,r.y))},a.handleKeyDown=function(e){!function(e,t){var n=1;switch(e.shiftKey&&(n=10),e.key){case"ArrowUp":t((function(e,t){return{x:e,y:t-n}}));break;case"ArrowDown":t((function(e,t){return{x:e,y:t+n}}));break;case"ArrowLeft":t((function(e,t){return{x:e-n,y:t}}));break;case"ArrowRight":t((function(e,t){return{x:e+n,y:t}}));break;default:return}e.preventDefault()}(e,(function(e){var t=a.props,n=t.x,r=t.y,s=t.onDragMove,c=e(n,r),i=a.applyConstraint(c);s&&s(i.x,i.y)}))},a.posRef=u.createRef(),a.focusRef=u.createRef(),a}return Object(j.a)(n,[{key:"renderCommon",value:function(e,t){var n=this.props.imageWidth,a=void 0===n?1:n/128;return Object(z.jsxs)("g",{children:[Object(z.jsx)("rect",{style:{visibility:"hidden"},ref:this.posRef,x:0,y:0,width:0,height:0}),Object(z.jsx)(kt,{scale:a,x:e+.5,y:t+.5,withCross:this.props.withCross,focusRef:this.focusRef,onMouseUp:this.stopDrag,onMouseMove:this.move,onMouseDown:this.startDrag,onKeyDown:this.handleKeyDown,tabIndex:0})]})}},{key:"renderDragging",value:function(){var e=this.state.drag,t=e.x,n=e.y;return this.renderCommon(t,n)}},{key:"render",value:function(){var e=this.props,t=e.x,n=e.y;return this.state.dragging?this.renderDragging():this.renderCommon(t,n)}}]),n}(u.Component),Lt=Nt,Mt=function(e,t,n,a){n===t&&(n+=360);var r=n-t;r=r<0?r+360:r;var s=[];return s.push(Ht(t,a,e)),s.push(Ht(t+r/3,a,e)),s.push(Ht(t+2*r/3,a,e)),s.push(Ht(n,a,e)),Pt(s,a,r<180?0:1)},Pt=function(e,t,n){return["M",e[0].x,e[0].y,"A",t,t,0,0,n,e[1].x,e[1].y,"A",t,t,0,0,n,e[2].x,e[2].y,"A",t,t,0,0,n,e[3].x,e[3].y].join(" ")},Ht=function(e,t,n){var a=e*Math.PI/180;return{x:Math.cos(a)*t+n.x,y:Math.sin(a)*t+n.y}},Ut=function(e){var t=e.imageWidth,n=e.cx,a=e.cy,r=e.ri,s=e.ro,c=[Mt({x:n+.5,y:a+.5},90,90,s),Mt({x:n+.5,y:a+.5},90,90,r)].join(" ");return Object(z.jsx)("path",{d:c,fillRule:"evenodd",style:Object(V.a)({},At(t))})};!function(e){e.CREATE="COMPOUND_ANALYSIS_CREATE",e.CREATED="COMPOUND_ANALYSIS_CREATED",e.SET_PARAMS="COMPOUND_ANALYSIS_SET_PARAMS",e.UPDATED="COMPOUND_ANALYSIS_UPDATED",e.RUN="COMPOUND_ANALYSIS_RUN",e.RUNNING="COMPOUND_ANALYSIS_RUNNING",e.REMOVE="COMPOUND_ANALYSIS_REMOVE",e.REMOVED="COMPOUND_ANALYSIS_REMOVED",e.ERROR="COMPOUND_ANALYSIS_ERROR",e.ENABLE_AUTOSTART="COMPOUND_ANALYSIS_ENABLE_AUTOSTART"}(at||(at={}));var Vt,Wt,Gt=function(e,t){return f(at.CREATE,{dataset:e,analysisType:t})},Bt=function(e,t){return f(at.CREATED,{compoundAnalysis:e,autoStart:t})},Yt=function(e,t,n,a){return f(at.SET_PARAMS,{compoundAnalysis:e,analysisId:a,analysisIndex:t,details:n})},Jt=function(e){return f(at.ENABLE_AUTOSTART,{compoundAnalysisId:e})},Kt=function(e,t,n){return f(at.RUN,{id:e,analysisIndex:t,details:n})},zt=function(e,t,n){return f(at.RUNNING,{id:e,job:t,jobIndex:n})},Xt=function(e){return f(at.REMOVE,{id:e})},Qt=function(e){return f(at.REMOVED,{id:e})},qt=function(e,t,n){return f(at.ERROR,{msg:e,timestamp:t,id:n})},$t=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.analysisIndex,c=e.compoundAnalysisId,i=e.cx,o=e.cy,u=e.setCx,l=e.setCy,j=Object(s.c)();d.a.useEffect((function(){if(t){var e={x:i,y:o};j(Kt(c,r,{analysisType:P.PICK_FRAME,parameters:e}))}}),[c,i,o,t,r,j]);var b=function(e,t){var n=Math.round(e),a=Math.round(t);i===n&&o===a||(u(n),l(a))};return{coords:{cx:i,cy:o},handles:function(e,t){return Object(z.jsx)(Lt,{x:i,y:o,withCross:!0,imageWidth:n,onDragMove:b,parentOnDragStart:e,parentOnDrop:t,constraint:gt(n,a)})}}},Zt=function(e){var t=e.modes,n=e.currentMode,a=e.onModeChange,r=e.label;return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("div",{children:[r,":"," ",Object(z.jsx)(p.a,{inline:!0,options:t,value:n,onChange:function(e,t){void 0!==t.value&&"string"===typeof t.value&&a(t.value)}})]})})},en=function(e){var t,n,a=e.imageWidth,r=e.x,s=e.y,c=e.width,i=e.height;return i*c>0?(t=Math.min(s,s+i),n=Math.min(r,r+c)):i>0&&c<0?(t=s,n=r+c):(t=s+i,n=r),Object(z.jsx)("rect",{x:n+.5,y:t+.5,width:Math.abs(c),height:Math.abs(i),style:Object(V.a)({},At(a))})},tn=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),r=Object(u.useState)(t/2),s=Object(Ge.a)(r,2),c=s[0],i=s[1],o=Object(u.useState)(n/2),d=Object(Ge.a)(o,2),l=d[0],j=d[1],b=Object(u.useState)(a/8),h=Object(Ge.a)(b,2),p=h[0],O=h[1],f=Object(u.useState)(a/8),x=Object(Ge.a)(f,2),m=x[0],y=x[1],g=function(e,t){i(e),j(t)},v=function(e,t){O(e-c),y(t-l)},_={x:c+p,y:l+m};return{rectRoiParameters:{roi:{shape:"rect",x:c,y:l,width:p,height:m}},rectRoiHandles:function(e,n){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:c,y:l,imageWidth:t,onDragMove:g,parentOnDragStart:e,parentOnDrop:n}),Object(z.jsx)(Lt,{x:_.x,y:_.y,imageWidth:t,onDragMove:v,parentOnDragStart:e,parentOnDrop:n})]})},rectRoiWidgets:Object(z.jsx)(en,{x:c,y:l,width:p,height:m,imageWidth:t,imageHeight:n})}},nn=function(e){var t=e.compoundAnalysisId,n=e.enabled,a=e.analysisIndex,r=e.roiParameters,c=e.analysisType,i=Object(s.c)();return u.useEffect((function(){var e=setTimeout((function(){n&&i(Kt(t,a,{analysisType:c,parameters:r}))}),100);return function(){return clearTimeout(e)}}),[c,t,n,a,JSON.stringify(r),i]),{}};!function(e){e.SUM="SUM",e.SD="SD",e.PICK="PICK"}(Vt||(Vt={})),function(e){e.ALL="ALL",e.DISK="DISK",e.RECT="RECT"}(Wt||(Wt={}));var an,rn,sn=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.compoundAnalysisId,r=e.doAutoStart,c=[{text:"Average",value:Vt.SUM},{text:"Standard Deviation",value:Vt.SD},{text:"Pick",value:Vt.PICK}],i=[{text:"All",value:Wt.ALL},{text:"Disk",value:Wt.DISK},{text:"Rect",value:Wt.RECT}],o=Object(u.useState)(Vt.SUM),d=Object(Ge.a)(o,2),l=d[0],j=d[1],b=Object(u.useState)(Wt.ALL),h=Object(Ge.a)(b,2),p=h[0],O=h[1],f=Object(s.c)(),x=Object(z.jsx)(Zt,{modes:c,currentMode:l,onModeChange:function(e){f(Jt(a)),j(e)},label:"Mode"}),m=Object(z.jsx)(Zt,{modes:i,currentMode:p,onModeChange:function(e){f(Jt(a)),O(e)},label:"ROI"});l===Vt.PICK&&(m=Object(z.jsx)(z.Fragment,{}));var y,g=u.useState(Math.floor(t/2)),v=Object(Ge.a)(g,2),_=v[0],E=v[1],S=u.useState(Math.floor(n/2)),A=Object(Ge.a)(S,2),C=A[0],T=A[1],I=$t({enabled:l===Vt.PICK,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,cx:_,cy:C,setCx:E,setCy:T}),R=I.coords,D=I.handles,w=tn({scanHeight:n,scanWidth:t}),k=w.rectRoiHandles,F=w.rectRoiWidgets,N=w.rectRoiParameters,L=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),r=Object(u.useState)(t/2),s=Object(Ge.a)(r,2),c=s[0],i=s[1],o=Object(u.useState)(n/2),d=Object(Ge.a)(o,2),l=d[0],j=d[1],b=Object(u.useState)(a/8),h=Object(Ge.a)(b,2),p=h[0],O=h[1],f=function(e,t){i(e),j(t)},x=function(e){O(e)},m={x:c-p,y:l};return{diskRoiParameters:{roi:{shape:"disk",cx:c,cy:l,r:p}},diskRoiHandles:function(e,a){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:c,y:l,imageWidth:t,onDragMove:f,parentOnDragStart:e,parentOnDrop:a,constraint:gt(t,n)}),Object(z.jsx)(Lt,{x:m.x,y:m.y,imageWidth:t,onDragMove:vt(c,l,x),parentOnDragStart:e,parentOnDrop:a,constraint:_t(l)})]})},diskRoiWidgets:Object(z.jsx)(Ct,{cx:c,cy:l,r:p,imageWidth:t})}}({scanHeight:n,scanWidth:t}),M=L.diskRoiHandles,H=L.diskRoiWidgets,U=L.diskRoiParameters,V=function(){return null},W={roi:{}};switch(p){case Wt.DISK:V=M,y=H,W=U;break;case Wt.RECT:V=k,y=F,W=N}switch(l){case Vt.PICK:V=D,y=void 0}return nn({enabled:l===Vt.SD&&r,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,roiParameters:W,analysisType:P.SD_FRAMES}),nn({enabled:l===Vt.SUM&&r,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,roiParameters:W,analysisType:P.SUM_FRAMES}),{frameViewTitle:l!==Vt.PICK?null:Object(z.jsxs)(z.Fragment,{children:["Pick: x=",R.cx,", y=",R.cy," \u2003"]}),frameModeSelector:Object(z.jsxs)(z.Fragment,{children:[x," ",m]}),roiSelector:m,handles:V,widgets:y}},cn=n(219),on=function(e){var t=e.title,n=e.subtitle,a=e.left,r=e.right,s=e.toolbar,c=e.params;return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(be.a,{as:"h3",attached:"top",children:[Object(z.jsx)(Y.a,{name:"cog"}),Object(z.jsx)(be.a.Content,{children:t})]}),Object(z.jsx)(O.a,{attached:!0,children:Object(z.jsx)(cn.a,{columns:2,children:Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsxs)(cn.a.Column,{children:[a,Object(z.jsx)("p",{children:n})]}),Object(z.jsx)(cn.a.Column,{children:r})]})})}),null===c?c:Object(z.jsx)(O.a,{attached:!0,children:c}),s]})},un=n(330),dn=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n,a,r){var s;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={dataset:a,details:r},e.next=3,qe("compoundAnalyses/".concat(t,"/analyses/").concat(n,"/"),s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),ln=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe("compoundAnalyses/".concat(t,"/analyses/").concat(n,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),jn=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n,a){var r;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={dataset:n,details:a},e.next=3,qe("compoundAnalyses/".concat(t,"/"),r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),bn=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe("compoundAnalyses/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hn=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){var n,a,r;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xe(),a="".concat(n,"compoundAnalyses/").concat(t,"/copy/notebook/"),e.next=4,fetch(a,{method:"GET",credentials:"same-origin"});case 4:return r=e.sent,e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pn=function(e){var t=P[e];return Gn[t]},On=function(e){var t=e.compoundAnalysis,n=e.currentFormat,a=Xe(),r=Object(s.d)((function(e){return e.analyses.byId})),c=Object(s.d)((function(e){return e.jobs.byId})),i=t.details.analyses.map((function(e){return r[e]})).filter((function(e){return e.jobs.some((function(e){return c[e].status===Ee.SUCCESS}))})),o=function(e){return pn(e.details.analysisType).desc},u=function(e){return e.displayedJob?c[e.displayedJob].results.filter((function(e){return e.description.includeInDownload})).map((function(e){return e.description.title})):[]};return Object(z.jsx)("ul",{children:i.map((function(e){return Object(z.jsx)("li",{children:Object(z.jsxs)("a",{href:(r=e.id,"".concat(a,"compoundAnalyses/").concat(t.compoundAnalysis,"/analyses/").concat(r,"/download/").concat(n,"/")),children:[o(e)," (channels: ",u(e).join(", "),")"]})},e.id);var r}))})},fn=function(e){var t=e.compoundAnalysis,n=Object(u.useState)({dependency:"",initial_setup:"",ctx:"",dataset:"",analysis:[{analysis:"",plot:[""]}]}),a=Object(Ge.a)(n,2),r=a[0],c=a[1],i=Object(s.c)(),o=function(e){return Object(z.jsxs)(O.a,{padded:!0,children:[Object(z.jsx)(J.a,{floated:"right",icon:"copy",onClick:function(){w(e,i)}}),Object(z.jsx)("pre",{children:e})]})};return Object(u.useEffect)((function(){hn(t.compoundAnalysis).then((function(e){c({dependency:e.dependency,initial_setup:e.initial_setup,ctx:e.ctx,dataset:e.dataset,analysis:e.analysis})})).catch((function(){return T(0,i)}))}),[t.compoundAnalysis]),Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(O.a,{clearing:!0,children:[Object(z.jsx)(be.a,{floated:"left",children:"Notebook"}),Object(z.jsxs)(J.a,{icon:!0,labelPosition:"left",floated:"right",onClick:function(){var e=[r.dependency,r.initial_setup,r.ctx,r.dataset].join("\n\n"),t=r.analysis.map((function(e){return"".concat(e.analysis,"\n").concat(e.plot.join("\n\n"))})).join("\n\n");w("".concat(e,"\n\n").concat(t),i)},children:[Object(z.jsx)(Y.a,{name:"copy"}),"Complete notebook"]})]}),Object(z.jsxs)(B.a.Content,{scrolling:!0,children:[[r.dependency,r.initial_setup,r.ctx,r.dataset].map(o),r.analysis.map((function(e){return Object(z.jsxs)(z.Fragment,{children:[o(e.analysis),e.plot.map(o)]})}))]})]})},xn=function(e){var t=e.compoundAnalysis,n=Xe(),a="".concat(n,"compoundAnalyses/").concat(t.compoundAnalysis,"/download/notebook/");return Object(z.jsx)("ul",{children:Object(z.jsx)("li",{children:Object(z.jsx)("a",{href:a,children:"notebook corresponding to analysis"})})})},mn=function(e){var t=e.formatOptions,n=e.onFormatChange,a=e.currentFormat,r=e.compoundAnalysis;return Object(z.jsxs)(un.a.Pane,{children:[Object(z.jsxs)(be.a,{children:["Download Results, format: ",Object(z.jsx)(p.a,{inline:!0,options:t,onChange:n,value:a})]}),Object(z.jsx)(be.a,{as:"h3",children:"Available results:"}),Object(z.jsx)(On,{compoundAnalysis:r,currentFormat:a})]})},yn=function(e){var t=e.compoundAnalysis;return Object(z.jsxs)(un.a.Pane,{children:[Object(z.jsx)(be.a,{as:"h3",children:"Available scripts: "}),Object(z.jsx)(xn,{compoundAnalysis:t})]})},gn=function(e){var t=e.compoundAnalysis;return Object(z.jsx)(un.a.Pane,{children:Object(z.jsx)(fn,{compoundAnalysis:t})})},vn=function(e){var t,n=e.compoundAnalysis,a=Object(s.d)((function(e){return e.config.resultFileFormats})),r=Object.keys(a).map((function(e){return{value:e,text:a[e].description}})),c=Object(u.useState)(null===(t=r[0])||void 0===t?void 0:t.value),i=Object(Ge.a)(c,2),o=i[0],d=i[1];u.useEffect((function(){0===r.length||o||d(r[0].value)}),[r,o]);var l=function(e,t){t.value&&d(t.value.toString())},j=[{menuItem:"Download result",render:function(){return Object(z.jsx)(mn,{formatOptions:r,onFormatChange:l,currentFormat:o,compoundAnalysis:n})}},{menuItem:"Download notebook",render:function(){return Object(z.jsx)(yn,{compoundAnalysis:n})}},{menuItem:"Copy notebook",render:function(){return Object(z.jsx)(gn,{compoundAnalysis:n})}}];return Object(z.jsx)(B.a,{trigger:Object(z.jsxs)(J.a,{icon:!0,children:[Object(z.jsx)(Y.a,{name:"download"}),"Download"]}),children:Object(z.jsx)(un.a,{panes:j})})},_n=function(e){var t=e.busyIdxs,n=e.onApply,a=e.compoundAnalysis,r=e.extra,c=Object(s.c)(),i=Object(s.d)((function(e){return e.analyses})),o=Object(s.d)((function(e){return e.jobs})),u="busy"===function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=e.details.analyses;return a.length>0&&(r=r.filter((function(e,t){return-1!==a.indexOf(t)}))),r.reduce((function(e,a){var r=t.byId[a];return r?(r.jobs.forEach((function(e){n.byId[e]||console.error("could not find job id ".concat(e," for analysis ").concat(a))})),r.jobs.every((function(e){return!n.byId[e]||n.byId[e].running===_e.DONE}))?e:"busy"):e}),"idle")}(a,i,o,t)?{name:"cog",loading:!0}:{name:"check"};return Object(z.jsx)(O.a,{attached:"bottom",children:Object(z.jsxs)(J.a.Group,{children:[Object(z.jsxs)(J.a,{primary:!0,onClick:n,icon:!0,children:[Object(z.jsx)(Y.a,Object(V.a)({},u)),"Apply"]}),Object(z.jsx)(vn,{compoundAnalysis:a}),Object(z.jsxs)(J.a,{onClick:function(){return c(Xt(a.compoundAnalysis))},icon:!0,children:[Object(z.jsx)(Y.a,{name:"remove"}),"Remove"]}),r]})})};!function(e){e.DISK="DISK",e.RING="RING"}(rn||(rn={}));var En,Sn,An=(an={},Object(k.a)(an,rn.DISK,{label:"Disk cut-off"}),Object(k.a)(an,rn.RING,{label:"Annular CoM"}),an),Cn=D(rn).map((function(e){return{text:An[rn[e]].label,value:rn[e]}})),Tn=function(e){var t=e.selectedShape,n=e.handleChange;return Object(z.jsxs)(z.Fragment,{children:["CoM mask shape:"," ",Object(z.jsx)(p.a,{inline:!0,options:Cn,value:t,onChange:n})]})},In=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(u.useState)(!1),E=Object(Ge.a)(_,2),S=E[0],A=E[1],C=Object(u.useState)("0.0"),T=Object(Ge.a)(C,2),I=T[0],D=T[1],w=Object(u.useState)(d/8),k=Object(Ge.a)(w,2),F=k[0],N=k[1],L=Object(u.useState)(rn.DISK),M=Object(Ge.a)(L,2),H=M[0],U=M[1],W=Object(u.useState)(!1),K=Object(Ge.a)(W,2),X=K[0],Q=K[1],q=Object(s.c)(),$={x:b-g,y:f},Z={x:b-F,y:f},ee=R((function(e,t){h(e),x(t)})),te=R(v),ne=R(N),ae=_t(f);H===rn.RING&&(ae=St(Z.x,f));var re,se,ce=function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Nt,{x:b,y:f,imageWidth:o,onDragMove:ee,parentOnDragStart:e,parentOnDrop:t,constraint:gt(o,i)}),Object(z.jsx)(Nt,{x:$.x,y:$.y,imageWidth:o,onDragMove:vt(b,f,te),parentOnDragStart:e,parentOnDrop:t,constraint:ae})]})},ie=Object(z.jsx)(z.Fragment,{});H===rn.DISK?ie=Object(z.jsx)(Ct,{cx:b,cy:f,r:g,imageWidth:o}):H===rn.RING&&(ie=Object(z.jsx)(Ut,{cx:b,cy:f,ro:g,ri:F,imageWidth:o}),re=ce,se=function(e,t){return Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(Nt,{x:Z.x,y:Z.y,imageWidth:o,onDragMove:vt(b,f,ne),parentOnDragStart:e,parentOnDrop:t,constraint:Et($.x,f)})})},ce=function(e,t){return Object(z.jsxs)(z.Fragment,{children:[re(e,t),se(e,t)]})});var oe=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),ue=oe.frameViewTitle,de=oe.frameModeSelector,le=oe.handles,je=oe.widgets,he=Object(z.jsxs)(z.Fragment,{children:[ue," Disk: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), r=",g.toFixed(2)]}),pe=parseFloat(I);pe||(pe=0);var Oe=function(){var e={shape:"com",cx:b,cy:f,r:g,flip_y:S,scan_rotation:pe};return H===rn.RING&&(e.ri=F),{analysisType:P.CENTER_OF_MASS,parameters:e}},fe=function(){q(Kt(t.compoundAnalysis,1,Oe()))};u.useEffect((function(){q(Yt(t,1,Oe()))}),[b,f,S,I,g,F,H]);var xe=Object(s.d)((function(e){return e.analyses})),me=Object(s.d)((function(e){return e.jobs})),ye=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=e.details.analyses;return a.length>0&&(r=r.filter((function(e,t){return-1!==a.indexOf(t)}))),0!==r.length&&r.reduce((function(e,a){var r=t.byId[a];if(!r)return!1;if(!r.displayedJob)return!1;var s=n.byId[r.displayedJob];return!!s&&s.running===_e.DONE&&e}),!0)}(t,xe,me,[1]);u.useEffect((function(){ye&&fe()}),[S,I]);var ge=function(e,t){var n=t.value;"-"===n&&D("-"),D(n)},ve=X?{name:"cog",loading:!0}:{name:"question"},Ee=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:fe,busyIdxs:[1],extra:Object(z.jsxs)(J.a,{icon:!0,onClick:function(e){Q(!0);var n=Xe(),a="".concat(n,"compoundAnalyses/").concat(t.compoundAnalysis,"/rpc/guess_parameters/");fetch(a,{method:"PUT",credentials:"same-origin"}).then((function(e){return e.json()})).then((function(e){Q(!1);var t=e;"ok"===t.status?(A(t.guess.flip_y),h(t.guess.cx),x(t.guess.cy),D(t.guess.scan_rotation.toString())):console.error(t.message)})).catch((function(e){Q(!1),console.error(e)})),e.preventDefault()},disabled:X,children:[Object(z.jsx)(Y.a,Object(V.a)({},ve)),"Guess parameters"]})}),Se=Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(be.a,{children:Object(z.jsxs)(B.a,{trigger:Object(z.jsxs)(be.a.Content,{children:["Parameters"," ",Object(z.jsx)(Y.a,{name:"info circle",size:"small",link:!0})]}),children:[Object(z.jsx)(We.a.Header,{children:"CoM / first moment parameters"}),Object(z.jsxs)(We.a.Content,{children:[Object(z.jsx)(be.a,{children:"CoM mask shape"}),Object(z.jsx)("p",{children:"Select a shape that will be used to mask out the data:"}),Object(z.jsxs)("ul",{children:[Object(z.jsxs)("li",{children:[Object(z.jsx)("em",{children:"Annular CoM"}),": calculate the center of mass in a selected ring"]}),Object(z.jsxs)("li",{children:[Object(z.jsx)("em",{children:"Disk cut-off"}),": calculate the center of mass in a selected disk"]})]}),Object(z.jsx)(be.a,{children:"Flip in y direction"}),Object(z.jsx)("p",{children:"Flip the Y coordinate. Some detectors, for example Quantum Detectors Merlin, may have pixel (0, 0) at the lower left corner. This has to be corrected to get the sign of the y shift as well as curl and divergence right."}),Object(z.jsx)(be.a,{children:"Rotation between scan and detector"}),Object(z.jsx)("p",{children:"The optics of an electron microscope can rotate the image. Furthermore, scan generators may allow scanning in arbitrary directions. This means that the x and y coordinates of the detector image are usually not parallel to the x and y scan coordinates. For interpretation of center of mass shifts, however, the shift vector in detector coordinates has to be put in relation to the position on the sample. This parameter can be used to rotate the detector coordinates to match the scan coordinate system. A positive value rotates the displacement vector clock-wise. That means if the detector seems rotated to the right relative to the scan, this value should be negative to counteract this rotation."}),Object(z.jsx)("p",{children:"Use either the numeric input or the slider to adjust the rotation angle."})]})]})}),Object(z.jsx)(G.a,{children:Object(z.jsxs)(Be.a,{relaxed:"very",children:[Object(z.jsx)(Be.a.Item,{children:Object(z.jsx)(Be.a.Content,{children:Object(z.jsx)(Tn,{selectedShape:H,handleChange:function(e,t){U(t.value)}})})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsx)(Be.a.Content,{children:Object(z.jsx)(G.a.Field,{control:Ye.a,label:"Flip in y direction",checked:S,onChange:function(e,t){var n=t.checked;A(n)}})})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsxs)(Be.a.Content,{children:[Object(z.jsx)(G.a.Field,{type:"number",control:we.a,label:"Rotation between scan and detector (deg)",value:I,onChange:ge}),Object(z.jsx)(G.a.Field,{type:"range",min:"-180",max:"180",step:"0.1",control:we.a,value:I,onChange:ge})]})})]})})]});return Object(z.jsx)(on,{title:"CoM / first moment analysis",subtitle:he,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:ce,extraWidgets:ie,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:de})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:le,extraWidgets:je})}),toolbar:Ee,params:Se})},Rn=n(326),Dn=function(e){var t=e.title,n=e.subtitle,a=e.left,r=e.mid,s=e.right,c=e.toolbar,i=e.clustparams,o=e.title1,u=e.title2,d=e.title3;return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(be.a,{as:"h3",attached:"top",children:[Object(z.jsx)(Y.a,{name:"cog"}),Object(z.jsx)(be.a.Content,{children:t})]}),Object(z.jsx)(O.a,{attached:!0,children:Object(z.jsxs)(cn.a,{columns:3,children:[Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsx)(cn.a.Column,{width:4,children:Object(z.jsx)("p",{children:o})}),Object(z.jsx)(cn.a.Column,{width:6,children:Object(z.jsx)("p",{children:u})}),Object(z.jsx)(cn.a.Column,{width:6,children:Object(z.jsx)("p",{children:d})})]}),Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsx)(cn.a.Column,{width:4,children:a}),Object(z.jsx)(cn.a.Column,{width:6,children:r}),Object(z.jsx)(cn.a.Column,{width:6,children:s})]}),Object(z.jsx)(cn.a.Row,{children:Object(z.jsxs)(cn.a.Column,{width:16,children:[Object(z.jsx)("div",{children:i}),Object(z.jsx)("p",{children:n})]})})]})}),c]})},wn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(u.useState)(d/2),E=Object(Ge.a)(_,2),S=E[0],A=E[1],C={x:b-g,y:f},T={x:b-S,y:f},I=u.useState(1),D=Object(Ge.a)(I,2),w=D[0],k=D[1],F=u.useState(500),N=Object(Ge.a)(F,2),L=N[0],M=N[1],H=u.useState(20),U=Object(Ge.a)(H,2),V=U[0],W=U[1],B=R((function(e,t){h(e),x(t)})),J=R(v),K=R(A),X=Object(z.jsx)(Ut,{cx:b,cy:f,ri:g,ro:S,imageWidth:o}),Q=Object(s.c)(),q=tn({scanWidth:c,scanHeight:r}),$=q.rectRoiParameters,Z=q.rectRoiHandles,ee=q.rectRoiWidgets;u.useEffect((function(){t.doAutoStart&&Q(Kt(t.compoundAnalysis,1,{analysisType:P.SUM_SIG,parameters:{}}))}),[t.compoundAnalysis,Q,t.doAutoStart]);var te=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),ne=te.frameViewTitle,ae=te.frameModeSelector,re=te.handles,se=te.widgets,ce=Object(z.jsxs)(z.Fragment,{children:[ne," Ring: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), ri=",g.toFixed(2),", ro=",S.toFixed(2)]}),ie=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){Q(Kt(t.compoundAnalysis,2,{analysisType:P.CLUST,parameters:{roi:$.roi,cx:b,cy:f,ri:g,ro:S,n_clust:V,n_peaks:L,min_dist:w}}))},busyIdxs:[2]}),oe=u.useState(!1),ue=Object(Ge.a)(oe,2),de=ue[0],le=ue[1],je=Object(z.jsxs)(Rn.a,{children:[Object(z.jsxs)(Rn.a.Title,{active:de,index:0,onClick:function(){le(!de)},children:[Object(z.jsx)(Y.a,{name:"dropdown"}),"Parameters"]}),Object(z.jsx)(Rn.a.Content,{active:de,children:Object(z.jsxs)(G.a,{children:[Object(z.jsx)(G.a.Field,{children:Object(z.jsxs)("label",{children:[" Number of clusters  ",Object(z.jsx)("input",{type:"number",value:V,step:"1",min:"2",max:"100",onChange:function(e){W(e.target.valueAsNumber)}})," "]})}),Object(z.jsx)(G.a.Field,{children:Object(z.jsxs)("label",{children:["  Maximal number of possible peak positions to detect (better put higher value, the output is limited to the number of peaks the algorithm could find)  ",Object(z.jsx)("input",{type:"number",value:L,step:"1",min:"5",max:"200",onChange:function(e){M(e.target.valueAsNumber)}})," "]})}),Object(z.jsx)(G.a.Field,{children:Object(z.jsxs)("label",{children:["  Minimal distance in pixels between peaks  ",Object(z.jsx)("input",{type:"number",value:w,step:"1",min:"0",max:"100",onChange:function(e){k(e.target.valueAsNumber)}}),"  "]})})]})})]});return Object(z.jsx)(Dn,{title:"Region clustering",subtitle:ce,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:b,y:f,imageWidth:o,onDragMove:B,parentOnDrop:t,parentOnDragStart:e,constraint:gt(o,i)}),Object(z.jsx)(Lt,{x:T.x,y:T.y,imageWidth:o,onDragMove:vt(b,f,K),parentOnDrop:t,parentOnDragStart:e,constraint:St(C.x,f)}),Object(z.jsx)(Lt,{x:C.x,y:C.y,imageWidth:o,parentOnDrop:t,parentOnDragStart:e,onDragMove:vt(b,f,J),constraint:Et(T.x,f)})]})},extraWidgets:X,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:ae})}),mid:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:Z,extraWidgets:ee})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:2,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:re,extraWidgets:se})}),toolbar:ie,clustparams:je,title1:"Peaks inside the ring will be considered",title2:"Choose specimen region",title3:"Clustering result"})},kn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=function(e,t){h(e),x(t)},E=v,S={x:b-g,y:f},A=Object(z.jsx)(Ct,{cx:b,cy:f,r:g,imageWidth:o}),C=Object(s.c)(),T=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),I=T.frameViewTitle,R=T.frameModeSelector,D=T.handles,w=T.widgets,k=Object(z.jsxs)(z.Fragment,{children:[I," Disk: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), r=",g.toFixed(2)]}),F=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){C(Kt(t.compoundAnalysis,1,{analysisType:P.APPLY_DISK_MASK,parameters:{shape:"disk",cx:b,cy:f,r:g}}))},busyIdxs:[1]});return Object(z.jsx)(on,{title:"Disk analysis",subtitle:k,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:b,y:f,imageWidth:o,onDragMove:_,parentOnDragStart:e,parentOnDrop:t,constraint:gt(o,i)}),Object(z.jsx)(Lt,{x:S.x,y:S.y,imageWidth:o,onDragMove:vt(b,f,E),parentOnDragStart:e,parentOnDrop:t,constraint:_t(f)})]})},extraWidgets:A,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:R})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:D,extraWidgets:w})}),toolbar:F})},Fn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(u.useState)(d/2),E=Object(Ge.a)(_,2),S=E[0],A=E[1],C={x:b-g,y:f},T={x:b-S,y:f},I=R((function(e,t){h(e),x(t)})),D=R(v),w=R(A),k=Object(z.jsx)(Ut,{cx:b,cy:f,ri:g,ro:S,imageWidth:o}),F=Object(s.c)(),N=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),L=N.frameViewTitle,M=N.frameModeSelector,H=N.handles,U=N.widgets,V=Object(z.jsxs)(z.Fragment,{children:[L," Ring: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), ri=",g.toFixed(2),", ro=",S.toFixed(2)]}),W=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){F(Kt(t.compoundAnalysis,1,{analysisType:P.FEM,parameters:{shape:"ring",cx:b,cy:f,ri:g,ro:S}}))},busyIdxs:[1]});return Object(z.jsx)(on,{title:"Fluctuation EM (SD over Ring analysis)",subtitle:V,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:b,y:f,imageWidth:o,onDragMove:I,parentOnDrop:t,parentOnDragStart:e,constraint:gt(o,i)}),Object(z.jsx)(Lt,{x:T.x,y:T.y,imageWidth:o,onDragMove:vt(b,f,w),parentOnDrop:t,parentOnDragStart:e,constraint:St(C.x,f)}),Object(z.jsx)(Lt,{x:C.x,y:C.y,imageWidth:o,parentOnDrop:t,parentOnDragStart:e,onDragMove:vt(b,f,D),constraint:Et(T.x,f)})]})},extraWidgets:k,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:M})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:H,extraWidgets:U})}),toolbar:W})},Nn=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.analysisIndex,c=e.compoundAnalysisId,i=e.cx,o=e.cy,u=e.real_rad,l=e.real_centerx,j=e.real_centery,b=e.setCx,h=e.setCy,p=Object(s.c)();d.a.useEffect((function(){t&&p(Kt(c,r,{analysisType:P.PICK_FFT_FRAME,parameters:{x:i,y:o,real_rad:u,real_centerx:l,real_centery:j}}))}),[c,i,o,t,r,u,l,j,p]);var O=function(e,t){var n=Math.round(e),a=Math.round(t);i===n&&o===a||(b(n),h(a))};return{coords:{cx:i,cy:o},handles:function(e,t){return Object(z.jsx)(Lt,{x:i,y:o,withCross:!0,imageWidth:n,onDragMove:O,parentOnDragStart:e,parentOnDrop:t,constraint:gt(n,a)})}}},Ln=function(e){var t=e.enabled,n=e.analysisIndex,a=e.compoundAnalysisId,r=e.real_rad,c=e.real_centerx,i=e.real_centery,o=Object(s.c)();d.a.useEffect((function(){t&&o(Kt(a,n,{analysisType:P.FFTSUM_FRAMES,parameters:{real_rad:r,real_centerx:c,real_centery:i}}))}),[a,t,n,r,c,i,o])},Mn=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.compoundAnalysisId,r=e.real_rad,c=e.real_centerx,i=e.real_centery,o=e.doAutoStart,d=[{text:"Pick",value:P.PICK_FRAME},{text:"Average",value:P.SUM_FRAMES}],l=Object(u.useState)(P.SUM_FRAMES),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(s.c)(),O=Object(z.jsx)(Zt,{modes:d,currentMode:b,onModeChange:function(e){p(Jt(a)),h(e)},label:"Mode"}),f=u.useState(Math.floor(t/2)),x=Object(Ge.a)(f,2),m=x[0],y=x[1],g=u.useState(Math.floor(n/2)),v=Object(Ge.a)(g,2),_=v[0],E=v[1],S=$t({enabled:b===P.PICK_FRAME&&o,scanWidth:t,scanHeight:n,analysisIndex:1,compoundAnalysisId:a,cx:m,cy:_,setCx:y,setCy:E}),A=S.coords,C=S.handles;Nn({enabled:b===P.PICK_FRAME&&o,scanWidth:t,scanHeight:n,analysisIndex:0,compoundAnalysisId:a,cx:m,cy:_,setCx:y,setCy:E,real_rad:r,real_centerx:c,real_centery:i}),nn({enabled:b===P.SUM_FRAMES&&o,analysisIndex:1,compoundAnalysisId:a,scanWidth:t,scanHeight:n,roiParameters:{roi:{}},analysisType:P.SUM_FRAMES}),Ln({enabled:b===P.SUM_FRAMES&&o,analysisIndex:0,compoundAnalysisId:a,real_rad:r,real_centerx:c,real_centery:i});return{frameViewTitle:b!==P.PICK_FRAME?null:Object(z.jsxs)(z.Fragment,{children:["Pick: x=",A.cx,", y=",A.cy," \u2003"]}),handles:b!==P.PICK_FRAME?function(){return null}:C,frameModeSelector:O}},Pn=function(e){var t=e.title,n=e.subtitle,a=e.left,r=e.mid,s=e.right,c=e.toolbar,i=e.title1,o=e.title2,u=e.title3;return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(be.a,{as:"h3",attached:"top",children:[Object(z.jsx)(Y.a,{name:"cog"}),Object(z.jsx)(be.a.Content,{children:t})]}),Object(z.jsx)(O.a,{attached:!0,children:Object(z.jsxs)(cn.a,{columns:3,children:[Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsx)(cn.a.Column,{width:5,children:Object(z.jsx)("p",{children:i})}),Object(z.jsx)(cn.a.Column,{width:5,children:Object(z.jsx)("p",{children:o})}),Object(z.jsx)(cn.a.Column,{width:6,children:Object(z.jsx)("p",{children:u})})]}),Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsx)(cn.a.Column,{width:5,children:a}),Object(z.jsx)(cn.a.Column,{width:5,children:r}),Object(z.jsx)(cn.a.Column,{width:6,children:s})]}),Object(z.jsxs)(cn.a.Row,{children:[Object(z.jsx)(cn.a.Column,{width:10,children:Object(z.jsx)("p",{children:n})}),Object(z.jsx)(cn.a.Column,{width:6})]})]})}),c]})},Hn=function(e){var t,n,a=e.compoundAnalysis,r=e.dataset.params.shape,c=Object(Ge.a)(r,4),i=c[0],o=c[1],d=c[2],l=c[3],j=Math.min(l,d),b=l/2,h=d/2,p=Object(u.useState)(j/4),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(j/2),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(s.c)(),E={x:b-f,y:h},S={x:b-g,y:h},A=R(x),C=R(v),T=Object(z.jsx)(Ut,{cx:b,cy:h,ri:f,ro:g,imageWidth:l}),I=u.useState(!0),D=Object(Ge.a)(I,2),w=D[0],k=D[1],F=Object(u.useState)(l/2),N=Object(Ge.a)(F,2),L=N[0],M=N[1],H=Object(u.useState)(d/2),U=Object(Ge.a)(H,2),V=U[0],W=U[1],G=Object(u.useState)(j/4),B=Object(Ge.a)(G,2),Y=B[0],J=B[1],K=R((function(e,t){_(Jt(a.compoundAnalysis)),M(e),W(t)})),X=R(J),Q={x:L-Y,y:V},q=Object(z.jsx)(Ct,{cx:L,cy:V,r:Y,imageWidth:l}),$=Mn({scanWidth:o,scanHeight:i,compoundAnalysisId:a.compoundAnalysis,real_rad:w?Y:null,real_centerx:w?L:null,real_centery:w?V:null,doAutoStart:a.doAutoStart}),Z=$.frameViewTitle,ee=$.frameModeSelector,te=$.handles,ne=Object(z.jsx)(_n,{compoundAnalysis:a,onApply:function(){_(Kt(a.compoundAnalysis,2,{analysisType:P.APPLY_FFT_MASK,parameters:{rad_in:f,rad_out:g,real_rad:w?Y:null,real_centerx:w?L:null,real_centery:w?V:null}}))},busyIdxs:[2]});return w?(n=Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:L,y:V,imageWidth:l,onDragMove:K,parentOnDragStart:e,parentOnDrop:t,constraint:gt(l,d)}),Object(z.jsx)(Lt,{x:Q.x,y:Q.y,imageWidth:l,onDragMove:vt(L,V,X),parentOnDragStart:e,parentOnDrop:t,constraint:_t(V)})]})},extraWidgets:q,analysisIndex:1,compoundAnalysis:a.compoundAnalysis,width:l,height:d,selectors:ee})}),t=Object(z.jsxs)(z.Fragment,{children:[Z," real_rad=",f.toFixed(2),", real_center=(x=",L.toFixed(2),", y=",V.toFixed(2),"), fourier_rad_in=",f.toFixed(2),", fourier_rad_out=",g.toFixed(2)]})):(n=Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:a.compoundAnalysis,width:l,height:d,selectors:ee})}),t=Object(z.jsxs)(z.Fragment,{children:[Z," fourier_rad_in=",f.toFixed(2),", fourier_rad_out=",g.toFixed(2)]})),Object(z.jsx)(Pn,{title:"FFT analysis",subtitle:t,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:S.x,y:S.y,imageWidth:l,onDragMove:vt(b,h,C),parentOnDrop:t,parentOnDragStart:e,constraint:St(E.x,h)}),Object(z.jsx)(Lt,{x:E.x,y:E.y,imageWidth:l,parentOnDrop:t,parentOnDragStart:e,onDragMove:vt(b,h,A),constraint:Et(S.x,h)})]})},extraWidgets:T,analysisIndex:0,compoundAnalysis:a.compoundAnalysis,width:l,height:d})}),mid:n,right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:2,compoundAnalysis:a.compoundAnalysis,width:o,height:i,extraHandles:te})}),toolbar:ne,title2:Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("label",{children:[" Masking out of zero order diffraction peak ",Object(z.jsx)("input",{type:"checkbox",name:"check",onChange:function(e){_(Jt(a.compoundAnalysis)),k(e.target.checked)},checked:w})," "]})}),title1:"Masking of integration region in Fourier space",title3:"Result of analysis"})},Un=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Object(u.useState)(o/2),l=Object(Ge.a)(d,2),j=l[0],b=l[1],h=Object(u.useState)(i/2),p=Object(Ge.a)(h,2),O=p[0],f=p[1],x=R((function(e,t){var n=Math.round(e),a=Math.round(t);j===n&&O===a||(b(n),f(a))})),m=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),y=m.frameViewTitle,g=m.frameModeSelector,v=m.handles,_=m.widgets,E=Object(z.jsxs)(z.Fragment,{children:[y," Point: center=(x=",j.toFixed(2),", y=",O.toFixed(2),")"]}),S=Object(s.c)(),A=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){S(Kt(t.compoundAnalysis,1,{analysisType:P.APPLY_POINT_SELECTOR,parameters:{shape:"point",cx:j,cy:O}}))},busyIdxs:[1]});return Object(z.jsx)(on,{title:"Point analysis",subtitle:E,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(Lt,{x:j,y:O,withCross:!0,onDragMove:x,imageWidth:o,parentOnDragStart:e,parentOnDrop:t,constraint:gt(o,i)})})},analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:g})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:v,extraWidgets:_})}),toolbar:A})},Vn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(u.useState)(d/2),E=Object(Ge.a)(_,2),S=E[0],A=E[1],C=Object(u.useState)(1),T=Object(Ge.a)(C,1)[0],I=Object(u.useState)(8),D=Object(Ge.a)(I,1)[0],w={x:b-g,y:f},k={x:b-S,y:f},F=R((function(e,t){h(e),x(t)})),N=R(v),L=R(A),M=Object(z.jsx)(Ut,{cx:b,cy:f,ri:g,ro:S,imageWidth:o}),H=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),U=H.frameViewTitle,V=H.frameModeSelector,W=H.handles,G=H.widgets,B=Object(z.jsxs)(z.Fragment,{children:[U," Ring: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), ri=",g.toFixed(2),", ro=",S.toFixed(2)]}),Y=Object(s.c)(),J=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){Y(Kt(t.compoundAnalysis,1,{analysisType:P.RADIAL_FOURIER,parameters:{shape:"radial_fourier",cx:b,cy:f,ri:g,ro:S,n_bins:T,max_order:D}}))},busyIdxs:[1]});return Object(z.jsx)(on,{title:"Radial Fourier analysis",subtitle:B,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:b,y:f,imageWidth:o,onDragMove:F,parentOnDrop:t,parentOnDragStart:e,constraint:gt(o,i)}),Object(z.jsx)(Lt,{x:k.x,y:k.y,imageWidth:o,onDragMove:vt(b,f,L),parentOnDrop:t,parentOnDragStart:e,constraint:St(w.x,f)}),Object(z.jsx)(Lt,{x:w.x,y:w.y,imageWidth:o,parentOnDrop:t,parentOnDragStart:e,onDragMove:vt(b,f,N),constraint:Et(k.x,f)})]})},extraWidgets:M,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:V})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:W,extraWidgets:G})}),toolbar:J})},Wn=function(e){var t=e.compoundAnalysis,n=e.dataset.params.shape,a=Object(Ge.a)(n,4),r=a[0],c=a[1],i=a[2],o=a[3],d=Math.min(o,i),l=Object(u.useState)(o/2),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=Object(u.useState)(i/2),O=Object(Ge.a)(p,2),f=O[0],x=O[1],m=Object(u.useState)(d/4),y=Object(Ge.a)(m,2),g=y[0],v=y[1],_=Object(u.useState)(d/2),E=Object(Ge.a)(_,2),S=E[0],A=E[1],C={x:b-g,y:f},T={x:b-S,y:f},I=R((function(e,t){h(e),x(t)})),D=R(v),w=R(A),k=Object(z.jsx)(Ut,{cx:b,cy:f,ri:g,ro:S,imageWidth:o}),F=Object(s.c)(),N=sn({scanWidth:c,scanHeight:r,compoundAnalysisId:t.compoundAnalysis,doAutoStart:t.doAutoStart}),L=N.frameViewTitle,M=N.frameModeSelector,H=N.handles,U=N.widgets,V=Object(z.jsxs)(z.Fragment,{children:[L," Ring: center=(x=",b.toFixed(2),", y=",f.toFixed(2),"), ri=",g.toFixed(2),", ro=",S.toFixed(2)]}),W=Object(z.jsx)(_n,{compoundAnalysis:t,onApply:function(){F(Kt(t.compoundAnalysis,1,{analysisType:P.APPLY_RING_MASK,parameters:{shape:"ring",cx:b,cy:f,ri:g,ro:S}}))},busyIdxs:[1]});return Object(z.jsx)(on,{title:"Ring analysis",subtitle:V,left:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{extraHandles:function(e,t){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Lt,{x:b,y:f,imageWidth:o,onDragMove:I,parentOnDrop:t,parentOnDragStart:e,constraint:gt(o,i)}),Object(z.jsx)(Lt,{x:T.x,y:T.y,imageWidth:o,onDragMove:vt(b,f,w),parentOnDrop:t,parentOnDragStart:e,constraint:St(C.x,f)}),Object(z.jsx)(Lt,{x:C.x,y:C.y,imageWidth:o,parentOnDrop:t,parentOnDragStart:e,onDragMove:vt(b,f,D),constraint:Et(T.x,f)})]})},extraWidgets:k,analysisIndex:0,compoundAnalysis:t.compoundAnalysis,width:o,height:i,selectors:M})}),right:Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(yt,{analysisIndex:1,compoundAnalysis:t.compoundAnalysis,width:c,height:r,extraHandles:H,extraWidgets:U})}),toolbar:W})},Gn=(En={},Object(k.a)(En,P.APPLY_RING_MASK,{desc:"Application of a ring mask",title:"Ring",component:Wn}),Object(k.a)(En,P.APPLY_DISK_MASK,{desc:"Application of a disk mask",title:"Disk",component:kn}),Object(k.a)(En,P.FEM,{desc:"Application of a ring mask",title:"FEM (SD over Ring)",component:Fn}),Object(k.a)(En,P.CENTER_OF_MASS,{desc:"The center of mass of all diffraction images",title:"Center of mass",component:In}),Object(k.a)(En,P.APPLY_POINT_SELECTOR,{desc:"Image from a single pixel selected in the detector",title:"Point selection",component:Un}),Object(k.a)(En,P.SUM_FRAMES,{desc:"A sum of all (or selected) detector frames",title:"Sum all frames"}),Object(k.a)(En,P.SD_FRAMES,{desc:"A SD of all (or selected) detector frames",title:"SD all frames"}),Object(k.a)(En,P.PICK_FRAME,{desc:"A single picked frame",title:"Pick frame"}),Object(k.a)(En,P.PICK_FFT_FRAME,{desc:"Fourier transform of a picked frame",title:"Pick frame"}),Object(k.a)(En,P.APPLY_FFT_MASK,{desc:"Application of a ring mask in Fourier space",title:"FFT analysis",component:Hn}),Object(k.a)(En,P.FFTSUM_FRAMES,{desc:"Fourier transform of sum of all detector frames",title:"FFT of Sum all frames"}),Object(k.a)(En,P.RADIAL_FOURIER,{desc:"Radial Fourier analysis over the selected ring",title:"Radial Fourier",component:Vn}),Object(k.a)(En,P.CLUST,{desc:"Region clustering based on non-zero order diffraction peaks positions",title:"Clustering",component:wn}),Object(k.a)(En,P.SUM_SIG,{desc:"Frame integration",title:"Sum"}),En),Bn=function(e){var t=e.analysis,n=Object(s.d)((function(e){return e.datasets.byId[t.dataset]}));if(n.status!==N.OPEN)return null;var a=Gn[t.details.mainType].component;if(!a)throw new Error("unknown analysis type");return Object(z.jsx)(a,{dataset:n,compoundAnalysis:t})},Yn=function(e){var t=e.analyses;return Object(z.jsx)(z.Fragment,{children:t.ids.map((function(e){return Object(z.jsx)(Bn,{analysis:t.byId[e]},e)}))})},Jn=function(e,t,n){var a=Object.assign({},e.byId[t],n),r=Object.assign({},e.byId,Object(k.a)({},t,a));return Object.assign({},e,{byId:r})},Kn=function(e,t,n){return{byId:Object.assign({},e.byId,Object(k.a)({},t,n)),ids:[].concat(Object(rt.a)(e.ids),[t])}},zn=function(e,t){return e.reduce((function(e,n){return Object.assign(e,Object(k.a)({},t(n),n))}),{})},Xn=function(e,t){return{byId:e.ids.reduce((function(n,a){return Object.assign(n,Object(k.a)({},a,t(e.byId[a])))}),{}),ids:e.ids}},Qn=function(e,t){var n=e.ids.filter((function(n){return t(e.byId[n])}));return{byId:n.reduce((function(t,n){return Object.assign(t,Object(k.a)({},n,e.byId[n]))}),{}),ids:n}},qn=function(e,t){return e.includes(t)?e.filter((function(e){return e!==t})):[t].concat(Object(rt.a)(e))},$n=D(P).filter((function(e){return void 0!==pn(e).component})).map((function(e){return{text:pn(e).title,value:P[e]}})),Zn=function(e){var t=e.onClick,n=e.label;return Object(z.jsx)(p.a,{text:n,icon:"add",floating:!0,labeled:!0,button:!0,className:"icon",children:Object(z.jsxs)(p.a.Menu,{children:[Object(z.jsx)(p.a.Header,{content:"implemented analyses"}),$n.map((function(e){return Object(z.jsx)(p.a.Item,Object(V.a)({onClick:(n=t,function(e,t){return n(t.value)})},e),e.value);var n}))]})})},ea=Object(s.b)(null,(function(e,t){return{handleAddAnalysis:function(n){e(Gt(t.dataset.id,n))}}}))((function(e){var t=e.handleAddAnalysis;return Object(z.jsx)(Zn,{onClick:t,label:"Add analysis"})})),ta=n(324),na=function(e,t,n){return Object(z.jsxs)(ta.a.Row,{children:[Object(z.jsx)(ta.a.Cell,{children:t}),Object(z.jsx)(ta.a.Cell,{children:(a=e,a instanceof Array?"(".concat(a.join(","),")"):a.toString())})]},n);var a},aa=function(e){var t,n=e.dataset;return Object(z.jsxs)(ta.a,{children:[Object(z.jsx)(ta.a.Header,{children:Object(z.jsxs)(ta.a.Row,{children:[Object(z.jsx)(ta.a.HeaderCell,{children:"Parameter"}),Object(z.jsx)(ta.a.HeaderCell,{children:"Value"})]})}),Object(z.jsx)(ta.a.Body,{children:(t=n.params,Object.entries(t).map((function(e,t){var n=Object(Ge.a)(e,2),a=n[0],r=n[1];return!r||"object"!==typeof r||r instanceof Array?r&&("string"===typeof r||r instanceof Array)?na(r,a,t):void 0:Object.keys(r).map((function(e,t){return na(r,e,t)}))})))})]})},ra=function(e){return e.value instanceof Array?Object(z.jsx)(ca,{diagnostics:e.value}):e.value},sa=function(e){var t=e.elem;return Object(z.jsxs)(ta.a.Row,{children:[Object(z.jsx)(ta.a.Cell,{children:t.name}),Object(z.jsx)(ta.a.Cell,{children:ra(t)})]})},ca=function(e){var t=e.diagnostics;return 0===t.length?null:Object(z.jsxs)(ta.a,{children:[Object(z.jsx)(ta.a.Header,{children:Object(z.jsxs)(ta.a.Row,{children:[Object(z.jsx)(ta.a.HeaderCell,{children:"Name"}),Object(z.jsx)(ta.a.HeaderCell,{children:"Value"})]})}),Object(z.jsx)(ta.a.Body,{children:t.map((function(e,t){return Object(z.jsx)(sa,{elem:e},t)}))})]})},ia=function(e){var t=e.dataset;return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(aa,{dataset:t}),Object(z.jsx)(ca,{diagnostics:t.diagnostics})]})};!function(e){e.OPEN="DATASET_OPEN",e.CANCEL_OPEN="DATASET_CANCEL_OPEN",e.CREATE="DATASET_CREATE",e.CREATED="DATASET_CREATED",e.ERROR="DATASET_ERROR",e.DELETE="DATASET_DELETE",e.DELETED="DATASET_DELETED",e.DETECT="DATASET_DETECT",e.DETECTED="DATASET_DETECTED",e.DETECT_FAILED="DATASET_DETECT_FAILED"}(Sn||(Sn={}));var oa,ua=function(e,t,n,a){return f(Sn.OPEN,{path:e,cachedParams:t,detectedParams:n,detectedInfo:a})},da=function(){return f(Sn.CANCEL_OPEN)},la=function(e){return f(Sn.CREATE,{dataset:e})},ja=function(e){return f(Sn.CREATED,{dataset:e})},ba=function(e,t,n,a){return f(Sn.ERROR,{dataset:e,msg:t,timestamp:n,id:a})},ha=function(e){return f(Sn.DELETE,{dataset:e})},pa=function(e){return f(Sn.DELETED,{dataset:e})},Oa=function(e){return f(Sn.DETECT,{path:e})},fa=function(e,t,n){return f(Sn.DETECTED,{path:e,params:t,info:n})},xa=function(e){return f(Sn.DETECT_FAILED,{path:e})},ma=Object(s.b)(null,(function(e,t){return{handleRemoveDataset:function(){e(ha(t.dataset.id))}}}))((function(e){var t=e.handleRemoveDataset;return Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(J.a,{icon:"remove",labelPosition:"left",onClick:t,content:"Close Dataset"})})})),ya=Object(s.b)((function(e,t){return{analyses:Qn(e.compoundAnalyses,(function(e){return e.dataset===t.dataset.id}))}}))((function(e){var t,n=e.dataset,a=e.analyses,r=(t={},Object(k.a)(t,N.OPENING,"Opening dataset ".concat(n.params.name)),Object(k.a)(t,N.DELETING,"Closing dataset ".concat(n.params.name)),t);return n.status===N.OPENING||n.status===N.DELETING?Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(be.a,{as:"h2",dividing:!0,children:n.params.name}),Object(z.jsxs)(K.a,{icon:!0,children:[Object(z.jsx)(Y.a,{name:"cog",loading:!0}),Object(z.jsx)(K.a.Content,{children:Object(z.jsx)(K.a.Header,{children:r[n.status]})})]})]}):Object(z.jsxs)(O.a.Group,{style:{marginTop:"3em",marginBottom:"3em"},children:[Object(z.jsxs)(O.a.Group,{horizontal:!0,children:[Object(z.jsx)(O.a,{children:Object(z.jsxs)(be.a,{as:"h2",children:[Object(z.jsx)(Y.a,{name:"database"}),Object(z.jsxs)(B.a,{trigger:Object(z.jsxs)(be.a.Content,{children:[n.params.name," ",Object(z.jsx)(Y.a,{name:"info circle",size:"small",link:!0})]}),children:[Object(z.jsxs)(We.a.Header,{children:[n.params.type," Dataset ",n.params.name]}),Object(z.jsx)(We.a.Content,{children:Object(z.jsx)(ia,{dataset:n})})]})]})}),Object(z.jsx)(O.a,{style:{flexShrink:1,flexGrow:0},children:Object(z.jsx)(ma,{dataset:n})})]}),a.ids.length>0?Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(O.a,{children:Object(z.jsx)(Yn,{analyses:a})})}):null,Object(z.jsx)(O.a,{textAlign:"center",children:Object(z.jsx)(ea,{dataset:n})})]})})),ga=n(182),va=n(215),_a=n.n(va),Ea=function(e){var t={};return e.forEach((function(e){var n=e.instancePath.split("/"),a=/^\.([^[]+)(\[[^]+\])?$/,r=n.map((function(e){return e.replace(a,(function(e,t){return t}))})).filter((function(e){return e.length>0&&!/^[0-9]$/.test(e)}))[0];t[r]=e.message})),t},Sa=function(e,t,n){var a=(new _a.a).compile(e);return!a(t)||n?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e||t){return e?Object(V.a)(Object(V.a)({},Ea(e)),t):t}throw new Error("unspecified error while validating fields")}(a.errors,n):{}},Aa=function(e){return e.split(",").filter((function(e){return""!==e.trim()})).map((function(e){return parseInt(e,10)}))},Ca=function(e,t){var n=function(e){return"nav"===e?{minLength:M.NAV_SHAPE_MIN_LENGTH,maxLength:M.NAV_SHAPE_MAX_LENGTH}:{minLength:M.SIG_SHAPE_MIN_LENGTH,maxLength:M.SIG_SHAPE_MAX_LENGTH}}(t),a=n.minLength,r=n.maxLength,s=new Array(a).fill("");if(e){var c=e.split(",");c.length===a?s=Object(rt.a)(c):c.length<a?s=[].concat(Object(rt.a)(c),Object(rt.a)(Array(a-c.length).fill("1"))):c.length<=r?s=Object(rt.a)(c):(s=new Array(r).fill(""),s=[].concat(Object(rt.a)(c.slice(0,r-1)),[Ia(c.slice(r-1)).toString()]))}return s.toString()},Ta=function(e){return Aa(e).reduce((function(e,t){return e*t}),1)},Ia=function(e){return function(e){return e.filter((function(e){return""!==e.trim()})).map((function(e){return parseInt(e,10)}))}(e).reduce((function(e,t){return e*t}),1)},Ra=function(e,t,n,a){var r={};return e&&!function(e,t){return Ta(e)===Ta(t)}(t,e.toString())&&(r.sig_shape="must be of size: ".concat(Ta(e.toString()))),a&&!function(e,t){return-t<e&&e<t}(n,a)&&(r.sync_offset="must be in (-".concat(a,", ").concat(a,")")),r},Da=function(e,t,n){return n&&void 0!==n[e]?n[e]:t},wa=function(e,t,n){return n&&void 0!==n[e]?n[e]:ga.basename(t)},ka=function(e){return!!Object.keys(F).some((function(t){return t===e}))},Fa=function(e){return Object(W.c)({mapPropsToValues:e.mapPropsToValues,handleSubmit:function(t,n){var a=n.props,r=a.onSubmit,s=a.path;r(e.formToJson(t,s)),n.setSubmitting(!1)},validate:function(t,n){var a;return Sa(n.datasetTypeInfo.schema,e.formToJson(t,n.path),null===(a=e.customValidation)||void 0===a?void 0:a.call(e,t,n))},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0})},Na=function(e){var t=e.value,n=e.setFieldValue,a=e.datasetTypeInfo,r=a.supported_io_backends.map((function(e){return{text:H[e].label,value:e}})),s=a.default_io_backend,c=s||"";return Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(p.a,{selection:!0,options:r,value:t||c,onChange:function(e,t){var a=t.value;n("io_backend",a)}})})},La=function(e){var t=e.name,n=e.id,a=e.tupleKey,r=e.tupleInputChangeHandle,s=e.value,c=e.commaPressHandle,i=e.tupleRef,o=e.onBlur;return Object(z.jsx)("input",{type:"number",name:t,id:n,onChange:function(e){r(a,e.target.value)},value:s||"",onKeyDown:function(e){188===e.keyCode&&c(a)},ref:i,onBlur:function(e){o(a,e.target.value)}},a)},Ma=function(e){var t=e.value,n=e.minLen,a=e.maxLen,r=e.fieldName,s=e.setFieldValue,c=e.setFieldTouched,i=t.split(","),o=u.useRef([]),d=function(e,t){var n=Object(rt.a)(i);n[e]=t,s(r,n.toString())},l=function(){c(r,!0)},j=function(e){e===i.length-1?b():o.current[e+1].focus()},b=function(){if(i.length<a){var e=Object(rt.a)(i);e.push(""),s(r,e.toString())}},h=u.useRef(!0);return u.useEffect((function(){!h.current&&o.current.length-1?o.current[i.length-1].focus():h.current=!1}),[i.length]),Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)(G.a.Group,{children:[i.map((function(e,t){return Object(z.jsx)(G.a.Field,{width:2,children:Object(z.jsx)(La,{tupleKey:t,name:"".concat(r,"_").concat(t),id:"id_".concat(r,"_").concat(t),value:parseInt(e,10),tupleRef:function(e){o.current[t]=e},tupleInputChangeHandle:d,onBlur:l,commaPressHandle:j})},t)})),Object(z.jsxs)(G.a.Field,{hidden:n===a,children:[Object(z.jsx)(J.a,{onClick:b,disabled:i.length===a,type:"button",icon:"add",title:"Add dimension",basic:!1}),Object(z.jsx)(J.a,{onClick:function(){if(i.length>n){var e=Object(rt.a)(i);e.pop(),s(r,e.toString())}},disabled:i.length===n,type:"button",icon:"minus",title:"Remove dimension",basic:!1})]})]})})},Pa=function(e){var t=e.navShape,n=e.sigShape,a=e.syncOffset,r=e.imageCount,s=void 0===r?0:r,c=e.hideInfo,i=void 0!==c&&c,o=e.setFieldValue,d=e.setFieldTouched,l=Ta(t),j=u.useState(a.toString()),b=Object(Ge.a)(j,2),h=b[0],p=b[1],O=function(e,t,n){return{framesSkippedStart:Math.max(0,e),framesIgnoredEnd:Math.max(0,n-t-e),framesInsertedStart:Math.abs(Math.min(0,e)),framesInsertedEnd:Math.max(0,t-n+e)}}(parseInt(h,10),l,s),f=O.framesSkippedStart,x=O.framesIgnoredEnd,m=O.framesInsertedStart,y=O.framesInsertedEnd;return Object(z.jsxs)("div",{style:{paddingBottom:5},children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_nav_shape_0",children:"Navigation shape (H, W):"}),Object(z.jsx)("div",{style:{color:"red"},children:Object(z.jsx)(W.a,{name:"nav_shape"})}),Object(z.jsx)(Ma,{value:t,minLen:M.NAV_SHAPE_MIN_LENGTH,maxLen:M.NAV_SHAPE_MAX_LENGTH,fieldName:"nav_shape",setFieldValue:o,setFieldTouched:d}),Object(z.jsx)("label",{htmlFor:"id_sig_shape_0",children:"Signal shape (H, W):"}),Object(z.jsx)("div",{style:{color:"red"},children:Object(z.jsx)(W.a,{name:"sig_shape"})}),Object(z.jsx)(Ma,{value:n,minLen:M.SIG_SHAPE_MIN_LENGTH,maxLen:M.SIG_SHAPE_MAX_LENGTH,fieldName:"sig_shape",setFieldValue:o,setFieldTouched:d})]}),Object(z.jsxs)(G.a.Field,{width:4,children:[Object(z.jsx)("label",{htmlFor:"id_sync_offset",children:"Sync Offset (frames):"}),Object(z.jsx)("div",{style:{color:"red"},children:Object(z.jsx)(W.a,{name:"sync_offset"})}),Object(z.jsx)(we.a,{type:"number",required:!0,name:"sync_offset",id:"id_sync_offset",value:h,onChange:function(e){var t=e.target.value;p(t),o("sync_offset",parseInt(t,10))}})]}),Object(z.jsxs)(G.a.Field,{hidden:i,children:[Object(z.jsxs)("label",{children:["Number of frames skipped at the beginning: ",f]}),Object(z.jsxs)("label",{children:["Number of blank frames inserted at the beginning: ",m]}),Object(z.jsxs)("label",{children:["Number of frames ignored at the end: ",x]}),Object(z.jsxs)("label",{children:["Number of blank frames inserted at the end: ",y]})]})]})},Ha=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},formToJson:function(e,t){return{path:t,type:F.BLO,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.BLO})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.isValidating,i=e.onCancel,o=e.setFieldValue,u=e.setFieldTouched,d=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:d,setFieldValue:o})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:o,setFieldTouched:u}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a||c,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:i,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Ua=D(F).map((function(e){return{text:F[e],value:F[e]}})),Va=function(e){var t=e.currentType,n=e.onClick;return Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(p.a,{inline:!0,options:Ua,value:t,onChange:n})})},Wa=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},formToJson:function(e,t){return{path:t,type:F.EMPAD,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.EMPAD})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.onCancel,i=e.setFieldValue,o=e.setFieldTouched,u=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:u,setFieldValue:i})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i,setFieldTouched:o}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:c,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Ga=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},formToJson:function(e,t){return{path:t,type:F.FRMS6,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.FRMS6})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.onCancel,i=e.setFieldValue,o=e.setFieldTouched,u=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:u,setFieldValue:i})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i,setFieldTouched:o}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:c,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Ba=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),ds_path:Da("ds_path","",n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:F.HDF5,name:e.name,ds_path:e.ds_path,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset}},type:F.HDF5})((function(e){var t,n,a,r=e.values,s=e.info,c=e.isSubmitting,i=e.handleSubmit,o=e.handleReset,u=e.onCancel,d=e.setFieldValue,l={};null===s||void 0===s||null===(t=s.datasets)||void 0===t||t.forEach((function(e){return l[e.path]=e}));var j,b=null===s||void 0===s||null===(n=s.datasets)||void 0===n?void 0:n.map((function(e){var t=e.shape.join(","),n=[];return null!==e.chunks&&n.push("chunked"),null!==e.compression&&n.push("compression: ".concat(e.compression)),{text:"".concat(e.path," (shape: (").concat(t,"), ").concat(n.join(", "),")"),key:e.path,value:e.path}})),h=null===s||void 0===s||null===(a=s.datasets)||void 0===a?void 0:a.length;j=0===h||void 0===h?Object(z.jsx)(W.b,{name:"ds_path",id:"id_ds_path"}):Object(z.jsx)(p.a,{name:"ds_path",id:"id_ds_path",placeholder:"Select dataset",fluid:!0,search:!0,selection:!0,defaultValue:r.ds_path,onChange:function(e,t){var n=t.value;n&&d("ds_path",n.toString())},options:b});var O=null,f=l[r.ds_path];return f&&f.compression&&(O=Object(z.jsx)("p",{children:Object(z.jsx)("strong",{style:{color:"red"},children:"Loading compressed HDF5, performance can be worse than with other formats"})})),Object(z.jsxs)(G.a,{onSubmit:i,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_ds_path",children:"HDF5 Dataset Path:"}),Object(z.jsx)(W.a,{name:"ds_path"}),j]}),O,Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:c,children:"Load Dataset"}),Object(z.jsx)(J.a,{onClick:u,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:o,children:"Reset"})]})})),Ya=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},formToJson:function(e,t){return{path:t,type:F.K2IS,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.K2IS})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.onCancel,i=e.setFieldValue,o=e.setFieldTouched,u=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:u,setFieldValue:i})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i,setFieldTouched:o}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:c,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Ja=Fa({formToJson:function(e,t){return{path:t,type:F.MIB,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.MIB})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.isValidating,i=e.onCancel,o=e.setFieldValue,u=e.setFieldTouched,d=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:d,setFieldValue:o})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:o,setFieldTouched:u}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a||c,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:i,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Ka=Fa({formToJson:function(e,t){return{path:t,type:F.MRC,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n)}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.MRC})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.isValidating,i=e.onCancel,o=e.setFieldValue,u=e.setFieldTouched;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:o,setFieldTouched:u}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a||c,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:i,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),za=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),dtype:Da("dtype","float32",n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},formToJson:function(e,t){return{path:t,type:F.RAW,name:e.name,dtype:e.dtype,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},type:F.RAW})((function(e){var t=e.values,n=e.isSubmitting,a=e.handleSubmit,r=e.handleReset,s=e.onCancel,c=e.setFieldValue,i=e.setFieldTouched,o=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:a,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsxs)("label",{htmlFor:"id_dtype",children:["Datatype (uint16, uint32, float32, float64, >u2, ..., can be anything that is ",Object(z.jsx)("a",{href:"https://numpy.org/doc/stable/reference/arrays.dtypes.html",children:"understood by numpy as a dtype"}),"):"]}),Object(z.jsx)(W.a,{name:"dtype"}),Object(z.jsx)(W.b,{name:"dtype",id:"id_dtype"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:o,setFieldValue:c})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,hideInfo:!0,setFieldValue:c,setFieldTouched:i}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:n,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:r,children:"Reset"})]})})),Xa=Fa({formToJson:function(e,t){return{path:t,type:F.SEQ,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.SEQ})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.isValidating,i=e.onCancel,o=e.setFieldValue,u=e.setFieldTouched,d=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:d,setFieldValue:o})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:o,setFieldTouched:u}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a||c,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:i,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),Qa=Fa({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n)}},formToJson:function(e,t){return{path:t,type:F.SER,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.SER})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.onCancel,i=e.setFieldValue,o=e.setFieldTouched;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:i,setFieldTouched:o}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:c,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),qa=Fa({formToJson:function(e,t){return{path:t,type:F.TVIPS,name:e.name,nav_shape:Aa(e.nav_shape),sig_shape:Aa(e.sig_shape),sync_offset:e.sync_offset,io_backend:e.io_backend}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:wa("name",t,n),nav_shape:Ca(Da("nav_shape","",n).toString(),"nav"),sig_shape:Ca(Da("sig_shape","",n).toString(),"sig"),sync_offset:Da("sync_offset",0,n),io_backend:Da("io_backend",void 0,n)}},customValidation:function(e,t){var n=t.info;return Ra(null===n||void 0===n?void 0:n.native_sig_shape,e.sig_shape,e.sync_offset,null===n||void 0===n?void 0:n.image_count)},type:F.TVIPS})((function(e){var t=e.values,n=e.info,a=e.isSubmitting,r=e.handleSubmit,s=e.handleReset,c=e.isValidating,i=e.onCancel,o=e.setFieldValue,u=e.setFieldTouched,d=e.datasetTypeInfo;return Object(z.jsxs)(G.a,{onSubmit:r,children:[Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_name",children:"Name:"}),Object(z.jsx)(W.a,{name:"name"}),Object(z.jsx)(W.b,{name:"name",id:"id_name"})]}),Object(z.jsxs)(G.a.Field,{children:[Object(z.jsx)("label",{htmlFor:"id_io_backend",children:"I/O Backend:"}),Object(z.jsx)(W.a,{name:"io_backend"}),Object(z.jsx)(Na,{value:t.io_backend,datasetTypeInfo:d,setFieldValue:o})]}),Object(z.jsx)(Pa,{navShape:t.nav_shape,sigShape:t.sig_shape,syncOffset:t.sync_offset,imageCount:null===n||void 0===n?void 0:n.image_count,setFieldValue:o,setFieldTouched:u}),Object(z.jsx)(J.a,{primary:!0,type:"submit",disabled:a||c,children:"Load Dataset"}),Object(z.jsx)(J.a,{type:"button",onClick:i,children:"Cancel"}),Object(z.jsx)(J.a,{type:"button",onClick:s,children:"Reset"})]})})),$a=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;return e?a?a.type:F.RAW:n?n.type:a?a.type:F.RAW},Za=function(){var e=Object(s.c)(),t=Object(s.d)((function(e){return e.openDataset})),n=u.useState(!1),a=Object(Ge.a)(n,2),r=a[0],c=a[1],i=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;if(e)return a?Object(V.a)(Object(V.a)({},a),{},{name:n?n.name:""}):void 0;if(n){var r=n;return n.scan_size&&(r=Object(V.a)(Object(V.a)({},r),{},{nav_shape:n.scan_size,scan_size:[]})),n.detector_size&&(r=Object(V.a)(Object(V.a)({},r),{},{sig_shape:n.detector_size,detector_size:[]})),n.nav_shape||(r=Object(V.a)(Object(V.a)({},r),{},{nav_shape:a?a.nav_shape:[]})),n.sig_shape||(r=Object(V.a)(Object(V.a)({},r),{},{sig_shape:a?a.sig_shape:[]})),r}return a}(r,t),o=function(e){var t=e.formDetectedInfo;if(t)return t}(t),d=$a(r,t),l=u.useState(d),j=Object(Ge.a)(l,2),b=j[0],h=j[1],p=function(e,t){return h(t.value)},f=function(e){return Object(z.jsxs)(O.a,{children:["Type: ",Object(z.jsx)(Va,{onClick:p,currentType:b}),Object(z.jsxs)(be.a,{as:"h2",children:["Open: ",t.formPath]}),e]})},x=Object(s.d)((function(e){return e.config.datasetTypes[b]})),m={path:t.formPath,onSubmit:function(t){e(la({id:Object(v.a)(),params:t}))},onCancel:function(){return e(da())},onReset:function(){c(!0),h($a(!0,t))},datasetTypeInfo:x};switch(b){case F.HDF5:var y=i&&b===i.type?i:void 0,g=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ba,Object(V.a)(Object(V.a)({},m),{},{initial:y,info:g})));case F.RAW:var _=i&&b===i.type?i:void 0,E=o&&b===o.type?o:void 0;return f(Object(z.jsx)(za,Object(V.a)(Object(V.a)({},m),{},{initial:_,info:E})));case F.MIB:var S=i&&b===i.type?i:void 0,A=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ja,Object(V.a)(Object(V.a)({},m),{},{initial:S,info:A})));case F.BLO:var C=i&&b===i.type?i:void 0,T=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ha,Object(V.a)(Object(V.a)({},m),{},{initial:C,info:T})));case F.K2IS:var R=i&&b===i.type?i:void 0,D=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ya,Object(V.a)(Object(V.a)({},m),{},{initial:R,info:D})));case F.SER:var w=i&&b===i.type?i:void 0,k=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Qa,Object(V.a)(Object(V.a)({},m),{},{initial:w,info:k})));case F.FRMS6:var N=i&&b===i.type?i:void 0,L=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ga,Object(V.a)(Object(V.a)({},m),{},{initial:N,info:L})));case F.EMPAD:var M=i&&b===i.type?i:void 0,P=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Wa,Object(V.a)(Object(V.a)({},m),{},{initial:M,info:P})));case F.SEQ:var H=i&&b===i.type?i:void 0,U=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Xa,Object(V.a)(Object(V.a)({},m),{},{initial:H,info:U})));case F.MRC:var W=i&&b===i.type?i:void 0,G=o&&b===o.type?o:void 0;return f(Object(z.jsx)(Ka,Object(V.a)(Object(V.a)({},m),{},{initial:W,info:G})));case F.TVIPS:var B=i&&b===i.type?i:void 0,Y=o&&b===o.type?o:void 0;return f(Object(z.jsx)(qa,Object(V.a)(Object(V.a)({},m),{},{initial:B,info:Y})))}return I("unknown dataset type")},er=Object(s.b)((function(e){return{busy:e.openDataset.busy,path:e.openDataset.busyPath}}))((function(e){var t=e.busy,n=e.path;return t?Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(be.a,{as:"h2",dividing:!0,children:"Loading..."}),Object(z.jsxs)(K.a,{icon:!0,children:[Object(z.jsx)(Y.a,{name:"cog",loading:!0}),Object(z.jsx)(K.a.Content,{children:Object(z.jsxs)(K.a.Header,{children:["Detecting parameters for ",n]})})]})]}):null})),tr=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props,t=e.formVisible,n=e.datasets;return Object(z.jsxs)(z.Fragment,{children:[n.ids.map((function(e){return Object(z.jsx)(ya,{dataset:n.byId[e]},e)})),Object(z.jsx)(er,{}),t&&Object(z.jsx)(Za,{}),Object(z.jsx)(Ve,{})]})}}]),n}(u.Component),nr=Object(s.b)((function(e){return{datasets:e.datasets,formVisible:e.openDataset.formVisible,formPath:e.openDataset.formPath}}))(tr),ar=Object(s.b)(null,(function(e,t){return{dismiss:function(){return e(S(t.error.id))}}}))((function(e){var t=e.dismiss,n=e.error;return Object(z.jsx)(K.a,{negative:!0,onDismiss:t,children:n.msg})})),rr=Object(s.b)((function(e){return{errors:e.errors,channelConnected:"connected"===e.channelStatus.status||"ready"===e.channelStatus.status}}))((function(e){var t,n=e.errors,a=e.channelConnected,r=n.ids.slice(Math.max(0,n.ids.length-3)),c=n.ids.length>0&&a,i=Object(s.c)();return t=function(){i(A())},d.a.useEffect((function(){var e=function(e){"Escape"!==e.code&&27!==e.keyCode||t()};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}})),Object(z.jsx)(B.a,{open:c,children:r.map((function(e){return Object(z.jsx)(ar,{error:n.byId[e]},e)}))})})),sr=n.p+"static/media/LiberTEM logo-medium.2765b438.png",cr=Object(s.b)((function(e){return{version:e.config.version,revision:e.config.revision}}))((function(e){var t=e.version,n=e.revision;return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(be.a,{as:"h3",children:["This is LiberTEM version ",t," (revision ",n.slice(0,8),")"]}),Object(z.jsxs)(Be.a,{children:[Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"github"}),Object(z.jsxs)(Be.a.Content,{children:["Find us on ",Object(z.jsx)("a",{href:"https://github.com/LiberTEM/LiberTEM",children:"GitHub"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"bug"}),Object(z.jsxs)(Be.a.Content,{children:["Found a bug? Got a feature request? Please ",Object(z.jsx)("a",{href:"https://github.com/LiberTEM/LiberTEM/issues/new",children:"open an issue!"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"legal"}),Object(z.jsxs)(Be.a.Content,{children:["LiberTEM is licensed under the ",Object(z.jsx)("a",{href:"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE",children:"GNU General Public License v3.0"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"book"}),Object(z.jsxs)(Be.a.Content,{children:["Read ",Object(z.jsx)("a",{href:"https://libertem.github.io/LiberTEM/",children:"the documentation"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"user"}),Object(z.jsxs)(Be.a.Content,{children:["Read ",Object(z.jsx)("a",{href:"https://libertem.github.io/LiberTEM/acknowledgments.html",children:"the acknowledgments"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"gitter"}),Object(z.jsxs)(Be.a.Content,{children:["Join our ",Object(z.jsx)("a",{href:"https://gitter.im/LiberTEM/Lobby",children:"chat on gitter!"})]})]}),Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsx)(Be.a.Icon,{name:"linkify"}),Object(z.jsx)(Be.a.Content,{children:Object(z.jsx)("a",{href:"https://doi.org/10.5281/zenodo.1477847",children:Object(z.jsx)("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.1477847.svg",alt:"doi.org/10.5281/zenodo.1477847"})})})]})]})]})})),ir=function(){var e=Object(ze.a)(Ke.a.mark((function e(){var t,n,a;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Xe(),n="".concat(t,"config/cluster/"),e.next=4,fetch(n,{method:"GET",credentials:"same-origin"});case 4:return a=e.sent,e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),or=function(e){var t,n=e.localCore,a=e.cudas,r=Object(u.useState)([{host:"",cpu:0,cuda:0,service:0}]),c=Object(Ge.a)(r,2),i=c[0],o=c[1],d=Object(s.c)();if(Object(u.useEffect)((function(){ir().then((function(e){o(e.details)})).catch((function(){var e=Object(v.a)(),t=Date.now();d(C(e,"Could not copy to clipboard",t))}))}),[]),0===a.length)t="None selected";else{var l=a.map((function(e){return" ".concat(e)})).join(",");t="GPU ".concat(l)}return Object(z.jsx)(B.a.Content,{children:Object(z.jsxs)(Be.a,{children:[Object(z.jsx)(Be.a.Item,{children:Object(z.jsx)(Be.a.Content,{as:"h4",children:"Connected to local cluster"})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsxs)(Be.a.Content,{children:["Number of local core : ",n]})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsxs)(Be.a.Content,{children:["Number of CPU workers : ",i[0].cpu," "]})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsxs)(Be.a.Content,{children:["Number of CUDA workers : ",i[0].cuda]})}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsxs)(Be.a.Content,{children:["Selected CUDA devices : ",t]})})]})})},ur=function(){return Object(z.jsx)(B.a.Content,{children:Object(z.jsx)(Be.a,{children:Object(z.jsx)(Be.a.Item,{children:Object(z.jsx)(Be.a.Content,{children:"Not Connected"})})})})},dr=function(e){var t=Object(u.useState)({host:0,cpu:0,cuda:0}),n=Object(Ge.a)(t,2),a=n[0],r=n[1],s=Object(u.useState)(!1),c=Object(Ge.a)(s,2),i=c[0],o=c[1],d=Object(u.useState)("More Info"),l=Object(Ge.a)(d,2),j=l[0],b=l[1];Object(u.useEffect)((function(){var t={host:0,cpu:0,cuda:0};e.forEach((function(e){t.host+=1,t.cpu+=e.cpu,t.cuda+=e.cuda})),r(t)}),[e]);var h=e.map((function(e){return Object(z.jsx)(O.a,{children:Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsxs)(Be.a.Content,{children:["Host : ",e.host]}),Object(z.jsxs)(Be.a.Content,{children:["Number of CPU workers : ",e.cpu]}),Object(z.jsxs)(Be.a.Content,{children:["Number of CUDA workers : ",e.cuda]})]})},e.host)}));return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(O.a,{children:Object(z.jsxs)(Be.a.Item,{children:[Object(z.jsxs)(Be.a.Content,{children:["Number of hosts : ",a.host]}),Object(z.jsxs)(Be.a.Content,{children:["Number of CPU workers : ",a.cpu]}),Object(z.jsxs)(Be.a.Content,{children:["Number of CUDA workers : ",a.cuda]})]})}),Object(z.jsxs)(Rn.a,{children:[Object(z.jsxs)(Rn.a.Title,{active:i,onClick:function(){o(!i),b("More Info"===j?"Less Info":"More Info")},children:[Object(z.jsx)(Y.a,{name:"dropdown"}),j]}),Object(z.jsx)(Rn.a.Content,{active:i,children:Object(z.jsx)(O.a.Group,{children:h})})]})]})},lr=function(e){var t=e.address,n=Object(s.c)(),a=["import libertem.api as lt","import distributed as dd","from libertem.executor.dask import DaskJobExecutor\n",'client = dd.Client("URI")',"executor = DaskJobExecutor(client)\n","ctx = lt.Context(executor=executor)"].join("\n").replace("URI",t),r=Object(u.useState)([]),c=Object(Ge.a)(r,2),i=c[0],o=c[1];return Object(u.useEffect)((function(){ir().then((function(e){o(e.details)})).catch((function(e){var t=Object(v.a)(),a=Date.now();n(C(t,"Could not fetch cluster details: ".concat(e.toString()),a))}))}),[]),Object(z.jsx)(B.a.Content,{children:Object(z.jsxs)(Be.a,{children:[Object(z.jsxs)(be.a,{as:"h4",attached:"top",children:["Connected to ",t]}),Object(z.jsx)(O.a.Group,{children:dr(i)}),Object(z.jsx)(Be.a.Item,{children:Object(z.jsx)(Be.a.Content,{children:Object(z.jsxs)(O.a.Group,{children:[Object(z.jsx)(O.a,{as:"h5",children:"Connection code"}),Object(z.jsxs)(O.a,{children:[Object(z.jsx)(J.a,{floated:"right",icon:"copy",onClick:function(){return w(a,n)}}),Object(z.jsx)("pre",{children:Object(z.jsx)("code",{children:a})})]})]})})})]})})},jr=Object(s.b)((function(e){return{clusterConnection:e.clusterConnection,channelStatus:e.channelStatus.status,type:e.config.lastConnection.type,localcore:e.config.localCores,cudas:e.config.lastConnection.cudas,address:e.config.lastConnection.address}}))((function(e){var t,n=e.clusterConnection,a=e.channelStatus,r=e.type,s=e.localcore,c=e.cudas,i=e.address;!function(e){e.blue="blue",e.grey="grey"}(t||(t={}));var o=Object(u.useState)(t.grey),d=Object(Ge.a)(o,2),l=d[0],j=d[1],b=Object(u.useState)(n.status),h=Object(Ge.a)(b,2),p=h[0],O=h[1],f=Object(u.useState)(!0),x=Object(Ge.a)(f,2),m=x[0],y=x[1];Object(u.useEffect)((function(){"connected"===a||"ready"===a?(O(n.status),y(!1),"connected"===n.status?j(t.blue):j(t.grey)):(y(!0),O("unknown"),j(t.grey))}),[n,a,t]);return Object(z.jsxs)(B.a,{trigger:Object(z.jsx)(J.a,{color:l,content:"Cluster info",icon:"plug",labelPosition:"left",disabled:m,label:{as:"a",basic:!0,content:p}}),size:"small",children:[Object(z.jsx)(We.a.Header,{children:"Connection Info"}),Object(z.jsx)(We.a.Content,{children:"connected"===n.status?"LOCAL"===r?Object(z.jsx)(or,{cudas:c,localCore:s}):Object(z.jsx)(lr,{address:i}):Object(z.jsx)(ur,{})})]})}));!function(e){e.INITIAL_STATE="CHANNEL_INITIAL_STATE",e.JOB_STARTED="CHANNEL_JOB_STARTED",e.FINISH_JOB="CHANNEL_FINISH_JOB",e.TASK_RESULT="CHANNEL_TASK_RESULT",e.JOB_ERROR="CHANNEL_JOB_ERROR",e.OPEN="CHANNEL_OPEN",e.CLOSE="CHANNEL_CLOSE",e.ERROR="CHANNEL_ERROR",e.CANCELLED="CANCELLED",e.CANCEL_JOB_FAILED="CANCEL_JOB_FAILED",e.SHUTDOWN="CHANNEL_SHUTDOWN",e.CLOSE_LOOP="CHANNEL_LOOP_CLOSE",e.ANALYSIS_CREATED="ANALYSIS_CREATED",e.ANALYSIS_UPDATED="ANALYSIS_UPDATED",e.ANALYSIS_REMOVED="ANALYSIS_REMOVED"}(oa||(oa={}));var br={initialState:function(e,t,n,a,r){return f(oa.INITIAL_STATE,{jobs:e,datasets:t,timestamp:r,compoundAnalyses:n,analyses:a})},jobStarted:function(e,t){return f(oa.JOB_STARTED,{job:e,timestamp:t})},finishJob:function(e,t,n){return f(oa.FINISH_JOB,{job:e,results:t,timestamp:n})},taskResult:function(e,t,n){return f(oa.TASK_RESULT,{job:e,results:t,timestamp:n})},jobError:function(e,t,n,a){return f(oa.JOB_ERROR,{job:e,msg:t,id:n,timestamp:a})},open:function(e){return f(oa.OPEN,{timestamp:e})},close:function(e){return f(oa.CLOSE,{timestamp:e})},error:function(e,t,n){return f(oa.ERROR,{msg:e,timestamp:t,id:n})},shutdown:function(e){return f(oa.SHUTDOWN,{timestamp:e})},closeloop:function(e){return f(oa.CLOSE_LOOP,{timestamp:e})},cancelled:function(e){return f(oa.CANCELLED,{job:e})},cancelFailed:function(e){return f(oa.CANCEL_JOB_FAILED,{job:e})},analysisCreated:function(e,t,n){return f(oa.ANALYSIS_CREATED,{dataset:t,analysis:e,details:n})},analysisUpdated:function(e,t,n){return f(oa.ANALYSIS_UPDATED,{dataset:t,analysis:e,details:n})},analysisRemoved:function(e){return f(oa.ANALYSIS_REMOVED,{analysis:e})}},hr=function(){var e=Object(ze.a)(Ke.a.mark((function e(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe("shutdown/");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pr={closeLoopAction:br.closeloop,shutdownAction:br.shutdown},Or=function(e){Object(b.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={modal:!1,shutdown:!1},e.modalOpen=function(){e.setState({modal:!0})},e.modalClose=function(){e.setState({modal:!1})},e.handleShutdown=function(){e.setState({shutdown:!0}),hr().then((function(){var t=Date.now();e.props.closeLoopAction(t)}))},e}return Object(j.a)(n,[{key:"componentDidUpdate",value:function(){if("waiting"===this.props.channel&&this.state.shutdown){var e=Date.now();this.modalClose(),this.props.shutdownAction(e)}}},{key:"render",value:function(){return Object(z.jsxs)(B.a,{trigger:Object(z.jsx)(J.a,{content:"Shutdown",icon:"shutdown",onClick:this.modalOpen,disabled:this.state.shutdown,labelPosition:"left",floated:"right"}),open:this.state.modal,closeOnDimmerClick:!1,onClose:this.modalClose,size:"mini",children:[Object(z.jsx)(be.a,{icon:"shutdown",content:"Confirm shutdown"}),Object(z.jsx)(B.a.Content,{children:Object(z.jsx)("p",{children:"Do you want to shutdown ?"})}),Object(z.jsxs)(B.a.Actions,{children:[Object(z.jsxs)(J.a,{onClick:this.modalClose,disabled:this.state.shutdown,children:[Object(z.jsx)(Y.a,{name:"remove"})," Cancel"]}),Object(z.jsxs)(J.a,{primary:!0,loading:this.state.shutdown,disabled:this.state.shutdown,onClick:this.handleShutdown,children:[Object(z.jsx)(Y.a,{name:"checkmark"})," Shutdown"]})]})]})}}]),n}(u.Component),fr=Object(s.b)((function(e){return{channel:e.channelStatus.status}}),pr)(Or),xr=function(){return Object(z.jsxs)(ve.a,{fixed:"top",children:[Object(z.jsx)(ve.a.Item,{children:Object(z.jsxs)(B.a,{trigger:Object(z.jsx)(J.a,{content:"About"}),children:[Object(z.jsx)(We.a.Header,{children:"About LiberTEM"}),Object(z.jsx)(We.a.Content,{children:Object(z.jsx)(cr,{})})]})}),Object(z.jsxs)(ve.a.Menu,{position:"right",children:[Object(z.jsx)(ve.a.Item,{children:Object(z.jsx)(jr,{})}),Object(z.jsx)(ve.a.Item,{children:Object(z.jsx)(fr,{})})]})]})},mr=function(){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(xr,{}),Object(z.jsxs)(o.a,{style:{margin:"5em 1em 5em 1em"},children:[Object(z.jsx)("div",{style:{display:"flex"},children:Object(z.jsx)("img",{src:sr,width:"200",height:"46",alt:"LiberTEM",style:{marginBottom:"20px"}})}),Object(z.jsx)(rr,{}),Object(z.jsx)(ue,{children:Object(z.jsx)(nr,{})})]})]})},yr=n(5),gr="LiberTEM.config",vr=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=function(t){return t.replace(new RegExp("".concat(g.a.escapeRegExp(e.separator),"$")),"")};return(n=[r(n[0])].concat(Object(rt.a)(n.slice(1)))).map((function(e){return e.trim()})).join(e.separator)},_r=function(e){var t=window.localStorage.getItem(gr);if(null===t)return Object.assign({},Sr(),e);var n=JSON.parse(t),a=Sr();return Object.assign({},a,e,n)},Er=function(e){var t={cwd:e.cwd,lastOpened:e.lastOpened,fileHistory:e.fileHistory,lastConnection:e.lastConnection,starred:e.starred};window.localStorage.setItem(gr,JSON.stringify(t))},Sr=function(){return{lastOpened:{},fileHistory:[],cwd:"/",lastConnection:{type:E.LOCAL,address:"tcp://localhost:8786",cudas:[]},starred:[]}},Ar=function(e){return e.reduce((function(e,t){return-1===e.indexOf(t)?[].concat(Object(rt.a)(e),[t]):e}),[])},Cr=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){var n,a,r;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xe(),a="".concat(n,"browse/localfs/?path=").concat(encodeURIComponent(t)),e.next=4,fetch(a,{method:"GET",credentials:"same-origin"});case 4:return r=e.sent,e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Tr=Ke.a.mark(wr),Ir=Ke.a.mark(kr),Rr=Ke.a.mark(Fr),Dr=Ke.a.mark(Nr);function wr(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.f)(kr);case 2:return e.next=4,Object(yr.f)(Nr);case 4:case"end":return e.stop()}}),Tr)}function kr(){var e,t,n,a,r,s;return Ke.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=3,Object(yr.i)(U.LIST_DIRECTORY);case 3:return e=c.sent,t=e.payload,n=t.name,a=t.path,c.next=7,Object(yr.h)((function(e){return e.config}));case 7:return r=c.sent,s=void 0!==n?vr(r,a,n):a,c.next=11,Object(yr.f)(Fr,s);case 11:c.next=0;break;case 13:case"end":return c.stop()}}),Ir)}function Fr(e){var t,n,a,r,s,c,i,o;return Ke.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,Object(yr.c)(Cr,e);case 3:if("ok"!==(t=u.sent).status){u.next=9;break}return u.next=7,Object(yr.g)(le.dirListing(t.path,t.dirs,t.files,t.drives,t.places));case 7:u.next=24;break;case 9:if("error"!==t.status){u.next=24;break}return u.next=12,Object(yr.h)((function(e){return e.browser}));case 12:return n=u.sent,a=Date.now(),r=Object(v.a)(),s=t.alternative?t.alternative:n.places.home.path,u.next=18,Object(yr.h)((function(e){return e.config}));case 18:if(u.sent.cwd===e){u.next=22;break}return u.next=22,Object(yr.g)(le.error("Error browsing directory: ".concat(t.msg),a,r));case 22:return u.next=24,Object(yr.g)(le.list(s));case 24:u.next=37;break;case 26:return u.prev=26,u.t0=u.catch(0),u.next=30,Object(yr.h)((function(e){return e.browser}));case 30:return c=u.sent,i=Date.now(),o=Object(v.a)(),u.next=35,Object(yr.g)(le.error("Error browsing directory: ".concat(u.t0.toString()),i,o));case 35:return u.next=37,Object(yr.g)(le.list(c.places.home.path));case 37:case"end":return u.stop()}}),Rr,null,[[0,26]])}function Nr(){var e;return Ke.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.i)(U.OPEN);case 3:return t.next=5,Object(yr.h)((function(e){return e.config}));case 5:return e=t.sent,t.next=8,Object(yr.g)(le.list(e.cwd));case 8:t.next=0;break;case 10:case"end":return t.stop()}}),Dr)}var Lr,Mr=function(e,t){return Object.assign({messageType:e},t)};!function(e){e.INITIAL_STATE="INITIAL_STATE",e.JOB_STARTED="JOB_STARTED",e.FINISH_JOB="FINISH_JOB",e.TASK_RESULT="TASK_RESULT",e.JOB_ERROR="JOB_ERROR",e.BINARY="BINARY",e.OPEN="OPEN",e.CLOSE="CLOSE",e.ERROR="ERROR",e.DELETE_DATASET="DELETE_DATASET",e.CREATE_DATASET="CREATE_DATASET",e.CANCEL_JOB_DONE="CANCEL_JOB_DONE",e.CANCEL_JOB_FAILED="CANCEL_JOB_FAILED",e.ANALYSIS_CREATED="ANALYSIS_CREATED",e.ANALYSIS_UPDATED="ANALYSIS_UPDATED",e.ANALYSIS_REMOVED="ANALYSIS_REMOVED",e.COMPOUND_ANALYSIS_CREATED="COMPOUND_ANALYSIS_CREATED",e.COMPOUND_ANALYSIS_UPDATED="COMPOUND_ANALYSIS_UPDATED",e.COMPOUND_ANALYSIS_REMOVED="COMPOUND_ANALYSIS_REMOVED"}(Lr||(Lr={}));var Pr=function(e){return Mr(Lr.BINARY,{objectURL:e})},Hr=function(){return Mr(Lr.OPEN,{})},Ur=function(){return Mr(Lr.CLOSE,{})},Vr=function(e){return Mr(Lr.ERROR,{msg:e})},Wr=Ke.a.mark(zr),Gr=Ke.a.mark(Xr),Br=Ke.a.mark(Qr),Yr=Ke.a.mark(qr),Jr=Ke.a.mark($r),Kr=function(){return Object(i.d)((function(e){var t=function(t){if(t.data instanceof Blob)e(Pr(URL.createObjectURL(t.data)));else{var n=JSON.parse(t.data);e(n)}},n=function(){e(Hr())},a=function(){e(Ur()),e(i.a)},r=function(){e(Vr("Error in weboscket connection"))},s=new WebSocket(function(){var e=Xe(),t="https:"===window.location.protocol;return"".concat(t?"wss":"ws","://").concat(window.location.hostname,":").concat(window.location.port).concat(e,"events/")}());return s.addEventListener("message",t),s.addEventListener("open",n),s.addEventListener("close",a),s.addEventListener("error",r),function(){s.removeEventListener("message",t),s.removeEventListener("open",n),s.removeEventListener("close",a),s.removeEventListener("error",r)}}))};function zr(){var e;return Ke.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.c)(Kr);case 3:return e=t.sent,t.next=6,Object(yr.f)(Xr,e);case 6:return t.next=8,Object(yr.i)([oa.OPEN,oa.CLOSE]);case 8:if(t.sent.type!==oa.OPEN){t.next=15;break}return t.next=12,Object(yr.i)([oa.CLOSE,oa.ERROR,oa.CLOSE_LOOP]);case 12:if(t.sent.type!==oa.CLOSE_LOOP){t.next=15;break}return t.abrupt("break",19);case 15:return t.next=17,Object(yr.e)(1e3);case 17:t.next=0;break;case 19:case"end":return t.stop()}}),Wr)}function Xr(e){var t,n,a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:s.prev=0;case 1:return s.next=4,Object(yr.i)(e);case 4:t=s.sent,n=Date.now(),s.t0=t.messageType,s.next=s.t0===Lr.OPEN?9:s.t0===Lr.CLOSE?12:s.t0===Lr.ERROR?15:s.t0===Lr.INITIAL_STATE?19:s.t0===Lr.JOB_STARTED?22:s.t0===Lr.FINISH_JOB?25:s.t0===Lr.TASK_RESULT?28:s.t0===Lr.CREATE_DATASET?31:s.t0===Lr.DELETE_DATASET?34:s.t0===Lr.JOB_ERROR?37:s.t0===Lr.CANCEL_JOB_DONE?41:s.t0===Lr.CANCEL_JOB_FAILED?44:46;break;case 9:return s.next=11,Object(yr.g)(br.open(n));case 11:return s.abrupt("break",46);case 12:return s.next=14,Object(yr.g)(br.close(n));case 14:return s.abrupt("break",46);case 15:return a=Object(v.a)(),s.next=18,Object(yr.g)(br.error(t.msg,n,a));case 18:return s.abrupt("break",46);case 19:return s.next=21,Object(yr.g)(br.initialState(t.jobs,t.datasets,t.compoundAnalyses,t.analyses,n));case 21:return s.abrupt("break",46);case 22:return s.next=24,Object(yr.g)(br.jobStarted(t.job,n));case 24:return s.abrupt("break",46);case 25:return s.next=27,Object(yr.c)($r,t,e,n);case 27:return s.abrupt("break",46);case 28:return s.next=30,Object(yr.c)(qr,t,e,n);case 30:return s.abrupt("break",46);case 31:return s.next=33,Object(yr.g)(ja(t.details));case 33:return s.abrupt("break",46);case 34:return s.next=36,Object(yr.g)(pa(t.dataset));case 36:return s.abrupt("break",46);case 37:return r=Object(v.a)(),s.next=40,Object(yr.g)(br.jobError(t.job,t.msg,r,n));case 40:return s.abrupt("break",46);case 41:return s.next=43,Object(yr.g)(br.cancelled(t.job));case 43:return s.abrupt("break",46);case 44:return s.next=46,Object(yr.g)(br.cancelFailed(t.job));case 46:s.next=1;break;case 48:return s.prev=48,s.finish(48);case 50:case"end":return s.stop()}}),Gr,null,[[0,,48,50]])}function Qr(e,t){var n,a;return Ke.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=[];case 1:if(!(n.length<e)){r.next=8;break}return r.next=4,Object(yr.i)(t);case 4:a=r.sent,n.push(a),r.next=1;break;case 8:return r.abrupt("return",n);case 9:case"end":return r.stop()}}),Br)}function qr(e,t,n){var a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(yr.c)(Qr,e.followup.numMessages,t);case 2:return a=s.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),s.next=6,Object(yr.g)(br.taskResult(e.job,r,n));case 6:case"end":return s.stop()}}),Yr)}function $r(e,t,n){var a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(yr.c)(Qr,e.followup.numMessages,t);case 2:return a=s.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),s.next=6,Object(yr.g)(br.finishJob(e.job,r,n));case 6:case"end":return s.stop()}}),Jr)}var Zr=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){var n;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={connection:t},e.next=3,qe("config/connection/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),es=function(){var e=Object(ze.a)(Ke.a.mark((function e(){var t,n;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Xe(),e.next=3,fetch("".concat(t,"config/connection/"),{method:"GET"});case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ts=Ke.a.mark(ss),ns=Ke.a.mark(cs),as=Ke.a.mark(is),rs=Ke.a.mark(os);function ss(e){var t;return Ke.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(yr.g)(m.connecting());case 2:return n.next=4,Object(yr.c)(Zr,e.payload.params);case 4:return t=n.sent,n.next=7,Object(yr.c)(cs,t);case 7:case"end":return n.stop()}}),ts)}function cs(e){var t,n;return Ke.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("ok"!==e.status){a.next=5;break}return a.next=3,Object(yr.g)(m.connected(e.connection.connection));case 3:a.next=16;break;case 5:if("error"!==e.status){a.next=14;break}return a.next=8,Object(yr.g)(m.notConnected());case 8:return t=Date.now(),n=Object(v.a)(),a.next=12,Object(yr.g)(m.error("error connecting to cluster: ".concat(e.msg),t,n));case 12:a.next=16;break;case 14:return a.next=16,Object(yr.g)(m.notConnected());case 16:case"end":return a.stop()}}),ns)}function is(){var e;return Ke.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.i)(oa.OPEN);case 3:return t.next=5,Object(yr.c)(es);case 5:return e=t.sent,t.next=8,Object(yr.c)(cs,e);case 8:t.next=0;break;case 10:case"end":return t.stop()}}),as)}function os(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(a.CONNECT,ss);case 2:return e.next=4,Object(yr.b)([is()]);case 4:case"end":return e.stop()}}),rs)}var us,ds=n(129);!function(e){e.CREATE="ANALYSIS_CREATE",e.CREATED="ANALYSIS_CREATED",e.UPDATED="ANALYSIS_UPDATED",e.REMOVE="ANALYSIS_REMOVE",e.REMOVED="ANALYSIS_REMOVED",e.ERROR="ANALYSIS_ERROR"}(us||(us={}));var ls,js=function(e,t,n){return f(us.CREATED,{analysis:e,compoundAnalysis:t,analysisIndex:n})},bs=function(e,t){return f(us.UPDATED,{id:e,details:t})},hs=function(e){return f(us.REMOVED,{id:e})};!function(e){e.CREATE="JOB_CREATE"}(ls||(ls={}));var ps=function(e,t,n){return f(ls.CREATE,{id:e,analysis:t,timestamp:n})},Os=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n){var a;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={job:{analysis:n}},e.next=3,qe("jobs/".concat(t,"/"),a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),fs=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe("jobs/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xs=Ke.a.mark(ks),ms=Ke.a.mark(Fs),ys=Ke.a.mark(Ns),gs=Ke.a.mark(Ls),vs=Ke.a.mark(Ms),_s=Ke.a.mark(Ps),Es=Ke.a.mark(Hs),Ss=Ke.a.mark(Us),As=Ke.a.mark(Vs),Cs=Ke.a.mark(Ws),Ts=Ke.a.mark(Gs),Is=function(e,t){return e.datasets.byId[t]},Rs=function(e,t){return e.compoundAnalyses.byId[t]},Ds=function(e,t){return e.analyses.byId[t]},ws=function(e,t){return e.jobs.byId[t]};function ks(e,t){return Ke.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(yr.i)(at.REMOVE);case 3:if(n.sent.payload.id!==e.compoundAnalysis){n.next=7;break}return n.next=7,Object(yr.d)(t);case 7:n.next=0;break;case 9:case"end":return n.stop()}}),xs)}function Fs(e){var t,n,a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(yr.h)(Is,e.payload.dataset);case 3:if(s.sent.status===N.OPEN){s.next=6;break}throw new Error("invalid dataset status");case 6:return t={compoundAnalysis:Object(v.a)(),dataset:e.payload.dataset,details:{mainType:e.payload.analysisType,analyses:[]}},s.next=9,Object(yr.c)(jn,t.compoundAnalysis,t.dataset,t.details);case 9:return s.next=11,Object(yr.f)(Us,t.compoundAnalysis);case 11:return n=s.sent,s.next=14,Object(yr.g)(Bt(t,!0));case 14:return s.next=16,Object(yr.f)(ks,t,n);case 16:s.next=24;break;case 18:return s.prev=18,s.t0=s.catch(0),a=Date.now(),r=Object(v.a)(),s.next=24,Object(yr.g)(qt("Error creating analysis: ".concat(s.t0.toString()),a,r));case 24:case"end":return s.stop()}}),ms,null,[[0,18]])}function Ns(e){var t,n,a,r,s;return Ke.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=Object(ds.a)(e.payload.compoundAnalyses),c.prev=1,t.s();case 3:if((n=t.n()).done){c.next=15;break}return a=n.value,c.next=7,Object(yr.h)(Rs,a.compoundAnalysis);case 7:return r=c.sent,c.next=10,Object(yr.f)(Us,r.compoundAnalysis);case 10:return s=c.sent,c.next=13,Object(yr.f)(ks,r,s);case 13:c.next=3;break;case 15:c.next=20;break;case 17:c.prev=17,c.t0=c.catch(1),t.e(c.t0);case 20:return c.prev=20,t.f(),c.finish(20);case 23:case"end":return c.stop()}}),ys,null,[[1,17,20,23]])}function Ls(e,t,n,a){var r,s,c,i,o,u,d,l;return Ke.a.wrap((function(j){for(;;)switch(j.prev=j.next){case 0:if(!t){j.next=33;break}return j.next=3,Object(yr.c)(dn,e.compoundAnalysis,t,e.dataset,a);case 3:return j.next=5,Object(yr.g)(bs(t,a));case 5:return j.next=7,Object(yr.h)(Ds,t);case 7:r=j.sent,s=r.jobs?r.jobs:[],c=Object(ds.a)(s),j.prev=10,c.s();case 12:if((i=c.n()).done){j.next=22;break}return o=i.value,j.next=16,Object(yr.h)(ws,o);case 16:if(!(u=j.sent)||"DONE"===u.running){j.next=20;break}return j.next=20,Object(yr.c)(fs,o);case 20:j.next=12;break;case 22:j.next=27;break;case 24:j.prev=24,j.t0=j.catch(10),c.e(j.t0);case 27:return j.prev=27,c.f(),j.finish(27);case 30:return j.abrupt("return",t);case 33:return d=Object(v.a)(),j.next=36,Object(yr.c)(dn,e.compoundAnalysis,d,e.dataset,a);case 36:return j.next=38,Object(yr.g)(js({id:d,dataset:e.dataset,details:a,jobs:[]},e.compoundAnalysis,n));case 38:return j.next=40,Object(yr.h)(Rs,e.compoundAnalysis);case 40:return l=j.sent,j.next=43,Object(yr.c)(jn,l.compoundAnalysis,l.dataset,l.details);case 43:return j.abrupt("return",d);case 44:case"end":return j.stop()}}),gs,null,[[10,24,27,30]])}function Ms(e,t,n){var a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(yr.h)(Rs,e);case 2:return a=s.sent,r=a.details.analyses[t],s.next=6,Object(yr.c)(Ls,a,r,t,n);case 6:return s.abrupt("return",s.sent);case 7:case"end":return s.stop()}}),vs)}function Ps(e){var t,n,a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.payload,n=t.compoundAnalysis,a=t.analysisIndex,r=t.details,s.next=3,Object(yr.c)(Ms,n.compoundAnalysis,a,r);case 3:case"end":return s.stop()}}),_s)}function Hs(){var e,t;return Ke.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(yr.a)(at.SET_PARAMS,i.b.sliding(2));case 2:e=n.sent;case 3:return n.next=6,Object(yr.i)(e);case 6:return t=n.sent,n.next=9,Object(yr.c)(Ps,t);case 9:n.next=3;break;case 11:case"end":return n.stop()}}),Es)}function Us(e){var t,n,a,r,s,c,o,u,d,l;return Ke.a.wrap((function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,Object(yr.a)(at.RUN,i.b.sliding(2));case 2:t=j.sent;case 3:return j.prev=4,j.next=7,Object(yr.i)(t);case 7:if((n=j.sent).payload.id===e){j.next=10;break}return j.abrupt("continue",3);case 10:return j.next=12,Object(yr.h)(Rs,e);case 12:return a=j.sent,r=n.payload,s=r.analysisIndex,c=r.details,j.next=16,Object(yr.c)(Ms,a.compoundAnalysis,s,c);case 16:return o=j.sent,u=Object(v.a)(),j.next=20,Object(yr.g)(ps(u,o,Date.now()));case 20:return j.next=22,Object(yr.c)(Os,u,o);case 22:return j.next=24,Object(yr.g)(zt(a.compoundAnalysis,u,s));case 24:j.next=32;break;case 26:return j.prev=26,j.t0=j.catch(4),d=Date.now(),l=Object(v.a)(),j.next=32,Object(yr.g)(qt("Error running analysis: ".concat(j.t0.toString()),d,l));case 32:j.next=3;break;case 34:case"end":return j.stop()}}),Ss,null,[[4,26]])}function Vs(e){var t,n,a,r;return Ke.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=Object(ds.a)(e.jobs),s.prev=1,t.s();case 3:if((n=t.n()).done){s.next=13;break}return a=n.value,s.next=7,Object(yr.h)(ws,a);case 7:if(!(r=s.sent)||"DONE"===r.running){s.next=11;break}return s.next=11,Object(yr.c)(fs,a);case 11:s.next=3;break;case 13:s.next=18;break;case 15:s.prev=15,s.t0=s.catch(1),t.e(s.t0);case 18:return s.prev=18,t.f(),s.finish(18);case 21:case"end":return s.stop()}}),As,null,[[1,15,18,21]])}function Ws(e){var t,n,a,r,s;return Ke.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Object(yr.h)(Rs,e.payload.id);case 2:t=c.sent,c.prev=3,n=Object(ds.a)(t.details.analyses),c.prev=5,n.s();case 7:if((a=n.n()).done){c.next=20;break}return r=a.value,c.next=11,Object(yr.h)(Ds,r);case 11:return s=c.sent,c.next=14,Object(yr.c)(Vs,s);case 14:return c.next=16,Object(yr.c)(ln,t.compoundAnalysis,r);case 16:return c.next=18,Object(yr.g)(hs(r));case 18:c.next=7;break;case 20:c.next=25;break;case 22:c.prev=22,c.t0=c.catch(5),n.e(c.t0);case 25:return c.prev=25,n.f(),c.finish(25);case 28:return c.next=30,Object(yr.c)(bn,e.payload.id);case 30:return c.prev=30,c.next=33,Object(yr.g)(Qt(e.payload.id));case 33:return c.finish(30);case 34:case"end":return c.stop()}}),Cs,null,[[3,,30,34],[5,22,25,28]])}function Gs(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(at.CREATE,Fs);case 2:return e.next=4,Object(yr.j)(at.REMOVE,Ws);case 4:return e.next=6,Object(yr.j)(oa.INITIAL_STATE,Ns);case 6:return e.next=8,Object(yr.f)(Hs);case 8:case"end":return e.stop()}}),Ts)}var Bs=function(){var e=Object(ze.a)(Ke.a.mark((function e(){var t,n;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Xe(),e.next=3,fetch("".concat(t,"config/"),{method:"GET",credentials:"same-origin"});case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ys=Ke.a.mark(Qs),Js=Ke.a.mark(qs),Ks=Ke.a.mark($s),zs=Ke.a.mark(Zs),Xs=Ke.a.mark(ec);function Qs(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(oa.OPEN,qs);case 2:case"end":return e.stop()}}),Ys)}function qs(){var e,t,n;return Ke.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(yr.g)(Se());case 2:return a.next=4,Object(yr.c)(Bs);case 4:return e=a.sent,a.prev=5,t=_r(e.config),a.next=9,Object(yr.g)(Ae(t));case 9:a.next=17;break;case 11:a.prev=11,a.t0=a.catch(5);try{window.localStorage.removeItem(gr)}catch(r){}return n=Object.assign({},e.config,Sr()),a.next=17,Object(yr.g)(Ae(n));case 17:case"end":return a.stop()}}),Js,null,[[5,11]])}function $s(){var e;return Ke.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(yr.i)([Sn.CREATE,U.DIRECTORY_LISTING,a.CONNECTED,de.TOGGLE_STAR]);case 3:return t.next=5,Object(yr.h)((function(e){return e.config}));case 5:e=t.sent,Er(e),t.next=0;break;case 9:case"end":return t.stop()}}),Ks)}function Zs(){var e,t;return Ke.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(yr.c)(qs);case 3:n.next=11;break;case 5:return n.prev=5,n.t0=n.catch(0),e=Date.now(),t=Object(v.a)(),n.next=11,Object(yr.g)(Ce("failed to fetch config: ".concat(n.t0.toString()),e,t));case 11:case"end":return n.stop()}}),zs,null,[[0,5]])}function ec(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.f)(Zs);case 2:return e.next=4,Object(yr.f)(Qs);case 4:return e.next=6,Object(yr.f)($s);case 6:case"end":return e.stop()}}),Xs)}var tc=function(){var e=Object(ze.a)(Ke.a.mark((function e(t,n){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe("datasets/".concat(t,"/"),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),nc=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe("datasets/".concat(t,"/"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ac=function(){var e=Object(ze.a)(Ke.a.mark((function e(t){var n,a;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Xe(),e.next=3,fetch("".concat(n,"datasets/detect/?path=").concat(encodeURIComponent(t)),{credentials:"same-origin",method:"GET"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),rc=Ke.a.mark(lc),sc=Ke.a.mark(jc),cc=Ke.a.mark(bc),ic=Ke.a.mark(hc),oc=Ke.a.mark(pc),uc=Ke.a.mark(Oc),dc=Ke.a.mark(fc);function lc(e){var t,n,a,r,s;return Ke.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(yr.c)(tc,e.payload.dataset.id,{dataset:e.payload.dataset});case 3:if("ok"!==(t=c.sent).status){c.next=9;break}return c.next=7,Object(yr.g)(ja(t.details));case 7:c.next=14;break;case 9:if("error"!==t.status){c.next=14;break}return n=Date.now(),a=Object(v.a)(),c.next=14,Object(yr.g)(ba(t.dataset,t.msg,n,a));case 14:c.next=22;break;case 16:return c.prev=16,c.t0=c.catch(0),r=Date.now(),s=Object(v.a)(),c.next=22,Object(yr.g)(ba(e.payload.dataset.id,"Error loading dataset: ".concat(c.t0.toString()),r,s));case 22:case"end":return c.stop()}}),rc,null,[[0,16]])}function jc(e){var t,n;return Ke.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(yr.c)(nc,e.payload.dataset);case 3:a.next=11;break;case 5:return a.prev=5,a.t0=a.catch(0),t=Date.now(),n=Object(v.a)(),a.next=11,Object(yr.g)(ba(e.payload.dataset,"Error closing dataset: ".concat(a.t0.toString()),t,n));case 11:case"end":return a.stop()}}),sc,null,[[0,5]])}function bc(e){var t,n,a,r,s,c;return Ke.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(yr.g)(Oa(e));case 2:return i.next=4,Object(yr.c)(ac,e);case 4:if(t=i.sent,r=!0,"ok"!==t.status){i.next=23;break}if(!ka(t.datasetParams.type)){i.next=14;break}return n=t.datasetParams,a=t.datasetInfo,i.next=12,Object(yr.g)(fa(e,n,a));case 12:i.next=21;break;case 14:return s=Date.now(),c=Object(v.a)(),i.next=18,Object(yr.g)(xa(e));case 18:return r=!1,i.next=21,Object(yr.g)(ba(c,t.datasetParams.type+" dataset type is currently not supported in the GUI",s,c));case 21:i.next=25;break;case 23:return i.next=25,Object(yr.g)(xa(e));case 25:return i.abrupt("return",{detectedParams:n,shouldOpen:r,detectedInfo:a});case 26:case"end":return i.stop()}}),cc)}function hc(e){var t,n,a,r,s,c;return Ke.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(yr.h)((function(e){return e.config}));case 2:return t=i.sent,n=t.lastOpened[e],i.prev=4,i.next=7,Object(yr.c)(bc,e);case 7:if(a=i.sent,r=a.detectedParams,s=a.shouldOpen,c=a.detectedInfo,!s){i.next=14;break}return i.next=14,Object(yr.g)(ua(e,n,r,c));case 14:i.next=20;break;case 16:return i.prev=16,i.t0=i.catch(4),i.next=20,Object(yr.g)(xa(e));case 20:case"end":return i.stop()}}),ic,null,[[4,16]])}function pc(e){var t;return Ke.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.payload.path,n.next=3,Object(yr.c)(hc,t);case 3:case"end":return n.stop()}}),oc)}function Oc(e){var t,n;return Ke.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(yr.h)((function(e){return e.config}));case 2:return t=a.sent,n=vr(t,e.payload.path,e.payload.name),a.next=6,Object(yr.c)(hc,n);case 6:case"end":return a.stop()}}),uc)}function fc(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.j)(Sn.CREATE,lc);case 2:return e.next=4,Object(yr.j)(Sn.DELETE,jc);case 4:return e.next=6,Object(yr.j)(U.SELECT,Oc);case 6:return e.next=8,Object(yr.j)(U.SELECT_FULL_PATH,pc);case 8:case"end":return e.stop()}}),dc)}var xc=Ke.a.mark(mc);function mc(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yr.b)([ec(),zr(),Gs(),fc(),os(),wr()]);case 2:case"end":return e.stop()}}),xc)}var yc,gc={byId:{},ids:[]},vc={isOpen:!1,isLoading:!0,path:"/",drives:[],places:{},files:[],dirs:[]};!function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.READY="ready",e.WAITING="waiting",e.DISCONNECTED="disconnected"}(yc||(yc={}));var _c={status:yc.WAITING},Ec={status:"unknown"},Sc={byId:{},ids:[]},Ac={version:"",revision:"",localCores:0,devices:{cpus:[],cudas:[],has_cupy:!1},cwd:"/",separator:"/",lastOpened:{},resultFileFormats:{},fileHistory:[],haveConfig:!1,lastConnection:{type:E.LOCAL,address:"tcp://localhost:8786",cudas:[]},starred:[],datasetTypes:{}},Cc={byId:{},ids:[]},Tc={busy:!1,busyPath:"",formVisible:!1,formPath:"/",formCachedParams:void 0,formDetectedParams:void 0,formDetectedInfo:void 0},Ic={byId:{},ids:[]},Rc={byId:{},ids:[]},Dc=Object(c.b)({compoundAnalyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case at.CREATED:var n=Object(V.a)({doAutoStart:t.payload.autoStart},t.payload.compoundAnalysis);return Kn(e,t.payload.compoundAnalysis.compoundAnalysis,n);case at.REMOVED:return Qn(e,(function(e){return e.compoundAnalysis!==t.payload.id}));case at.ENABLE_AUTOSTART:return Jn(e,t.payload.compoundAnalysisId,{doAutoStart:!0});case Sn.DELETE:return Qn(e,(function(e){return e.dataset!==t.payload.dataset}));case us.CREATED:var a=e.byId[t.payload.compoundAnalysis],r=Object(rt.a)(a.details.analyses);return r[t.payload.analysisIndex]=t.payload.analysis.id,Jn(e,t.payload.compoundAnalysis,{details:{analyses:r,mainType:a.details.mainType}});case oa.INITIAL_STATE:var s=t.payload.compoundAnalyses.map((function(e){return Object(V.a)({doAutoStart:!1},e)}));return{byId:zn(s,(function(e){return e.compoundAnalysis})),ids:s.map((function(e){return e.compoundAnalysis}))}}return e},analyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case us.CREATED:return Kn(e,t.payload.analysis.id,t.payload.analysis);case us.REMOVED:return Qn(e,(function(e){return e.id!==t.payload.id}));case us.UPDATED:return Jn(e,t.payload.id,{details:t.payload.details});case ls.CREATE:var n=e.byId[t.payload.analysis],a=n.jobs?n.jobs:[];return Jn(e,t.payload.analysis,{jobs:[t.payload.id].concat(Object(rt.a)(a))});case oa.CANCEL_JOB_FAILED:case oa.CANCELLED:return Xn(e,(function(e){return Object(V.a)(Object(V.a)({},e),{},{jobs:e.jobs.filter((function(e){return e!==t.payload.job}))})}));case oa.INITIAL_STATE:var r=t.payload.analyses.map((function(e){return{doAutoStart:!1,id:e.analysis,dataset:e.dataset,details:e.details,jobs:e.jobs}}));return{byId:zn(r,(function(e){return e.id})),ids:t.payload.analyses.map((function(e){return e.analysis}))};case oa.FINISH_JOB:case oa.TASK_RESULT:var s=e.ids.find((function(n){var a=e.byId[n];return(a.jobs?a.jobs:[]).some((function(e){return e===t.payload.job}))}));return s?Jn(e,s,{displayedJob:t.payload.job}):e}return e},channelStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case oa.OPEN:return{status:yc.CONNECTED};case oa.INITIAL_STATE:return{status:yc.READY};case oa.CLOSE:return{status:yc.WAITING};case oa.SHUTDOWN:return{status:yc.DISCONNECTED}}return e},clusterConnection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ec,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.NOT_CONNECTED:return{status:"disconnected"};case a.CONNECTED:return{status:"connected",params:t.payload.params};case a.CONNECTING:return{status:"connecting"}}return e},datasets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case oa.INITIAL_STATE:var n=t.payload.datasets.map((function(e){return Object.assign({},e,{status:N.OPEN})}));return{byId:zn(n,(function(e){return e.id})),ids:n.map((function(e){return e.id}))};case Sn.CREATE:var a=Object(V.a)(Object(V.a)({},t.payload.dataset),{},{status:N.OPENING});return Kn(e,t.payload.dataset.id,a);case Sn.CREATED:var r=Object.assign({},t.payload.dataset,{status:N.OPEN});return e.byId[t.payload.dataset.id]?Jn(e,t.payload.dataset.id,r):Kn(e,t.payload.dataset.id,r);case Sn.ERROR:return Qn(e,(function(e){return e.id!==t.payload.dataset}));case Sn.DELETE:return Jn(e,t.payload.dataset,{status:N.DELETING});case Sn.DELETED:return Qn(e,(function(e){return e.id!==t.payload.dataset}))}return e},openDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Sn.OPEN:return Object(V.a)(Object(V.a)({},e),{},{formVisible:!0,formPath:t.payload.path,formCachedParams:t.payload.cachedParams,formDetectedParams:t.payload.detectedParams,formDetectedInfo:t.payload.detectedInfo});case Sn.CANCEL_OPEN:case Sn.CREATE:return Object(V.a)(Object(V.a)({},e),{},{formVisible:!1});case Sn.DETECT:return Object(V.a)(Object(V.a)({},e),{},{busyPath:t.payload.path,busy:!0});case Sn.DETECTED:case Sn.DETECT_FAILED:return Object(V.a)(Object(V.a)({},e),{},{busyPath:"",busy:!1})}return e},jobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ls.CREATE:var n=Kn(e,t.payload.id,{id:t.payload.id,analysis:t.payload.analysis,running:_e.CREATING,status:Ee.CREATING,results:[],startTimestamp:t.payload.timestamp});return n;case oa.JOB_STARTED:return Jn(e,t.payload.job,{running:_e.RUNNING,status:Ee.IN_PROGRESS,startTimestamp:t.payload.timestamp});case oa.TASK_RESULT:return Jn(e,t.payload.job,{results:t.payload.results});case oa.FINISH_JOB:var a=t.payload,r=a.job,s=a.timestamp,c=a.results;return Jn(e,r,{running:_e.DONE,status:Ee.SUCCESS,results:c,endTimestamp:s});case oa.JOB_ERROR:var i=t.payload,o=i.job,u=i.timestamp;return Jn(e,o,{running:_e.DONE,status:Ee.ERROR,endTimestamp:u});case oa.INITIAL_STATE:var d=t.payload.jobs,l=d.map((function(e){return{id:e.id,analysis:e.analysis,status:Ee.SUCCESS,startTimestamp:0,results:[],running:_e.DONE,endTimestamp:0}}));return{byId:zn(l,(function(e){return e.id})),ids:l.map((function(e){return e.id}))}}return e},errors:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ic,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U.ERROR:case Sn.ERROR:case oa.ERROR:case a.ERROR:case at.ERROR:case x.GENERIC:case oa.JOB_ERROR:return Kn(e,t.payload.id,{id:t.payload.id,msg:t.payload.msg,timestamp:t.payload.timestamp});case oa.OPEN:return Ic;case x.DISMISS:return Qn(e,(function(e){return e.id!==t.payload.id}));case x.DISMISS_ALL:return Ic}return e},config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ac,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case de.FETCHED:return Object.assign({},t.payload.config,{haveConfig:!0});case U.DIRECTORY_LISTING:return Object.assign({},e,{cwd:t.payload.path});case Sn.CREATE:var n=Object.assign({},e.lastOpened,Object(k.a)({},t.payload.dataset.params.path,t.payload.dataset.params)),r=Ar([t.payload.dataset.params.path].concat(Object(rt.a)(e.fileHistory))).slice(0,11);return Object.assign({},e,{lastOpened:n,fileHistory:r});case a.CONNECT:if(t.payload.params.type===E.LOCAL){var s=Object.assign({},e.lastConnection,{type:E.LOCAL,cudas:t.payload.params.cudas});return Object.assign({},e,{lastConnection:s})}var c=Object.assign({},e.lastConnection,{type:E.TCP,address:t.payload.params.address});return Object.assign({},e,{lastConnection:c});case de.TOGGLE_STAR:var i=t.payload.path;return Object(V.a)(Object(V.a)({},e),{},{starred:qn(e.starred,i)})}return e},browser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case de.FETCHED:return Object.assign({},e,{path:t.payload.config.cwd});case U.OPEN:return Object.assign({},e,{isOpen:!0});case U.CANCEL:return Object.assign({},e,{isOpen:!1});case U.LIST_DIRECTORY:return Object.assign({},e,{isLoading:!0});case U.DIRECTORY_LISTING:var n=t.payload.places.reduce((function(e,t){return Object.assign({},e,Object(k.a)({},t.key,t))}),{});return Object.assign({},e,{isLoading:!1,path:t.payload.path,files:t.payload.files,dirs:t.payload.dirs,drives:t.payload.drives,places:n});case U.SELECT_FULL_PATH:case U.SELECT:return Object.assign({},e,{isLoading:!1,isOpen:!1})}return e}}),wc=Object(i.c)(),kc=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.c,Fc=Object(c.d)(Dc,kc(Object(c.a)(wc)));r.render(Object(z.jsx)(s.a,{store:Fc,children:Object(z.jsx)(mr,{})}),document.getElementById("root")),wc.run(mc)}},[[301,1,2]]]);
//# sourceMappingURL=main.2e050bba.chunk.js.map