{"version":3,"sources":["job/components/ResultImage.module.css","images/LiberTEM logo-medium.png","cluster/actions.ts","About.tsx","helpers/actionHelpers.ts","helpers/index.ts","messages.ts","cluster/components/LocalConnectionForm.tsx","cluster/components/TCPConnectionForm.tsx","browser/actions.ts","cluster/components/ClusterConnectionForm.tsx","channel/components/ChannelConnecting.tsx","channel/components/ChannelStatus.tsx","browser/components/FileBrowserEntry.tsx","browser/components/FileBrowserHeader.tsx","browser/components/FileEntry.tsx","browser/components/FolderEntry.tsx","browser/components/PathDropDownItem.tsx","browser/components/PathInput.tsx","browser/components/RecentFiles.tsx","browser/components/PathBar.tsx","browser/components/FileBrowser.tsx","job/types.ts","browser/components/BrowserWrapper.tsx","widgets/BusySpinner.tsx","widgets/BusyWrapper.tsx","widgets/HandleParent.tsx","job/components/ResultImage.tsx","job/components/Result.tsx","job/components/Selectors.tsx","job/components/ResultList.tsx","widgets/constraints.ts","widgets/styles.ts","widgets/Disk.tsx","widgets/kbdHandler.ts","widgets/DraggableHandle.tsx","analysis/actions.ts","analysis/components/AnalysisLayoutTwoCol.tsx","analysis/components/FramePicker.tsx","analysis/components/ModeSelector.tsx","widgets/Rect.tsx","analysis/components/DefaultFrameView.tsx","analysis/components/RectROI.tsx","analysis/components/RoiPicker.tsx","analysis/components/DiskROI.tsx","analysis/components/Toolbar.tsx","analysis/helpers.ts","analysis/components/CenterOfMassAnalysis.tsx","helpers/svg.ts","widgets/Ring.tsx","analysis/components/AnalysisLayoutTwoRes.tsx","analysis/components/Clustering.tsx","analysis/components/DiskMaskAnalysis.tsx","analysis/components/FEM.tsx","analysis/components/AnalysisLayoutThreeCol.tsx","analysis/components/FFTFramePicker.tsx","analysis/components/FFTSumFrames.tsx","analysis/components/FFTFrameView.tsx","analysis/components/FFTAnalysis.tsx","analysis/components/PointSelectionAnalysis.tsx","analysis/components/RadialFourierAnalysis.tsx","analysis/components/RingMaskAnalysis.tsx","analysis/types.ts","analysis/components/Analysis.tsx","analysis/components/AnalysisList.tsx","helpers/reducerHelpers.ts","analysis/components/AnalysisSelect.tsx","dataset/actions.ts","dataset/components/AddAnalysis.tsx","dataset/components/DatasetParams.tsx","dataset/components/DatasetInfo.tsx","dataset/components/DatasetToolbar.tsx","dataset/components/Dataset.tsx","dataset/api.ts","dataset/validate.ts","dataset/helpers.ts","dataset/components/BLOParamsForm.tsx","dataset/components/DatasetTypeSelect.tsx","dataset/components/EMPADParamsForm.tsx","dataset/components/FRMS6ParamsForm.tsx","dataset/components/HDF5ParamsForm.tsx","dataset/components/K2ISParamsForm.tsx","dataset/components/MIBParamsForm.tsx","dataset/components/RawFileParamsForm.tsx","dataset/components/SERParamsForm.tsx","dataset/components/DatasetOpen.tsx","errors/actions.ts","dataset/components/DatasetOpenSpinner.tsx","dataset/components/DatasetList.tsx","errors/components/Error.tsx","errors/components/ErrorList.tsx","App.tsx","registerServiceWorker.ts","job/actions.ts","job/api.ts","analysis/sagas.ts","config/helpers.ts","browser/api.ts","channel/actions.ts","browser/sagas.ts","channel/messages.ts","channel/sagas.ts","cluster/api.ts","config/actions.ts","cluster/sagas.ts","config/api.ts","config/sagas.ts","dataset/sagas.ts","sagas.ts","analysis/reducers.ts","browser/reducers.ts","channel/reducers.ts","cluster/reducers.ts","config/reducers.ts","dataset/reducers.ts","errors/reducers.ts","job/reducers.ts","store.ts","index.tsx"],"names":["module","exports","ActionTypes","connect","state","version","config","revision","Header","as","slice","List","Item","Icon","name","Content","href","src","alt","createAction","type","payload","meta","undefined","Actions","notConnected","NOT_CONNECTED","params","CONNECT","connected","CONNECTED","defaultDebounce","fn","delay","_","maxWait","getEnumValues","e","Object","keys","ClusterTypes","DatasetTypes","DatasetStatus","AnalysisTypes","ClusterTypeMetadata","LOCAL","label","TCP","helpText","withFormik","mapPropsToValues","ownProps","numWorkers","localCores","handleSubmit","values","formikBag","onSubmit","props","touched","errors","isSubmitting","dirty","handleChange","handleBlur","handleReset","Form","Field","htmlFor","value","onChange","onBlur","Button","primary","disabled","address","mapDispatchToProps","connectToCluster","clusterActions","clusterTypeOptions","map","t","text","ClusterConnectionForm","clusterType","setType","setState","data","this","Dropdown","inline","options","Segment","renderForm","React","ChannelConnecting","msg","Message","icon","loading","messages","waiting","connecting","clusterMessages","channelStatus","clusterConnection","haveConfig","children","status","list","path","LIST_DIRECTORY","dirListing","dirs","files","drives","places","DIRECTORY_LISTING","open","OPEN","cancel","CANCEL","select","SELECT","selectFullPath","SELECT_FULL_PATH","error","timestamp","id","ERROR","detectParams","DETECT_PARAMS","paramsDetected","PARAMS_DETECTED","TimeStamp","ts","date","Date","fmtDate","toLocaleDateString","fmtTime","toLocaleTimeString","title","style","display","whiteSpace","width","marginRight","FileSize","fmtSize","bytes","si","thresh","Math","abs","size","unit","units","u","length","toFixed","humanFileSize","textAlign","Cell","overflow","textOverflow","FileBrowserEntry","onClick","details","myStyle","cursor","tsStyles","paddingRight","flexGrow","owner","ctime","mtime","FileBrowserHeader","alignRight","paddingBottom","FileEntry","dispatch","browserActions","window","setTimeout","toString","newProps","initialPath","enableReinitialize","Input","autoComplete","lastOpened","fileHistory","separator","recentFiles","filter","item","floating","Menu","content","option","idx","key","refresh","currentPath","handleInputChange","goUp","driveOptions","placeOptions","listRef","scrollToTop","current","scrollToItem","sortByKey","array","getKey","sort","a","b","x","y","JobRunning","JobStatus","browser","isLoading","getSortKey","toLowerCase","dirEntries","dir","fileEntries","f","entries","concat","overflowY","ref","height","itemCount","itemSize","index","Group","isOpen","labelPosition","BusySpinner","margin","padding","position","bottom","right","color","opacity","BusyWrapper","busy","HandleParent","currentHandle","handleDragStart","h","handleDrop","handleMouseMove","externalMouseMove","handleMouseLeave","externalLeave","handleMouseUp","externalMouseUp","onMouseMove","onMouseLeave","onMouseUp","onKeyDown","onKeyboardEvent","outline","tabIndex","fill","renderHandles","handles","i","elem","ResultImage","job","result","results","className","styles","fallback","viewBox","default","xlinkHref","imageURL","ResultWrapper","styled","svg","Result","extraHandles","extraWidgets","running","DONE","Selectors","div","ResultList","selectedChannel","selectChannel","getJob","currentJob","analysis","jobsById","jobIndex","history","jobHistory","tmpJob","selectors","dataset","subtitle","currentResult","border","dt","endTimestamp","startTimestamp","selectedImg","ResultImageSelector","availableImages","description","analyses","byId","jobId","jobs","ds","datasets","inRectConstraint","p","max","min","cbToRadius","cx","cy","cb","dx","dy","sqrt","dist","keepOnCY","riConstraint","outerPos","otherX","roConstraints","innerPos","defaultMaskStyles","imageWidth","fillOpacity","strokeOpacity","stroke","strokeWidth","Disk","imageHeight","r","handleKeyEvent","update","delta","shiftKey","preventDefault","StyledCircle","circle","Cross","FocusGroup","g","Handle","scale","withCross","focusRef","args","transform","crossSpec","cross","d","relativeCoords","parent","ownerSVGElement","Error","inWidthAttr","getAttribute","inWidth","getBoundingClientRect","getScalingFactor","parentPos","pageX","left","pageXOffset","pageY","top","pageYOffset","DraggableHandle","posRef","dragging","drag","move","stopDrag","applyConstraint","constraint","startDrag","parentOnDragStart","focus","onDragMove","constrained","parentOnDrop","handleKeyDown","newCoords","visibility","onMouseDown","renderCommon","renderDragging","create","analysisType","CREATE","created","CREATED","prepareRun","PREPARE_RUN","run","parameters","RUN","RUNNING","remove","REMOVE","removed","REMOVED","AnalysisLayoutTwoCol","toolbar","attached","Grid","columns","Row","Column","useFramePicker","enabled","scanWidth","scanHeight","analysisId","setCx","setCy","useDispatch","useEffect","analysisActions","PICK_FRAME","onPickChange","pickX","pickY","newX","round","newY","coords","onDragStart","onDrop","ModeSelector","modes","currentMode","onModeChange","DefaultModes","DefaultRois","Rect","ymin","xmin","useRectROI","minLength","useState","setx","sety","setwidth","setheight","handleCornerChange","newx","newy","handleShapeChange","smthHandle","rectRoiParameters","roi","shape","rectRoiHandles","rectRoiWidgets","useRoiPicker","roiParameters","handle","analysisDetails","clearTimeout","JSON","stringify","useDefaultFrameView","availableModes","SUM","SD","PICK","availableRois","ALL","DISK","RECT","frameMode","setMode","setRoi","frameModeSelector","roiSelector","widgets","pickCoords","pickHandles","setR","handleCenterChange","newCx","newCy","handleRChange","newR","rHandle","diskRoiParameters","diskRoiHandles","diskRoiWidgets","useDiskROI","SD_FRAMES","SUM_FRAMES","frameViewTitle","jobIdxsToInclude","filteredJobs","indexOf","reduce","prevValue","getAnalysisStatus","busyIdxs","handleRemove","onApply","applyIconProps","CenterOfMassAnalysis","frameViewWidgets","resultHandles","resultWidgets","CENTER_OF_MASS","getPathArc","center","start","end","radius","degree","points","push","getLocationFromAngle","clockWise","join","getCirclePath","radian","PI","cos","sin","Ring","ri","pathSpec","ro","fillRule","AnalysisLayoutTwoRes","mid","clustparams","title1","title2","title3","ClustAnalysis","setRi","setRo","riHandle","roHandle","minDist","setMinDist","nPeaks","setNPeaks","nClust","setNClust","handleRIChange","handleROChange","SUM_SIG","CLUST","n_clust","n_peaks","min_dist","paramsVisible","setParamsVisible","Accordion","Title","active","event","step","target","valueAsNumber","DiskMaskAnalysis","APPLY_DISK_MASK","FEMAnalysis","FEM","AnalysisLayoutThreeCol","useFFTFramePicker","real_rad","real_centerx","real_centery","PICK_FFT_FRAME","useFFTSumFrames","FFTSUM_FRAMES","useFFTFrameView","FFTAnalysis","radIn","radOut","frameViewWidgetsfft","check","setCheck","realCenterX","realCenterY","realRad","frameViewWidgetsreal","APPLY_FFT_MASK","rad_in","rad_out","checked","PointSelectionAnalysis","APPLY_POINT_SELECTOR","RadialFourierAnalysis","nBins","maxOrder","RADIAL_FOURIER","n_bins","max_order","RingMaskAnalysis","APPLY_RING_MASK","AnalysisMetadata","desc","component","AnalysisDispatcherComponent","useSelector","AnalysisComponent","mainAnalysisType","AnalysisList","ids","Analysis","updateById","partialRecord","newObj","assign","newById","insertById","record","filterWithPred","pred","acc","getMetadata","typeName","analysisTypeOptions","AnalysisSelect","labeled","button","handleAddAnalysis","renderParams","Table","Array","DatasetParams","HeaderCell","Body","DiagElem","diagnostics","renderValue","DiagElems","DatasetInfo","cachedParams","detectedParams","cancelOpen","CANCEL_OPEN","delete","DELETE","deleted","DELETED","detect","DETECT","detected","DETECTED","detectFailed","DETECT_FAILED","handleRemoveDataset","datasetActions","DatasetContainer","OPENING","DELETING","dividing","marginTop","marginBottom","horizontal","Modal","trigger","link","Popup","flexShrink","openDataset","fetch","body","credentials","method","then","json","deleteDataset","detectDataset","encodeURIComponent","schemaCache","getSchema","cached","Promise","resolve","schemaResponse","convertErrors","res","forEach","err","fieldName","dataPath","replace","match","plainName","message","schema","validate","Ajv","compile","parseNumList","nums","split","part","trim","getInitial","otherwise","getInitialName","pathfind","isKnownDatasetType","detectedType","some","v","withValidation","opts","formToJson","setSubmitting","validateOpen","validateOnChange","validateOnBlur","initial","tileshape","BLO","isValidating","onCancel","datasetTypeOptions","DatasetTypeSelect","currentType","scan_size","EMPAD","FRMS6","ds_path","HDF5","K2IS","MIB","enable_direct","detector_size","dtype","RAW","SER","getDefaultDSType","didReset","openState","formCachedParams","formDetectedParams","getFormInitial","DatasetOpen","setReset","formInitial","defaultType","datasetType","setDatasetType","doSetType","form","formPath","commonParams","uuid","onReset","MIBParamsForm","BLOParamsForm","K2ISParamsForm","assertNotReached","busyPath","DatasetList","formVisible","dsId","Dataset","DISMISS","DISMISS_ALL","dismiss","errorActions","negative","onDismiss","clusterConnected","channelConnected","latestErrors","showModal","handleEsc","ev","code","keyCode","document","addEventListener","removeEventListener","App","Container","logo","alignSelf","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","catch","startJob","datasetId","cancelJob","createAnalysisSaga","analysisSidecar","doRemoveAnalysisSaga","analysisRootSaga","selectDataset","selectAnalysis","selectJob","action","fork","sidecarTask","put","take","now","actionChannel","buffers","sliding","runOrParamsChannel","jobActions","oldJobId","call","takeEvery","CONFIG_KEY","joinPaths","parts","RegExp","escapeRegExp","mergeLocalStorage","serverConfig","localSettings","localStorage","getItem","cwd","localSettingsParsed","parse","defaultConfig","setLocalStorage","setItem","getDirectoryListing","url","directoryListingSaga","fetchOnRequest","fetchDirectoryListing","fetchDirectoryListOnOpen","newPath","browserState","alternative","home","MessageTypes","initialState","INITIAL_STATE","jobStarted","JOB_STARTED","finishJob","FINISH_JOB","taskResult","TASK_RESULT","jobError","JOB_ERROR","close","CLOSE","cancelled","CANCELLED","createMessage","messageType","attribs","Messages","followup","binary","objectURL","BINARY","DELETE_DATASET","CANCEL_JOB_DONE","webSocketSaga","actionsFromChannel","handleBinaryParts","handleTaskResult","handleFinishJob","createWebSocketChannel","eventChannel","emit","onMessage","Blob","channelMessages","URL","createObjectURL","parsed","onOpen","onClose","END","onError","ws","WebSocket","port","socketChannel","channelActions","numParts","binMsg","numMessages","images","descriptions","connection","checkClusterConnection","connectSaga","putClusterStatus","trackClusterConnection","clusterConnectionSaga","conn","all","FETCH","fetched","FETCHED","fetchFailed","FETCH_FAILED","getConfig","getConfigOnReconnect","getConfigSaga","updateLocalStorageConfig","firstConfigFetch","configRootSaga","configActions","configResponse","mergedConfig","removeItem","createDatasetSaga","deleteDatasetSaga","doDetectDataset","doOpenDataset","openDatasetSagaFullPath","openDatasetSaga","datasetRootSaga","resp","fullPath","detectResult","shouldOpen","datasetParams","doDetectDatasetRes","rootSaga","initialAnalysisState","ChannelStatusCodes","initialBrowserState","initialChannelState","WAITING","initialClusterConnectionState","initialConfigState","initialDatasetState","initialOpenDatasetState","initialErrorState","initialJobState","rootReducer","combineReducers","oldJob","hist","newJobs","READY","items","CREATING","IN_PROGRESS","SUCCESS","inp","newLastOpened","newFileHistory","curr","place","sagaMiddleware","createSagaMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","ReactDOM","getElementById","process","origin","response","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.760dd336.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"default\":\"ResultImage_default__3K5yi\",\"fallback\":\"ResultImage_fallback__3V1su\"};","module.exports = __webpack_public_path__ + \"static/media/LiberTEM logo-medium.7999e0dc.png\";","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { ConnectRequestParams } from '../messages';\r\n\r\nexport enum ActionTypes {\r\n    NOT_CONNECTED = 'CLUSTER_NOT_CONNECTED',\r\n    CONNECT = 'CLUSTER_CONNECT',\r\n    CONNECTED = 'CLUSTER_CONNECTED',\r\n}\r\n\r\nexport const Actions = {\r\n    notConnected: () => createAction(ActionTypes.NOT_CONNECTED),\r\n    connect: (params: ConnectRequestParams) => createAction(ActionTypes.CONNECT, { params }),\r\n    connected: (params: ConnectRequestParams) => createAction(ActionTypes.CONNECTED, { params }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, List } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"./store\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        version: state.config.version,\r\n        revision: state.config.revision,\r\n    }\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst About: React.SFC<MergedProps> = ({ version, revision }) => {\r\n    return (\r\n        <>\r\n            <Header as=\"h3\">This is LiberTEM version {version} (revision {revision.slice(0, 8)})</Header>\r\n            <List>\r\n                <List.Item>\r\n                    <List.Icon name=\"github\" />\r\n                    <List.Content>\r\n                        Find us on <a href=\"https://github.com/LiberTEM/LiberTEM\">GitHub</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"bug\" />\r\n                    <List.Content>\r\n                        Found a bug? Got a feature request? Please <a href=\"https://github.com/LiberTEM/LiberTEM/issues/new\">open an issue!</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"legal\" />\r\n                    <List.Content>\r\n                        LiberTEM is licensed under the <a href=\"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE\">GNU General Public License v3.0</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"book\" />\r\n                    <List.Content>\r\n                        Read <a href=\"https://libertem.github.io/LiberTEM/\">the documentation</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"user\" />\r\n                    <List.Content>\r\n                        Read <a href=\"https://libertem.github.io/LiberTEM/acknowledgments.html\">the acknowledgments</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"gitter\" />\r\n                    <List.Content>\r\n                        Join our <a href=\"https://gitter.im/LiberTEM/Lobby\">chat on gitter!</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"linkify\" />\r\n                    <List.Content>\r\n                    <a href=\"https://doi.org/10.5281/zenodo.1477847\"><img src=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1477847.svg\" alt=\"doi.org/10.5281/zenodo.1477847\"/></a>\r\n                    </List.Content>\r\n                </List.Item>\r\n            </List>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(About);\r\n","import { ActionCreatorsMapObject } from \"redux\";\r\n\r\nexport interface Action<T extends string> {\r\n    type: T\r\n}\r\n\r\nexport interface ActionWithPayload<T extends string, P> extends Action<T> {\r\n    payload: P\r\n}\r\n\r\nexport interface ActionWithMeta<T extends string, P, M> extends ActionWithPayload<T, P> {\r\n    meta: M\r\n}\r\n\r\nexport function createAction<T extends string>(type: T): Action<T>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P): ActionWithPayload<T, P>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P, meta?: M): ActionWithMeta<T, P, M>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P, meta?: M) {\r\n    if (meta === undefined && payload === undefined) {\r\n        return { type };\r\n    } else if (meta === undefined) {\r\n        return { type, payload };\r\n    } else {\r\n        return { type, payload, meta }\r\n    }\r\n}\r\n\r\nexport type ActionsUnion<A extends ActionCreatorsMapObject> = ReturnType<A[keyof A]>","import * as _ from \"lodash\";\r\n\r\nexport function assertNotReached(message: string): never {\r\n    throw new Error(message);\r\n}\r\n\r\nexport function defaultDebounce<T extends (...args: any[]) => any>(fn: T, delay: number = 50) {\r\n    return _.debounce(fn, delay, { maxWait: delay });\r\n}\r\n\r\nexport function getEnumValues<E>(e: E): Array<keyof E> {\r\n    return Object.keys(e) as Array<keyof E>;\r\n}","\r\n/* \r\n * Common\r\n */\r\n\r\nexport interface FollowupPart {\r\n    numMessages: number,\r\n    descriptions: Array<{ title: string, desc: string }>,\r\n}\r\n\r\nexport interface MsgPartConfig {\r\n    version: string,\r\n    revision: string,\r\n    localCores: number,\r\n    cwd: string,\r\n    separator: string,\r\n}\r\n\r\nexport interface GetConfigResponse {\r\n    status: \"ok\",\r\n    config: MsgPartConfig,\r\n}\r\n\r\n/*\r\n * Connection\r\n */\r\n\r\nexport enum ClusterTypes {\r\n    LOCAL = \"LOCAL\",\r\n    TCP = \"TCP\",\r\n}\r\n\r\nexport const ClusterTypeMetadata: { [s: string]: { [s: string]: string } } = {\r\n    [ClusterTypes.LOCAL]: {\r\n        label: \"Create local cluster\",\r\n    },\r\n    [ClusterTypes.TCP]: {\r\n        label: \"Connect to cluster\",\r\n        helpText: \"can be either local or remote, connection via TCP\",\r\n    }\r\n}\r\n\r\nexport interface ConnectRequestLocalCluster {\r\n    type: ClusterTypes.LOCAL,\r\n    numWorkers?: number,\r\n}\r\n\r\nexport interface ConnectRequestTCP {\r\n    type: ClusterTypes.TCP,\r\n    address: string,\r\n}\r\n\r\nexport type ConnectRequestParams = ConnectRequestLocalCluster | ConnectRequestTCP\r\n\r\nexport interface ConnectRequest {\r\n    connection: ConnectRequestParams\r\n}\r\n\r\nexport type ConnectResponse = {\r\n    status: \"ok\",\r\n    connection: ConnectRequest,\r\n} | {\r\n    status: \"disconnected\",\r\n    connection: {},\r\n}\r\n\r\n/*\r\n * Dataset\r\n */\r\n\r\nexport enum DatasetTypes {\r\n    HDF5 = \"HDF5\",\r\n    RAW = \"RAW\",\r\n    MIB = \"MIB\",\r\n    BLO = \"BLO\",\r\n    K2IS = \"K2IS\",\r\n    SER = \"SER\",\r\n    FRMS6 = \"FRMS6\",\r\n    EMPAD = \"EMPAD\",\r\n}\r\n\r\nexport interface DatasetParamsCommon {\r\n    name: string,\r\n}\r\n\r\nexport type DatasetParamsHDF5 = {\r\n    type: DatasetTypes.HDF5,\r\n    path: string,\r\n    ds_path: string,\r\n    tileshape: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsRaw = {\r\n    type: DatasetTypes.RAW,\r\n    path: string,\r\n    dtype: string,\r\n    detector_size: number[],\r\n    enable_direct: boolean,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsMIB = {\r\n    type: DatasetTypes.MIB,\r\n    path: string,\r\n    scan_size: number[],\r\n    tileshape: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsBLO = {\r\n    type: DatasetTypes.BLO,\r\n    path: string,\r\n    tileshape: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsK2IS = {\r\n    type: DatasetTypes.K2IS,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsSER = {\r\n    type: DatasetTypes.SER,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsFRMS6 = {\r\n    type: DatasetTypes.FRMS6,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsEMPAD = {\r\n    type: DatasetTypes.EMPAD,\r\n    path: string,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetFormParams = DatasetParamsHDF5 | DatasetParamsRaw | DatasetParamsMIB | DatasetParamsBLO | DatasetParamsK2IS | DatasetParamsSER | DatasetParamsFRMS6 | DatasetParamsEMPAD\r\n\r\nexport interface DatasetCreateParams {\r\n    id: string,\r\n    params: DatasetFormParams,\r\n}\r\n\r\nexport enum DatasetStatus {\r\n    OPEN = \"OPEN\",\r\n    OPENING = \"OPENING\",\r\n    DELETING = \"DELETING\",\r\n}\r\n\r\nexport interface DiagElemMsg {\r\n    name: string,\r\n    value: string | DiagElemMsg[],\r\n}\r\n\r\ninterface DatasetCommon {\r\n    id: string,\r\n    params: DatasetFormParams,\r\n}\r\n\r\nexport type DatasetOpening = DatasetCommon & {\r\n    status: DatasetStatus.OPENING,\r\n}\r\n\r\nexport type DatasetDeleting = DatasetCommon & {\r\n    status: DatasetStatus.DELETING,\r\n}\r\n\r\nexport type DatasetOpen = DatasetCommon & {\r\n    status: DatasetStatus.OPEN,\r\n    params: {\r\n        shape: number[],\r\n    }\r\n    diagnostics: DiagElemMsg[],\r\n}\r\n\r\nexport type Dataset = DatasetOpening | DatasetOpen | DatasetDeleting;\r\n\r\nexport interface OpenDatasetRequest {\r\n    dataset: DatasetCreateParams\r\n}\r\n\r\nexport interface OpenDatasetResponseOk {\r\n    status: \"ok\",\r\n    dataset: string,  // TODO: uuid type?\r\n    details: Dataset,\r\n}\r\n\r\nexport interface OpenDatasetResponseError {\r\n    status: \"error\",\r\n    dataset: string,\r\n    msg: string,\r\n}\r\n\r\nexport type OpenDatasetResponse = OpenDatasetResponseOk | OpenDatasetResponseError\r\n\r\nexport interface DeleteDatasetResponse {\r\n    status: \"ok\",\r\n    dataset: string,\r\n}\r\n\r\nexport interface DetectDatasetSuccessResponse {\r\n    status: \"ok\",\r\n    datasetParams: DatasetFormParams,\r\n}\r\n\r\nexport interface DetectDatasetErrorResponse {\r\n    status: \"error\",\r\n    path: string,\r\n    msg: string,\r\n}\r\n\r\nexport type DetectDatasetResponse = DetectDatasetSuccessResponse | DetectDatasetErrorResponse;\r\n\r\nexport interface DataSetOpenSchemaSuccessResponse {\r\n    status: \"ok\",\r\n    ds_type: string,\r\n    schema: object,\r\n}\r\n\r\nexport interface DataSetOpenSchemaErrorResponse {\r\n    status: \"error\",\r\n    ds_type: string,\r\n    msg: string,\r\n}\r\n\r\nexport type DataSetOpenSchemaResponse = DataSetOpenSchemaSuccessResponse | DataSetOpenSchemaErrorResponse;\r\n\r\nexport type MsgPartInitialDataset = DatasetOpen\r\n\r\n// type alias to add client-side state to datasets\r\nexport type DatasetState = Dataset & {}\r\n\r\n/*\r\n * Job\r\n */\r\nexport interface MsgPartJob {\r\n    id: string,\r\n    dataset: string,\r\n}\r\n\r\nexport interface MaskDefRing {\r\n    shape: \"ring\",\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number\r\n}\r\n\r\n\r\nexport interface MaskDefDisk {\r\n    shape: \"disk\",\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nexport interface PointDef {\r\n    shape: \"point\",\r\n    cx: number,\r\n    cy: number,\r\n}\r\n\r\n// TODO: shape doesn't really make sense here, needs to be restructured\r\nexport interface CenterOfMassParams {\r\n    shape: \"com\",\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nexport interface PickFrameParams {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\nexport interface FFTSumFramesParams {\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\n\r\nexport interface PickFFTFrameParams {\r\n    x: number,\r\n    y: number,\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\nexport interface RadialFourierParams {\r\n    shape: \"radial_fourier\",\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n    n_bins: number,\r\n    max_order: number\r\n}\r\n\r\nexport interface FFTParams {\r\n    rad_in: number,\r\n    rad_out: number,\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\n\r\n\r\nexport interface FrameParams {\r\n    roi: {\r\n        shape: \"rect\",\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n    } | {\r\n        shape: \"disk\",\r\n        cx: number,\r\n        cy: number,\r\n        r: number,\r\n    } |\r\n    {}\r\n}\r\n\r\nexport interface ClustParams {\r\n    roi: {\r\n        shape: \"rect\",\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n    } | {}\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n    n_peaks: number,\r\n    n_clust: number,\r\n    min_dist: number,\r\n}\r\n\r\nexport enum AnalysisTypes {\r\n    APPLY_RING_MASK = \"APPLY_RING_MASK\",\r\n    APPLY_DISK_MASK = \"APPLY_DISK_MASK\",\r\n    APPLY_POINT_SELECTOR = \"APPLY_POINT_SELECTOR\",\r\n    CENTER_OF_MASS = \"CENTER_OF_MASS\",\r\n    SUM_FRAMES = \"SUM_FRAMES\",\r\n    SD_FRAMES = \"SD_FRAMES\",\r\n    PICK_FRAME = \"PICK_FRAME\",\r\n    PICK_FFT_FRAME = \"PICK_FFT_FRAME\",\r\n    APPLY_FFT_MASK = \"APPLY_FFT_MASK\",\r\n    FFTSUM_FRAMES = \"FFTSUM_FRAMES\",\r\n    RADIAL_FOURIER = \"RADIAL_FOURIER\",\r\n    FEM = \"FEM\",\r\n    CLUST = \"CLUST\",\r\n    SUM_SIG = \"SUM_SIG\",\r\n}\r\n\r\nexport interface RingMaskDetails {\r\n    type: AnalysisTypes.APPLY_RING_MASK,\r\n    parameters: MaskDefRing,\r\n\r\n}\r\n\r\nexport interface FFTDetails {\r\n    type: AnalysisTypes.APPLY_FFT_MASK,\r\n    parameters: FFTParams,\r\n}\r\n\r\nexport interface FEMDetails {\r\n    type: AnalysisTypes.FEM,\r\n    parameters: MaskDefRing,\r\n}\r\n\r\nexport interface DiskMaskDetails {\r\n    type: AnalysisTypes.APPLY_DISK_MASK,\r\n    parameters: MaskDefDisk,\r\n}\r\n\r\nexport interface PointDefDetails {\r\n    type: AnalysisTypes.APPLY_POINT_SELECTOR,\r\n    parameters: PointDef,\r\n}\r\n\r\nexport interface CenterOfMassDetails {\r\n    type: AnalysisTypes.CENTER_OF_MASS,\r\n    parameters: CenterOfMassParams,\r\n}\r\n\r\nexport interface SumFramesDetails {\r\n    type: AnalysisTypes.SUM_FRAMES,\r\n    parameters: FrameParams\r\n}\r\n\r\nexport interface SDFramesDetails {\r\n    type: AnalysisTypes.SD_FRAMES,\r\n    parameters: FrameParams\r\n}\r\n\r\nexport interface SumSigDetails {\r\n    type: AnalysisTypes.SUM_SIG,\r\n    parameters: {}\r\n}\r\n\r\nexport interface FFTSumFramesDetails {\r\n    type: AnalysisTypes.FFTSUM_FRAMES,\r\n    parameters: FFTSumFramesParams,\r\n}\r\n\r\nexport interface PickFrameDetails {\r\n    type: AnalysisTypes.PICK_FRAME,\r\n    parameters: PickFrameParams,\r\n}\r\n\r\nexport interface PickFFTFrameDetails {\r\n    type: AnalysisTypes.PICK_FFT_FRAME,\r\n    parameters: PickFFTFrameParams,\r\n}\r\n\r\nexport interface RadialFourierDetails {\r\n    type: AnalysisTypes.RADIAL_FOURIER,\r\n    parameters: RadialFourierParams,\r\n}\r\n\r\nexport interface RadialFourierDetails {\r\n    type: AnalysisTypes.RADIAL_FOURIER,\r\n    parameters: RadialFourierParams,\r\n}\r\n\r\nexport interface ClustDetails {\r\n    type: AnalysisTypes.CLUST,\r\n    parameters: ClustParams,\r\n}\r\n\r\nexport type AnalysisParameters = MaskDefRing | MaskDefDisk | CenterOfMassParams | PointDef | PickFrameParams | RadialFourierParams | FFTParams | PickFFTFrameParams | FFTSumFramesParams | ClustParams;\r\nexport type AnalysisDetails = RingMaskDetails | DiskMaskDetails | CenterOfMassDetails | PointDefDetails | SumFramesDetails | SDFramesDetails | PickFrameDetails | RadialFourierDetails | FEMDetails | FFTDetails | FFTSumFramesDetails | PickFFTFrameDetails | SumSigDetails | ClustDetails;\r\n\r\nexport interface StartJobRequest {\r\n    job: {\r\n        dataset: string,\r\n        analysis: AnalysisDetails,\r\n    }\r\n}\r\n\r\nexport interface StartJobResponse {\r\n    status: \"ok\",\r\n    job: string,\r\n    details: MsgPartJob,\r\n}\r\n\r\nexport interface CancelJobResponse {\r\n    status: \"ok\",\r\n    job: string,\r\n}\r\n\r\n/*\r\n * fs browser \r\n */\r\n\r\n// some named place, i.e. \"Documents\", \"Home\", ...\r\nexport interface FSPlace {\r\n    title: string,\r\n    path: string,\r\n    key: string,\r\n}\r\n\r\nexport interface DirectoryListingDetails {\r\n    name: string,\r\n    size: number,\r\n    ctime: number,\r\n    mtime: number,\r\n    owner: string,\r\n}\r\n\r\nexport interface DirectoryListingResponseOK {\r\n    status: \"ok\",\r\n    path: string,\r\n    files: DirectoryListingDetails[],\r\n    dirs: DirectoryListingDetails[],\r\n    drives: string[],\r\n    places: FSPlace[],\r\n}\r\n\r\nexport interface DirectoryListingResponseError {\r\n    status: \"error\",\r\n    path: string,\r\n    code: string,\r\n    msg: string,\r\n    alternative?: string,\r\n}\r\n\r\nexport type DirectoryListingResponse = DirectoryListingResponseOK | DirectoryListingResponseError;\r\n","import { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { ConfigState } from \"../../config/reducers\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { ClusterTypes, ConnectRequestLocalCluster } from \"../../messages\";\r\n\r\ntype FormValues = Omit<ConnectRequestLocalCluster, \"type\">;\r\n\r\ninterface FormProps {\r\n    onSubmit: (params: ConnectRequestLocalCluster) => void,\r\n    config: ConfigState,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & FormProps;\r\n\r\nconst LocalConnectionForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"numWorkers\">Number of Workers:</label>\r\n                <input type=\"number\" name=\"numWorkers\" value={values.numWorkers}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur} />\r\n                {errors.numWorkers && touched.numWorkers && errors.numWorkers}\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Connect</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<FormProps, FormValues>({\r\n    mapPropsToValues: (ownProps: FormProps) => ({\r\n        numWorkers: ownProps.config.localCores,\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onSubmit } = formikBag.props;\r\n        onSubmit({\r\n            type: ClusterTypes.LOCAL,\r\n            ...values,\r\n        });\r\n    }\r\n})(LocalConnectionForm);\r\n","\r\nimport { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { ClusterTypes, ConnectRequestTCP } from \"../../messages\";\r\n\r\ntype FormValues = Omit<ConnectRequestTCP, \"type\">;\r\n\r\ninterface FormProps {\r\n    onSubmit: (params: ConnectRequestTCP) => void,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & FormProps;\r\n\r\nconst TCPConnectionForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"address\">Scheduler URI</label>\r\n                <input type=\"text\" name=\"address\" value={values.address}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur} />\r\n                {errors.address && touched.address && errors.address}\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Connect</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<FormProps, FormValues>({\r\n    mapPropsToValues: () => ({\r\n        address: \"tcp://localhost:8786\",\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onSubmit } = formikBag.props;\r\n        onSubmit({\r\n            type: ClusterTypes.TCP,\r\n            ...values\r\n        });\r\n    }\r\n})(TCPConnectionForm);\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { DatasetFormParams, DirectoryListingDetails, FSPlace } from \"../messages\";\r\n\r\nexport enum ActionTypes {\r\n    LIST_DIRECTORY = 'BROWSER_LIST_DIRECTORY',\r\n    LIST_FULL_PATH = 'BROWSER_LIST_DIRECTORY_FULL',\r\n    DIRECTORY_LISTING = 'BROWSER_DIRECTORY_LISTING',\r\n    DETECT_PARAMS = 'BROWSER_DETECT_PARAMS',\r\n    PARAMS_DETECTED = 'BROWSER_PARAMS_DETECTED',\r\n    ERROR = 'BROWSER_ERROR',\r\n    OPEN = 'BROWSER_OPEN',\r\n    CANCEL = 'BROWSER_CANCEL',\r\n    SELECT = 'BROWSER_SELECT',\r\n    SELECT_FULL_PATH = 'BROWSER_SELECT_FULL_PATH',\r\n}\r\n\r\nexport const Actions = {\r\n    list: (path: string, name?: string) => createAction(ActionTypes.LIST_DIRECTORY, { path, name }),\r\n    dirListing: (path: string, dirs: DirectoryListingDetails[], files: DirectoryListingDetails[], drives: string[], places: FSPlace[]) => createAction(ActionTypes.DIRECTORY_LISTING, { path, dirs, files, drives, places }),\r\n    open: () => createAction(ActionTypes.OPEN),\r\n    cancel: () => createAction(ActionTypes.CANCEL),\r\n    select: (path: string, name: string) => createAction(ActionTypes.SELECT, { path, name }),\r\n    selectFullPath: (path: string) => createAction(ActionTypes.SELECT_FULL_PATH, { path }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n    detectParams: (path: string) => createAction(ActionTypes.DETECT_PARAMS, { path }),\r\n    paramsDetected: (path: string, params: DatasetFormParams) => createAction(ActionTypes.PARAMS_DETECTED, { path, params }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","\r\nimport * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dropdown, DropdownProps, Segment } from \"semantic-ui-react\";\r\nimport * as clusterActions from \"../../cluster/actions\";\r\nimport { getEnumValues } from \"../../helpers\";\r\nimport { ClusterTypeMetadata, ClusterTypes, ConnectRequestParams } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport LocalConnectionForm from \"./LocalConnectionForm\";\r\nimport TCPConnectionForm from \"./TCPConnectionForm\";\r\n\r\n\r\nconst mapDispatchToProps = {\r\n    connectToCluster: clusterActions.Actions.connect,\r\n};\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        config: state.config,\r\n    }\r\n}\r\n\r\ntype MergedProps = DispatchProps<typeof mapDispatchToProps> & ReturnType<typeof mapStateToProps>;\r\n\r\nconst clusterTypeKeys = getEnumValues(ClusterTypes);\r\nconst clusterTypeOptions = clusterTypeKeys.map(t => ({\r\n    text: ClusterTypeMetadata[ClusterTypes[t]].label,\r\n    value: ClusterTypes[t],\r\n}));\r\n\r\ninterface ConnectionParamsState {\r\n    clusterType: ClusterTypes\r\n}\r\n\r\nclass ClusterConnectionForm extends React.Component<MergedProps, ConnectionParamsState> {\r\n    public state = {\r\n        clusterType: ClusterTypes.LOCAL,\r\n    }\r\n\r\n    public setType = (type: ClusterTypes) => {\r\n        this.setState({\r\n            clusterType: type,\r\n        });\r\n    }\r\n\r\n    public handleChange = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        const value = data.value as ClusterTypes;\r\n        this.setType(value);\r\n    }\r\n\r\n    public handleSubmit = (params: ConnectRequestParams) => {\r\n        this.props.connectToCluster(params);\r\n    }\r\n\r\n    public renderForm() {\r\n        const { clusterType } = this.state;\r\n        const { config } = this.props;\r\n\r\n        switch (clusterType) {\r\n            case ClusterTypes.LOCAL: {\r\n                return <LocalConnectionForm config={config} onSubmit={this.handleSubmit} />\r\n            }\r\n            case ClusterTypes.TCP: {\r\n                return <TCPConnectionForm onSubmit={this.handleSubmit} />\r\n            }\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <>\r\n                <div>\r\n                    <Dropdown\r\n                        inline={true}\r\n                        options={clusterTypeOptions}\r\n                        value={this.state.clusterType}\r\n                        onChange={this.handleChange}\r\n                    />\r\n                </div>\r\n                <Segment>\r\n                    {this.renderForm()}\r\n                </Segment>\r\n            </>\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ClusterConnectionForm);","import * as React from 'react';\r\nimport { Icon, Message } from 'semantic-ui-react';\r\n\r\ninterface ChannelConnectingProps {\r\n    msg: string,\r\n}\r\n\r\nconst ChannelConnecting: React.SFC<ChannelConnectingProps> = ({ msg }) => (\r\n    <Message icon={true}>\r\n        <Icon name='cog' loading={true} />\r\n        <Message.Content>\r\n            <Message.Header>Connecting to LiberTEM</Message.Header>\r\n            {msg}\r\n        </Message.Content>\r\n    </Message>\r\n)\r\n\r\nexport default ChannelConnecting;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport ClusterConnectionForm from \"../../cluster/components/ClusterConnectionForm\";\r\nimport { RootReducer } from \"../../store\";\r\nimport ChannelConnecting from \"./ChannelConnecting\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        channelStatus: state.channelStatus,\r\n        clusterConnection: state.clusterConnection,\r\n        haveConfig: state.config.haveConfig,\r\n    }\r\n}\r\n\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst messages = {\r\n    waiting: \"Waiting...\",\r\n    connecting: \"Connecting...\",\r\n}\r\n\r\nconst clusterMessages = {\r\n    connected: \"Connected, waiting for initial state...\",\r\n    unknown: \"Connected, fetching cluster status...\",\r\n}\r\n\r\nconst ChannelStatus: React.SFC<MergedProps> = ({ haveConfig, children, channelStatus, clusterConnection }) => {\r\n    switch (channelStatus.status) {\r\n        case \"waiting\":\r\n        case \"connecting\": {\r\n            return <ChannelConnecting msg={messages[channelStatus.status]} />;\r\n        }\r\n        case \"connected\": {\r\n            if (!haveConfig) {\r\n                return <ChannelConnecting msg=\"waiting for configuration...\" />;\r\n            }\r\n            if (clusterConnection.status === \"disconnected\") {\r\n                return <ClusterConnectionForm />\r\n            } else if (clusterConnection.status === \"connected\") {\r\n                return <ChannelConnecting msg={clusterMessages.connected} />;\r\n            } else if (clusterConnection.status === \"unknown\") {\r\n                return <ChannelConnecting msg={clusterMessages.unknown} />;\r\n            }\r\n        }\r\n    }\r\n    return <>{children}</>;\r\n}\r\n\r\nexport default connect(mapStateToProps)(ChannelStatus);","import * as React from \"react\";\r\nimport { Icon, SemanticICONS } from \"semantic-ui-react\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\n\r\n\r\ninterface FileBrowserEntryProps {\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n    onClick?: () => void,\r\n    icon?: SemanticICONS,\r\n}\r\n\r\ninterface TimeStampProps {\r\n    ts: number,\r\n}\r\n\r\nexport const TimeStamp: React.SFC<TimeStampProps> = ({ ts }) => {\r\n    const date = new Date(ts * 1000);\r\n    const fmtDate = date.toLocaleDateString();\r\n    const fmtTime = date.toLocaleTimeString();\r\n    const title = `${fmtDate} ${fmtTime}`;\r\n    return (\r\n        <div style={{ display: \"flex\", whiteSpace: \"nowrap\" }} title={title}>\r\n            <div style={{ width: \"50%\", marginRight: \"10px\" }}>{fmtDate}</div>\r\n            <div style={{ width: \"45%\" }}>{fmtTime}</div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// adapted from https://stackoverflow.com/a/14919494/540644\r\nfunction humanFileSize(bytes: number, si: boolean = false) {\r\n    const thresh = si ? 1000 : 1024;\r\n    if (Math.abs(bytes) < thresh) {\r\n        return {\r\n            size: bytes,\r\n            unit: 'B',\r\n        }\r\n    }\r\n    const units = si\r\n        ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n        : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\r\n    let u = -1;\r\n    do {\r\n        bytes /= thresh;\r\n        ++u;\r\n    } while (Math.abs(bytes) >= thresh && u < units.length - 1);\r\n\r\n    return {\r\n        size: bytes.toFixed(1),\r\n        unit: units[u],\r\n    }\r\n}\r\n\r\ninterface FileSizeProps {\r\n    size: number,\r\n    si?: boolean,\r\n}\r\n\r\nexport const FileSize: React.SFC<FileSizeProps> = ({ size, si }) => {\r\n    const fmtSize = humanFileSize(size, si)\r\n    return (\r\n        <div style={{ textAlign: \"right\" }}>\r\n            {fmtSize.size} {fmtSize.unit}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const Cell: React.SFC<{ title?: string }> = ({ children, title }) => {\r\n    const styles: React.CSSProperties = {\r\n        whiteSpace: \"nowrap\",\r\n        overflow: \"hidden\",\r\n        textOverflow: \"ellipsis\",\r\n        marginRight: \"10px\",\r\n    }\r\n    return (\r\n        <div style={styles} title={title}>{children}</div>\r\n    );\r\n}\r\n\r\n\r\nclass FileBrowserEntry extends React.Component<FileBrowserEntryProps> {\r\n    public onClick = (e: React.MouseEvent) => {\r\n        const { onClick } = this.props;\r\n        if (onClick) {\r\n            onClick();\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { details, style, icon } = this.props;\r\n        const myStyle: React.CSSProperties = {\r\n            cursor: \"pointer\",\r\n            ...style,\r\n        };\r\n\r\n        const tsStyles: React.CSSProperties = {\r\n            textAlign: \"right\",\r\n        };\r\n\r\n        return (\r\n            <div onClick={this.onClick} style={myStyle}>\r\n                <div style={{ display: \"flex\", paddingRight: \"10px\" }}>\r\n                    <div style={{ width: \"20%\", flexGrow: 1 }}>\r\n                        <Cell title={details.name}>\r\n                            {icon && <Icon name={icon} />}\r\n                            {details.name}\r\n                        </Cell>\r\n                    </div>\r\n                    <div style={{ width: \"10%\" }}><Cell><FileSize size={details.size} si={false} /></Cell></div>\r\n                    <div style={{ width: \"10%\" }}><Cell>{details.owner}</Cell></div>\r\n                    <div style={{ width: \"18%\", ...tsStyles }}>\r\n                        <Cell><TimeStamp ts={details.ctime} /></Cell>\r\n                    </div>\r\n                    <div style={{ width: \"18%\", ...tsStyles }}>\r\n                        <Cell><TimeStamp ts={details.mtime} /></Cell>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default FileBrowserEntry;","import * as React from \"react\";\r\nimport { Cell } from \"./FileBrowserEntry\";\r\n\r\nconst FileBrowserHeader: React.SFC = () => {\r\n    const alignRight: React.CSSProperties = {\r\n        textAlign: \"right\",\r\n    };\r\n\r\n    // ugly hack: padding-right to compensate for scrollbar size\r\n    return (\r\n        <div style={{ paddingRight: \"20px\", paddingBottom: \"10px\" }}>\r\n            <div style={{ display: \"flex\" }}>\r\n                <div style={{ width: \"20%\", flexGrow: 1 }}>\r\n                    <Cell>Name</Cell>\r\n                </div>\r\n                <div style={{ width: \"10%\", ...alignRight }}>\r\n                    <Cell>Size</Cell>\r\n                </div>\r\n                <div style={{ width: \"10%\" }}>\r\n                    <Cell>Owner</Cell>\r\n                </div>\r\n                <div style={{ width: \"18%\", ...alignRight }}>\r\n                    <Cell>Created</Cell>\r\n                </div>\r\n                <div style={{ width: \"18%\", ...alignRight }}>\r\n                    <Cell>Modified</Cell>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FileBrowserHeader;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserEntry from \"./FileBrowserEntry\";\r\n\r\ninterface FileEntryProps {\r\n    path: string,\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: FileEntryProps) => {\r\n    return {\r\n        select: () => dispatch(browserActions.Actions.select(ownProps.path, ownProps.details.name)),\r\n    };\r\n}\r\n\r\ntype MergedProps = FileEntryProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nclass FileEntry extends React.Component<MergedProps> {\r\n    public render() {\r\n        const { details, style, select } = this.props;\r\n\r\n        return (\r\n            <FileBrowserEntry onClick={select} style={style} details={details}\r\n                icon=\"file outline\" />\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(FileEntry);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserEntry from \"./FileBrowserEntry\";\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: FolderEntryProps) => {\r\n    return {\r\n        list: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.path, ownProps.details.name));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n    };\r\n}\r\n\r\ninterface FolderEntryProps {\r\n    path: string,\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n    onChange: () => void,\r\n}\r\n\r\ntype MergedProps = FolderEntryProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst FolderEntry: React.SFC<MergedProps> = ({ list, details, style, onChange }) => {\r\n    return (\r\n        <FileBrowserEntry onClick={list} style={style} details={details} icon=\"folder\" />\r\n    )\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(FolderEntry);\r\n","import * as React from 'react';\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from 'redux';\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport * as browserActions from '../actions';\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DropdownItemProps) => {\r\n    return {\r\n        list: () => {\r\n            if (ownProps.value !== undefined) {\r\n                dispatch(browserActions.Actions.list(ownProps.value.toString()));\r\n                window.setTimeout(() => ownProps.onChange(), 0);\r\n            }\r\n        },\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapDispatchToProps> & DropdownItemProps & {\r\n    onChange: () => void,\r\n};\r\n\r\nconst PathDropDownItem: React.SFC<MergedProps> = ({ list, ...props }) => {\r\n    const newProps = {\r\n        onClick: list,\r\n        ...props,\r\n    }\r\n    return <Dropdown.Item {...newProps} />;\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(PathDropDownItem);","import { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Form, Input } from \"semantic-ui-react\";\r\n\r\ninterface FormValues {\r\n    path: string,\r\n}\r\n\r\ninterface PathInputProps {\r\n    onChange: (path: string) => void,\r\n    initialPath: string,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & PathInputProps;\r\n\r\nconst PathInput: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit} style={{ flexGrow: 1 }}>\r\n            <Form.Field>\r\n                <Input autoComplete=\"off\" onBlur={handleBlur} onChange={handleChange} value={values.path} name=\"path\" />\r\n            </Form.Field>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<PathInputProps, FormValues>({\r\n    mapPropsToValues: ({ initialPath }) => ({\r\n        path: initialPath,\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onChange } = formikBag.props;\r\n        onChange(values.path);\r\n    },\r\n    enableReinitialize: true,\r\n})(PathInput);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport { DatasetTypes } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\n\r\n\r\ntype DropdownOptions = Array<{\r\n    text: string,\r\n    value: {\r\n        type: DatasetTypes,\r\n        path: string,\r\n    },\r\n}>;\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        lastOpened: state.config.lastOpened,\r\n        fileHistory: state.config.fileHistory,\r\n        separator: state.config.separator,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => {\r\n    return {\r\n        select: (path: string) => dispatch(browserActions.Actions.selectFullPath(path)),\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst RecentFiles: React.SFC<MergedProps> = ({ lastOpened, fileHistory, select }) => {\r\n\r\n    const recentFiles: DropdownOptions = fileHistory.filter((path: string) => lastOpened[path]).map((path: string) => {\r\n        const item = lastOpened[path];\r\n        return {\r\n            text: item.path,\r\n            value: {\r\n                type: item.type,\r\n                path: item.path,\r\n            },\r\n        };\r\n    });\r\n\r\n    const onClick = (e: React.MouseEvent<HTMLDivElement>, data: DropdownItemProps) => data.value && select(data.value.toString())\r\n\r\n    return (\r\n        <Dropdown item={true} text=\"Recent\" floating={true}>\r\n            <Dropdown.Menu>\r\n                <Dropdown.Header content=\"recent datasets\" />\r\n                {recentFiles.map((option, idx) => (\r\n                    <Dropdown.Item key={idx} value={option.value.path} content={option.text} onClick={onClick} />\r\n                ))}\r\n            </Dropdown.Menu>\r\n        </Dropdown>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(RecentFiles);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Dropdown, Menu } from \"semantic-ui-react\";\r\nimport * as browserActions from '../actions';\r\nimport { FSPlaces } from \"../types\";\r\nimport PathDropDownItem from \"./PathDropDownItem\";\r\nimport PathInput from \"./PathInput\";\r\nimport RecentFiles from \"./RecentFiles\";\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: PathBarProps) => {\r\n    return {\r\n        refresh: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.currentPath));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n        handleInputChange: (path: string) => {\r\n            dispatch(browserActions.Actions.list(path));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n        goUp: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.currentPath, '..'));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n    };\r\n}\r\n\r\ninterface PathBarProps {\r\n    currentPath: string,\r\n    onChange: () => void,\r\n    drives: string[],\r\n    places: FSPlaces,\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapDispatchToProps> & PathBarProps;\r\n\r\nconst PathBar: React.SFC<MergedProps> = ({ currentPath, drives, places, onChange, refresh, goUp, handleInputChange }) => {\r\n    const driveOptions = drives.map((path) => ({ key: path, text: path }));\r\n    const placeOptions = Object.keys(places).map((key) => ({ key: places[key].path, text: places[key].title }))\r\n    return (\r\n        <Menu>\r\n            <RecentFiles />\r\n            <Dropdown text=\"Go to...\" floating={true} item={true}>\r\n                <Dropdown.Menu>\r\n                    <Dropdown.Header content=\"Drives\" />\r\n                    {driveOptions.map((option) => {\r\n                        return <PathDropDownItem key={option.key} value={option.key} content={option.text} onChange={onChange} />\r\n                    })}\r\n                    <Dropdown.Header content=\"Places\" />\r\n                    {placeOptions.map((option) => {\r\n                        return <PathDropDownItem key={option.key} value={option.key} content={option.text} onChange={onChange} />\r\n                    })}\r\n                </Dropdown.Menu>\r\n            </Dropdown>\r\n            <Menu.Item icon=\"arrow up\" onClick={goUp} />\r\n            <Menu.Item style={{ flexGrow: 1 }}>\r\n                <PathInput onChange={handleInputChange} initialPath={currentPath} />\r\n            </Menu.Item>\r\n            <Menu.Item icon=\"refresh\" onClick={refresh} />\r\n        </Menu>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(PathBar);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { FixedSizeList as List } from \"react-window\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Button, Header, Segment } from \"semantic-ui-react\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserHeader from \"./FileBrowserHeader\";\r\nimport FileEntry from \"./FileEntry\";\r\nimport FolderEntry from \"./FolderEntry\";\r\nimport PathBar from \"./PathBar\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    const { browser } = state;\r\n    return {\r\n        files: browser.files,\r\n        dirs: browser.dirs,\r\n        path: browser.path,\r\n        drives: browser.drives,\r\n        places: browser.places,\r\n        isLoading: browser.isLoading,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => {\r\n    return {\r\n        cancel: () => dispatch(browserActions.Actions.cancel()),\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;\r\n\r\ninterface EntryFnArgs {\r\n    index: number,\r\n    style: object\r\n}\r\ntype EntryFn = (arg: EntryFnArgs) => void\r\n\r\nconst listRef = React.createRef<List>();\r\n\r\nconst scrollToTop = () => {\r\n    if (listRef.current === null) {\r\n        return;\r\n    }\r\n    listRef.current.scrollToItem(0);\r\n}\r\n\r\nfunction sortByKey<T extends object>(array: T[], getKey: (item: T) => any) {\r\n    return array.sort((a, b) => {\r\n        const x = getKey(a);\r\n        const y = getKey(b);\r\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n    });\r\n}\r\n\r\nconst FileBrowser: React.SFC<MergedProps> = ({ files, dirs, path, drives, places, cancel, isLoading }) => {\r\n    const getSortKey = (item: DirectoryListingDetails) => item.name.toLowerCase();\r\n    const dirEntries = sortByKey(dirs, getSortKey).map((dir) => (style: object) => <FolderEntry style={style} onChange={scrollToTop} path={path} details={dir} />);\r\n    const fileEntries = sortByKey(files, getSortKey).map((f) => ((style: object) => <FileEntry style={style} path={path} details={f} />));\r\n    const entries = dirEntries.concat(fileEntries);\r\n\r\n    const cellFn: EntryFn = ({ index, style }) => {\r\n        return entries[index](style)\r\n    }\r\n\r\n    let list = (\r\n        <List style={{ overflowY: \"scroll\" }} ref={listRef} height={300} width=\"100%\" itemCount={entries.length} itemSize={35}>\r\n            {cellFn}\r\n        </List>\r\n    );\r\n\r\n    if (isLoading) {\r\n        // FIXME: hardcoded height\r\n        list = (\r\n            <Segment loading={true} style={{ height: \"300px\" }} />\r\n        )\r\n    }\r\n\r\n    return (\r\n        <Segment.Group>\r\n            <Segment>\r\n                <Header as=\"h2\">Open dataset</Header>\r\n            </Segment>\r\n            <Segment>\r\n                <PathBar currentPath={path} drives={drives} places={places} onChange={scrollToTop} />\r\n            </Segment>\r\n            <Segment>\r\n                <FileBrowserHeader />\r\n                {list}\r\n            </Segment>\r\n            <Segment>\r\n                <Button onClick={cancel}>Cancel</Button>\r\n            </Segment>\r\n        </Segment.Group>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(FileBrowser);","\r\nexport interface JobResultType {\r\n    imageURL: string,\r\n    description: { title: string, desc: string },\r\n}\r\n\r\nexport enum JobRunning {\r\n    CREATING = 'CREATING',\r\n    RUNNING = 'RUNNING',\r\n    DONE = 'DONE',\r\n}\r\n\r\nexport enum JobStatus {\r\n    CREATING = 'CREATING',\r\n    IN_PROGRESS = 'IN_PROGRESS',\r\n    CANCELLED = 'CANCELLED',\r\n    SUCCESS = 'SUCCESS',\r\n    ERROR = 'ERROR',\r\n}\r\n\r\nexport interface JobStateCommon {\r\n    id: string,\r\n    dataset: string,\r\n    status: JobStatus,\r\n    startTimestamp: number,\r\n    results: JobResultType[],\r\n}\r\n\r\nexport type JobStateStart = JobStateCommon & {\r\n    running: JobRunning.CREATING | JobRunning.RUNNING,\r\n}\r\n\r\nexport type JobStateDone = JobStateCommon & {\r\n    running: JobRunning.DONE,\r\n    endTimestamp: number,\r\n}\r\n\r\nexport type JobState = JobStateStart | JobStateDone;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Button, Icon } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowser from \"./FileBrowser\";\r\n\r\nexport const mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        isOpen: state.browser.isOpen,\r\n    }\r\n}\r\n\r\nexport const mapDispatchToProps = {\r\n    open: browserActions.Actions.open,\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & DispatchProps<typeof mapDispatchToProps>;\r\n\r\nconst BrowserWrapper: React.SFC<MergedProps> = ({ isOpen, open }) => {\r\n    if (!isOpen) {\r\n        return (\r\n            <Button icon={true} labelPosition=\"left\" onClick={open}>\r\n                <Icon name='add' />\r\n                Browse\r\n            </Button>\r\n        );\r\n    }\r\n    return (\r\n        <FileBrowser />\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(BrowserWrapper)","import * as React from \"react\";\r\nimport { Icon } from \"semantic-ui-react\";\r\n\r\nconst BusySpinner: React.SFC = () => {\r\n    const styles: React.CSSProperties = {\r\n        margin: 0,\r\n        padding: 0,\r\n        position: \"absolute\",\r\n        bottom: \"10px\",\r\n        right: \"10px\",\r\n        color: \"white\",\r\n        opacity: 0.7,\r\n        filter: \"drop-shadow(0 0 3px #000)\",\r\n    };\r\n    return (\r\n        <Icon name=\"cog\" loading={true} style={styles} />\r\n    )\r\n}\r\n\r\nexport default BusySpinner;","import * as React from \"react\";\r\nimport BusySpinner from \"./BusySpinner\";\r\n\r\ninterface BusyWrapperProps {\r\n    busy: boolean,\r\n}\r\n\r\nconst BusyWrapper: React.SFC<BusyWrapperProps> = ({ children, busy }) => {\r\n    const styles: React.CSSProperties = {\r\n        position: \"relative\",\r\n    };\r\n    return (\r\n        <div style={styles}>\r\n            {children}\r\n            {busy && <BusySpinner />}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BusyWrapper;","import * as React from \"react\";\r\nimport { DraggableHandle } from \"./DraggableHandle\";\r\nimport { HandleRenderFunction } from \"./types\";\r\n\r\nexport interface HandleParentProps {\r\n    width: number,\r\n    height: number,\r\n    onKeyboardEvent?: React.KeyboardEventHandler<SVGElement>,\r\n    handles: HandleRenderFunction[],\r\n}\r\n\r\nexport class HandleParent extends React.Component<HandleParentProps> {\r\n    public currentHandle: DraggableHandle | undefined;\r\n\r\n    public handleDragStart = (h: DraggableHandle): void => {\r\n        this.currentHandle = h;\r\n    }\r\n\r\n    public handleDrop = (): void => {\r\n        this.currentHandle = undefined;\r\n    }\r\n\r\n    public handleMouseMove = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            return this.currentHandle.externalMouseMove(e);\r\n        }\r\n    }\r\n\r\n    public handleMouseLeave = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            this.currentHandle.externalLeave(e);\r\n        }\r\n    }\r\n\r\n    public handleMouseUp = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            this.currentHandle.externalMouseUp(e);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { width, height } = this.props;\r\n        const styles = {\r\n            outline: \"1px dashed black\"\r\n        }\r\n        return (\r\n            <g\r\n                onMouseMove={this.handleMouseMove}\r\n                onMouseLeave={this.handleMouseLeave}\r\n                onMouseUp={this.handleMouseUp}\r\n                onKeyDown={this.props.onKeyboardEvent}\r\n                style={styles}\r\n                tabIndex={0}\r\n            >\r\n                <rect style={{ fill: \"transparent\" }}\r\n                    x={0} y={0} width={width} height={height}\r\n                />\r\n                {this.renderHandles()}\r\n            </g>\r\n        );\r\n    }\r\n\r\n    public renderHandles() {\r\n        const { handles, onKeyboardEvent } = this.props;\r\n        // we need to inform the handle when there are move/up/leave events\r\n        // on this parent element, for which we need to know the current handle.\r\n        // so we pass the handle a dragstart/drop function and kindly ask it\r\n        // to call us if it starts to be dragged or is dropped.\r\n        return handles.map((h, i) => {\r\n            const elem = h(this.handleDragStart, this.handleDrop, onKeyboardEvent);\r\n            if (React.isValidElement(elem)) {\r\n                return React.cloneElement(elem, { key: i });\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n}\r\n\r\nexport default HandleParent;","import * as React from \"react\";\r\nimport { JobState } from \"../types\";\r\nimport styles from \"./ResultImage.module.css\";\r\n\r\ninterface ResultImageProps {\r\n    job: JobState,\r\n    idx: number,\r\n    width: number,\r\n    height: number,\r\n}\r\n\r\nconst ResultImage: React.SFC<ResultImageProps> = ({ job, idx, width, height }) => {\r\n    const result = job.results[idx];\r\n    if (result === undefined) {\r\n        return (\r\n            <svg className={styles.fallback} width={width} height={height} viewBox={`0 0 ${width} ${height}`} key={-1} />\r\n        )\r\n    }\r\n    return (\r\n        <image className={styles.default} xlinkHref={result.imageURL} width={width} height={height} />\r\n    );\r\n}\r\n\r\nexport default ResultImage;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport styled from 'styled-components';\r\nimport { AnalysisState } from \"../../analysis/types\";\r\nimport { DatasetState } from \"../../messages\";\r\nimport BusyWrapper from \"../../widgets/BusyWrapper\";\r\nimport HandleParent from \"../../widgets/HandleParent\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport { JobRunning, JobState } from \"../types\";\r\nimport ResultImage from \"./ResultImage\";\r\n\r\ninterface ResultProps {\r\n    width: number,\r\n    height: number,\r\n    job: JobState,\r\n    dataset: DatasetState,\r\n    analysis: AnalysisState,\r\n    extraHandles?: HandleRenderFunction,\r\n    extraWidgets?: React.ReactElement<SVGElement>,\r\n    idx: number,\r\n    jobIndex: number,\r\n}\r\n\r\nconst ResultWrapper = styled.svg`\r\n    display: block;\r\n    border: 1px solid black;\r\n    width: 100%;\r\n    height: auto;\r\n`;\r\n\r\ntype MergedProps = ResultProps;\r\n\r\nclass Result extends React.Component<MergedProps> {\r\n    public renderHandles() {\r\n        const { width, height, extraHandles } = this.props;\r\n        let handles: HandleRenderFunction[] = [];\r\n        if (extraHandles) {\r\n            handles = [...handles, extraHandles];\r\n        }\r\n\r\n        return (\r\n            <HandleParent width={width} height={height} handles={handles} />\r\n        )\r\n    }\r\n\r\n    public render() {\r\n        const { job, idx, width, height, extraWidgets } = this.props;\r\n        const busy = job.running !== JobRunning.DONE;\r\n\r\n        return (\r\n            <BusyWrapper busy={busy}>\r\n                <ResultWrapper width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\r\n                    <ResultImage job={job} idx={idx} width={width} height={height} />\r\n                    {extraWidgets}\r\n                    {this.renderHandles()}\r\n                </ResultWrapper>\r\n            </BusyWrapper>\r\n        );\r\n    }\r\n};\r\n\r\nexport default connect(null, null)(Result);","import styled from 'styled-components';\r\n\r\n\r\nconst Selectors = styled.div`\r\n    display: flex;\r\n    & > * {\r\n        margin-right: 10px;\r\n    }\r\n`;\r\n\r\n\r\n\r\nexport default Selectors;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport { JobRunning, JobState } from \"../types\";\r\nimport Result from \"./Result\";\r\nimport Selectors from \"./Selectors\";\r\n\r\ninterface ResultListProps {\r\n    width: number,\r\n    height: number,\r\n    selectors?: React.ReactElement<any>,\r\n    extraHandles?: HandleRenderFunction,\r\n    extraWidgets?: React.ReactElement<SVGElement>,\r\n    subtitle?: React.ReactNode,\r\n}\r\n\r\ninterface ExternalResultListProps {\r\n    analysis: string,\r\n    jobIndex: number,\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer, ownProps: ExternalResultListProps) => {\r\n    const analysis = state.analyses.byId[ownProps.analysis];\r\n    const jobId = analysis.jobs[ownProps.jobIndex];\r\n    const job = jobId ? state.jobs.byId[jobId] : undefined;\r\n    const ds = job ? state.datasets.byId[job.dataset] : undefined;\r\n\r\n    return {\r\n        currentJob: job,\r\n        jobsById: state.jobs.byId,\r\n        analysis,\r\n        dataset: ds,\r\n        jobIndex: ownProps.jobIndex,\r\n    };\r\n};\r\n\r\ntype MergedProps = ResultListProps & ReturnType<typeof mapStateToProps>;\r\n\r\ninterface ResultListState {\r\n    selectedChannel: number,\r\n}\r\n\r\nclass ResultList extends React.Component<MergedProps, ResultListState> {\r\n    public state: ResultListState = { selectedChannel: 0 };\r\n\r\n    public selectChannel = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        const value = data.value as number;\r\n        this.setState({ selectedChannel: value });\r\n    }\r\n\r\n    public getJob = () => {\r\n        const { currentJob, analysis, jobsById, jobIndex } = this.props;\r\n        if (!currentJob) {\r\n            return;\r\n        }\r\n        if (currentJob.results.length > 0) {\r\n            return currentJob;\r\n        }\r\n        const history = analysis.jobHistory[jobIndex];\r\n\r\n        if (history === undefined) {\r\n            return;\r\n        }\r\n        for (const tmpJobId of history) {\r\n            const tmpJob = jobsById[tmpJobId];\r\n            if (tmpJob.results.length > 0) {\r\n                return tmpJob;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    public render() {\r\n        const {\r\n            selectors, analysis, dataset, children, width, height, jobIndex,\r\n            extraHandles, extraWidgets, subtitle,\r\n        } = this.props;\r\n        let msg;\r\n        let currentResult = (\r\n            // placeholder:\r\n            <svg style={{ display: \"block\", border: \"1px solid black\", width: \"100%\", height: \"auto\" }} width={width} height={height} viewBox={`0 0 ${width} ${height}`} key={-1} />\r\n        );\r\n        const job = this.getJob();\r\n        if (!job || !dataset) {\r\n            msg = <>&nbsp;</>;\r\n        } else {\r\n            currentResult = (\r\n                <Result analysis={analysis} job={job} dataset={dataset}\r\n                    extraHandles={extraHandles}\r\n                    extraWidgets={extraWidgets}\r\n                    width={width} height={height}\r\n                    jobIndex={jobIndex}\r\n                    idx={this.state.selectedChannel}\r\n                />\r\n            );\r\n            if (job.running === JobRunning.DONE) {\r\n                const dt = (job.endTimestamp - job.startTimestamp) / 1000;\r\n                msg = <>Analysis done in {dt.toFixed(3)}s</>;\r\n            } else {\r\n                msg = <>Analysis running...</>;\r\n            }\r\n        }\r\n        return (\r\n            <div>\r\n                {currentResult}\r\n                {children}\r\n                <Selectors>\r\n                    <ResultImageSelector job={job} handleChange={this.selectChannel} selectedImg={this.state.selectedChannel} />\r\n                    {selectors}\r\n                </Selectors>\r\n                <p>{subtitle} {msg}</p>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface ImageSelectorProps {\r\n    job?: JobState,\r\n    handleChange: (e: React.SyntheticEvent, data: DropdownProps) => void,\r\n    selectedImg: number,\r\n}\r\n\r\nconst ResultImageSelector: React.SFC<ImageSelectorProps> = ({ job, handleChange, selectedImg }) => {\r\n    if (!job) {\r\n        return null;\r\n    }\r\n    const availableImages = job.results.map((result, idx) => ({ text: result.description.title, value: idx }));\r\n    return (\r\n        <>\r\n            <div>\r\n                Channel:{' '}\r\n                <Dropdown\r\n                    inline={true}\r\n                    options={availableImages}\r\n                    value={selectedImg}\r\n                    onChange={handleChange}\r\n                />\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps)(ResultList);\r\n","export const inRectConstraint = (width: number, height: number) => (p: Point2D) => {\r\n    return {\r\n        x: Math.max(0, Math.min(width - 1, p.x)),\r\n        y: Math.max(0, Math.min(height - 1, p.y)),\r\n    }\r\n}\r\n\r\nexport const dist = (cx: number, cy: number, x: number, y: number) => {\r\n    const dx = cx - x;\r\n    const dy = cy - y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nexport const cbToRadius = (cx: number, cy: number, cb: ((r: number) => void) | undefined) => (x: number, y: number) => cb && cb(dist(cx, cy, x, y))\r\n\r\nexport const keepOnCY = (cy: number) => (p: Point2D) => {\r\n    return {\r\n        x: p.x,\r\n        y: cy,\r\n    }\r\n}\r\n\r\nexport const keepXLargerThan = (otherX: number) => (p: Point2D) => {\r\n    return {\r\n        x: otherX > p.x ? otherX : p.x,\r\n        y: p.y,\r\n    }\r\n}\r\n\r\nexport const keepXSmallerThan = (otherX: number) => (p: Point2D) => {\r\n    return {\r\n        x: otherX < p.x ? otherX : p.x,\r\n        y: p.y,\r\n    }\r\n}\r\n\r\nexport const riConstraint = (outerPos: number, cy: number) => (p: Point2D) => {\r\n    return keepXLargerThan(outerPos)(\r\n        keepOnCY(cy)(p)\r\n    );\r\n}\r\n\r\nexport const roConstraints = (innerPos: number, cy: number) => (p: Point2D) => {\r\n    return keepXSmallerThan(innerPos)(\r\n        keepOnCY(cy)(p)\r\n    );\r\n}","import { CSSProperties } from \"react\";\r\n\r\nexport const defaultMaskStyles = (imageWidth: number): CSSProperties => ({\r\n    fillOpacity: 0.3,\r\n    fill: \"red\",\r\n    strokeOpacity: 0.7,\r\n    stroke: \"red\",\r\n    strokeWidth: imageWidth / 128 / 3,\r\n});","import * as React from \"react\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface DiskProps {\r\n    imageWidth: number,\r\n    imageHeight: number,\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nconst Disk: React.SFC<DiskProps> = ({ imageWidth, imageHeight, cx, cy, r }) => {\r\n    return (\r\n        <circle cx={cx + .5} cy={cy + .5} r={r} style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Disk;","export type ModifyCoords = ((x: number, y: number) => ({ x: number, y: number }));\r\n\r\n/**\r\n * Call this function whenever a keyboard event happens. The keyboard event is then translated\r\n * to a coordinate transformation, which is passed to the update callback. The update callback is\r\n * only called if relevant keys were pressed (example: arrow keys).\r\n * \r\n * @param e keyboard event\r\n * @param update a callback to handle coordinate updates\r\n */\r\nexport const handleKeyEvent = (e: React.KeyboardEvent<SVGElement>, update: (fn: ModifyCoords) => void) => {\r\n    let delta = 1;\r\n    if (e.shiftKey) {\r\n        delta = 10;\r\n    }\r\n    switch (e.key) {\r\n        case \"ArrowUp\":\r\n            update((x: number, y: number) => ({ x, y: y - delta }));\r\n            break;\r\n        case \"ArrowDown\":\r\n            update((x: number, y: number) => ({ x, y: y + delta }));\r\n            break;\r\n        case \"ArrowLeft\":\r\n            update((x: number, y: number) => ({ x: x - delta, y }));\r\n            break;\r\n        case \"ArrowRight\":\r\n            update((x: number, y: number) => ({ x: x + delta, y }));\r\n            break;\r\n        default:\r\n            return;\r\n    }\r\n    e.preventDefault();\r\n}\r\n","import * as React from \"react\";\r\nimport styled from 'styled-components';\r\nimport { handleKeyEvent, ModifyCoords } from \"./kbdHandler\";\r\n\r\nexport type HandleProps = {\r\n    x: number,\r\n    y: number,\r\n    scale: number,\r\n    withCross?: boolean,\r\n    focusRef: React.RefObject<SVGGElement>,\r\n} & React.SVGProps<SVGGElement>;\r\n\r\nconst StyledCircle = styled.circle`\r\n    stroke: red;\r\n    stroke-width: 1;\r\n    fill: transparent;\r\n    g:focus > & {\r\n        stroke: lightgreen;\r\n    }\r\n`;\r\n\r\nconst Cross = styled.path`\r\n    stroke: red;\r\n    stroke-width: 1;\r\n    fill: transparent;\r\n    g:focus > & {\r\n        stroke: lightgreen;\r\n    }\r\n`;\r\n\r\nconst FocusGroup = styled.g`\r\n    &:focus { outline: none; }\r\n`;\r\n\r\nconst Handle: React.SFC<HandleProps> = ({ scale, x, y, withCross, focusRef, ...args }) => {\r\n    const r = 3;\r\n    // scaleMatrix is needed to set the origin of the scale\r\n    const scaleMatrix = `matrix(${scale}, 0, 0, ${scale}, ${x - scale * x}, ${y - scale * y})`;\r\n    const style: React.CSSProperties = { transform: scaleMatrix };\r\n    const crossSpec = `\r\n        M${x - 4 - r / 2} ${y} L ${x - r / 2} ${y} M${x + r / 2} ${y} L ${x + 4 + r / 2} ${y}\r\n        M${x} ${y - 4 - r / 2} L ${x} ${y - r / 2} M${x} ${y + r / 2} L ${x} ${y + 4 + r / 2}\r\n    `;\r\n    const cross = withCross ? <Cross d={crossSpec} style={style} /> : null;\r\n    return (\r\n        <FocusGroup {...args} ref={focusRef}>\r\n            <StyledCircle cx={x} cy={y} r={r} style={style} />\r\n            {cross}\r\n        </FocusGroup>\r\n    )\r\n}\r\n\r\nexport interface DraggableHandleProps {\r\n    x: number,\r\n    y: number,\r\n    withCross?: boolean,\r\n    imageWidth?: number,\r\n    onDragMove?: (x: number, y: number) => void,\r\n    parentOnDragStart: (h: DraggableHandle) => void,\r\n    parentOnDrop: (x: number, y: number) => void,\r\n    onKeyboardEvent?: (e: React.KeyboardEvent<SVGElement>) => void,\r\n    constraint?: (p: Point2D) => Point2D,\r\n}\r\n\r\nexport function getScalingFactor(elem: SVGElement): number {\r\n    const svg = elem.ownerSVGElement;\r\n    if (svg === null) {\r\n        throw new Error(\"no owner SVG element?\");\r\n    }\r\n    const inWidthAttr = svg.getAttribute(\"width\");\r\n    if (inWidthAttr === null) {\r\n        throw new Error(\"no width on SVG element?\");\r\n    }\r\n    const inWidth = +inWidthAttr;\r\n    const svgMeasurements = svg.getBoundingClientRect();\r\n    return svgMeasurements.width / inWidth;\r\n}\r\n\r\nfunction relativeCoords(e: React.MouseEvent, parent: SVGElement) {\r\n    const f = getScalingFactor(parent);\r\n    const parentPos = parent.getBoundingClientRect();\r\n    const res = {\r\n        x: (e.pageX - (parentPos.left + window.pageXOffset)) / f,\r\n        y: (e.pageY - (parentPos.top + window.pageYOffset)) / f,\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * stateful draggable handle, to be used as part of <svg/>\r\n */\r\nexport class DraggableHandle extends React.Component<DraggableHandleProps> {\r\n    public posRef: React.RefObject<SVGRectElement>;\r\n    public focusRef: React.RefObject<SVGGElement>;\r\n\r\n    public state = {\r\n        dragging: false,\r\n        drag: { x: 0, y: 0 },\r\n    }\r\n\r\n    constructor(props: DraggableHandleProps) {\r\n        super(props);\r\n        this.posRef = React.createRef<SVGRectElement>();\r\n        this.focusRef = React.createRef<SVGGElement>();\r\n    }\r\n\r\n    // mousemove event from outside (delegated from surrounding element)\r\n    public externalMouseMove = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.move(e);\r\n    }\r\n\r\n    // mouseleave event from outside (delegated from surrounding element)\r\n    public externalLeave = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.stopDrag(e);\r\n    }\r\n\r\n    // mouseup event from outside (delegated from surrounding element)\r\n    public externalMouseUp = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.stopDrag(e);\r\n    }\r\n\r\n    public applyConstraint = (p: Point2D) => {\r\n        const { constraint } = this.props;\r\n        if (constraint) {\r\n            return constraint(p);\r\n        } else {\r\n            return p;\r\n        }\r\n    }\r\n\r\n    public startDrag = (e: React.MouseEvent<SVGElement>): void => {\r\n        e.preventDefault();\r\n        const { parentOnDragStart } = this.props;\r\n        if (this.posRef.current) {\r\n            this.setState({\r\n                dragging: true,\r\n                drag: this.applyConstraint(relativeCoords(e, this.posRef.current)),\r\n            });\r\n            if (parentOnDragStart) {\r\n                parentOnDragStart(this);\r\n            }\r\n            if (this.focusRef.current && this.focusRef.current.focus) {\r\n                this.focusRef.current.focus();\r\n            }\r\n        } else {\r\n            throw new Error(\"startDrag without posRef\");\r\n        }\r\n    }\r\n\r\n    public move = (e: React.MouseEvent<SVGElement>): void => {\r\n        const { onDragMove } = this.props;\r\n        if (!this.state.dragging) {\r\n            return;\r\n        }\r\n        if (this.posRef.current) {\r\n            this.setState({\r\n                drag: this.applyConstraint(relativeCoords(e, this.posRef.current)),\r\n            }, () => {\r\n                if (onDragMove) {\r\n                    const constrained = this.applyConstraint(this.state.drag)\r\n                    onDragMove(constrained.x, constrained.y);\r\n                }\r\n            })\r\n        } else {\r\n            throw new Error(\"move without posRef\");\r\n        }\r\n    }\r\n\r\n    public stopDrag = (e: React.MouseEvent<SVGElement>): void => {\r\n        const { parentOnDrop } = this.props;\r\n        const { dragging, drag } = this.state;\r\n        if (!dragging) {\r\n            return;\r\n        }\r\n        this.setState({\r\n            dragging: false,\r\n        })\r\n        if (parentOnDrop) {\r\n            parentOnDrop(drag.x, drag.y);\r\n        }\r\n    }\r\n\r\n    public handleKeyDown = (e: React.KeyboardEvent<SVGElement>) => {\r\n        const update = (fn: ModifyCoords) => {\r\n            const { x, y, onDragMove } = this.props;\r\n            const newCoords = fn(x, y);\r\n            const constrained = this.applyConstraint(newCoords);\r\n            if (onDragMove) {\r\n                onDragMove(constrained.x, constrained.y);\r\n            }\r\n        }\r\n        handleKeyEvent(e, update);\r\n    }\r\n\r\n    public renderCommon(x: number, y: number) {\r\n        const { imageWidth } = this.props;\r\n        const scale = imageWidth === undefined ? 1 : imageWidth / 128;\r\n        // empty zero-size <rect> as relative position reference\r\n        return (\r\n            <g>\r\n                <rect\r\n                    style={{ visibility: \"hidden\" }}\r\n                    ref={this.posRef}\r\n                    x={0} y={0} width={0} height={0}\r\n                />\r\n                <Handle scale={scale} x={x + .5} y={y + .5} withCross={this.props.withCross}\r\n                    focusRef={this.focusRef}\r\n                    onMouseUp={this.stopDrag}\r\n                    onMouseMove={this.move}\r\n                    onMouseDown={this.startDrag}\r\n                    onKeyDown={this.handleKeyDown}\r\n                    tabIndex={0}\r\n                />\r\n            </g>\r\n        );\r\n    }\r\n\r\n    public renderDragging() {\r\n        const { x, y } = this.state.drag;\r\n        return this.renderCommon(x, y);\r\n    }\r\n\r\n    public render() {\r\n        const { x, y } = this.props;\r\n        // either render from state (when dragging) or from props\r\n        if (this.state.dragging) {\r\n            return this.renderDragging();\r\n        } else {\r\n            return this.renderCommon(x, y);\r\n        }\r\n    }\r\n}\r\n\r\nexport default DraggableHandle;\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { AnalysisDetails, AnalysisTypes } from \"../messages\";\r\nimport { AnalysisState } from \"./types\";\r\n\r\n\r\nexport enum ActionTypes {\r\n    CREATE = 'ANALYSIS_CREATE',\r\n    CREATED = 'ANALYSIS_CREATED',\r\n    PREPARE_RUN = 'ANALYSIS_PREPARE_RUN',\r\n    RUN = 'ANALYSIS_RUN',\r\n    RUNNING = 'ANALYSIS_RUNNING',\r\n    REMOVE = 'ANALYSIS_REMOVE',\r\n    REMOVED = 'ANALYSIS_REMOVED',\r\n    ERROR = 'ANALYSIS_ERROR',\r\n}\r\n\r\nexport const Actions = {\r\n    create: (dataset: string, analysisType: AnalysisTypes) => createAction(ActionTypes.CREATE, { dataset, analysisType }),\r\n    created: (analysis: AnalysisState) => createAction(ActionTypes.CREATED, { analysis }),\r\n    prepareRun: (id: string, jobIndex: number, job: string) => createAction(ActionTypes.PREPARE_RUN, { id, jobIndex, job }),\r\n    run: (id: string, jobIndex: number, parameters: AnalysisDetails) => createAction(ActionTypes.RUN, { id, jobIndex, parameters }),\r\n    running: (id: string, job: string, jobIndex: number) => createAction(ActionTypes.RUNNING, { id, job, jobIndex }),\r\n    remove: (id: string) => createAction(ActionTypes.REMOVE, { id }),\r\n    removed: (id: string) => createAction(ActionTypes.REMOVED, { id }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n\r\nexport type ActionParts = {\r\n    [K in keyof typeof Actions]: ReturnType<typeof Actions[K]>\r\n}","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutTwoColProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    right: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutTwoColProps;\r\n\r\nconst AnalysisLayoutTwoCol: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, right,\r\n    toolbar,\r\n}) => {\r\n\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={2}>\r\n                    <Grid.Row>\r\n                        <Grid.Column>\r\n                            {left}\r\n                            <p>{subtitle}</p>\r\n                        </Grid.Column>\r\n                        <Grid.Column>\r\n                            {right}\r\n                        </Grid.Column>\r\n                    </Grid.Row>\r\n                </Grid>\r\n            </Segment>\r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutTwoCol","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisParameters, AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\n\r\nconst useFramePicker = ({\r\n    enabled, scanWidth, scanHeight, jobIndex, analysisId, cx, cy, setCx, setCy\r\n}: {\r\n    enabled: boolean, scanWidth: number, scanHeight: number,\r\n    jobIndex: number, analysisId: string,\r\n    cx: number, cy: number, setCx: (newCx: number) => void, setCy: (newCy: number) => void,\r\n}) => {\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            const params: AnalysisParameters = {\r\n                x: cx,\r\n                y: cy,\r\n            };\r\n\r\n            dispatch(analysisActions.Actions.run(analysisId, jobIndex, {\r\n                type: AnalysisTypes.PICK_FRAME,\r\n                parameters: params,\r\n            }))\r\n        }\r\n    }, [analysisId, cx, cy, enabled, jobIndex, dispatch]);\r\n\r\n    const onPickChange = (pickX: number, pickY: number) => {\r\n        const newX = Math.round(pickX);\r\n        const newY = Math.round(pickY);\r\n        if (cx === newX && cy === newY) {\r\n            return;\r\n        }\r\n        setCx(newX);\r\n        setCy(newY);\r\n    }\r\n\r\n    const renderPickHandle: HandleRenderFunction = (onDragStart, onDrop) => (\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            imageWidth={scanWidth}\r\n            onDragMove={onPickChange}\r\n            parentOnDragStart={onDragStart}\r\n            parentOnDrop={onDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n    )\r\n\r\n    return { coords: { cx, cy }, handles: renderPickHandle };\r\n}\r\n\r\nexport default useFramePicker;","import * as React from \"react\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\n\r\n\r\ntype ModeOptions = Array<{\r\n    text: string;\r\n    value: any;\r\n}>;\r\n\r\ninterface ModeSelectorProps {\r\n    modes: ModeOptions,\r\n    currentMode: any,\r\n    onModeChange: (mode: any) => void,\r\n    label: string,\r\n}\r\n\r\nconst ModeSelector: React.FunctionComponent<ModeSelectorProps> = ({\r\n    modes, currentMode, onModeChange, label\r\n}) => {\r\n\r\n    const onChange = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        onModeChange(data.value)\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div>\r\n                {label}:{' '}\r\n                <Dropdown\r\n                    inline={true}\r\n                    options={modes}\r\n                    value={currentMode}\r\n                    onChange={onChange}\r\n                />\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default ModeSelector;","import * as React from \"react\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface RectProps {\r\n    imageWidth: number,\r\n    imageHeight: number,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n}\r\n\r\nconst Rect: React.SFC<RectProps> = ({ imageWidth, imageHeight, x, y, width, height }) => {\r\n    let ymin: number;\r\n    let xmin: number;\r\n    if (height*width > 0) {\r\n    ymin = Math.min(y, y+height);\r\n    xmin = Math.min(x, x+width);}\r\n    else if (height > 0 && width < 0) \r\n    {ymin = y;\r\n    xmin = x+width;}\r\n    else \r\n    {ymin = y+height;\r\n    xmin = x;}\r\n    return (\r\n        <rect x={xmin + .5} y={ymin + .5} width={Math.abs(width)} height={Math.abs(height)} style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Rect;\r\n\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport { useDiskROI } from \"./DiskROI\";\r\nimport useFramePicker from \"./FramePicker\";\r\nimport ModeSelector from \"./ModeSelector\";\r\nimport { useRectROI } from \"./RectROI\";\r\nimport { useRoiPicker } from \"./RoiPicker\";\r\n\r\n\r\nexport enum DefaultModes {\r\n    SUM = \"SUM\",\r\n    SD = \"SD\",\r\n    PICK = \"PICK\",\r\n}\r\n\r\nexport enum DefaultRois {\r\n\r\n    ALL = \"ALL\",\r\n    DISK = \"DISK\",\r\n    RECT = \"RECT\",\r\n\r\n}\r\n\r\nconst useDefaultFrameView = ({\r\n    scanWidth, scanHeight, analysisId,\r\n}: {\r\n    scanWidth: number, scanHeight: number, analysisId: string,\r\n}) => {\r\n    const availableModes = [\r\n        {\r\n            text: \"Average\",\r\n            value: DefaultModes.SUM,\r\n        },\r\n        {\r\n            text: \"Standard Deviation\",\r\n            value: DefaultModes.SD,\r\n        },\r\n        {\r\n            text: \"Pick\",\r\n            value: DefaultModes.PICK,\r\n        },\r\n    ]\r\n\r\n    const availableRois = [\r\n        {\r\n            text: \"All\",\r\n            value: DefaultRois.ALL,\r\n        },\r\n        {\r\n            text: \"Disk\",\r\n            value: DefaultRois.DISK,\r\n        },\r\n        {\r\n            text: \"Rect\",\r\n            value: DefaultRois.RECT,\r\n        },\r\n    ]\r\n\r\n    const [frameMode, setMode] = useState(DefaultModes.SUM);\r\n    const [roi, setRoi] = useState(DefaultRois.ALL)\r\n\r\n    const frameModeSelector = <ModeSelector modes={availableModes} currentMode={frameMode} onModeChange={setMode} label=\"Mode\" />\r\n\r\n    let roiSelector = <ModeSelector modes={availableRois} currentMode={roi} onModeChange={setRoi} label=\"ROI\" />\r\n\r\n    if (frameMode === DefaultModes.PICK) {\r\n        roiSelector = <></>;\r\n    }\r\n\r\n    const [cx, setCx] = React.useState(Math.round(scanWidth / 2));\r\n    const [cy, setCy] = React.useState(Math.round(scanHeight / 2));\r\n\r\n    const { coords: pickCoords, handles: pickHandles } = useFramePicker({\r\n        enabled: frameMode === DefaultModes.PICK,\r\n        scanWidth, scanHeight,\r\n        jobIndex: 0,\r\n        analysisId,\r\n        cx, cy, setCx, setCy\r\n    });\r\n\r\n    const { rectRoiHandles, rectRoiWidgets, rectRoiParameters } = useRectROI({ scanHeight, scanWidth })\r\n    const { diskRoiHandles, diskRoiWidgets, diskRoiParameters } = useDiskROI({ scanHeight, scanWidth })\r\n\r\n    const nullHandles: HandleRenderFunction = (onDragStart, onDrop) => null\r\n    let handles = nullHandles;\r\n\r\n    let widgets;\r\n    let params = { roi: {} };\r\n    switch (roi) {\r\n        case DefaultRois.DISK:\r\n            handles = diskRoiHandles;\r\n            widgets = diskRoiWidgets;\r\n            params = diskRoiParameters;\r\n            break;\r\n        case DefaultRois.RECT:\r\n            handles = rectRoiHandles;\r\n            widgets = rectRoiWidgets;\r\n            params = rectRoiParameters;\r\n            break;\r\n    }\r\n\r\n    switch (frameMode) {\r\n        case DefaultModes.PICK:\r\n            handles = pickHandles;\r\n            widgets = undefined;\r\n            break;\r\n    }\r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === DefaultModes.SD,\r\n        scanWidth, scanHeight,\r\n        jobIndex: 0,\r\n        analysisId,\r\n        roiParameters: params,\r\n        analysis: AnalysisTypes.SD_FRAMES\r\n    })\r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === DefaultModes.SUM,\r\n        scanWidth, scanHeight,\r\n        jobIndex: 0,\r\n        analysisId,\r\n        roiParameters: params,\r\n        analysis: AnalysisTypes.SUM_FRAMES,\r\n    })\r\n\r\n    const frameViewTitle = (\r\n        frameMode !== DefaultModes.PICK ? null : <>Pick: x={pickCoords.cx}, y={pickCoords.cy} &emsp;</>\r\n    )\r\n\r\n    return {\r\n        frameViewTitle,\r\n        frameModeSelector: (<>{frameModeSelector} {roiSelector}</>),\r\n        roiSelector,\r\n        handles,\r\n        widgets,\r\n    }\r\n}\r\n\r\nexport default useDefaultFrameView;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\n\r\nimport { FrameParams } from \"../../messages\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Rect from \"../../widgets/Rect\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\n\r\n\r\nconst useRectROI = ({ scanWidth, scanHeight}: {\r\n    scanWidth: number;\r\n    scanHeight: number; \r\n}) => {\r\n    const minLength = Math.min(scanWidth, scanHeight);\r\n    const [x, setx] = useState(scanWidth / 2);\r\n    const [y, sety] = useState(scanHeight / 2);\r\n    const [width, setwidth] = useState(minLength / 8);\r\n    const [height, setheight] = useState(minLength / 8);\r\n\r\n\r\n    const rectRoiParameters: FrameParams = {\r\n        roi: {\r\n            shape: \"rect\",\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n        },\r\n    }\r\n\r\n\r\n    const handleCornerChange = (newx: number, newy: number) => {\r\n        setx(newx);\r\n        sety(newy);\r\n    };\r\n\r\n    const handleShapeChange = (newx: number, newy: number) => {\r\n        setwidth(newx-x);\r\n        setheight(newy-y);\r\n    };\r\n\r\n    const smthHandle = {\r\n        x: x + width ,\r\n        y: y + height,\r\n    }\r\n\r\n    const rectRoiHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={x} y={y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleCornerChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}/>\r\n        <DraggableHandle x={smthHandle.x} y={smthHandle.y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleShapeChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}/>\r\n    </>);\r\n\r\n    const rectRoiWidgets = (\r\n        <Rect x={x} y={y} width={width} height={height}\r\n            imageWidth={scanWidth} imageHeight={scanHeight}\r\n        />\r\n    );\r\n\r\n    return {\r\n        rectRoiParameters,\r\n        rectRoiHandles,\r\n        rectRoiWidgets,\r\n    };\r\n};\r\n\r\nexport { useRectROI };\r\n\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes, FrameParams } from \"../../messages\";\r\nimport * as analysisActions from \"../actions\";\r\n\r\n\r\nconst useRoiPicker = ({ analysisId, enabled, jobIndex, roiParameters, analysis }: {\r\n    scanWidth: number;\r\n    scanHeight: number;\r\n    enabled: boolean;\r\n    jobIndex: number,\r\n    analysisId: string;\r\n    roiParameters: FrameParams;\r\n    analysis: AnalysisTypes.SD_FRAMES | AnalysisTypes.SUM_FRAMES\r\n}) => {\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        const handle = setTimeout(() => {\r\n            if (enabled) {\r\n                const analysisDetails = {\r\n                    type: analysis,\r\n                    parameters: roiParameters,\r\n                };\r\n                dispatch(analysisActions.Actions.run(analysisId, jobIndex, analysisDetails))\r\n            }\r\n        }, 100);\r\n\r\n        return () => clearTimeout(handle);\r\n        // rules-of-hooks can't be statically validated here\r\n        // eslint-disable-next-line\r\n    }, [analysis, analysisId, enabled, jobIndex, JSON.stringify(roiParameters), dispatch]);\r\n\r\n    return {\r\n    };\r\n};\r\n\r\nexport { useRoiPicker };\r\n\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\n\r\nimport { FrameParams } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\n\r\nconst useDiskROI = ({ scanWidth, scanHeight}: {\r\n    scanWidth: number;\r\n    scanHeight: number;\r\n}) => {\r\n    const minLength = Math.min(scanWidth, scanHeight);\r\n    const [cx, setCx] = useState(scanWidth / 2);\r\n    const [cy, setCy] = useState(scanHeight / 2);\r\n    const [r, setR] = useState(minLength / 8);\r\n\r\n\r\n    const diskRoiParameters: FrameParams = {\r\n        roi: {\r\n            shape: \"disk\",\r\n            cx,\r\n            cy,\r\n            r,\r\n        },\r\n    }\r\n\r\n\r\n    const handleCenterChange = (newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    };\r\n\r\n    const handleRChange = (newR: number) => {\r\n        setR(newR);\r\n    };\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const diskRoiHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const diskRoiWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={scanWidth} imageHeight={scanHeight}\r\n        />\r\n    );\r\n\r\n    return {\r\n        diskRoiParameters,\r\n        diskRoiHandles,\r\n        diskRoiWidgets,\r\n    };\r\n};\r\n\r\nexport { useDiskROI };\r\n\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Button, Icon, IconProps, Segment } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { getAnalysisStatus } from \"../helpers\";\r\nimport { AnalysisState } from \"../types\";\r\n\r\ninterface ToolbarProps {\r\n    analysis: AnalysisState,\r\n    busyIdxs: number[],\r\n    onApply: () => void,\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: ToolbarProps) => {\r\n    return {\r\n        handleRemove: () => dispatch(analysisActions.Actions.remove(ownProps.analysis.id)),\r\n    }\r\n}\r\n\r\ntype MergedProps = ToolbarProps & ReturnType<typeof mapDispatchToProps> & ReturnType<typeof mapStateToProps>;\r\n\r\nconst Toolbar: React.SFC<MergedProps> = ({ status, onApply, handleRemove }) => {\r\n    const running = status === \"busy\";\r\n    const applyIconProps: IconProps = running ? { name: 'cog', loading: true } : { name: 'check' }\r\n    return (\r\n        <Segment attached=\"bottom\">\r\n            <Button.Group>\r\n                <Button primary={true} onClick={onApply} icon={true}>\r\n                    <Icon {...applyIconProps} />\r\n                    Apply\r\n                </Button>\r\n                <Button onClick={handleRemove} icon={true}>\r\n                    <Icon name='remove' />\r\n                    Remove\r\n                </Button>\r\n            </Button.Group>\r\n        </Segment>\r\n    );\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer, ownProps: ToolbarProps) => {\r\n    const status = getAnalysisStatus(ownProps.analysis, state.jobs, ownProps.busyIdxs);\r\n    return {\r\n        status,\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Toolbar);","import { JobReducerState } from \"../job/reducers\";\r\nimport { JobRunning } from \"../job/types\";\r\nimport { AnalysisState } from \"./types\";\r\n\r\nexport const getAnalysisStatus = (analysis: AnalysisState, jobs: JobReducerState, jobIdxsToInclude: number[] = []): \"idle\" | \"busy\" => {\r\n    let filteredJobs = analysis.jobs;\r\n\r\n    if (jobIdxsToInclude.length > 0) {\r\n        filteredJobs = analysis.jobs.filter((jobId: string, idx: number) => {\r\n            return jobIdxsToInclude.indexOf(idx) !== -1;\r\n        })\r\n    }\r\n\r\n    return filteredJobs.reduce((prevValue: \"idle\" | \"busy\", jobId: string) => {\r\n        const isDone = jobs.byId[jobId].running === JobRunning.DONE;\r\n        return isDone ? prevValue : \"busy\";\r\n    }, \"idle\");\r\n}","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport { DraggableHandle } from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst CenterOfMassAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [r, setR] = useState(minLength / 4);\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRChange = defaultDebounce(setR);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={imageWidth} imageHeight={imageHeight} />\r\n    )\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles, widgets: resultWidgets\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = <>{frameViewTitle} Disk: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), r={r.toFixed(2)}</>;\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.CENTER_OF_MASS,\r\n            parameters: {\r\n                shape: \"com\",\r\n                cx,\r\n                cy,\r\n                r\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"COM analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default CenterOfMassAnalysis;","// from https://stackoverflow.com/a/45100420/540644\r\nexport function getPathArc(center: { x: number, y: number }, start: number, end: number, radius: number) {\r\n    if (end === start) { end += 360; }\r\n    let degree = end - start;\r\n    degree = degree < 0 ? (degree + 360) : degree;\r\n    const points = [];\r\n    points.push(getLocationFromAngle(start, radius, center));\r\n    points.push(getLocationFromAngle(start + degree / 3, radius, center));\r\n    points.push(getLocationFromAngle(start + degree * 2 / 3, radius, center));\r\n    points.push(getLocationFromAngle(end, radius, center));\r\n    return getCirclePath(points, radius, (degree < 180) ? 0 : 1);\r\n}\r\n\r\nfunction getCirclePath(points: Array<{ x: number, y: number }>, radius: number, clockWise: 0 | 1) {\r\n    return ['M', points[0].x, points[0].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[1].x, points[1].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[2].x, points[2].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[3].x, points[3].y\r\n    ].join(' ');\r\n}\r\n\r\nfunction getLocationFromAngle(degree: number, radius: number, center: { x: number, y: number }) {\r\n    const radian = (degree * Math.PI) / 180;\r\n    return {\r\n        x: Math.cos(radian) * radius + center.x,\r\n        y: Math.sin(radian) * radius + center.y\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport { getPathArc } from \"../helpers/svg\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface RingProps {\r\n    imageWidth: number,\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n}\r\n\r\nconst Ring: React.SFC<RingProps> = ({ imageWidth, cx, cy, ri, ro }) => {\r\n    // see also: https://stackoverflow.com/a/37883328/540644\r\n    const pathSpecs = [\r\n        getPathArc({ x: cx + .5, y: cy + .5 }, 90, 90, ro),\r\n        getPathArc({ x: cx + .5, y: cy + .5 }, 90, 90, ri)\r\n    ]\r\n    const pathSpec = pathSpecs.join(' ');\r\n\r\n    return (\r\n        <path d={pathSpec} fillRule=\"evenodd\" style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Ring;","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutTwoResProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    mid: React.ReactNode,\r\n    right: React.ReactNode,\r\n    clustparams: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n    title1: string, \r\n    title2: React.ReactNode,\r\n    title3:string,\r\n\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutTwoResProps;\r\n\r\nconst AnalysisLayoutTwoRes: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, mid, right,\r\n    toolbar, clustparams, title1, title2, title3\r\n}) => {\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={3}>\r\n                    <Grid.Row>\r\n                        <Grid.Column width={4}>\r\n                            <p>{title1}</p>\r\n                        </Grid.Column> \r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title2}</p>   \r\n\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title3}</p>\r\n                        </Grid.Column>    \r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={4}>\r\n                            {left}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {mid}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {right}\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={16}>\r\n\r\n                            <div>{clustparams}</div>\r\n                            <p>{subtitle}</p>\r\n\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n                </Grid>\r\n                \r\n            </Segment>\r\n            \r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutTwoRes","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { Accordion, Form, Icon } from \"semantic-ui-react\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoRes from \"./AnalysisLayoutTwoRes\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport { useRectROI } from \"./RectROI\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\n\r\n\r\nconst ClustAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const [minDist, setMinDist] = React.useState(1);\r\n\r\n    const minDistChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setMinDist(event.target.valueAsNumber);\r\n    }\r\n\r\n    const [nPeaks, setNPeaks] = React.useState(500);\r\n\r\n    const peakChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setNPeaks(event.target.valueAsNumber);\r\n    }\r\n\r\n    const [nClust, setNClust] = React.useState(20);\r\n\r\n    const clustChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setNClust(event.target.valueAsNumber);\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n    const { rectRoiParameters, rectRoiHandles, rectRoiWidgets } = useRectROI({ scanWidth, scanHeight });\r\n\r\n    React.useEffect(() => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.SUM_SIG,\r\n            parameters: {},\r\n        }))\r\n    }, [analysis.id, dispatch]);\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 2, {\r\n            type: AnalysisTypes.CLUST,\r\n            parameters: {\r\n                roi: rectRoiParameters.roi,\r\n                cx,\r\n                cy,\r\n                ri,\r\n                ro,\r\n                n_clust: nClust,\r\n                n_peaks: nPeaks,\r\n                min_dist: minDist\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[2]} />\r\n\r\n    const [paramsVisible, setParamsVisible] = React.useState(false);\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        setParamsVisible(!paramsVisible);\r\n    }\r\n\r\n    const clustparams =\r\n        <Accordion>\r\n            <Accordion.Title active={paramsVisible} index={0} onClick={handleClick}>\r\n                <Icon name='dropdown' />\r\n                Parameters\r\n    </Accordion.Title>\r\n            <Accordion.Content active={paramsVisible}>\r\n                <Form>\r\n                    <Form.Field>\r\n                        <label> Number of clusters  <input type=\"number\" value={nClust} step=\"1\" min=\"2\" max=\"100\" onChange={clustChange} /> </label>\r\n                    </Form.Field>\r\n                    <Form.Field>\r\n                        <label>  Maximal number of possible peak positions to detect (better put higher value,\r\n        the output is limited to the number of peaks the algorithm could find)  <input type=\"number\" value={nPeaks} step=\"1\" min=\"5\" max=\"200\" onChange={peakChange} /> </label>\r\n                    </Form.Field>\r\n                    <Form.Field>\r\n                        <label>  Minimal distance in pixels between peaks  <input type=\"number\" value={minDist} step=\"1\" min=\"0\" max=\"100\" onChange={minDistChange} />  </label>\r\n                    </Form.Field>\r\n                </Form>\r\n            </Accordion.Content>\r\n        </Accordion>\r\n    return (\r\n        <AnalysisLayoutTwoRes\r\n            title=\"Region clustering\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            mid={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={rectRoiHandles}\r\n                    extraWidgets={rectRoiWidgets}\r\n                />\r\n            </>}\r\n\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={2} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n            clustparams={clustparams}\r\n\r\n            title1=\"Peaks inside the ring will be considered\"\r\n            title2=\"Choose specimen region\"\r\n            title3=\"Clustering result\"\r\n\r\n        />\r\n    );\r\n\r\n}\r\n\r\n\r\nexport default ClustAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\nconst DiskMaskAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [r, setR] = useState(minLength / 4);\r\n\r\n    const handleCenterChange = (newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    };\r\n    const handleRChange = setR;\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={imageWidth} imageHeight={imageHeight}\r\n        />\r\n    );\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.APPLY_DISK_MASK,\r\n            parameters: {\r\n                shape: \"disk\",\r\n                cx, cy, r\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles, widgets: resultWidgets\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = <>{frameViewTitle} Disk: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), r={r.toFixed(2)}</>;\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Disk analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default DiskMaskAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst FEMAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.FEM,\r\n            parameters: {\r\n                shape: \"ring\",\r\n                cx, cy, ri, ro,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Fluctuation EM (SD over Ring analysis)\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default FEMAnalysis;","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutThreeColProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    mid: React.ReactNode,\r\n    right: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n    title1: string,\r\n    title2: React.ReactNode,\r\n    title3: string,\r\n\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutThreeColProps;\r\n\r\nconst AnalysisLayoutThreeCol: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, mid, right,\r\n    toolbar, title1, title2, title3\r\n}) => {\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={3}>\r\n                    <Grid.Row>\r\n                        <Grid.Column width={5}>\r\n                            <p>{title1}</p>\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={5}>\r\n                            <p>{title2}</p>\r\n\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title3}</p>\r\n                        </Grid.Column>\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={5}>\r\n                            {left}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={5}>\r\n                            {mid}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {right}\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={10}>\r\n\r\n                            <p>{subtitle}</p>\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6} />\r\n                    </Grid.Row>\r\n                </Grid>\r\n            </Segment>\r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutThreeCol","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\n\r\nconst useFFTFramePicker = ({\r\n    enabled, scanWidth, scanHeight, jobIndex, analysisId, cx, cy, real_rad, real_centerx, real_centery, setCx, setCy\r\n}: {\r\n    enabled: boolean, scanWidth: number, scanHeight: number,\r\n    jobIndex: number, analysisId: string,\r\n    cx: number, cy: number, setCx: (newCx: number) => void, setCy: (newCy: number) => void,\r\n    real_rad: number | null, real_centerx: number | null, real_centery: number | null\r\n\r\n}) => {\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            dispatch(analysisActions.Actions.run(analysisId, jobIndex, {\r\n                type: AnalysisTypes.PICK_FFT_FRAME,\r\n                parameters: { x: cx, y: cy, real_rad, real_centerx, real_centery },\r\n            }))\r\n\r\n        }\r\n    }, [analysisId, cx, cy, enabled, jobIndex, real_rad, real_centerx, real_centery, dispatch]);\r\n\r\n    const onPickChange = (pickX: number, pickY: number) => {\r\n        const newX = Math.round(pickX);\r\n        const newY = Math.round(pickY);\r\n        if (cx === newX && cy === newY) {\r\n            return;\r\n        }\r\n        setCx(newX);\r\n        setCy(newY);\r\n    }\r\n\r\n    const renderPickHandle: HandleRenderFunction = (onDragStart, onDrop) => (\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            imageWidth={scanWidth}\r\n            onDragMove={onPickChange}\r\n            parentOnDragStart={onDragStart}\r\n            parentOnDrop={onDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n    )\r\n\r\n    return { coords: { cx, cy }, handles: renderPickHandle };\r\n}\r\n\r\nexport default useFFTFramePicker;","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport * as analysisActions from \"../actions\";\r\n\r\nconst useFFTSumFrames = ({\r\n    enabled, jobIndex, analysisId, real_rad, real_centerx, real_centery\r\n}: {\r\n    enabled: boolean, jobIndex: number, analysisId: string, real_rad: number | null, real_centerx: number | null, real_centery: number | null\r\n}) => {\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            dispatch(analysisActions.Actions.run(analysisId, jobIndex, {\r\n                type: AnalysisTypes.FFTSUM_FRAMES,\r\n                parameters: { real_rad, real_centerx, real_centery },\r\n            }));\r\n        }\r\n    }, [analysisId, enabled, jobIndex, real_rad, real_centerx, real_centery, dispatch]);\r\n};\r\n\r\nexport default useFFTSumFrames;\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport useFFTFramePicker from \"./FFTFramePicker\";\r\nimport useFFTSumFrames from \"./FFTSumFrames\";\r\nimport useFramePicker from \"./FramePicker\";\r\nimport ModeSelector from \"./ModeSelector\";\r\nimport { useRoiPicker } from \"./RoiPicker\";\r\n\r\nconst useFFTFrameView = ({\r\n    scanWidth, scanHeight, analysisId, real_rad, real_centerx, real_centery\r\n}: {\r\n    scanWidth: number, scanHeight: number,\r\n    analysisId: string, real_rad:number|null, real_centerx:number|null, real_centery:number|null\r\n}) => {\r\n    const availableModes = [\r\n\r\n        {\r\n            text: \"Pick\",\r\n            value: AnalysisTypes.PICK_FRAME,\r\n        },\r\n\r\n        {\r\n            text: \"Average\",\r\n            value: AnalysisTypes.SUM_FRAMES,\r\n        },\r\n    ];\r\n\r\n    const [frameMode, setMode] = useState(AnalysisTypes.SUM_FRAMES);\r\n\r\n    const frameModeSelector = <ModeSelector modes={availableModes} currentMode={frameMode} onModeChange={setMode} label=\"Mode\"/>\r\n\r\n    const [cx, setCx] = React.useState(Math.round(scanWidth / 2));\r\n    const [cy, setCy] = React.useState(Math.round(scanHeight / 2));\r\n\r\n    const { coords: pickCoords, handles: pickHandles } = useFramePicker({\r\n        enabled: frameMode === AnalysisTypes.PICK_FRAME,\r\n        scanWidth, scanHeight,\r\n        jobIndex: 1,\r\n        analysisId,\r\n        cx, cy, setCx, setCy\r\n    });\r\n    \r\n    useFFTFramePicker({\r\n        enabled: frameMode === AnalysisTypes.PICK_FRAME,\r\n        scanWidth, scanHeight,\r\n        jobIndex: 0,\r\n        analysisId,\r\n        cx, cy, setCx, setCy,real_rad, real_centerx, real_centery\r\n    });\r\n    \r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === AnalysisTypes.SUM_FRAMES,\r\n        jobIndex: 1,\r\n        analysisId,\r\n        scanWidth, scanHeight,\r\n        roiParameters: {roi:{}},\r\n        analysis: AnalysisTypes.SUM_FRAMES,\r\n    })\r\n    useFFTSumFrames({\r\n        enabled: frameMode === AnalysisTypes.SUM_FRAMES,\r\n        jobIndex: 0,\r\n        analysisId,\r\n        real_rad,\r\n        real_centerx,\r\n        real_centery\r\n    })\r\n\r\n    const frameViewTitle = (\r\n        frameMode !== AnalysisTypes.PICK_FRAME ? null : <>Pick: x={pickCoords.cx}, y={pickCoords.cy} &emsp;</>\r\n    )\r\n\r\n\r\n\r\n    const nullHandles: HandleRenderFunction = (onDragStart, onDrop) => null\r\n\r\n    return {\r\n        frameViewTitle,\r\n        handles: frameMode !== AnalysisTypes.PICK_FRAME ? nullHandles : pickHandles,\r\n\r\n        frameModeSelector,\r\n    }\r\n}\r\n\r\nexport default useFFTFrameView;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutThreeCol from \"./AnalysisLayoutThreeCol\";\r\nimport useFFTFrameView from \"./FFTFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\n\r\n\r\nconst FFTAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const cx = imageWidth / 2;\r\n    const cy = imageHeight / 2;\r\n    const [radIn, setRi] = useState(minLength / 4);\r\n    const [radOut, setRo] = useState(minLength / 2);\r\n\r\n    const dispatch = useDispatch();\r\n    const riHandle = {\r\n        x: cx - radIn,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - radOut,\r\n        y: cy,\r\n    }\r\n\r\n\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandlesfft: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgetsfft = (\r\n        <Ring cx={cx} cy={cy} ri={radIn} ro={radOut}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const [check, setCheck] = React.useState(true);\r\n\r\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setCheck(event.target.checked);\r\n    }\r\n\r\n\r\n\r\n    const [realCenterX, setCx] = useState(imageWidth / 2);\r\n    const [realCenterY, setCy] = useState(imageHeight / 2);\r\n    const [realRad, setR] = useState(minLength / 4);\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRChange = defaultDebounce(setR);\r\n\r\n    const rHandle = {\r\n        x: realCenterX - realRad,\r\n        y: realCenterY,\r\n    }\r\n\r\n    const frameViewHandlesreal: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={realCenterX} y={realCenterY}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(realCenterX, realCenterY, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(realCenterY)} />\r\n    </>);\r\n\r\n    const frameViewWidgetsreal = (\r\n        <Disk cx={realCenterX} cy={realCenterY} r={realRad}\r\n            imageWidth={imageWidth} imageHeight={imageHeight}\r\n        />\r\n    );\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 2, {\r\n            type: AnalysisTypes.APPLY_FFT_MASK,\r\n            parameters: {\r\n                rad_in: radIn,\r\n                rad_out: radOut,\r\n                real_rad: check ? realRad : null,\r\n                real_centerx: check ? realCenterX : null,\r\n                real_centery: check ? realCenterY : null\r\n\r\n            }\r\n        }));\r\n    };\r\n\r\n    const { frameViewTitle, frameModeSelector, handles: resultHandles } = useFFTFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n        real_rad: check ? realRad : null,\r\n        real_centerx: check ? realCenterX : null,\r\n        real_centery: check ? realCenterY : null\r\n    })\r\n\r\n\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[2]} />\r\n\r\n\r\n    let subtitle;\r\n    let mid: React.ReactNode;\r\n    if (check) {\r\n        mid = (<>\r\n            <ResultList\r\n                extraHandles={frameViewHandlesreal} extraWidgets={frameViewWidgetsreal}\r\n                jobIndex={1} analysis={analysis.id}\r\n                width={imageWidth} height={imageHeight}\r\n                selectors={frameModeSelector}\r\n            />\r\n        </>)\r\n        subtitle = (\r\n            <>{frameViewTitle} real_rad={radIn.toFixed(2)}, real_center=(x={realCenterX.toFixed(2)}, y={realCenterY.toFixed(2)}), fourier_rad_in={radIn.toFixed(2)}, fourier_rad_out={radOut.toFixed(2)}</>\r\n        )\r\n    }\r\n\r\n    else {\r\n        mid = (<>\r\n            <ResultList\r\n                jobIndex={1} analysis={analysis.id}\r\n                width={imageWidth} height={imageHeight}\r\n                selectors={frameModeSelector}\r\n            />\r\n        </>)\r\n        subtitle = (\r\n            <>{frameViewTitle} fourier_rad_in={radIn.toFixed(2)}, fourier_rad_out={radOut.toFixed(2)}</>\r\n        )\r\n    }\r\n\r\n\r\n    return (\r\n        <AnalysisLayoutThreeCol\r\n            title=\"FFT analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandlesfft} extraWidgets={frameViewWidgetsfft}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                />\r\n            </>}\r\n            mid={mid}\r\n\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={2} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n\r\n            title2={<><label> Masking out of zero order diffraction peak <input type=\"checkbox\" name=\"check\" onChange={handleChange} checked={check} /> </label>\r\n            </>}\r\n            title1=\"Masking of intergation region in Fourier space\"\r\n            title3=\"Result of analysis\"\r\n\r\n        />\r\n    );\r\n}\r\n\r\n\r\nexport default FFTAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\nconst PointSelectionAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset, }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            onDragMove={handleCenterChange}\r\n            imageWidth={imageWidth}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n    </>);\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Point: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)})</>\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.APPLY_POINT_SELECTOR,\r\n            parameters: {\r\n                shape: \"point\",\r\n                cx,\r\n                cy,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Point analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default PointSelectionAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst RadialFourierAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n    const [nBins] = useState(1);\r\n    const [maxOrder] = useState(8);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.RADIAL_FOURIER,\r\n            parameters: {\r\n                shape: \"radial_fourier\",\r\n                cx, cy, ri, ro,\r\n                n_bins: nBins,\r\n                max_order: maxOrder,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Radial Fourier analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default RadialFourierAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { AnalysisProps } from \"../types\";\r\nimport AnalysisLayoutTwoCol from \"./AnalysisLayoutTwoCol\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst RingMaskAnalysis: React.SFC<AnalysisProps> = ({ analysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(analysis.id, 1, {\r\n            type: AnalysisTypes.APPLY_RING_MASK,\r\n            parameters: {\r\n                shape: \"ring\",\r\n                cx, cy, ri, ro,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        analysisId: analysis.id,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const toolbar = <Toolbar analysis={analysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Ring analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    jobIndex={0} analysis={analysis.id}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    jobIndex={1} analysis={analysis.id}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default RingMaskAnalysis;","import { AnalysisTypes, DatasetOpen, PickFrameDetails, SumFramesDetails } from \"../messages\";\r\nimport CenterOfMassAnalysis from \"./components/CenterOfMassAnalysis\";\r\nimport ClustAnalysis from \"./components/Clustering\";\r\nimport DiskMaskAnalysis from \"./components/DiskMaskAnalysis\";\r\nimport FEM from \"./components/FEM\";\r\nimport FFTAnalysis from \"./components/FFTAnalysis\";\r\nimport PointSelectionAnalysis from \"./components/PointSelectionAnalysis\";\r\nimport RadialFourierAnalysis from \"./components/RadialFourierAnalysis\";\r\nimport RingMaskAnalysis from \"./components/RingMaskAnalysis\";\r\n\r\n\r\n\r\nexport type AnalysisStatus = \"busy\" | \"idle\";\r\n\r\nexport type JobList = string[];\r\n\r\nexport type JobHistory = string[][];\r\n\r\nexport type FrameAnalysisDetails = PickFrameDetails | SumFramesDetails;\r\n\r\nexport interface Analysis {\r\n    id: string,\r\n    dataset: string,\r\n    jobs: JobList,\r\n    jobHistory: JobHistory,\r\n    mainAnalysisType: AnalysisTypes,\r\n}\r\n\r\n\r\n/**\r\n * AnalysisProps is the interface you should implement with your Analysis, as a functional component.\r\n * For example:\r\n * \r\n * const MyAnalysis: React.FunctionalComponent<AnalysisProps> = ({ analysis, dataset }) = { ... }\r\n * \r\n */\r\nexport interface AnalysisProps {\r\n    analysis: AnalysisState,\r\n    dataset: DatasetOpen,\r\n}\r\n\r\nexport type AnalysisState = Analysis & {\r\n};\r\n\r\nexport interface AnalysisMetadataItem {\r\n    desc: string,\r\n    title: string,\r\n    component?: React.FunctionComponent<AnalysisProps>,\r\n}\r\n\r\n/**\r\n * list of all analyses; those having a component will be available for selection in the UI\r\n * \r\n * please fill in a title and description, and reference your component.\r\n */\r\nexport const AnalysisMetadata: { [s: string]: AnalysisMetadataItem } = {\r\n    [AnalysisTypes.APPLY_RING_MASK]: {\r\n        desc: \"Apply a ring mask with center cx, cy; inner radius ri, outer radius ro\",\r\n        title: \"Ring\",\r\n        component: RingMaskAnalysis,\r\n    },\r\n    [AnalysisTypes.APPLY_DISK_MASK]: {\r\n        desc: \"Apply a disk mask with center cx, cy; radius r\",\r\n        title: \"Disk\",\r\n        component: DiskMaskAnalysis,\r\n    },\r\n    [AnalysisTypes.FEM]: {\r\n        desc: \"Apply a ring mask with center cx, cy; radius r\",\r\n        title: \"FEM (SD over Ring)\",\r\n        component: FEM,\r\n    },\r\n    [AnalysisTypes.CENTER_OF_MASS]: {\r\n        desc: \"Compute the center of mass of all diffraction images\",\r\n        title: \"Center of mass\",\r\n        component: CenterOfMassAnalysis,\r\n    },\r\n    [AnalysisTypes.APPLY_POINT_SELECTOR]: {\r\n        desc: \"Create an image from a single pixel selected in the detector\",\r\n        title: \"Point selection\",\r\n        component: PointSelectionAnalysis,\r\n    },\r\n    [AnalysisTypes.SUM_FRAMES]: {\r\n        desc: \"Create a sum of all detector frames\",\r\n        title: \"Sum all frames\",\r\n    },\r\n    [AnalysisTypes.SD_FRAMES]: {\r\n        desc: \"Create a SD of all detector frames\",\r\n        title: \"SD all frames\",\r\n    },\r\n    [AnalysisTypes.PICK_FRAME]: {\r\n        desc: \"Pick a single frame\",\r\n        title: \"Pick frame\",\r\n    },\r\n    [AnalysisTypes.PICK_FFT_FRAME]: {\r\n        desc: \"Pick a single frame\",\r\n        title: \"Pick frame\",\r\n    },\r\n    [AnalysisTypes.APPLY_FFT_MASK]: {\r\n        desc: \"Apply a ring mask with inner radius fourier_rad_in and outer radius fourier_rad_out in Fourier space\",\r\n        title: \"FFT analysis\",\r\n        component: FFTAnalysis\r\n    },\r\n    [AnalysisTypes.FFTSUM_FRAMES]: {\r\n        desc: \"Fourier transform of sum of all detector frames\",\r\n        title: \"FFT of Sum all frames\",\r\n    },\r\n    [AnalysisTypes.RADIAL_FOURIER]: {\r\n        desc: \"Compute a radial Fourier analysis\",\r\n        title: \"Radial Fourier\",\r\n        component: RadialFourierAnalysis,\r\n    },\r\n    [AnalysisTypes.CLUST]: {\r\n        desc: \"Region clustering based on non-zero order diffraction peaks positions\",\r\n        title: \"Clustering\",\r\n        component: ClustAnalysis,\r\n    },\r\n    [AnalysisTypes.SUM_SIG]: {\r\n        desc: \"Frame integration\",\r\n        title: \"Sum\",\r\n    },\r\n}","import * as React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { DatasetStatus } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { AnalysisMetadata, AnalysisState } from \"../types\";\r\n\r\ninterface AnalysisDispatcherProps {\r\n    analysis: AnalysisState,\r\n}\r\n\r\nconst AnalysisDispatcherComponent: React.SFC<AnalysisDispatcherProps> = ({ analysis }) => {\r\n    const dataset = useSelector((state: RootReducer) => state.datasets.byId[analysis.dataset])\r\n\r\n    if (dataset.status !== DatasetStatus.OPEN) {\r\n        return null;\r\n    }\r\n\r\n    const AnalysisComponent = AnalysisMetadata[analysis.mainAnalysisType].component;\r\n    if (!AnalysisComponent) {\r\n        throw new Error(\"unknown analysis type\");\r\n    }\r\n\r\n    return <AnalysisComponent dataset={dataset} analysis={analysis} />;\r\n}\r\n\r\nexport default AnalysisDispatcherComponent;","import * as React from \"react\";\r\nimport { AnalysisReducerState } from \"../reducers\";\r\nimport Analysis from \"./Analysis\";\r\n\r\ninterface AnalysisProps {\r\n    analyses: AnalysisReducerState,\r\n}\r\n\r\nconst AnalysisList: React.SFC<AnalysisProps> = ({ analyses }) => {\r\n    return (<>{\r\n        analyses.ids.map(analysisId => <Analysis key={analysisId} analysis={analyses.byId[analysisId]} />)\r\n    }</>);\r\n}\r\n\r\nexport default AnalysisList;","interface IdMap<R> {\r\n    [s: string]: R\r\n}\r\n\r\nexport interface ById<R> {\r\n    ids: string[],\r\n    byId: IdMap<R>,\r\n};\r\n\r\n// TODO: make ById DeepReadonly\r\n// import { DeepReadonly } from 'utility-types'\r\n\r\nexport function updateById<R>(state: ById<R>, id: string, partialRecord: Partial<R>): ById<R> {\r\n    const newObj = Object.assign({}, state.byId[id], partialRecord);\r\n    const newById = Object.assign({}, state.byId, { [id]: newObj });\r\n    return Object.assign({}, state, { byId: newById });\r\n}\r\n\r\nexport function insertById<R>(state: ById<R>, id: string, record: R): ById<R> {\r\n    const newById = Object.assign({}, state.byId, { [id]: record });\r\n    const newIds = [...state.ids, id];\r\n    return { byId: newById, ids: newIds };\r\n}\r\n\r\nexport function constructById<R>(items: R[], key: (k: R) => string): IdMap<R> {\r\n    const byId = items.reduce((acc, item) => Object.assign(acc, {\r\n        [key(item)]: item,\r\n    }), {} as IdMap<R>);\r\n    return byId;\r\n}\r\n\r\nexport type Predicate<R> = (item: R) => boolean;\r\n\r\nexport function filterWithPred<R>(state: ById<R>, pred: Predicate<R>): ById<R> {\r\n    const ids = state.ids.filter(id => pred(state.byId[id]));\r\n    const byId: IdMap<R> = ids.reduce((acc, id) => Object.assign(acc, {\r\n        [id]: state.byId[id],\r\n    }), {});\r\n    return {\r\n        byId,\r\n        ids,\r\n    };\r\n}","import * as React from \"react\";\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport { getEnumValues } from \"../../helpers\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { AnalysisMetadata, AnalysisMetadataItem } from \"../types\";\r\n\r\n// keyof typeof: https://stackoverflow.com/a/42623905/540644\r\nconst getMetadata = (typeName: keyof typeof AnalysisTypes): AnalysisMetadataItem => {\r\n    const type: AnalysisTypes = AnalysisTypes[typeName];\r\n    return AnalysisMetadata[type]\r\n}\r\n\r\nconst analysisTypeKeys = getEnumValues(AnalysisTypes);\r\nconst analysisTypeOptions = analysisTypeKeys.filter(t => getMetadata(t).component !== undefined).map(t => ({\r\n    text: getMetadata(t).title,\r\n    value: AnalysisTypes[t],\r\n}));\r\n\r\ninterface AnalysisSelectProps {\r\n    onClick: (analysisType: AnalysisTypes) => void,\r\n    label: string,\r\n}\r\n\r\nconst selectData = (fn: (v: AnalysisTypes) => void) => (e: React.MouseEvent, data: DropdownItemProps) => {\r\n    return fn(data.value as AnalysisTypes);\r\n}\r\n\r\nconst AnalysisSelect: React.SFC<AnalysisSelectProps> = ({ onClick, label }) => {\r\n    return (\r\n        <Dropdown text={label} icon='add' floating={true} labeled={true} button={true} className='icon'>\r\n            <Dropdown.Menu>\r\n                <Dropdown.Header content='implemented analyses' />\r\n                {analysisTypeOptions.map(option => <Dropdown.Item key={option.value} onClick={selectData(onClick)} {...option} />)}\r\n            </Dropdown.Menu>\r\n        </Dropdown>\r\n    );\r\n}\r\n\r\nexport default AnalysisSelect;","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { DatasetCreateParams, DatasetFormParams, DatasetState } from '../messages';\r\n\r\nexport enum ActionTypes {\r\n    OPEN = 'DATASET_OPEN',\r\n    CANCEL_OPEN = 'DATASET_CANCEL_OPEN',\r\n    CREATE = 'DATASET_CREATE',\r\n    CREATED = 'DATASET_CREATED',\r\n    ERROR = 'DATASET_ERROR',\r\n    DELETE = 'DATASET_DELETE',\r\n    DELETED = 'DATASET_DELETED',\r\n    DETECT = 'DATASET_DETECT',\r\n    DETECTED = 'DATASET_DETECTED',\r\n    DETECT_FAILED = 'DATASET_DETECT_FAILED',\r\n}\r\n\r\nexport const Actions = {\r\n    open: (path: string, cachedParams?: DatasetFormParams, detectedParams?: DatasetFormParams) => createAction(ActionTypes.OPEN, { path, cachedParams, detectedParams }),\r\n    cancelOpen: () => createAction(ActionTypes.CANCEL_OPEN),\r\n    create: (dataset: DatasetCreateParams) => createAction(ActionTypes.CREATE, { dataset }),\r\n    created: (dataset: DatasetState) => createAction(ActionTypes.CREATED, { dataset }),\r\n    error: (dataset: string, msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { dataset, msg, timestamp, id }),\r\n    delete: (dataset: string) => createAction(ActionTypes.DELETE, { dataset }),\r\n    deleted: (dataset: string) => createAction(ActionTypes.DELETED, { dataset }),\r\n    detect: (path: string) => createAction(ActionTypes.DETECT, { path }),\r\n    detected: (path: string, params: DatasetFormParams) => createAction(ActionTypes.DETECTED, { path, params }),\r\n    detectFailed: (path: string) => createAction(ActionTypes.DETECT_FAILED, { path }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport * as analysisActions from \"../../analysis/actions\";\r\nimport AnalysisSelect from \"../../analysis/components/AnalysisSelect\";\r\nimport { AnalysisTypes, DatasetState } from \"../../messages\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DatasetProps) => {\r\n    return {\r\n        handleAddAnalysis: (type: AnalysisTypes) => {\r\n            dispatch(analysisActions.Actions.create(ownProps.dataset.id, type));\r\n        },\r\n    }\r\n}\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst AddAnalysis: React.SFC<MergedProps> = ({ handleAddAnalysis }) => {\r\n    return <AnalysisSelect onClick={handleAddAnalysis} label='Add analysis' />\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(AddAnalysis);","import * as React from \"react\";\r\nimport { Table } from \"semantic-ui-react\";\r\nimport { DatasetState } from \"../../messages\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst renderParamValue = (value: any) => {\r\n    if (value instanceof Array) {\r\n        return `(${value.join(\",\")})`;\r\n    } else {\r\n        return value;\r\n    }\r\n}\r\n\r\nconst renderParams = (params: any) => {\r\n    return Object.keys(params).map((key: string, idx: number) => {\r\n        return (\r\n            <Table.Row key={idx}>\r\n                <Table.Cell>{key}</Table.Cell>\r\n                <Table.Cell>{renderParamValue(params[key])}</Table.Cell>\r\n            </Table.Row>\r\n        );\r\n    })\r\n}\r\n\r\n\r\nconst DatasetParams: React.SFC<DatasetProps> = ({ dataset }) => {\r\n    return (\r\n        <Table>\r\n            <Table.Header>\r\n                <Table.Row>\r\n                    <Table.HeaderCell>Parameter</Table.HeaderCell>\r\n                    <Table.HeaderCell>Value</Table.HeaderCell>\r\n                </Table.Row>\r\n            </Table.Header>\r\n            <Table.Body>\r\n                {renderParams(dataset.params)}\r\n            </Table.Body>\r\n        </Table>\r\n    );\r\n}\r\n\r\n\r\nexport default DatasetParams;","import * as React from \"react\";\r\nimport { Table } from \"semantic-ui-react\";\r\nimport { DatasetOpen, DiagElemMsg } from \"../../messages\";\r\nimport DatasetParams from \"./DatasetParams\";\r\n\r\ninterface DatasetInfoProps {\r\n    dataset: DatasetOpen,\r\n}\r\n\r\nconst renderValue = (elem: DiagElemMsg) => {\r\n    if (elem.value instanceof Array) {\r\n        return <DiagElems diagnostics={elem.value} />\r\n    } else {\r\n        return elem.value;\r\n    }\r\n}\r\n\r\nconst DiagElem: React.SFC<{ elem: DiagElemMsg }> = ({ elem }) => {\r\n    return (\r\n        <Table.Row>\r\n            <Table.Cell>{elem.name}</Table.Cell>\r\n            <Table.Cell>{renderValue(elem)}</Table.Cell>\r\n        </Table.Row>\r\n    )\r\n}\r\n\r\nconst DiagElems: React.SFC<{ diagnostics: DiagElemMsg[] }> = ({ diagnostics }) => {\r\n    if (diagnostics.length === 0) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Table>\r\n            <Table.Header>\r\n                <Table.Row>\r\n                    <Table.HeaderCell>Name</Table.HeaderCell>\r\n                    <Table.HeaderCell>Value</Table.HeaderCell>\r\n                </Table.Row>\r\n            </Table.Header>\r\n            <Table.Body>\r\n                {diagnostics.map((elem, idx) => (\r\n                    <DiagElem elem={elem} key={idx} />\r\n                ))}\r\n            </Table.Body>\r\n        </Table>\r\n    );\r\n}\r\n\r\nconst DatasetInfo: React.SFC<DatasetInfoProps> = ({ dataset }) => {\r\n    return (\r\n        <>\r\n            <DatasetParams dataset={dataset} />\r\n            <DiagElems diagnostics={dataset.diagnostics} />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default DatasetInfo;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Button } from \"semantic-ui-react\";\r\nimport { DatasetState } from \"../../messages\";\r\nimport * as datasetActions from \"../actions\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState,\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DatasetProps) => {\r\n    return {\r\n        handleRemoveDataset: () => {\r\n            dispatch(datasetActions.Actions.delete(ownProps.dataset.id));\r\n        }\r\n    }\r\n}\r\n\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst DatasetToolbar: React.SFC<MergedProps> = ({ dataset, handleRemoveDataset }) => {\r\n    return (\r\n        <>\r\n            <Button icon=\"remove\" labelPosition=\"left\" onClick={handleRemoveDataset} content='Close Dataset' />\r\n        </>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(DatasetToolbar);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, Icon, Message, Modal, Popup, Segment } from 'semantic-ui-react';\r\nimport AnalysisList from \"../../analysis/components/AnalysisList\";\r\nimport { AnalysisState } from \"../../analysis/types\";\r\nimport { filterWithPred } from \"../../helpers/reducerHelpers\";\r\nimport { DatasetState, DatasetStatus } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport AddAnalysis from \"./AddAnalysis\";\r\nimport DatasetInfo from \"./DatasetInfo\";\r\nimport DatasetToolbar from \"./DatasetToolbar\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer, ownProps: DatasetProps) => {\r\n    const p = (analysis: AnalysisState) => analysis.dataset === ownProps.dataset.id;\r\n    return {\r\n        analyses: filterWithPred(state.analyses, p),\r\n    }\r\n}\r\n\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapStateToProps>;\r\n\r\nconst DatasetComponent: React.SFC<MergedProps> = ({ dataset, analyses }) => {\r\n    const msg = {\r\n        [DatasetStatus.OPENING]: `Opening dataset ${dataset.params.name}`,\r\n        [DatasetStatus.DELETING]: `Closing dataset ${dataset.params.name}`,\r\n    }\r\n    if (dataset.status === DatasetStatus.OPENING || dataset.status === DatasetStatus.DELETING) {\r\n        return (\r\n            <>\r\n                <Header as=\"h2\" dividing={true}>{dataset.params.name}</Header>\r\n                <Message icon={true}>\r\n                    <Icon name='cog' loading={true} />\r\n                    <Message.Content>\r\n                        <Message.Header>{msg[dataset.status]}</Message.Header>\r\n                    </Message.Content>\r\n                </Message>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Segment.Group style={{ marginTop: \"3em\", marginBottom: \"3em\" }}>\r\n            <Segment.Group horizontal={true}>\r\n                <Segment>\r\n                    <Header as=\"h2\">\r\n                        <Icon name=\"database\" />\r\n                        <Modal trigger={\r\n                            <Header.Content>\r\n                                {dataset.params.name}\r\n                                {' '}\r\n                                <Icon name=\"info circle\" size=\"small\" link={true} />\r\n                            </Header.Content>\r\n                        }>\r\n                            <Popup.Header>{dataset.params.type} Dataset {dataset.params.name}</Popup.Header>\r\n                            <Popup.Content>\r\n                                <DatasetInfo dataset={dataset} />\r\n                            </Popup.Content>\r\n                        </Modal>\r\n                    </Header>\r\n                </Segment>\r\n                <Segment style={{ flexShrink: 1, flexGrow: 0 }}>\r\n                    <DatasetToolbar dataset={dataset} />\r\n                </Segment>\r\n            </Segment.Group>\r\n            {\r\n                analyses.ids.length > 0 ? (\r\n                    <>\r\n                        <Segment>\r\n                            <AnalysisList analyses={analyses} />\r\n                        </Segment>\r\n                    </>\r\n                ) : null\r\n            }\r\n            <Segment textAlign=\"center\">\r\n                <AddAnalysis dataset={dataset} />\r\n            </Segment>\r\n        </Segment.Group>\r\n    );\r\n}\r\n\r\nconst DatasetContainer = connect(mapStateToProps)(DatasetComponent);\r\n\r\nexport default DatasetContainer;","import { DataSetOpenSchemaResponse, DeleteDatasetResponse, DetectDatasetResponse, OpenDatasetRequest, OpenDatasetResponse } from \"../messages\";\r\n\r\nexport function openDataset(id: string, dataset: OpenDatasetRequest): Promise<OpenDatasetResponse> {\r\n    return fetch(`/api/datasets/${id}/`, {\r\n        body: JSON.stringify(dataset),\r\n        credentials: \"same-origin\",\r\n        method: \"PUT\",\r\n    }).then(r => r.json());\r\n}\r\n\r\nexport function deleteDataset(id: string): Promise<DeleteDatasetResponse> {\r\n    return fetch(`/api/datasets/${id}/`, {\r\n        credentials: \"same-origin\",\r\n        method: \"DELETE\",\r\n    }).then(r => r.json());\r\n}\r\n\r\n\r\nexport function detectDataset(path: string): Promise<DetectDatasetResponse> {\r\n    return fetch(`/api/datasets/detect/?path=${encodeURIComponent(path)}`, {\r\n        credentials: \"same-origin\",\r\n        method: \"GET\",\r\n    }).then(r => r.json());\r\n}\r\n\r\ninterface SchemaCache {\r\n    [type: string]: DataSetOpenSchemaResponse,\r\n}\r\n\r\nconst schemaCache: SchemaCache = {};\r\n\r\nexport async function getSchema(type: string): Promise<DataSetOpenSchemaResponse> {\r\n    const cached = schemaCache[type];\r\n    if (cached) {\r\n        return new Promise((resolve) => resolve(cached));\r\n    } else {\r\n        const r = await fetch(`/api/datasets/schema/?type=${encodeURIComponent(type)}`, {\r\n            credentials: \"same-origin\",\r\n            method: \"GET\",\r\n        });\r\n        const schemaResponse = await r.json();\r\n        schemaCache[type] = schemaResponse;\r\n        return schemaResponse;\r\n    }\r\n}","import Ajv, { ErrorObject } from 'ajv';\r\nimport { FormikErrors, FormikValues } from 'formik';\r\nimport { DataSetOpenSchemaResponse } from '../messages';\r\nimport { getSchema } from './api';\r\n\r\nexport function convertErrors(errors: ErrorObject[]): FormikErrors<FormikValues> {\r\n    const res: FormikErrors<FormikValues> = {};\r\n    errors.forEach(err => {\r\n        // flatten field names, convert from array to object\r\n        // FIXME: doesn't support multiple errors per field yet (formik limitation?)\r\n        const expr = /^\\.([^[]+)(\\[[^]+\\])?$/\r\n        const fieldName = err.dataPath.replace(expr, (match, plainName) => {\r\n            return plainName;\r\n        });\r\n        res[fieldName] = err.message;\r\n    });\r\n    return res;\r\n}\r\n\r\nexport async function validateOpen(type: string, data: object) {\r\n    return getSchema(type).then((schemaResponse: DataSetOpenSchemaResponse) => {\r\n        if (schemaResponse.status === \"error\") {\r\n            throw new Error(schemaResponse.msg);\r\n        }\r\n        // FIXME: cache compiled schema\r\n        const schema = schemaResponse.schema;\r\n        const ajv = new Ajv();\r\n        const validate = ajv.compile(schema);\r\n        const valid = validate(data);\r\n        if (!valid) {\r\n            if (validate.errors) {\r\n                const converted = convertErrors(validate.errors);\r\n                throw converted;\r\n            } else {\r\n                throw new Error(\"unspecified error while validating fields\");\r\n            }\r\n        }\r\n    })\r\n}","import { withFormik } from \"formik\";\r\nimport * as pathfind from 'path';\r\nimport { DatasetTypes } from \"../messages\";\r\nimport { OpenFormProps } from \"./types\";\r\nimport { validateOpen } from \"./validate\";\r\n\r\nexport function parseNumList(nums: string) {\r\n    return nums.split(\",\").filter(part => part.trim() !== \"\").map(part => +part);\r\n}\r\n\r\nexport function getInitial<T extends object, K extends keyof T, V>(key: K, otherwise: V, values?: T): V | T[K] {\r\n    if (!values) {\r\n        return otherwise;\r\n    }\r\n    const res = values[key] !== undefined ? values[key] : otherwise;\r\n    return res;\r\n}\r\n\r\nexport function getInitialName<T extends object, K extends keyof T>(key: K, otherwise: string, values?: T): string | T[K] {\r\n    if (!values) {\r\n        return pathfind.basename(otherwise);\r\n    }\r\n    const res = values[key] !== undefined ? values[key] : pathfind.basename(otherwise);\r\n    return res;\r\n}\r\n\r\nexport function isKnownDatasetType(detectedType: string) {\r\n  return (Object.keys(DatasetTypes).some((v) => v === detectedType) ? true : false);\r\n}\r\n\r\ntype FormToJsonFn<SubmitParams, FormParams> = (inParams: FormParams, path: string) => SubmitParams;\r\ntype PropsToValuesFn<SubmitParams, FormParams> = (props: OpenFormProps<SubmitParams>) => FormParams;\r\n\r\ninterface WithValidationOpts<SubmitParams extends object, FormParams> {\r\n    formToJson: FormToJsonFn<SubmitParams, FormParams>,\r\n    mapPropsToValues: PropsToValuesFn<SubmitParams, FormParams>,\r\n    type: DatasetTypes,\r\n    // WrappedComponent: React.FunctionComponent<FormikProps<FormParams> & OpenFormProps<SubmitParams>>\r\n}\r\n\r\nexport function withValidation<SubmitParams extends object, FormParams>(\r\n    opts: WithValidationOpts<SubmitParams, FormParams>\r\n) {\r\n    return withFormik<OpenFormProps<SubmitParams>, FormParams>({\r\n        mapPropsToValues: opts.mapPropsToValues,\r\n        handleSubmit: (values, formikBag) => {\r\n            const { onSubmit, path } = formikBag.props;\r\n            const submitData = opts.formToJson(values, path);\r\n            onSubmit(submitData);\r\n            formikBag.setSubmitting(false);\r\n        },\r\n        validate: (values, props) => {\r\n            return validateOpen(opts.type, opts.formToJson(values, props.path));\r\n        },\r\n        enableReinitialize: true,\r\n        validateOnChange: true,\r\n        validateOnBlur: true,\r\n    });\r\n}\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsBLO, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsBLOForForm = Omit<DatasetParamsBLO,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"tileshape\"> & {\r\n        tileshape: string,\r\n    };\r\n\r\ntype MergedProps = FormikProps<DatasetParamsBLOForForm> & OpenFormProps<DatasetParamsBLO>;\r\n\r\nconst BLOFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    isValidating,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_tileshape\">Tileshape:</label>\r\n                <ErrorMessage name=\"tileshape\" />\r\n                <Field name=\"tileshape\" id=\"id_tileshape\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting || isValidating}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsBLO, DatasetParamsBLOForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        tileshape: getInitial(\"tileshape\", \"1, 8, 128, 128\", initial).toString(),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.BLO,\r\n            name: values.name,\r\n            tileshape: parseNumList(values.tileshape),\r\n        };\r\n    },\r\n    type: DatasetTypes.BLO,\r\n})(BLOFileParamsForm);\r\n","import * as React from \"react\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\nimport { getEnumValues } from \"../../helpers\";\r\nimport { DatasetTypes } from \"../../messages\";\r\n\r\n\r\nconst datasetTypeKeys = getEnumValues(DatasetTypes);\r\nconst datasetTypeOptions = datasetTypeKeys.map(t => ({\r\n    // text: DatasetTypeMetadata[DatasetTypes[t as any]].short,\r\n    text: DatasetTypes[t],\r\n    value: DatasetTypes[t],\r\n}));\r\n\r\ninterface DatasetTypeSelectProps {\r\n    onClick: (e: React.SyntheticEvent, data: DropdownProps) => void,\r\n    currentType: DatasetTypes,\r\n}\r\n\r\nconst DatasetTypeSelect: React.SFC<DatasetTypeSelectProps> = ({ currentType, onClick }) => {\r\n    return (\r\n        <>\r\n            <Dropdown\r\n                inline={true}\r\n                options={datasetTypeOptions}\r\n                value={currentType}\r\n                onChange={onClick}\r\n            />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default DatasetTypeSelect;","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsEMPAD, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsEMPADForForm = Omit<DatasetParamsEMPAD,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"scan_size\"\r\n> & {\r\n    scan_size: string,\r\n};\r\n\r\ntype MergedProps = FormikProps<DatasetParamsEMPADForForm> & OpenFormProps<DatasetParamsEMPAD>;\r\n\r\nconst EMPADParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <Field name=\"scan_size\" id=\"id_scan_size\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsEMPAD, DatasetParamsEMPADForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.EMPAD,\r\n            name: values.name,\r\n            scan_size: parseNumList(values.scan_size),\r\n        };\r\n    },\r\n    type: DatasetTypes.EMPAD,\r\n})(EMPADParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsFRMS6, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsFRMS6ForForm = Omit<DatasetParamsFRMS6,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsFRMS6ForForm> & OpenFormProps<DatasetParamsFRMS6>;\r\nconst FRMS6ParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsFRMS6, DatasetParamsFRMS6ForForm>({\r\n    mapPropsToValues: ({ path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.FRMS6,\r\n            name: values.name,\r\n        };\r\n    },\r\n    type: DatasetTypes.FRMS6,\r\n})(FRMS6ParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsHDF5, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\ntype DatasetParamsHDF5ForForm = Omit<DatasetParamsHDF5, \"path\" | \"type\" | \"tileshape\"> & { tileshape: string, };\r\n\r\ntype MergedProps = FormikProps<DatasetParamsHDF5ForForm> & OpenFormProps<DatasetParamsHDF5>;\r\n\r\nconst HDF5ParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_ds_path\">HDF5 Dataset Path:</label>\r\n                <ErrorMessage name=\"ds_path\" />\r\n                <Field name=\"ds_path\" id=\"id_ds_path\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_tileshape\">Tileshape:</label>\r\n                <ErrorMessage name=\"tileshape\" />\r\n                <Field name=\"tileshape\" id=\"id_tileshape\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button onClick={onCancel} >Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsHDF5, DatasetParamsHDF5ForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        tileshape: getInitial(\"tileshape\", \"1, 8, 128, 128\", initial).toString(),\r\n        ds_path: getInitial(\"ds_path\", \"\", initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.HDF5,\r\n            name: values.name,\r\n            ds_path: values.ds_path,\r\n            tileshape: parseNumList(values.tileshape),\r\n        };\r\n    },\r\n    type: DatasetTypes.HDF5,\r\n})(HDF5ParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsK2IS, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsK2ISForForm = Omit<DatasetParamsK2IS,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsK2ISForForm> & OpenFormProps<DatasetParamsK2IS>;\r\n\r\nconst K2ISFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsK2IS, DatasetParamsK2ISForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.K2IS,\r\n            name: values.name,\r\n        }\r\n    },\r\n    type: DatasetTypes.K2IS,\r\n})(K2ISFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsMIB, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsMIBForForm = Omit<DatasetParamsMIB,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"tileshape\"\r\n    | \"scan_size\"\r\n> & {\r\n    tileshape: string,\r\n    scan_size: string,\r\n};\r\n\r\ntype FormValues = DatasetParamsMIBForForm\r\n\r\ntype MergedProps = FormikProps<FormValues> & OpenFormProps<DatasetParamsMIB>;\r\n\r\nconst MIBFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    isValidating,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_tileshape\">Tileshape:</label>\r\n                <ErrorMessage name=\"tileshape\" />\r\n                <Field name=\"tileshape\" id=\"id_tileshape\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <Field name=\"scan_size\" id=\"id_scan_size\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting || isValidating}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsMIB, DatasetParamsMIBForForm>({\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.MIB,\r\n            name: values.name,\r\n            tileshape: parseNumList(values.tileshape),\r\n            scan_size: parseNumList(values.scan_size),\r\n        }\r\n    },\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        tileshape: getInitial(\"tileshape\", \"1, 8, 256, 256\", initial).toString(),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n    }),\r\n    type: DatasetTypes.MIB,\r\n})(MIBFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsRaw, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsRawForForm = Omit<DatasetParamsRaw,\r\n    \"type\"\r\n    | \"path\"\r\n    | \"scan_size\"\r\n    | \"detector_size\"> & {\r\n        scan_size: string\r\n        detector_size: string,\r\n    };\r\n\r\ntype MergedProps = FormikProps<DatasetParamsRawForForm> & OpenFormProps<DatasetParamsRaw>;\r\n\r\nconst RawFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <Field name=\"scan_size\" id=\"id_scan_size\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_dtype\">Datatype (uint16, uint32, float32, float64, &gt;u2, ..., can be anything that is <a href=\"https://docs.scipy.org/doc/numpy-1.15.1/reference/arrays.dtypes.html\">understood by numpy as a dtype</a>):</label>\r\n                <ErrorMessage name=\"dtype\" />\r\n                <Field name=\"dtype\" id=\"id_dtype\" />\r\n            </Form.Field>\r\n\r\n            <Form.Field>\r\n                <label htmlFor=\"id_detector_size\">Detector Size (pixels, example: 256,256):</label>\r\n                <ErrorMessage name=\"detector_size\" />\r\n                <Field name=\"detector_size\" id=\"id_detector_size\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_enable_direct\">Enable Direct I/O (for usage with fast SSDs and files much larger than RAM):</label>\r\n                <ErrorMessage name=\"enable_direct\" />\r\n                <Field type=\"checkbox\" name=\"enable_direct\" id=\"id_enable_direct\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsRaw, DatasetParamsRawForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        enable_direct: getInitial(\"enable_direct\", false, initial),\r\n        detector_size: getInitial(\"detector_size\", \"\", initial).toString(),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n        dtype: getInitial(\"dtype\", \"float32\", initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.RAW,\r\n            name: values.name,\r\n            dtype: values.dtype,\r\n            enable_direct: values.enable_direct,\r\n            scan_size: parseNumList(values.scan_size),\r\n            detector_size: parseNumList(values.detector_size),\r\n        }\r\n    },\r\n    type: DatasetTypes.RAW,\r\n})(RawFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsSER, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsSERForForm = Omit<DatasetParamsSER,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsSERForForm> & OpenFormProps<DatasetParamsSER>;\r\nconst SERParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsSER, DatasetParamsSERForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.SER,\r\n            name: values.name,\r\n        }\r\n    },\r\n    type: DatasetTypes.SER,\r\n})(SERParamsForm);\r\n","import * as React from \"react\";\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { DropdownProps, Header, Segment } from \"semantic-ui-react\";\r\nimport uuid from \"uuid/v4\";\r\nimport { assertNotReached } from \"../../helpers\";\r\nimport { DatasetFormParams, DatasetTypes } from '../../messages';\r\nimport { RootReducer } from \"../../store\";\r\nimport * as datasetActions from \"../actions\";\r\nimport { OpenDatasetState } from \"../types\";\r\nimport BLOParamsForm from \"./BLOParamsForm\";\r\nimport DatasetTypeSelect from \"./DatasetTypeSelect\";\r\nimport EMPADParamsForm from \"./EMPADParamsForm\";\r\nimport FRMS6ParamsForm from \"./FRMS6ParamsForm\";\r\nimport HDF5ParamsForm from \"./HDF5ParamsForm\";\r\nimport K2ISParamsForm from \"./K2ISParamsForm\";\r\nimport MIBParamsForm from \"./MIBParamsForm\";\r\nimport RawFileParamsForm from \"./RawFileParamsForm\";\r\nimport SERParamsForm from \"./SERParamsForm\";\r\n\r\n\r\n/**\r\n * Get the initial selection for the dataset type dropdown. If we have a previous\r\n * user selection, we use it, but only if the reset button was not pressed. If it was,\r\n * we use the detected dataset type, falling back to RAW.\r\n *\r\n * @param didReset flag: was the reset button pressed?\r\n * @param openState complete OpenDatasetState instance\r\n */\r\nconst getDefaultDSType = (didReset: boolean, openState: OpenDatasetState) => {\r\n    const { formCachedParams, formDetectedParams } = openState;\r\n    if (didReset) {\r\n        return formDetectedParams ? formDetectedParams.type : DatasetTypes.RAW;\r\n    }\r\n    if (formCachedParams) {\r\n        return formCachedParams.type;\r\n    }\r\n    if (formDetectedParams) {\r\n        return formDetectedParams.type;\r\n    }\r\n    return DatasetTypes.RAW;\r\n}\r\n\r\n\r\n/**\r\n * Get the initial form field values. If we have previously entered values, we\r\n * use these, otherwise we use the detected parameters. If the reset button was\r\n * clicked, we use the detected params, but keep the original name field,\r\n *\r\n * @param didReset flag: was the reset button pressed?\r\n * @param openState complete OpenDatasetState instance\r\n */\r\n\r\nconst getFormInitial = (didReset: boolean, openState: OpenDatasetState) => {\r\n    const { formCachedParams, formDetectedParams } = openState;\r\n    if (didReset) {\r\n        if (formDetectedParams) {\r\n            return {\r\n                name: formCachedParams ? formCachedParams.name : \"\",\r\n                ...formDetectedParams,\r\n            };\r\n        }\r\n        return undefined;\r\n    }\r\n    if (formCachedParams) {\r\n        return formCachedParams;\r\n    } else {\r\n        return formDetectedParams;\r\n    }\r\n}\r\n\r\n/**\r\n * Dispatch to specific dataset opening forms, including a selection of dataset type\r\n * via a dropdown.\r\n */\r\nconst DatasetOpen = () => {\r\n    const dispatch = useDispatch();\r\n    const openState = useSelector((state: RootReducer) => state.openDataset);\r\n\r\n    const [didReset, setReset] = React.useState(false);\r\n    const formInitial = getFormInitial(didReset, openState);\r\n    const defaultType = getDefaultDSType(didReset, openState);\r\n    const [datasetType, setDatasetType] = React.useState(defaultType);\r\n\r\n    const doSetType = (e: React.SyntheticEvent, data: DropdownProps) => setDatasetType(data.value as DatasetTypes);\r\n    // FIXME: find out how to make ts correctly correlate the types of FormComponent\r\n    // and initial and replace the huge switch below with something like:\r\n    // const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n    // const formComponentMap = {\r\n    //     [DatasetTypes.HDF5]: HDF5ParamsForm,\r\n    //     [DatasetTypes.RAW]: RawFileParamsForm,\r\n    //     [DatasetTypes.MIB]: MIBParamsForm,\r\n    //     [DatasetTypes.BLO]: BLOParamsForm,\r\n    //     [DatasetTypes.K2IS]: K2ISParamsForm,\r\n    //     [DatasetTypes.SER]: SERParamsForm,\r\n    //     [DatasetTypes.FRMS6]: FRMS6ParamsForm,\r\n    //     [DatasetTypes.EMPAD]: EMPADParamsForm,\r\n    // }\r\n    // const FormComponent = formComponentMap[datasetType];\r\n\r\n    const renderForm = (form: React.ReactNode) => {\r\n        return (\r\n            <Segment>\r\n                Type: <DatasetTypeSelect onClick={doSetType} currentType={datasetType} />\r\n                <Header as=\"h2\">Open: {openState.formPath}</Header>\r\n                {form}\r\n            </Segment>\r\n        );\r\n    }\r\n\r\n    const commonParams = {\r\n        path: openState.formPath,\r\n        onSubmit: (params: DatasetFormParams) => {\r\n            dispatch(datasetActions.Actions.create({\r\n                id: uuid(),\r\n                params,\r\n            }))\r\n        },\r\n        onCancel: () => dispatch(datasetActions.Actions.cancelOpen()),\r\n        onReset: () => {\r\n            setReset(true);\r\n            setDatasetType(getDefaultDSType(true, openState));\r\n        },\r\n    }\r\n\r\n    switch (datasetType) {\r\n        case DatasetTypes.HDF5: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<HDF5ParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.RAW: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<RawFileParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.MIB: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<MIBParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.BLO: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<BLOParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.K2IS: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<K2ISParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.SER: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<SERParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.FRMS6: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<FRMS6ParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.EMPAD: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<EMPADParamsForm {...commonParams} initial={initial} />)\r\n        }\r\n    }\r\n    return assertNotReached(\"unknown dataset type\");\r\n}\r\n\r\nexport default DatasetOpen;\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\n\r\nexport enum ActionTypes {\r\n    DISMISS = \"ERROR_DISMISS\",\r\n    DISMISS_ALL = \"ERROR_DISMISS_ALL\",\r\n}\r\n\r\nexport const Actions = {\r\n    dismiss: (id: string) => createAction(ActionTypes.DISMISS, { id }),\r\n    dismissAll: () => createAction(ActionTypes.DISMISS_ALL),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, Icon, Message } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        busy: state.openDataset.busy,\r\n        path: state.openDataset.busyPath,\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst DatasetOpenSpinner: React.SFC<MergedProps> = ({ busy, path }) => {\r\n    if (!busy) {\r\n        return null;\r\n    }\r\n    return (\r\n        <>\r\n            <Header as=\"h2\" dividing={true}>Loading...</Header>\r\n            <Message icon={true}>\r\n                <Icon name='cog' loading={true} />\r\n                <Message.Content>\r\n                    <Message.Header>Detecting parameters for {path}</Message.Header>\r\n                </Message.Content>\r\n            </Message>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(DatasetOpenSpinner);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport BrowserWrapper from \"../../browser/components/BrowserWrapper\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { DatasetsState } from \"../types\";\r\nimport Dataset from \"./Dataset\";\r\nimport DatasetOpen from \"./DatasetOpen\";\r\nimport DatasetOpenSpinner from \"./DatasetOpenSpinner\";\r\n\r\ninterface DatasetListProps {\r\n    datasets: DatasetsState\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        datasets: state.datasets,\r\n        formVisible: state.openDataset.formVisible,\r\n        formPath: state.openDataset.formPath,\r\n    };\r\n}\r\n\r\ntype MergedProps = DatasetListProps & ReturnType<typeof mapStateToProps>;\r\n\r\nclass DatasetList extends React.Component<MergedProps> {\r\n    public render() {\r\n        const { formVisible, datasets } = this.props;\r\n\r\n        return (\r\n            <>\r\n                {datasets.ids.map((dsId: string) => <Dataset dataset={datasets.byId[dsId]} key={dsId} />)}\r\n                <DatasetOpenSpinner />\r\n                {formVisible && <DatasetOpen />}\r\n                <BrowserWrapper />\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(DatasetList);","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Dispatch } from 'redux';\r\nimport { Message } from 'semantic-ui-react';\r\nimport * as errorActions from '../actions';\r\nimport { ErrorMessage } from '../reducers';\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: ErrorProps) => {\r\n    return {\r\n        dismiss: () => dispatch(errorActions.Actions.dismiss(ownProps.error.id)),\r\n    }\r\n}\r\n\r\ninterface ErrorProps {\r\n    error: ErrorMessage,\r\n}\r\n\r\ntype MergedProps = ErrorProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst ErrorComponent: React.SFC<MergedProps> = ({ dismiss, error }) => {\r\n    return (\r\n        <Message negative={true} onDismiss={dismiss}>{error.msg}</Message>\r\n    )\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(ErrorComponent);","import * as React from \"react\";\r\nimport { connect, useDispatch } from \"react-redux\";\r\nimport { Modal } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { Actions } from \"../actions\";\r\nimport Error from \"./Error\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        errors: state.errors,\r\n        clusterConnected: state.clusterConnection.status === \"connected\",\r\n        channelConnected: (state.channelStatus.status === \"connected\" ||\r\n            state.channelStatus.status === \"ready\"),\r\n    }\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst ErrorList: React.SFC<MergedProps> = ({ errors, clusterConnected, channelConnected }) => {\r\n    const numShown = 3;\r\n    const latestErrors = errors.ids.slice(Math.max(0, errors.ids.length - numShown));\r\n    const showModal = errors.ids.length > 0 && clusterConnected && channelConnected;\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        const handleEsc = (ev: KeyboardEvent) => {\r\n            if(ev.code === \"Escape\" || ev.keyCode === 27) {\r\n                dispatch(Actions.dismissAll());\r\n            }\r\n        }\r\n        document.addEventListener(\"keyup\", handleEsc);\r\n\r\n        return () => {\r\n            document.removeEventListener(\"keyup\", handleEsc);\r\n        };\r\n    });\r\n\r\n    return (\r\n        <Modal open={showModal}>\r\n            {latestErrors.map(error => <Error error={errors.byId[error]} key={error} />)}\r\n        </Modal>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(ErrorList);","import * as React from 'react';\r\nimport 'semantic-ui-css/semantic.min.css';\r\nimport { Container, Icon, Modal, Popup } from 'semantic-ui-react';\r\nimport About from './About';\r\nimport ChannelStatus from './channel/components/ChannelStatus';\r\nimport DatasetList from './dataset/components/DatasetList';\r\nimport ErrorList from './errors/components/ErrorList';\r\nimport logo from './images/LiberTEM logo-medium.png';\r\n\r\nclass App extends React.Component {\r\n    public render() {\r\n        return (\r\n            <Container style={{ margin: \"5em 1em 5em 1em\" }}>\r\n                <div style={{ display: \"flex\" }}>\r\n                    <img src={logo} width=\"200\" height=\"46\" alt=\"LiberTEM\" style={{ marginBottom: \"20px\" }} />\r\n                    {' '}\r\n                    <Modal trigger={\r\n                        <Icon name=\"info circle\" link={true} style={{ alignSelf: \"flex-start\" }} />\r\n                    }>\r\n                        <Popup.Header>About LiberTEM</Popup.Header>\r\n                        <Popup.Content>\r\n                            <About />\r\n                        </Popup.Content>\r\n                    </Modal>\r\n                </div>\r\n                <ErrorList />\r\n                <ChannelStatus>\r\n                    <DatasetList />\r\n                </ChannelStatus>\r\n            </Container>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// tslint:disable:no-console\r\n// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the 'N+1' visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL!,\r\n      window.location.toString()\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker) {\r\n          installingWorker.onstatechange = () => {\r\n            if (installingWorker.state === 'installed') {\r\n              if (navigator.serviceWorker.controller) {\r\n                // At this point, the old content will have been purged and\r\n                // the fresh content will have been added to the cache.\r\n                // It's the perfect time to display a 'New content is\r\n                // available; please refresh.' message in your web app.\r\n                console.log('New content is available; please refresh.');\r\n              } else {\r\n                // At this point, everything has been precached.\r\n                // It's the perfect time to display a\r\n                // 'Content is cached for offline use.' message.\r\n                console.log('Content is cached for offline use.');\r\n              }\r\n            }\r\n          };\r\n        }\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type')!.indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\n\r\nexport enum ActionTypes {\r\n    CREATE = 'JOB_CREATE',\r\n}\r\n\r\nexport const Actions = {\r\n    create: (id: string, dataset: string, timestamp: number) => createAction(ActionTypes.CREATE, { id, dataset, timestamp }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n\r\nexport type ActionParts = {\r\n    [K in keyof typeof Actions]: ReturnType<typeof Actions[K]>\r\n}","import { AnalysisDetails, CancelJobResponse, StartJobRequest, StartJobResponse } from \"../messages\";\r\n\r\nexport function startJob(jobId: string, datasetId: string, analysis: AnalysisDetails): Promise<StartJobResponse> {\r\n    const payload: StartJobRequest = {\r\n        job: {\r\n            dataset: datasetId,\r\n            analysis,\r\n        }\r\n    }\r\n    return fetch(`/api/jobs/${jobId}/`, {\r\n        body: JSON.stringify(payload),\r\n        credentials: \"same-origin\",\r\n        method: \"PUT\",\r\n    }).then(r => r.json());\r\n}\r\n\r\nexport function cancelJob(jobId: string): Promise<CancelJobResponse> {\r\n    return fetch(`/api/jobs/${jobId}/`, {\r\n        method: \"DELETE\",\r\n        credentials: \"same-origin\",\r\n    }).then(r => r.json());\r\n}","import { buffers } from 'redux-saga';\r\nimport { actionChannel, call, cancel, fork, put, select, take, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as jobActions from '../job/actions';\r\nimport { cancelJob, startJob } from '../job/api';\r\nimport { JobState } from '../job/types';\r\nimport { DatasetState, DatasetStatus } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as analysisActions from './actions';\r\nimport { AnalysisState } from './types';\r\n\r\nfunction selectDataset(state: RootReducer, dataset: string) {\r\n    return state.datasets.byId[dataset];\r\n}\r\n\r\nfunction selectAnalysis(state: RootReducer, id: string) {\r\n    return state.analyses.byId[id];\r\n}\r\n\r\nfunction selectJob(state: RootReducer, id: string) {\r\n    return state.jobs.byId[id];\r\n}\r\n\r\n\r\nexport function* createAnalysisSaga(action: ReturnType<typeof analysisActions.Actions.create>) {\r\n    try {\r\n        const datasetState: DatasetState = yield select(selectDataset, action.payload.dataset)\r\n        if (datasetState.status !== DatasetStatus.OPEN) {\r\n            throw new Error(\"invalid dataset status\");\r\n        }\r\n        const analysis: AnalysisState = {\r\n            id: uuid(),\r\n            dataset: action.payload.dataset,\r\n            mainAnalysisType: action.payload.analysisType,\r\n            jobs: [],\r\n            jobHistory: [],\r\n        }\r\n\r\n        const sidecarTask = yield fork(analysisSidecar, analysis.id);\r\n\r\n        yield put(analysisActions.Actions.created(analysis));\r\n\r\n        while (true) {\r\n            const removeAction: ReturnType<typeof analysisActions.Actions.remove> = yield take(analysisActions.ActionTypes.REMOVE);\r\n            if (removeAction.payload.id === analysis.id) {\r\n                yield cancel(sidecarTask);\r\n            }\r\n        }\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(analysisActions.Actions.error(`Error creating analysis: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* cancelOldJob(analysis: AnalysisState, jobIndex: number) {\r\n    const jobId = analysis.jobs[jobIndex];\r\n    if (jobId === undefined) {\r\n        return;\r\n    } else {\r\n        const job: JobState = yield select(selectJob, jobId);\r\n        if (job.running !== \"DONE\") {\r\n            yield call(cancelJob, jobId);\r\n        }\r\n    }\r\n}\r\n\r\nexport function* analysisSidecar(analysisId: string) {\r\n    // channel for incoming actions:\r\n    // all actions that arrive while we block in `call` will be buffered here.\r\n    // because the buffer is sliding of size 1, we only keep the latest action!\r\n    const runOrParamsChannel = yield actionChannel(analysisActions.ActionTypes.RUN, buffers.sliding(2));\r\n\r\n    while (true) {\r\n        try {\r\n            const action: analysisActions.ActionParts[\"run\"] = yield take(runOrParamsChannel);\r\n\r\n            // ignore actions meant for other analyses\r\n            if (action.payload.id !== analysisId) {\r\n                continue;\r\n            }\r\n\r\n            // get the current state incl. configuration\r\n            const analysis: AnalysisState = yield select(selectAnalysis, analysisId);\r\n            const { jobIndex, parameters } = action.payload;\r\n\r\n            // prepare running the job:\r\n            const jobId = uuid();\r\n            yield put(jobActions.Actions.create(jobId, analysis.dataset, Date.now()));\r\n            yield put(analysisActions.Actions.prepareRun(analysis.id, jobIndex, jobId));\r\n\r\n            const oldJobId = analysis.jobs[jobIndex];\r\n            if (oldJobId !== undefined) {\r\n                const job: JobState = yield select(selectJob, oldJobId);\r\n                if (job && job.running !== \"DONE\") {\r\n                    // wait until the job is cancelled:\r\n                    yield call(cancelJob, oldJobId);\r\n                }\r\n            }\r\n\r\n            // FIXME: we have a race here, as the websocket msg FINISH_JOB may\r\n            // arrive before call(startJob, ...) returns. this causes the apply button\r\n            // to feel unresponsive (the action gets done, but only after we finish here...)\r\n            // best reproduced in \"Slow 3G\" network simulation mode in devtools\r\n\r\n            // wait until the job is started\r\n            yield call(startJob, jobId, analysis.dataset, parameters);\r\n            yield put(analysisActions.Actions.running(analysis.id, jobId, jobIndex));\r\n        } catch (e) {\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            yield put(analysisActions.Actions.error(`Error running analysis: ${e.toString()}`, timestamp, id));\r\n        }\r\n    }\r\n}\r\n\r\nexport function* doRemoveAnalysisSaga(action: ReturnType<typeof analysisActions.Actions.remove>) {\r\n    // const analysis: AnalysisState = yield select(selectAnalysis, action.payload.id)\r\n    try {\r\n        // TODO: cancel all jobs! loop over all of them...\r\n        // yield call(cancelOldJob, analysis, \"RESULT\");\r\n        // yield call(cancelOldJob, analysis, \"FRAME\");\r\n    } finally {\r\n        yield put(analysisActions.Actions.removed(action.payload.id));\r\n    }\r\n}\r\n\r\nexport function* analysisRootSaga() {\r\n    yield takeEvery(analysisActions.ActionTypes.CREATE, createAnalysisSaga);\r\n    yield takeEvery(analysisActions.ActionTypes.REMOVE, doRemoveAnalysisSaga);\r\n}","import _ from 'lodash';\r\nimport { MsgPartConfig } from \"../messages\";\r\nimport { ConfigParams, ConfigState, LocalConfig } from \"./reducers\";\r\n\r\nconst CONFIG_KEY = \"LiberTEM.config\";\r\n\r\nexport function joinPaths(config: ConfigState, ...parts: string[]) {\r\n    const removeSep = (part: string) => part.replace(new RegExp(`${_.escapeRegExp(config.separator)}$`), \"\")\r\n    parts = [removeSep(parts[0]), ...parts.slice(1)];\r\n    return parts.map(part => part.trim()).join(config.separator);\r\n}\r\n\r\nexport function mergeLocalStorage(serverConfig: MsgPartConfig): ConfigParams {\r\n    const localSettings = window.localStorage.getItem(CONFIG_KEY);\r\n    if (localSettings === null) {\r\n        return Object.assign({}, serverConfig, getDefaultLocalConfig(serverConfig));\r\n    }\r\n    const localSettingsParsed = JSON.parse(localSettings);\r\n    const defaultConfig = getDefaultLocalConfig(serverConfig);\r\n    const mergedConfig = Object.assign({}, defaultConfig, serverConfig, localSettingsParsed);\r\n    return mergedConfig;\r\n}\r\n\r\nexport function setLocalStorage(config: ConfigState): void {\r\n    const localSettings: LocalConfig = {\r\n        cwd: config.cwd,\r\n        lastOpened: config.lastOpened,\r\n        fileHistory: config.fileHistory,\r\n    }\r\n\r\n    window.localStorage.setItem(CONFIG_KEY, JSON.stringify(localSettings));\r\n}\r\n\r\nexport function clearLocalStorage(): void {\r\n    window.localStorage.removeItem(CONFIG_KEY);\r\n}\r\n\r\nexport function getDefaultLocalConfig(config: MsgPartConfig): LocalConfig {\r\n    return {\r\n        lastOpened: {},\r\n        fileHistory: [],\r\n        cwd: \"/\",\r\n    };\r\n}\r\n\r\nexport function makeUnique<T>(inp: T[]): T[] {\r\n    return inp.reduce((acc: T[], curr: T) => {\r\n        if (acc.indexOf(curr) === -1) {\r\n            return [...acc, curr];\r\n        } else {\r\n            return acc;\r\n        }\r\n    }, [] as T[]);\r\n}","import { DirectoryListingResponse } from \"../messages\";\r\n\r\nexport function getDirectoryListing(path: string): Promise<DirectoryListingResponse> {\r\n    const url = `/api/browse/localfs/?path=${encodeURIComponent(path)}`;\r\n    return fetch(url, {\r\n        method: 'GET',\r\n        credentials: \"same-origin\",\r\n    }).then(r => r.json());\r\n}","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { JobResultType } from '../job/types';\r\nimport { MsgPartInitialDataset, MsgPartJob } from '../messages';\r\n\r\n\r\nexport type PartialResultType = JobResultType;\r\n\r\nexport enum ActionTypes {\r\n    INITIAL_STATE = 'CHANNEL_INITIAL_STATE',\r\n    JOB_STARTED = 'CHANNEL_JOB_STARTED',\r\n    FINISH_JOB = 'CHANNEL_FINISH_JOB',\r\n    TASK_RESULT = 'CHANNEL_TASK_RESULT',\r\n    JOB_ERROR = 'CHANNEL_JOB_ERROR',\r\n    OPEN = \"CHANNEL_OPEN\",\r\n    CLOSE = \"CHANNEL_CLOSE\",\r\n    ERROR = \"CHANNEL_ERROR\",\r\n    CANCELLED = \"CANCELLED\",\r\n}\r\n\r\nexport const Actions = {\r\n    initialState: (jobs: MsgPartJob[], datasets: MsgPartInitialDataset[], timestamp: number) => createAction(ActionTypes.INITIAL_STATE, { jobs, datasets, timestamp }),\r\n    jobStarted: (job: string, dataset: string, timestamp: number) => createAction(ActionTypes.JOB_STARTED, { job, timestamp, dataset }),\r\n    finishJob: (job: string, results: JobResultType[], timestamp: number) => createAction(ActionTypes.FINISH_JOB, { job, results, timestamp }),\r\n    taskResult: (job: string, results: PartialResultType[], timestamp: number) => createAction(ActionTypes.TASK_RESULT, { job, results, timestamp }),\r\n    jobError: (job: string, msg: string, id: string, timestamp: number) => createAction(ActionTypes.JOB_ERROR, { job, msg, id, timestamp }),\r\n    open: (timestamp: number) => createAction(ActionTypes.OPEN, { timestamp }),\r\n    close: (timestamp: number) => createAction(ActionTypes.CLOSE, { timestamp }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n    cancelled: (job: string) => createAction(ActionTypes.CANCELLED, { job }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import { call, fork, put, select, take } from \"redux-saga/effects\";\r\nimport uuid from 'uuid/v4';\r\nimport { joinPaths } from \"../config/helpers\";\r\nimport { ConfigState } from \"../config/reducers\";\r\nimport { DirectoryListingResponse } from \"../messages\";\r\nimport { RootReducer } from \"../store\";\r\nimport * as browserActions from './actions';\r\nimport { getDirectoryListing } from \"./api\";\r\nimport { DirectoryBrowserState } from \"./types\";\r\n\r\nexport function* directoryListingSaga() {\r\n    yield fork(fetchOnRequest);\r\n    yield fork(fetchDirectoryListOnOpen);\r\n}\r\n\r\nfunction* fetchOnRequest() {\r\n    while (true) {\r\n        const action: ReturnType<typeof browserActions.Actions.list> = yield take(browserActions.ActionTypes.LIST_DIRECTORY);\r\n\r\n        const { name, path } = action.payload;\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config)\r\n        const newPath = name !== undefined ? joinPaths(config, path, name) : path;\r\n        yield fork(fetchDirectoryListing, newPath);\r\n    }\r\n}\r\n\r\nfunction* fetchDirectoryListing(path: string) {\r\n    try {\r\n        const result: DirectoryListingResponse = yield call(getDirectoryListing, path);\r\n        if (result.status === \"ok\") {\r\n            yield put(browserActions.Actions.dirListing(result.path, result.dirs, result.files, result.drives, result.places));\r\n        } else if (result.status === \"error\") {\r\n            const browserState: DirectoryBrowserState = yield select((state: RootReducer) => state.browser);\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            const alternative = result.alternative ? result.alternative : browserState.places.home.path;\r\n            yield put(browserActions.Actions.error(`Error browsing directory: ${result.msg}`, timestamp, id));\r\n            yield put(browserActions.Actions.list(alternative));\r\n        }\r\n    } catch (e) {\r\n        const browserState: DirectoryBrowserState = yield select((state: RootReducer) => state.browser);\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(browserActions.Actions.error(`Error browsing directory: ${e.toString()}`, timestamp, id));\r\n        yield put(browserActions.Actions.list(browserState.places.home.path));\r\n    }\r\n}\r\n\r\nfunction* fetchDirectoryListOnOpen() {\r\n    while (true) {\r\n        yield take(browserActions.ActionTypes.OPEN);\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config)\r\n        yield put(browserActions.Actions.list(config.cwd));\r\n    }\r\n}","import { ActionCreatorsMapObject } from \"redux\";\r\nimport { FollowupPart, MsgPartInitialDataset, MsgPartJob } from \"../messages\";\r\n\r\nexport interface Message<T extends string> {\r\n    messageType: T\r\n}\r\n\r\nexport function createMessage<T extends string, O>(messageType: T, attribs: O) {\r\n    return Object.assign({ messageType }, attribs);\r\n}\r\n\r\nexport enum MessageTypes {\r\n    INITIAL_STATE = \"INITIAL_STATE\",\r\n    JOB_STARTED = \"JOB_STARTED\",\r\n    FINISH_JOB = \"FINISH_JOB\",\r\n    TASK_RESULT = \"TASK_RESULT\",\r\n    JOB_ERROR = \"JOB_ERROR\",\r\n    BINARY = \"BINARY\",\r\n    OPEN = \"OPEN\",\r\n    CLOSE = \"CLOSE\",\r\n    ERROR = \"ERROR\",\r\n    DELETE_DATASET = \"DELETE_DATASET\",\r\n    CANCEL_JOB_DONE = \"CANCEL_JOB_DONE\",\r\n}\r\n\r\nexport const Messages = {\r\n    initialState: (jobs: MsgPartJob[], datasets: MsgPartInitialDataset[]) => createMessage(MessageTypes.INITIAL_STATE, { jobs, datasets }),\r\n    startJob: (job: string, dataset: string) => createMessage(MessageTypes.JOB_STARTED, { job, dataset }),\r\n    finishJob: (job: string, followup: FollowupPart) => createMessage(MessageTypes.FINISH_JOB, { job, followup }),\r\n    taskResult: (job: string, followup: FollowupPart) => createMessage(MessageTypes.TASK_RESULT, { job, followup }),\r\n    jobError: (job: string, msg: string) => createMessage(MessageTypes.JOB_ERROR, { job, msg }),\r\n    binary: (objectURL: string) => createMessage(MessageTypes.BINARY, { objectURL }),\r\n    open: () => createMessage(MessageTypes.OPEN, {}),\r\n    close: () => createMessage(MessageTypes.CLOSE, {}),\r\n    error: (msg: string) => createMessage(MessageTypes.ERROR, { msg }),\r\n    deleteDataset: (dataset: string) => createMessage(MessageTypes.DELETE_DATASET, { dataset }),\r\n    cancelled: (job: string) => createMessage(MessageTypes.CANCEL_JOB_DONE, { job }),\r\n}\r\n\r\nexport type MessagesUnion<A extends ActionCreatorsMapObject> = ReturnType<A[keyof A]>\r\nexport type Messages = MessagesUnion<typeof Messages>;\r\n\r\n// types of messages sent by the server:\r\n/*\r\nexport type InitialStateMessage = ReturnType<typeof Messages.initialState>;\r\nexport type StartJobMessage = ReturnType<typeof Messages.startJob>;\r\nexport type FinishJobMessage = ReturnType<typeof Messages.finishJob>;\r\nexport type TaskResultMessage = ReturnType<typeof Messages.taskResult>;\r\n*/\r\n\r\nexport type BinaryMessage = ReturnType<typeof Messages.binary>;","import { END, eventChannel, EventChannel } from \"redux-saga\";\r\nimport { call, delay, fork, put, take } from \"redux-saga/effects\";\r\nimport uuid from 'uuid/v4';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport * as channelActions from \"./actions\";\r\nimport * as channelMessages from './messages';\r\n\r\ntype SocketChannel = EventChannel<channelMessages.Messages>;\r\n\r\n\r\n/**\r\n * create typesafe messages from the websocket messages\r\n * \r\n * also creates some synthetic events like open, close, error\r\n */\r\nfunction createWebSocketChannel(/* addr */): SocketChannel {\r\n    return eventChannel(emit => {\r\n        function onMessage(msg: MessageEvent) {\r\n            if (msg.data instanceof Blob) {\r\n                // TODO: cleanup createObjectURL results somewhere\r\n                emit(channelMessages.Messages.binary(URL.createObjectURL(msg.data)));\r\n            } else {\r\n                const parsed = JSON.parse(msg.data) as channelMessages.Messages;\r\n                emit(parsed);\r\n            }\r\n        }\r\n\r\n        function onOpen() {\r\n            emit(channelMessages.Messages.open());\r\n        }\r\n\r\n        function onClose() {\r\n            emit(channelMessages.Messages.close());\r\n            emit(END);\r\n        }\r\n\r\n        function onError(err: Event) {\r\n            emit(channelMessages.Messages.error(\"Error in weboscket connection\"));\r\n        }\r\n\r\n        const ws = new WebSocket(`ws://${window.location.hostname}:${window.location.port}/api/events/`);\r\n        ws.addEventListener(\"message\", onMessage);\r\n        ws.addEventListener(\"open\", onOpen);\r\n        ws.addEventListener(\"close\", onClose);\r\n        ws.addEventListener(\"error\", onError);\r\n\r\n        // return cleanup function:\r\n        return () => {\r\n            ws.removeEventListener(\"message\", onMessage);\r\n            ws.removeEventListener(\"open\", onOpen);\r\n            ws.removeEventListener(\"close\", onClose);\r\n            ws.removeEventListener(\"error\", onError);\r\n            // TODO: close connection if still open\r\n            // (or is it guaranteed that if an error was thrown, the connection is closed?)\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * handles the connection lifecycle for our websocket\r\n */\r\nexport function* webSocketSaga() {\r\n    while (true) {\r\n        const socketChannel = yield call(createWebSocketChannel);\r\n        yield fork(actionsFromChannel, socketChannel);\r\n        const action: channelActions.Actions = yield take([\r\n            channelActions.ActionTypes.OPEN,\r\n            channelActions.ActionTypes.CLOSE,\r\n        ]);\r\n        if (action.type === channelActions.ActionTypes.OPEN) {\r\n            yield take([\r\n                channelActions.ActionTypes.CLOSE,\r\n                channelActions.ActionTypes.ERROR,\r\n            ]);\r\n        }\r\n        yield delay(1000);\r\n    }\r\n}\r\n\r\n/**\r\n * translates the messages from the channel to redux actions, handles aggregation etc.\r\n */\r\nexport function* actionsFromChannel(socketChannel: SocketChannel) {\r\n    try {\r\n        while (true) {\r\n            const msg = yield take(socketChannel);\r\n            const timestamp = Date.now();\r\n            switch (msg.messageType) {\r\n                case channelMessages.MessageTypes.OPEN: {\r\n                    yield put(channelActions.Actions.open(timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.CLOSE: {\r\n                    yield put(channelActions.Actions.close(timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.ERROR: {\r\n                    const id = uuid();\r\n                    yield put(channelActions.Actions.error(msg.msg, timestamp, id));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.INITIAL_STATE: {\r\n                    yield put(channelActions.Actions.initialState(msg.jobs, msg.datasets, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.JOB_STARTED: {\r\n                    yield put(channelActions.Actions.jobStarted(msg.job, msg.details.dataset, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.FINISH_JOB: {\r\n                    yield call(handleFinishJob, msg, socketChannel, timestamp);\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.TASK_RESULT: {\r\n                    yield call(handleTaskResult, msg, socketChannel, timestamp);\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.DELETE_DATASET: {\r\n                    yield put(datasetActions.Actions.deleted(msg.dataset));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.JOB_ERROR: {\r\n                    const id = uuid();\r\n                    yield put(channelActions.Actions.jobError(msg.job, msg.msg, id, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.CANCEL_JOB_DONE: {\r\n                    yield put(channelActions.Actions.cancelled(msg.job));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    } finally {\r\n        // disconnected\r\n    }\r\n}\r\n\r\nexport function* handleBinaryParts(numParts: number, socketChannel: SocketChannel) {\r\n    const parts: channelMessages.BinaryMessage[] = [];\r\n    while (parts.length < numParts) {\r\n        const binMsg = yield take(socketChannel)\r\n        parts.push(binMsg);\r\n    }\r\n    return parts;\r\n}\r\n\r\nexport function* handleTaskResult(msg: ReturnType<typeof channelMessages.Messages.taskResult>, socketChannel: SocketChannel, timestamp: number) {\r\n    const parts: channelMessages.BinaryMessage[] = yield call(handleBinaryParts, msg.followup.numMessages, socketChannel);\r\n    const images = parts.map((part, idx) => ({ imageURL: part.objectURL, description: msg.followup.descriptions[idx] }));\r\n    yield put(channelActions.Actions.taskResult(msg.job, images, timestamp));\r\n}\r\n\r\nexport function* handleFinishJob(msg: ReturnType<typeof channelMessages.Messages.finishJob>, socketChannel: SocketChannel, timestamp: number) {\r\n    const parts: channelMessages.BinaryMessage[] = yield call(handleBinaryParts, msg.followup.numMessages, socketChannel);\r\n    const images = parts.map((part, idx) => ({ imageURL: part.objectURL, description: msg.followup.descriptions[idx] }));\r\n    yield put(channelActions.Actions.finishJob(msg.job, images, timestamp));\r\n}","import { ConnectRequest, ConnectRequestParams, ConnectResponse } from \"../messages\";\r\n\r\nexport function connectToCluster(params: ConnectRequestParams): Promise<ConnectResponse> {\r\n    const payload: ConnectRequest = {\r\n        connection: params\r\n    }\r\n    return fetch(`/api/config/connection/`, {\r\n        body: JSON.stringify(payload),\r\n        credentials: \"same-origin\",\r\n        method: \"PUT\",\r\n    }).then(r => r.json());\r\n}\r\n\r\nexport function checkClusterConnection(): Promise<ConnectResponse> {\r\n    return fetch(`/api/config/connection/`, {\r\n        method: 'GET',\r\n    }).then(r => r.json());\r\n}","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { ConfigParams } from \"./reducers\";\r\n\r\nexport enum ActionTypes {\r\n    FETCHED = \"CONFIG_FETCHED\",\r\n    FETCH = \"CONFIG_FETCH\",\r\n    FETCH_FAILED = \"CONFIG_FETCH_FAILED\",\r\n}\r\n\r\nexport const Actions = {\r\n    fetch: () => createAction(ActionTypes.FETCH),\r\n    fetched: (config: ConfigParams) => createAction(ActionTypes.FETCHED, { config }),\r\n    fetchFailed: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.FETCH_FAILED, { msg, timestamp, id }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import { all, call, put, take, takeEvery } from \"redux-saga/effects\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { ConnectResponse } from \"../messages\";\r\nimport * as clusterActions from './actions';\r\nimport { checkClusterConnection, connectToCluster } from \"./api\";\r\n\r\nfunction* connectSaga(action: ReturnType<typeof clusterActions.Actions.connect>) {\r\n    const conn: ConnectResponse = yield call(connectToCluster, action.payload.params);\r\n    yield call(putClusterStatus, conn);\r\n}\r\n\r\nfunction* putClusterStatus(conn: ConnectResponse) {\r\n    if (conn.status === \"ok\") {\r\n        yield put(clusterActions.Actions.connected(conn.connection.connection));\r\n    } else {\r\n        yield put(clusterActions.Actions.notConnected());\r\n    }\r\n}\r\n\r\n/**\r\n * when the channel is connected, check if cluster is connected and update status accordingly\r\n */\r\nfunction* trackClusterConnection() {\r\n    while (true) {\r\n        yield take(channelActions.ActionTypes.OPEN)\r\n        const conn: ConnectResponse = yield call(checkClusterConnection);\r\n        yield call(putClusterStatus, conn);\r\n    }\r\n}\r\n\r\nexport function* clusterConnectionSaga() {\r\n    yield takeEvery(clusterActions.ActionTypes.CONNECT, connectSaga);\r\n    yield all([\r\n        trackClusterConnection(),\r\n    ])\r\n}","import { GetConfigResponse } from \"../messages\";\r\n\r\nexport function getConfig(): Promise<GetConfigResponse> {\r\n    return fetch(`/api/config/`, {\r\n        method: \"GET\",\r\n        credentials: \"same-origin\",\r\n    }).then(r => r.json());\r\n}","import { call, fork, put, select, take, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as browserActions from '../browser/actions';\r\nimport * as channelActions from '../channel/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { GetConfigResponse } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as configActions from './actions';\r\nimport { getConfig } from './api';\r\nimport { clearLocalStorage, getDefaultLocalConfig, mergeLocalStorage, setLocalStorage } from './helpers';\r\nimport { ConfigState } from './reducers';\r\n\r\nfunction* getConfigOnReconnect() {\r\n    yield takeEvery(channelActions.ActionTypes.OPEN, getConfigSaga);\r\n}\r\n\r\n/**\r\n * get config from server and try to merge in the localStorage config\r\n */\r\nfunction* getConfigSaga() {\r\n    yield put(configActions.Actions.fetch());\r\n    const configResponse: GetConfigResponse = yield call(getConfig);\r\n    try {\r\n        const mergedConfig = mergeLocalStorage(configResponse.config);\r\n        yield put(configActions.Actions.fetched(mergedConfig));\r\n    } catch (e) {\r\n        try {\r\n            clearLocalStorage();\r\n            // tslint:disable-next-line:no-empty\r\n        } catch (e) { }\r\n        const defaultConfig = Object.assign({}, configResponse.config, getDefaultLocalConfig(configResponse.config));\r\n        yield put(configActions.Actions.fetched(defaultConfig));\r\n    }\r\n}\r\n\r\n/**\r\n * update localStorage config on opening files or using the file browser\r\n */\r\nfunction* updateLocalStorageConfig() {\r\n    while (true) {\r\n        yield take([\r\n            datasetActions.ActionTypes.CREATE,\r\n            browserActions.ActionTypes.DIRECTORY_LISTING\r\n        ]);\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n        setLocalStorage(config);\r\n    }\r\n}\r\n\r\nexport function* firstConfigFetch() {\r\n    try {\r\n        yield call(getConfigSaga);\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(configActions.Actions.fetchFailed(`failed to fetch config: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* configRootSaga() {\r\n    yield fork(firstConfigFetch);\r\n    yield fork(getConfigOnReconnect);\r\n    yield fork(updateLocalStorageConfig);\r\n}","import { call, put, select, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as browserActions from '../browser/actions';\r\nimport { joinPaths } from '../config/helpers';\r\nimport { ConfigState } from '../config/reducers';\r\nimport { DetectDatasetResponse, OpenDatasetResponse } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as datasetActions from \"./actions\";\r\nimport { deleteDataset, detectDataset, openDataset } from './api';\r\nimport { isKnownDatasetType } from './helpers';\r\n\r\n\r\nexport function* createDatasetSaga(action: ReturnType<typeof datasetActions.Actions.create>) {\r\n    try {\r\n        const resp: OpenDatasetResponse = yield call(openDataset, action.payload.dataset.id, { dataset: action.payload.dataset });\r\n        if (resp.status === \"ok\") {\r\n            yield put(datasetActions.Actions.created(resp.details));\r\n        } else if (resp.status === \"error\") {\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            yield put(datasetActions.Actions.error(resp.dataset, resp.msg, timestamp, id));\r\n        }\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(datasetActions.Actions.error(action.payload.dataset.id, `Error loading dataset: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* deleteDatasetSaga(action: ReturnType<typeof datasetActions.Actions.delete>) {\r\n    try {\r\n        yield call(deleteDataset, action.payload.dataset);\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(datasetActions.Actions.error(action.payload.dataset, `Error closing dataset: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* doDetectDataset(fullPath: string) {\r\n    yield put(datasetActions.Actions.detect(fullPath));\r\n    const detectResult: DetectDatasetResponse = yield call(detectDataset, fullPath);\r\n    let detectedParams;\r\n    let shouldOpen = true;\r\n    if (detectResult.status === \"ok\") {\r\n        if (isKnownDatasetType(detectResult.datasetParams.type)) {\r\n          detectedParams = detectResult.datasetParams;\r\n          yield put(datasetActions.Actions.detected(fullPath, detectResult.datasetParams));\r\n        }\r\n        else {\r\n          const timestamp = Date.now();\r\n          const id = uuid();\r\n          yield put(datasetActions.Actions.detectFailed(fullPath));\r\n          shouldOpen = false;\r\n          yield put(datasetActions.Actions.error(id, detectResult.datasetParams.type + ` dataset type is currently not supported in the GUI`, timestamp, id));\r\n        }\r\n    } else {\r\n        yield put(datasetActions.Actions.detectFailed(fullPath));\r\n    }\r\n    return [detectedParams, shouldOpen];\r\n}\r\n\r\nexport function* doOpenDataset(fullPath: string) {\r\n    const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n    const cachedParams = config.lastOpened[fullPath];\r\n    let detectedParams;\r\n    let shouldOpen = true;\r\n    try {\r\n      let doDetectDatasetRes = yield call(doDetectDataset, fullPath);\r\n      detectedParams = doDetectDatasetRes[0];\r\n      shouldOpen = doDetectDatasetRes[1];\r\n    } catch (e) {\r\n        yield put(datasetActions.Actions.detectFailed(fullPath));\r\n    }\r\n    if(shouldOpen)\r\n      yield put(datasetActions.Actions.open(fullPath, cachedParams, detectedParams));\r\n}\r\n\r\nexport function* openDatasetSagaFullPath(action: ReturnType<typeof browserActions.Actions.selectFullPath>) {\r\n    const fullPath = action.payload.path;\r\n    yield call(doOpenDataset, fullPath);\r\n}\r\n\r\nexport function* openDatasetSaga(action: ReturnType<typeof browserActions.Actions.select>) {\r\n    const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n    const fullPath = joinPaths(config, action.payload.path, action.payload.name);\r\n    yield call(doOpenDataset, fullPath);\r\n}\r\n\r\nexport function* datasetRootSaga() {\r\n    yield takeEvery(datasetActions.ActionTypes.CREATE, createDatasetSaga);\r\n    yield takeEvery(datasetActions.ActionTypes.DELETE, deleteDatasetSaga);\r\n    yield takeEvery(browserActions.ActionTypes.SELECT, openDatasetSaga);\r\n    yield takeEvery(browserActions.ActionTypes.SELECT_FULL_PATH, openDatasetSagaFullPath);\r\n}\r\n","import { all } from 'redux-saga/effects';\r\nimport { analysisRootSaga } from './analysis/sagas';\r\nimport { directoryListingSaga } from './browser/sagas';\r\nimport { webSocketSaga } from './channel/sagas';\r\nimport { clusterConnectionSaga } from './cluster/sagas';\r\nimport { configRootSaga } from './config/sagas';\r\nimport { datasetRootSaga } from './dataset/sagas';\r\n\r\nexport function* rootSaga() {\r\n    yield all([\r\n        configRootSaga(),\r\n        webSocketSaga(),\r\n        analysisRootSaga(),\r\n        datasetRootSaga(),\r\n        clusterConnectionSaga(),\r\n        directoryListingSaga(),\r\n    ]);\r\n}","import { AllActions } from \"../actions\";\r\nimport * as datasetActions from \"../dataset/actions\";\r\nimport { ById, filterWithPred, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport * as analysisActions from \"./actions\";\r\nimport { AnalysisState, JobList } from \"./types\";\r\n\r\nexport type AnalysisReducerState = ById<AnalysisState>;\r\n\r\nconst initialAnalysisState: AnalysisReducerState = {\r\n    byId: {},\r\n    ids: [],\r\n}\r\n\r\nexport function analysisReducer(state = initialAnalysisState, action: AllActions): AnalysisReducerState {\r\n    switch (action.type) {\r\n        case analysisActions.ActionTypes.CREATED: {\r\n            return insertById(state, action.payload.analysis.id, action.payload.analysis);\r\n        }\r\n        case analysisActions.ActionTypes.PREPARE_RUN: {\r\n            const { jobIndex, id } = action.payload;\r\n            const analysis = state.byId[id];\r\n            const oldJob = analysis.jobs[jobIndex];\r\n            const jobHistory = [...analysis.jobHistory];\r\n            if (oldJob !== undefined) {\r\n                // TODO: length restriction?\r\n                const hist = jobHistory[jobIndex] ? jobHistory[jobIndex] : [];\r\n                jobHistory[jobIndex] = [oldJob, ...hist];\r\n            }\r\n            const newJobs: JobList = [...analysis.jobs];\r\n            newJobs[jobIndex] = action.payload.job;\r\n            return updateById(state, action.payload.id, { jobs: newJobs, jobHistory })\r\n        }\r\n        case analysisActions.ActionTypes.REMOVED: {\r\n            return filterWithPred(state, (r: AnalysisState) => r.id !== action.payload.id);\r\n        }\r\n        case datasetActions.ActionTypes.DELETE: {\r\n            return filterWithPred(state, (r: AnalysisState) => r.dataset !== action.payload.dataset);\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as configActions from '../config/actions';\r\nimport { DirectoryListingDetails, FSPlace } from \"../messages\";\r\nimport * as browserActions from './actions';\r\nimport { DirectoryBrowserState } from \"./types\";\r\n\r\nconst initialBrowserState: DirectoryBrowserState = {\r\n    isOpen: false,\r\n    isLoading: true,\r\n    path: \"/\",\r\n    drives: [],\r\n    places: {},\r\n    files: [] as DirectoryListingDetails[],\r\n    dirs: [] as DirectoryListingDetails[],\r\n}\r\n\r\nexport function directoryBrowserReducer(state: DirectoryBrowserState = initialBrowserState, action: AllActions): DirectoryBrowserState {\r\n    switch (action.type) {\r\n        case configActions.ActionTypes.FETCHED: {\r\n            return Object.assign({}, state, {\r\n                path: action.payload.config.cwd,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.OPEN: {\r\n            return Object.assign({}, state, {\r\n                isOpen: true,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.CANCEL: {\r\n            return Object.assign({}, state, {\r\n                isOpen: false,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.LIST_DIRECTORY: {\r\n            return Object.assign({}, state, {\r\n                isLoading: true,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.DIRECTORY_LISTING: {\r\n            const places = action.payload.places.reduce((acc, place: FSPlace) => {\r\n                return Object.assign({}, acc, {\r\n                    [place.key]: place,\r\n                })\r\n            }, {});\r\n            return Object.assign({}, state, {\r\n                isLoading: false,\r\n                path: action.payload.path,\r\n                files: action.payload.files,\r\n                dirs: action.payload.dirs,\r\n                drives: action.payload.drives,\r\n                places,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.SELECT_FULL_PATH:\r\n        case browserActions.ActionTypes.SELECT: {\r\n            return Object.assign({}, state, {\r\n                isLoading: false,\r\n                isOpen: false,\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from './actions';\r\n\r\nexport interface ChannelStatusReducer {\r\n    status: ChannelStatusCodes,\r\n}\r\n\r\nexport enum ChannelStatusCodes {\r\n    CONNECTING = \"connecting\",\r\n    CONNECTED = \"connected\",\r\n    READY = \"ready\",\r\n    WAITING = \"waiting\",\r\n}\r\n\r\nconst initialChannelState: ChannelStatusReducer = {\r\n    status: ChannelStatusCodes.WAITING,\r\n}\r\n\r\nexport function channelStatusReducer(state = initialChannelState, action: AllActions): ChannelStatusReducer {\r\n    switch (action.type) {\r\n        case channelActions.ActionTypes.OPEN: {\r\n            return { status: ChannelStatusCodes.CONNECTED };\r\n        }\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            return { status: ChannelStatusCodes.READY };\r\n        }\r\n        case channelActions.ActionTypes.CLOSE: {\r\n            return { status: ChannelStatusCodes.WAITING };\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport { ConnectRequestParams } from \"../messages\";\r\nimport * as clusterActions from './actions';\r\n\r\nexport type ClusterConnectionState = {\r\n    status: \"connected\",\r\n    params: ConnectRequestParams,\r\n} | {\r\n    status: \"disconnected\",\r\n} | {\r\n    status: \"unknown\",\r\n}\r\n\r\nconst initialClusterConnectionState: ClusterConnectionState = {\r\n    status: \"unknown\"\r\n}\r\n\r\nexport function clusterConnectionReducer(state = initialClusterConnectionState, action: AllActions): ClusterConnectionState {\r\n    switch (action.type) {\r\n        case clusterActions.ActionTypes.NOT_CONNECTED: {\r\n            return {\r\n                status: \"disconnected\"\r\n            };\r\n        }\r\n        case clusterActions.ActionTypes.CONNECTED: {\r\n            return {\r\n                status: \"connected\",\r\n                params: action.payload.params,\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as browserActions from '../browser/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { DatasetFormParams, MsgPartConfig } from \"../messages\";\r\nimport * as configActions from './actions';\r\nimport { makeUnique } from \"./helpers\";\r\n\r\nexport interface LocalConfig {\r\n    cwd: string,\r\n    fileHistory: string[],\r\n    lastOpened: {\r\n        [path: string]: DatasetFormParams\r\n    }\r\n}\r\n\r\nexport interface ConfigMeta {\r\n    haveConfig: boolean,\r\n}\r\n\r\nexport type ConfigParams = MsgPartConfig & LocalConfig;\r\nexport type ConfigState = ConfigParams & ConfigMeta;\r\n\r\nconst initialConfigState: ConfigState = {\r\n    version: \"\",\r\n    revision: \"\",\r\n    localCores: 0,\r\n    cwd: \"/\",\r\n    separator: \"/\",\r\n    lastOpened: {},\r\n    fileHistory: [],\r\n    haveConfig: false,\r\n}\r\n\r\nexport function configReducer(state = initialConfigState, action: AllActions): ConfigState {\r\n    switch (action.type) {\r\n        case configActions.ActionTypes.FETCHED: {\r\n            return Object.assign({}, action.payload.config, { haveConfig: true });\r\n        }\r\n        case browserActions.ActionTypes.DIRECTORY_LISTING: {\r\n            return Object.assign({}, state, {\r\n                cwd: action.payload.path,\r\n            });\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            const newLastOpened = Object.assign({}, state.lastOpened, { [action.payload.dataset.params.path]: action.payload.dataset.params });\r\n            const newFileHistory = makeUnique([\r\n                action.payload.dataset.params.path, ...state.fileHistory\r\n            ]).slice(0, 11);\r\n            return Object.assign({}, state, {\r\n                lastOpened: newLastOpened,\r\n                fileHistory: newFileHistory,\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { constructById, filterWithPred, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport { Dataset, DatasetState, DatasetStatus } from \"../messages\";\r\nimport * as datasetActions from './actions';\r\nimport { DatasetsState, OpenDatasetState } from \"./types\";\r\n\r\nconst initialDatasetState: DatasetsState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function datasetReducer(state = initialDatasetState, action: AllActions): DatasetsState {\r\n    switch (action.type) {\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            const datasets = action.payload.datasets.map(ds => Object.assign({}, ds, { status: DatasetStatus.OPEN }));\r\n            return {\r\n                byId: constructById(datasets, ds => ds.id),\r\n                ids: datasets.map(ds => ds.id),\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            const ds: Dataset = {\r\n                ...action.payload.dataset,\r\n                status: DatasetStatus.OPENING\r\n            };\r\n            return insertById(state, action.payload.dataset.id, ds);\r\n        }\r\n        case datasetActions.ActionTypes.CREATED: {\r\n            const ds = Object.assign({}, action.payload.dataset, { status: DatasetStatus.OPEN });\r\n            return updateById(state, action.payload.dataset.id, ds);\r\n        }\r\n        case datasetActions.ActionTypes.ERROR: {\r\n            return filterWithPred(state, (r: DatasetState) => r.id !== action.payload.dataset);\r\n        }\r\n        case datasetActions.ActionTypes.DELETE: {\r\n            return updateById(state, action.payload.dataset, { status: DatasetStatus.DELETING });\r\n        }\r\n        case datasetActions.ActionTypes.DELETED: {\r\n            return filterWithPred(state, (r: DatasetState) => r.id !== action.payload.dataset);\r\n        }\r\n    }\r\n    return state;\r\n}\r\n\r\nconst initialOpenDatasetState: OpenDatasetState = {\r\n    busy: false,\r\n    busyPath: \"\",\r\n    formVisible: false,\r\n    formPath: \"/\",\r\n    formCachedParams: undefined,\r\n    formDetectedParams: undefined,\r\n}\r\n\r\nexport function openDatasetReducer(state = initialOpenDatasetState, action: AllActions): OpenDatasetState {\r\n    switch (action.type) {\r\n        case datasetActions.ActionTypes.OPEN: {\r\n            return {\r\n                ...state,\r\n                formVisible: true,\r\n                formPath: action.payload.path,\r\n                formCachedParams: action.payload.cachedParams,\r\n                formDetectedParams: action.payload.detectedParams,\r\n            };\r\n        }\r\n        case datasetActions.ActionTypes.CANCEL_OPEN: {\r\n            return {\r\n                ...state,\r\n                formVisible: false,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            return {\r\n                ...state,\r\n                formVisible: false,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.DETECT: {\r\n            return {\r\n                ...state,\r\n                busyPath: action.payload.path,\r\n                busy: true,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.DETECTED:\r\n        case datasetActions.ActionTypes.DETECT_FAILED: {\r\n            return {\r\n                ...state,\r\n                busyPath: \"\",\r\n                busy: false,\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as analysisActions from '../analysis/actions';\r\nimport * as browserActions from '../browser/actions';\r\nimport * as channelActions from '../channel/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { ById, filterWithPred, insertById } from \"../helpers/reducerHelpers\";\r\nimport * as errorActions from './actions';\r\n\r\nexport interface ErrorMessage {\r\n    id: string,\r\n    msg: string,\r\n    timestamp: number,\r\n}\r\n\r\nexport type ErrorState = ById<ErrorMessage>;\r\n\r\nconst initialErrorState: ErrorState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function errorReducer(state = initialErrorState, action: AllActions): ErrorState {\r\n    switch (action.type) {\r\n        case browserActions.ActionTypes.ERROR:\r\n        case datasetActions.ActionTypes.ERROR:\r\n        case channelActions.ActionTypes.ERROR:\r\n        case analysisActions.ActionTypes.ERROR:\r\n        case channelActions.ActionTypes.JOB_ERROR: {\r\n            return insertById(state, action.payload.id, {\r\n                id: action.payload.id,\r\n                msg: action.payload.msg,\r\n                timestamp: action.payload.timestamp,\r\n            });\r\n        }\r\n        case channelActions.ActionTypes.OPEN: {\r\n            return initialErrorState;\r\n        }\r\n        case errorActions.ActionTypes.DISMISS: {\r\n            return filterWithPred(state, (r: ErrorMessage) => r.id !== action.payload.id);\r\n        }\r\n        case errorActions.ActionTypes.DISMISS_ALL: {\r\n            return initialErrorState;\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { ById, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport * as jobActions from './actions';\r\nimport { JobRunning, JobState, JobStatus } from \"./types\";\r\n\r\nexport type JobReducerState = ById<JobState>;\r\n\r\nconst initialJobState: JobReducerState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function jobReducer(state = initialJobState, action: AllActions): JobReducerState {\r\n    switch (action.type) {\r\n        case jobActions.ActionTypes.CREATE: {\r\n            const createResult = insertById(\r\n                state,\r\n                action.payload.id,\r\n                {\r\n                    id: action.payload.id,\r\n                    dataset: action.payload.dataset,\r\n                    running: JobRunning.CREATING,\r\n                    status: JobStatus.CREATING,\r\n                    results: [],\r\n                    startTimestamp: action.payload.timestamp,\r\n                }\r\n            )\r\n            return createResult;\r\n        }\r\n        case channelActions.ActionTypes.JOB_STARTED: {\r\n            return updateById(\r\n                state,\r\n                action.payload.job,\r\n                {\r\n                    running: JobRunning.RUNNING,\r\n                    status: JobStatus.IN_PROGRESS,\r\n                    startTimestamp: action.payload.timestamp,\r\n                }\r\n            )\r\n        }\r\n        case channelActions.ActionTypes.TASK_RESULT: {\r\n            return updateById(\r\n                state,\r\n                action.payload.job,\r\n                {\r\n                    results: action.payload.results,\r\n                }\r\n            );\r\n        }\r\n        case channelActions.ActionTypes.FINISH_JOB: {\r\n            const { job, timestamp, results } = action.payload;\r\n            return updateById(\r\n                state,\r\n                job,\r\n                {\r\n                    running: JobRunning.DONE,\r\n                    status: JobStatus.SUCCESS,\r\n                    results,\r\n                    endTimestamp: timestamp,\r\n                }\r\n            );\r\n        }\r\n        case channelActions.ActionTypes.JOB_ERROR: {\r\n            const { job, timestamp } = action.payload;\r\n            return updateById(\r\n                state,\r\n                job,\r\n                {\r\n                    running: JobRunning.DONE,\r\n                    status: JobStatus.ERROR,\r\n                    endTimestamp: timestamp,\r\n                }\r\n            )\r\n        }\r\n    }\r\n    return state;\r\n}","import { combineReducers } from \"redux\";\r\nimport { analysisReducer } from \"./analysis/reducers\";\r\nimport { directoryBrowserReducer } from './browser/reducers';\r\nimport { channelStatusReducer } from \"./channel/reducers\";\r\nimport { clusterConnectionReducer } from \"./cluster/reducers\";\r\nimport { configReducer } from \"./config/reducers\";\r\nimport { datasetReducer, openDatasetReducer } from \"./dataset/reducers\";\r\nimport { errorReducer } from \"./errors/reducers\";\r\nimport { jobReducer } from \"./job/reducers\";\r\n\r\nexport const rootReducer = combineReducers({\r\n    analyses: analysisReducer,\r\n    channelStatus: channelStatusReducer,\r\n    clusterConnection: clusterConnectionReducer,\r\n    datasets: datasetReducer,\r\n    openDataset: openDatasetReducer,\r\n    jobs: jobReducer,\r\n    errors: errorReducer,\r\n    config: configReducer,\r\n    browser: directoryBrowserReducer,\r\n})\r\n\r\nexport type RootReducer = ReturnType<typeof rootReducer>;","// tslint:disable:ordered-imports\r\nimport \"core-js/fn/symbol/iterator.js\";\r\nimport \"core-js/es6/symbol.js\";\r\nimport 'react-app-polyfill/ie11';\r\n// tslint:enable:ordered-imports\r\n\r\nimport * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\nimport { applyMiddleware, compose, createStore } from 'redux';\r\nimport createSagaMiddleware from 'redux-saga';\r\nimport App from './App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport { rootSaga } from './sagas';\r\nimport { rootReducer } from './store';\r\n\r\nconst sagaMiddleware = createSagaMiddleware();\r\n\r\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nconst store = createStore(rootReducer, composeEnhancers(\r\n    applyMiddleware(\r\n        sagaMiddleware,\r\n    )\r\n));\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <App />\r\n    </Provider>,\r\n    document.getElementById('root') as HTMLElement\r\n);\r\nregisterServiceWorker();\r\n\r\nsagaMiddleware.run(rootSaga);"],"sourceRoot":""}