{"version":3,"sources":["job/components/ResultImage.module.css","images/LiberTEM logo-medium.png","cluster/actions.ts","About.tsx","helpers/actionHelpers.ts","helpers/index.ts","messages.ts","browser/actions.ts","cluster/components/LocalConnectionForm.tsx","cluster/components/TCPConnectionForm.tsx","cluster/components/ClusterConnectionForm.tsx","channel/components/ChannelConnecting.tsx","channel/components/ChannelStatus.tsx","browser/components/FileBrowserEntry.tsx","config/actions.ts","browser/components/FileBrowserHeader.tsx","browser/components/FileEntry.tsx","browser/components/FolderEntry.tsx","browser/components/PathDropDownItem.tsx","browser/components/PathInput.tsx","browser/components/RecentFiles.tsx","browser/components/PathBar.tsx","browser/components/FileBrowser.tsx","job/types.ts","browser/components/BrowserWrapper.tsx","widgets/BusySpinner.tsx","widgets/BusyWrapper.tsx","widgets/HandleParent.tsx","job/components/ResultImage.tsx","job/components/Result.tsx","job/components/Selectors.tsx","job/components/ResultList.tsx","widgets/constraints.ts","widgets/styles.ts","widgets/Disk.tsx","widgets/DraggableHandle.tsx","compoundAnalysis/actions.ts","widgets/kbdHandler.ts","compoundAnalysis/components/DefaultFrameView.tsx","compoundAnalysis/components/FramePicker.tsx","compoundAnalysis/components/ModeSelector.tsx","widgets/Rect.tsx","compoundAnalysis/components/roi/RectROI.tsx","compoundAnalysis/components/roi/RoiPicker.tsx","compoundAnalysis/components/roi/DiskROI.tsx","compoundAnalysis/components/layouts/AnalysisLayoutTwoCol.tsx","helpers/apiHelpers.ts","compoundAnalysis/getMetadata.tsx","compoundAnalysis/components/Download.tsx","compoundAnalysis/components/Toolbar.tsx","compoundAnalysis/helpers.ts","compoundAnalysis/components/CenterOfMassAnalysis.tsx","helpers/svg.ts","widgets/Ring.tsx","compoundAnalysis/components/layouts/AnalysisLayoutTwoRes.tsx","compoundAnalysis/components/Clustering.tsx","compoundAnalysis/components/DiskMaskAnalysis.tsx","compoundAnalysis/components/FEM.tsx","compoundAnalysis/components/FFTFramePicker.tsx","compoundAnalysis/components/FFTSumFrames.tsx","compoundAnalysis/components/FFTFrameView.tsx","compoundAnalysis/components/layouts/AnalysisLayoutThreeCol.tsx","compoundAnalysis/components/FFTAnalysis.tsx","compoundAnalysis/components/PointSelectionAnalysis.tsx","compoundAnalysis/components/RadialFourierAnalysis.tsx","compoundAnalysis/components/RingMaskAnalysis.tsx","compoundAnalysis/types.ts","compoundAnalysis/components/base/Analysis.tsx","compoundAnalysis/components/base/AnalysisList.tsx","helpers/reducerHelpers.ts","compoundAnalysis/components/base/AnalysisSelect.tsx","dataset/components/AddAnalysis.tsx","dataset/api.ts","dataset/validate.ts","dataset/helpers.ts","dataset/components/DatasetParams.tsx","dataset/actions.ts","dataset/components/DatasetInfo.tsx","errors/actions.ts","dataset/components/DatasetToolbar.tsx","dataset/components/Dataset.tsx","dataset/components/BLOParamsForm.tsx","dataset/components/DatasetTypeSelect.tsx","dataset/components/EMPADParamsForm.tsx","dataset/components/FRMS6ParamsForm.tsx","dataset/components/HDF5ParamsForm.tsx","dataset/components/K2ISParamsForm.tsx","dataset/components/TupleInputPart.tsx","dataset/components/TupleInput.tsx","dataset/components/MIBParamsForm.tsx","dataset/components/RawFileParamsForm.tsx","dataset/components/SEQParamsForm.tsx","dataset/components/SERParamsForm.tsx","dataset/components/DatasetOpen.tsx","dataset/components/DatasetOpenSpinner.tsx","dataset/components/DatasetList.tsx","errors/components/Error.tsx","errors/components/ErrorList.tsx","helpers/hooks.ts","App.tsx","registerServiceWorker.ts","config/helpers.ts","browser/api.ts","channel/actions.ts","browser/sagas.ts","channel/messages.ts","channel/sagas.ts","cluster/api.ts","analysis/actions.ts","cluster/sagas.ts","job/actions.ts","job/api.ts","compoundAnalysis/api.ts","compoundAnalysis/sagas.ts","config/api.ts","config/sagas.ts","dataset/sagas.ts","sagas.ts","analysis/reducers.ts","browser/reducers.ts","channel/reducers.ts","cluster/reducers.ts","compoundAnalysis/reducers.ts","config/reducers.ts","dataset/reducers.ts","errors/reducers.ts","job/reducers.ts","store.ts","index.tsx"],"names":["module","exports","ActionTypes","connect","state","version","config","revision","Header","as","slice","List","Item","Icon","name","Content","href","src","alt","createAction","type","payload","meta","undefined","Actions","notConnected","NOT_CONNECTED","params","CONNECT","connecting","CONNECTING","connected","CONNECTED","error","msg","timestamp","id","ERROR","assertNotReached","message","Error","defaultDebounce","fn","delay","_","maxWait","getEnumValues","e","Object","keys","ClusterTypes","DatasetTypes","AdditionalInfo","DatasetStatus","AnalysisTypes","ClusterTypeMetadata","LOCAL","label","TCP","helpText","withFormik","mapPropsToValues","ownProps","numWorkers","localCores","handleSubmit","values","formikBag","onSubmit","props","touched","errors","isSubmitting","dirty","handleChange","handleBlur","handleReset","Form","Field","htmlFor","value","onChange","onBlur","Button","primary","disabled","address","lastConnection","mapDispatchToProps","connectToCluster","clusterActions","clusterTypeOptions","map","t","text","ClusterConnectionForm","clusterType","lastConnectionType","setType","setState","data","this","Dropdown","inline","options","Segment","renderForm","React","ChannelConnecting","Message","icon","loading","messages","waiting","clusterMessages","ConnectedNotReady","haveConfig","useSelector","clusterConnection","status","ChannelStatus","children","channelStatus","list","path","LIST_DIRECTORY","dirListing","dirs","files","drives","places","DIRECTORY_LISTING","open","OPEN","cancel","CANCEL","select","SELECT","selectFullPath","SELECT_FULL_PATH","detectParams","DETECT_PARAMS","paramsDetected","PARAMS_DETECTED","TimeStamp","ts","date","Date","fmtDate","toLocaleDateString","fmtTime","toLocaleTimeString","title","style","display","whiteSpace","width","marginRight","FileSize","fmtSize","bytes","si","thresh","Math","abs","size","unit","units","u","length","toFixed","humanFileSize","textAlign","Cell","overflow","textOverflow","FileBrowserEntry","onClick","details","myStyle","cursor","tsStyles","paddingRight","flexGrow","owner","ctime","mtime","FileBrowserHeader","alignRight","paddingBottom","FileEntry","dispatch","browserActions","window","setTimeout","FETCH","FETCHED","FETCH_FAILED","TOGGLE_STAR","toString","newProps","initialPath","enableReinitialize","Input","autoComplete","lastOpened","fileHistory","separator","recentFiles","filter","item","floating","Menu","content","option","idx","key","refresh","currentPath","handleInputChange","goUp","toggleStar","configActions","starred","driveOptions","placeOptions","starOptions","isStarred","includes","starredIcon","bookmarkTitle","listRef","scrollToTop","current","scrollToItem","sortByKey","array","getKey","sort","a","b","x","y","JobRunning","JobStatus","browser","isLoading","getSortKey","toLowerCase","dirEntries","dir","fileEntries","f","entries","concat","overflowY","ref","height","itemCount","itemSize","index","Group","isOpen","busy","openDataset","formVisible","labelPosition","BusySpinner","margin","padding","position","bottom","right","color","opacity","BusyWrapper","HandleParent","currentHandle","handleDragStart","h","handleDrop","handleMouseMove","externalMouseMove","handleMouseLeave","externalLeave","handleMouseUp","externalMouseUp","onMouseMove","onMouseLeave","onMouseUp","onKeyDown","onKeyboardEvent","outline","tabIndex","fill","renderHandles","handles","i","elem","ResultImage","job","channel","result","results","className","styles","fallback","viewBox","default","xlinkHref","imageURL","ResultWrapper","styled","svg","Result","extraHandles","extraWidgets","running","DONE","Selectors","div","ResultListPlaceholder","border","ResultList","selectedChannel","selectChannel","analysis","jobsById","displayedJob","dt","endTimestamp","startTimestamp","currentResult","subtitle","selectors","getMsg","selectedImg","getJob","genericRender","ResultImageSelector","availableImages","description","compoundAnalysis","compoundAnalyses","byId","analyses","analysisIndex","jobs","inRectConstraint","p","max","min","cbToRadius","cx","cy","cb","dx","dy","sqrt","dist","keepOnCY","riConstraint","outerPos","otherX","roConstraints","innerPos","defaultMaskStyles","imageWidth","fillOpacity","strokeOpacity","stroke","strokeWidth","Disk","imageHeight","r","StyledCircle","circle","Cross","FocusGroup","g","Handle","scale","withCross","focusRef","args","transform","crossSpec","cross","d","relativeCoords","parent","ownerSVGElement","inWidthAttr","getAttribute","inWidth","getBoundingClientRect","getScalingFactor","parentPos","pageX","left","pageXOffset","pageY","top","pageYOffset","DraggableHandle","posRef","dragging","drag","move","stopDrag","applyConstraint","constraint","startDrag","preventDefault","parentOnDragStart","focus","onDragMove","constrained","parentOnDrop","handleKeyDown","update","delta","shiftKey","handleKeyEvent","newCoords","visibility","onMouseDown","renderCommon","renderDragging","DefaultModes","DefaultRois","dataset","analysisType","CREATE","autoStart","CREATED","compoundAnalysisId","ENABLE_AUTOSTART","RUN","RUNNING","jobIndex","REMOVE","REMOVED","useFramePicker","enabled","scanWidth","scanHeight","setCx","setCy","useDispatch","useEffect","compoundAnalysisActions","PICK_FRAME","parameters","onPickChange","pickX","pickY","newX","round","newY","coords","onDragStart","onDrop","ModeSelector","modes","currentMode","onModeChange","Rect","ymin","xmin","useRectROI","minLength","useState","setx","sety","setwidth","setheight","handleCornerChange","newx","newy","handleShapeChange","smthHandle","rectRoiParameters","roi","shape","rectRoiHandles","rectRoiWidgets","useRoiPicker","roiParameters","handle","analysisActions","clearTimeout","JSON","stringify","useDefaultFrameView","doAutoStart","availableModes","SUM","SD","PICK","availableRois","ALL","DISK","RECT","frameMode","setMode","setRoi","frameModeSelector","newMode","roiSelector","newRoi","widgets","pickCoords","pickHandles","setR","handleCenterChange","newCx","newCy","handleRChange","newR","rHandle","diskRoiParameters","diskRoiHandles","diskRoiWidgets","useDiskROI","SD_FRAMES","SUM_FRAMES","frameViewTitle","AnalysisLayoutTwoCol","toolbar","attached","Grid","columns","Row","Column","getApiBasePath","loc","location","pathname","endsWith","genericDelete","basePath","fetch","credentials","method","json","genericPut","body","getMetadata","typeName","CompoundAnalysisMetadata","DownloadItems","currentFormat","analysesById","some","jobId","SUCCESS","analysisId","desc","getAnalysisDescription","includeInDownload","getDownloadChannels","join","Download","formats","resultFileFormats","formatOptions","identifier","setFormat","Modal","trigger","Popup","Toolbar","busyIdxs","onApply","applyIconProps","analysisIdxsToInclude","filteredAnalyses","indexOf","reduce","prevValue","every","getAnalysisStatus","CenterOfMassAnalysis","frameViewWidgets","resultHandles","resultWidgets","CENTER_OF_MASS","getPathArc","center","start","end","radius","degree","points","push","getLocationFromAngle","clockWise","getCirclePath","radian","PI","cos","sin","Ring","ri","pathSpec","ro","fillRule","AnalysisLayoutTwoRes","mid","clustparams","title1","title2","title3","ClustAnalysis","setRi","setRo","riHandle","roHandle","minDist","setMinDist","nPeaks","setNPeaks","nClust","setNClust","handleRIChange","handleROChange","SUM_SIG","CLUST","n_clust","n_peaks","min_dist","paramsVisible","setParamsVisible","Accordion","Title","active","event","step","target","valueAsNumber","DiskMaskAnalysis","APPLY_DISK_MASK","FEMAnalysis","FEM","useFFTFramePicker","real_rad","real_centerx","real_centery","PICK_FFT_FRAME","useFFTSumFrames","FFTSUM_FRAMES","useFFTFrameView","AnalysisLayoutThreeCol","FFTAnalysis","radIn","radOut","frameViewWidgetsfft","check","setCheck","realCenterX","realCenterY","realRad","frameViewWidgetsreal","APPLY_FFT_MASK","rad_in","rad_out","checked","PointSelectionAnalysis","APPLY_POINT_SELECTOR","RadialFourierAnalysis","nBins","maxOrder","RADIAL_FOURIER","n_bins","max_order","RingMaskAnalysis","APPLY_RING_MASK","component","AnalysisDispatcherComponent","datasets","AnalysisComponent","mainType","AnalysisList","ids","Analysis","updateById","partialRecord","newObj","assign","newById","insertById","record","constructById","items","acc","filterWithPred","pred","toggleItemInList","analysisTypeOptions","AnalysisSelect","labeled","button","handleAddAnalysis","deleteDataset","detectDataset","encodeURIComponent","schemaCache","getSchema","cached","Promise","resolve","schemaResponse","convertErrors","res","forEach","err","fieldName","dataPath","replace","match","plainName","then","schema","validate","Ajv","compile","parseNumList","nums","split","part","trim","getInitial","otherwise","getInitialName","pathfind","isKnownDatasetType","detectedType","v","isAdditionalInfo","param","withValidation","opts","formToJson","setSubmitting","validateOpen","validateOnChange","validateOnBlur","renderParams","Table","Array","DatasetParams","HeaderCell","Body","DiagElem","diagnostics","renderValue","DiagElems","DatasetInfo","cachedParams","detectedParams","CANCEL_OPEN","DELETE","DELETED","DETECT","DETECTED","DETECT_FAILED","handleRemoveDataset","datasetActions","DatasetContainer","OPENING","DELETING","dividing","marginTop","marginBottom","horizontal","link","flexShrink","initial","BLO","isValidating","onCancel","datasetTypeOptions","DatasetTypeSelect","currentType","scan_size","EMPAD","FRMS6","dataset_paths","ds_path","HDF5","dsPathInput","setFieldValue","dsPathOptions","dsPath","placeholder","fluid","search","selection","defaultValue","K2IS","TupleInputPart","tupleKey","tupleInputChangeHandle","commaPressHandle","tupleRef","keyCode","TupleInput","minLen","maxLen","tupleInputValue","initialList","parseNumListWithPadding","tupleInputRefsArray","val","newTupleInputValue","newTupleDim","hidden","basic","pop","MIB","enable_direct","detector_size","dtype","RAW","SEQ","SER","getDefaultDSType","didReset","openState","formCachedParams","formDetectedParams","getFormInitial","additionalInfo","allInfo","info","getAdditionalInfo","DatasetOpen","setReset","formInitial","defaultType","datasetType","setDatasetType","doSetType","form","formPath","commonParams","uuid","onReset","MIBParamsForm","BLOParamsForm","K2ISParamsForm","SEQParamsForm","busyPath","DatasetList","dsId","Dataset","DISMISS","DISMISS_ALL","dismiss","errorActions","negative","onDismiss","channelConnected","latestErrors","showModal","handleEsc","ev","code","document","addEventListener","removeEventListener","App","Container","logo","alignSelf","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","catch","joinPaths","parts","removeSep","RegExp","escapeRegExp","mergeLocalStorage","serverConfig","localSettings","localStorage","getItem","getDefaultLocalConfig","localSettingsParsed","parse","defaultConfig","setLocalStorage","cwd","setItem","makeUnique","inp","curr","getDirectoryListing","url","directoryListingSaga","fetchOnRequest","fetchDirectoryListing","fetchDirectoryListOnOpen","fork","take","action","newPath","call","put","browserState","now","alternative","home","MessageTypes","INITIAL_STATE","JOB_STARTED","FINISH_JOB","TASK_RESULT","JOB_ERROR","CLOSE","CANCELLED","createMessage","messageType","attribs","Messages","objectURL","BINARY","webSocketSaga","actionsFromChannel","handleBinaryParts","handleTaskResult","handleFinishJob","createWebSocketChannel","eventChannel","emit","onMessage","Blob","channelMessages","URL","createObjectURL","parsed","onOpen","onClose","END","onError","ws","WebSocket","port","getApiWSURL","socketChannel","channelActions","CREATE_DATASET","DELETE_DATASET","CANCEL_JOB_DONE","numParts","binMsg","followup","numMessages","images","descriptions","connection","checkClusterConnection","connectSaga","putClusterStatus","trackClusterConnection","clusterConnectionSaga","conn","takeEvery","all","UPDATED","startJob","cancelJob","createOrUpdateAnalysis","removeAnalysis","createOrUpdateCompoundAnalysis","removeCompoundAnalysis","cleanupOnRemove","createCompoundAnalysisSaga","createFromServerState","createOrUpdate","analysisSidecar","removeJobsForAnalysis","doRemoveAnalysisSaga","analysisRootSaga","selectDataset","selectCompoundAnalysis","selectAnalysis","selectJob","sidecarTask","msgPart","oldJobId","newAnalysisId","updatedCompoundAnalysis","actionChannel","buffers","sliding","runOrParamsChannel","existingAnalysisId","jobActions","getConfig","getConfigOnReconnect","getConfigSaga","updateLocalStorageConfig","firstConfigFetch","configRootSaga","configResponse","mergedConfig","removeItem","createDatasetSaga","deleteDatasetSaga","doDetectDataset","doOpenDataset","openDatasetSagaFullPath","openDatasetSaga","datasetRootSaga","resp","fullPath","detectResult","shouldOpen","datasetParams","doDetectDatasetRes","rootSaga","initialAnalysisState","ChannelStatusCodes","initialBrowserState","initialChannelState","WAITING","initialClusterConnectionState","initialCompoundAnalysisState","initialConfigState","initialDatasetState","initialOpenDatasetState","initialErrorState","initialJobState","rootReducer","combineReducers","newCompoundAnalysis","newAnalyses","ca","oldJobs","analysisState","analysisIdForJob","find","READY","ds","createResult","CREATING","IN_PROGRESS","jobState","newLastOpened","newFileHistory","newLastConnection","place","sagaMiddleware","createSagaMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","ReactDOM","getElementById","process","origin","response","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","run"],"mappings":"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","file":"static/js/main.93af365a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"default\":\"ResultImage_default__3K5yi\",\"fallback\":\"ResultImage_fallback__3V1su\"};","module.exports = __webpack_public_path__ + \"static/media/LiberTEM logo-medium.7999e0dc.png\";","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { ConnectRequestParams } from '../messages';\r\n\r\nexport enum ActionTypes {\r\n    NOT_CONNECTED = 'CLUSTER_NOT_CONNECTED',\r\n    CONNECT = 'CLUSTER_CONNECT',\r\n    CONNECTING = 'CLUSTER_CONNECTING',\r\n    CONNECTED = 'CLUSTER_CONNECTED',\r\n    ERROR = 'CLUSTER_ERROR'\r\n    \r\n}\r\n\r\nexport const Actions = {\r\n    notConnected: () => createAction(ActionTypes.NOT_CONNECTED),\r\n    connect: (params: ConnectRequestParams) => createAction(ActionTypes.CONNECT, { params },),\r\n    connecting: () => createAction(ActionTypes.CONNECTING),\r\n    connected: (params: ConnectRequestParams) => createAction(ActionTypes.CONNECTED, { params }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, List } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"./store\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        version: state.config.version,\r\n        revision: state.config.revision,\r\n    }\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst About: React.SFC<MergedProps> = ({ version, revision }) => {\r\n    return (\r\n        <>\r\n            <Header as=\"h3\">This is LiberTEM version {version} (revision {revision.slice(0, 8)})</Header>\r\n            <List>\r\n                <List.Item>\r\n                    <List.Icon name=\"github\" />\r\n                    <List.Content>\r\n                        Find us on <a href=\"https://github.com/LiberTEM/LiberTEM\">GitHub</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"bug\" />\r\n                    <List.Content>\r\n                        Found a bug? Got a feature request? Please <a href=\"https://github.com/LiberTEM/LiberTEM/issues/new\">open an issue!</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"legal\" />\r\n                    <List.Content>\r\n                        LiberTEM is licensed under the <a href=\"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE\">GNU General Public License v3.0</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"book\" />\r\n                    <List.Content>\r\n                        Read <a href=\"https://libertem.github.io/LiberTEM/\">the documentation</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"user\" />\r\n                    <List.Content>\r\n                        Read <a href=\"https://libertem.github.io/LiberTEM/acknowledgments.html\">the acknowledgments</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"gitter\" />\r\n                    <List.Content>\r\n                        Join our <a href=\"https://gitter.im/LiberTEM/Lobby\">chat on gitter!</a>\r\n                    </List.Content>\r\n                </List.Item>\r\n                <List.Item>\r\n                    <List.Icon name=\"linkify\" />\r\n                    <List.Content>\r\n                    <a href=\"https://doi.org/10.5281/zenodo.1477847\"><img src=\"https://zenodo.org/badge/DOI/10.5281/zenodo.1477847.svg\" alt=\"doi.org/10.5281/zenodo.1477847\"/></a>\r\n                    </List.Content>\r\n                </List.Item>\r\n            </List>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(About);\r\n","import { ActionCreatorsMapObject } from \"redux\";\r\n\r\nexport interface Action<T extends string> {\r\n    type: T\r\n}\r\n\r\nexport interface ActionWithPayload<T extends string, P> extends Action<T> {\r\n    payload: P\r\n}\r\n\r\nexport interface ActionWithMeta<T extends string, P, M> extends ActionWithPayload<T, P> {\r\n    meta: M\r\n}\r\n\r\nexport function createAction<T extends string>(type: T): Action<T>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P): ActionWithPayload<T, P>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P, meta?: M): ActionWithMeta<T, P, M>\r\nexport function createAction<T extends string, P, M>(type: T, payload?: P, meta?: M) {\r\n    if (meta === undefined && payload === undefined) {\r\n        return { type };\r\n    } else if (meta === undefined) {\r\n        return { type, payload };\r\n    } else {\r\n        return { type, payload, meta }\r\n    }\r\n}\r\n\r\nexport type ActionsUnion<A extends ActionCreatorsMapObject> = ReturnType<A[keyof A]>","import * as _ from \"lodash\";\r\n\r\nexport function assertNotReached(message: string): never {\r\n    throw new Error(message);\r\n}\r\n\r\nexport function defaultDebounce<T extends (...args: any[]) => any>(fn: T, delay: number = 50) {\r\n    return _.debounce(fn, delay, { maxWait: delay });\r\n}\r\n\r\nexport function getEnumValues<E>(e: E): Array<keyof E> {\r\n    return Object.keys(e) as Array<keyof E>;\r\n}","import { JobList } from \"./analysis/types\"\r\n\r\n/*\r\n * Common\r\n */\r\n\r\nexport interface FollowupPart {\r\n    numMessages: number,\r\n    descriptions: Array<{ title: string, desc: string, includeInDownload: boolean }>,\r\n}\r\n\r\nexport interface MsgPartConfig {\r\n    version: string,\r\n    revision: string,\r\n    localCores: number,\r\n    cwd: string,\r\n    separator: string,\r\n    resultFileFormats: {\r\n        [id: string]: {\r\n            identifier: string,\r\n            description: string,\r\n        }\r\n    },\r\n}\r\n\r\nexport interface GetConfigResponse {\r\n    status: \"ok\",\r\n    config: MsgPartConfig,\r\n}\r\n\r\n/*\r\n * Connection\r\n */\r\n\r\nexport enum ClusterTypes {\r\n    LOCAL = \"LOCAL\",\r\n    TCP = \"TCP\",\r\n}\r\n\r\nexport const ClusterTypeMetadata: { [s: string]: { [s: string]: string } } = {\r\n    [ClusterTypes.LOCAL]: {\r\n        label: \"Create local cluster\",\r\n    },\r\n    [ClusterTypes.TCP]: {\r\n        label: \"Connect to cluster\",\r\n        helpText: \"can be either local or remote, connection via TCP\",\r\n    }\r\n}\r\n\r\nexport interface ConnectRequestLocalCluster {\r\n    type: ClusterTypes.LOCAL,\r\n    numWorkers?: number,\r\n}\r\n\r\nexport interface ConnectRequestTCP {\r\n    type: ClusterTypes.TCP,\r\n    address: string,\r\n}\r\n\r\nexport type ConnectRequestParams = ConnectRequestLocalCluster | ConnectRequestTCP\r\n\r\nexport interface ConnectRequest {\r\n    connection: ConnectRequestParams\r\n}\r\n\r\nexport type ConnectResponse = {\r\n    status: \"ok\",\r\n    connection: ConnectRequest,\r\n} | {\r\n    status: \"disconnected\",\r\n    connection: {},\r\n} | {\r\n    status: \"error\",\r\n    messageType: string,\r\n    msg: string,\r\n}\r\n\r\n/*\r\n * Dataset\r\n */\r\n\r\nexport enum DatasetTypes {\r\n    HDF5 = \"HDF5\",\r\n    RAW = \"RAW\",\r\n    MIB = \"MIB\",\r\n    BLO = \"BLO\",\r\n    K2IS = \"K2IS\",\r\n    SER = \"SER\",\r\n    FRMS6 = \"FRMS6\",\r\n    EMPAD = \"EMPAD\",\r\n    SEQ = \"SEQ\",\r\n}\r\n\r\nexport interface DatasetParamsCommon {\r\n    name: string,\r\n}\r\n\r\nexport enum AdditionalInfo {\r\n    dataset_paths = \"dataset_paths\",\r\n}\r\n\r\nexport type DatasetParamsHDF5 = {\r\n    type: DatasetTypes.HDF5,\r\n    path: string,\r\n    ds_path: string,\r\n    dataset_paths: string[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsRaw = {\r\n    type: DatasetTypes.RAW,\r\n    path: string,\r\n    dtype: string,\r\n    detector_size: number[],\r\n    enable_direct: boolean,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsMIB = {\r\n    type: DatasetTypes.MIB,\r\n    path: string,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsBLO = {\r\n    type: DatasetTypes.BLO,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsK2IS = {\r\n    type: DatasetTypes.K2IS,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsSER = {\r\n    type: DatasetTypes.SER,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsFRMS6 = {\r\n    type: DatasetTypes.FRMS6,\r\n    path: string,\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsEMPAD = {\r\n    type: DatasetTypes.EMPAD,\r\n    path: string,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetParamsSEQ = {\r\n    type: DatasetTypes.SEQ,\r\n    path: string,\r\n    scan_size: number[],\r\n} & DatasetParamsCommon\r\n\r\nexport type DatasetFormParams = DatasetParamsHDF5 | DatasetParamsRaw | DatasetParamsMIB | DatasetParamsBLO | DatasetParamsK2IS | DatasetParamsSER | DatasetParamsFRMS6 | DatasetParamsEMPAD | DatasetParamsSEQ\r\n\r\nexport interface DatasetCreateParams {\r\n    id: string,\r\n    params: DatasetFormParams,\r\n}\r\n\r\nexport enum DatasetStatus {\r\n    OPEN = \"OPEN\",\r\n    OPENING = \"OPENING\",\r\n    DELETING = \"DELETING\",\r\n}\r\n\r\nexport interface DiagElemMsg {\r\n    name: string,\r\n    value: string | DiagElemMsg[],\r\n}\r\n\r\ninterface DatasetCommon {\r\n    id: string,\r\n    params: DatasetFormParams,\r\n}\r\n\r\nexport type DatasetOpening = DatasetCommon & {\r\n    status: DatasetStatus.OPENING,\r\n}\r\n\r\nexport type DatasetDeleting = DatasetCommon & {\r\n    status: DatasetStatus.DELETING,\r\n}\r\n\r\nexport type DatasetOpen = DatasetCommon & {\r\n    status: DatasetStatus.OPEN,\r\n    params: {\r\n        shape: number[],\r\n    }\r\n    diagnostics: DiagElemMsg[],\r\n}\r\n\r\nexport type Dataset = DatasetOpening | DatasetOpen | DatasetDeleting;\r\n\r\nexport interface OpenDatasetRequest {\r\n    dataset: DatasetCreateParams\r\n}\r\n\r\nexport interface OpenDatasetResponseOk {\r\n    status: \"ok\",\r\n    dataset: string,  // TODO: uuid type?\r\n    details: Dataset,\r\n}\r\n\r\nexport interface OpenDatasetResponseError {\r\n    status: \"error\",\r\n    dataset: string,\r\n    msg: string,\r\n}\r\n\r\nexport type OpenDatasetResponse = OpenDatasetResponseOk | OpenDatasetResponseError\r\n\r\nexport interface DeleteDatasetResponse {\r\n    status: \"ok\",\r\n    dataset: string,\r\n}\r\n\r\nexport interface DetectDatasetSuccessResponse {\r\n    status: \"ok\",\r\n    datasetParams: DatasetFormParams,\r\n}\r\n\r\nexport interface DetectDatasetErrorResponse {\r\n    status: \"error\",\r\n    path: string,\r\n    msg: string,\r\n}\r\n\r\nexport type DetectDatasetResponse = DetectDatasetSuccessResponse | DetectDatasetErrorResponse;\r\n\r\nexport interface DataSetOpenSchemaSuccessResponse {\r\n    status: \"ok\",\r\n    ds_type: string,\r\n    schema: object,\r\n}\r\n\r\nexport interface DataSetOpenSchemaErrorResponse {\r\n    status: \"error\",\r\n    ds_type: string,\r\n    msg: string,\r\n}\r\n\r\nexport type DataSetOpenSchemaResponse = DataSetOpenSchemaSuccessResponse | DataSetOpenSchemaErrorResponse;\r\n\r\nexport type MsgPartInitialDataset = DatasetOpen\r\n\r\n// type alias to add client-side state to datasets\r\nexport type DatasetState = Dataset & {}\r\n\r\n/*\r\n * Job\r\n */\r\nexport interface MsgPartJob {\r\n    id: string,\r\n    analysis: string,\r\n}\r\n\r\nexport interface MaskDefRing {\r\n    shape: \"ring\",\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number\r\n}\r\n\r\n\r\nexport interface MaskDefDisk {\r\n    shape: \"disk\",\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nexport interface PointDef {\r\n    shape: \"point\",\r\n    cx: number,\r\n    cy: number,\r\n}\r\n\r\n// TODO: shape doesn't really make sense here, needs to be restructured\r\nexport interface CenterOfMassParams {\r\n    shape: \"com\",\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nexport interface PickFrameParams {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\nexport interface FFTSumFramesParams {\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\n\r\nexport interface PickFFTFrameParams {\r\n    x: number,\r\n    y: number,\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\nexport interface RadialFourierParams {\r\n    shape: \"radial_fourier\",\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n    n_bins: number,\r\n    max_order: number\r\n}\r\n\r\nexport interface FFTParams {\r\n    rad_in: number,\r\n    rad_out: number,\r\n    real_rad: number | null,\r\n    real_centerx: number | null,\r\n    real_centery: number | null,\r\n}\r\n\r\n\r\nexport interface FrameParams {\r\n    roi: {\r\n        shape: \"rect\",\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n    } | {\r\n        shape: \"disk\",\r\n        cx: number,\r\n        cy: number,\r\n        r: number,\r\n    } |\r\n    {}\r\n}\r\n\r\nexport interface ClustParams {\r\n    roi: {\r\n        shape: \"rect\",\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n    } | {}\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n    n_peaks: number,\r\n    n_clust: number,\r\n    min_dist: number,\r\n}\r\n\r\nexport enum AnalysisTypes {\r\n    APPLY_RING_MASK = \"APPLY_RING_MASK\",\r\n    APPLY_DISK_MASK = \"APPLY_DISK_MASK\",\r\n    APPLY_POINT_SELECTOR = \"APPLY_POINT_SELECTOR\",\r\n    CENTER_OF_MASS = \"CENTER_OF_MASS\",\r\n    SUM_FRAMES = \"SUM_FRAMES\",\r\n    SD_FRAMES = \"SD_FRAMES\",\r\n    PICK_FRAME = \"PICK_FRAME\",\r\n    PICK_FFT_FRAME = \"PICK_FFT_FRAME\",\r\n    APPLY_FFT_MASK = \"APPLY_FFT_MASK\",\r\n    FFTSUM_FRAMES = \"FFTSUM_FRAMES\",\r\n    RADIAL_FOURIER = \"RADIAL_FOURIER\",\r\n    FEM = \"FEM\",\r\n    CLUST = \"CLUST\",\r\n    SUM_SIG = \"SUM_SIG\",\r\n}\r\n\r\nexport interface RingMaskDetails {\r\n    analysisType: AnalysisTypes.APPLY_RING_MASK,\r\n    parameters: MaskDefRing,\r\n}\r\n\r\nexport interface FFTDetails {\r\n    analysisType: AnalysisTypes.APPLY_FFT_MASK,\r\n    parameters: FFTParams,\r\n}\r\n\r\nexport interface FEMDetails {\r\n    analysisType: AnalysisTypes.FEM,\r\n    parameters: MaskDefRing,\r\n}\r\n\r\nexport interface DiskMaskDetails {\r\n    analysisType: AnalysisTypes.APPLY_DISK_MASK,\r\n    parameters: MaskDefDisk,\r\n}\r\n\r\nexport interface PointDefDetails {\r\n    analysisType: AnalysisTypes.APPLY_POINT_SELECTOR,\r\n    parameters: PointDef,\r\n}\r\n\r\nexport interface CenterOfMassDetails {\r\n    analysisType: AnalysisTypes.CENTER_OF_MASS,\r\n    parameters: CenterOfMassParams,\r\n}\r\n\r\nexport interface SumFramesDetails {\r\n    analysisType: AnalysisTypes.SUM_FRAMES,\r\n    parameters: FrameParams\r\n}\r\n\r\nexport interface SDFramesDetails {\r\n    analysisType: AnalysisTypes.SD_FRAMES,\r\n    parameters: FrameParams\r\n}\r\n\r\nexport interface SumSigDetails {\r\n    analysisType: AnalysisTypes.SUM_SIG,\r\n    parameters: {}\r\n}\r\n\r\nexport interface FFTSumFramesDetails {\r\n    analysisType: AnalysisTypes.FFTSUM_FRAMES,\r\n    parameters: FFTSumFramesParams,\r\n}\r\n\r\nexport interface PickFrameDetails {\r\n    analysisType: AnalysisTypes.PICK_FRAME,\r\n    parameters: PickFrameParams,\r\n}\r\n\r\nexport interface PickFFTFrameDetails {\r\n    analysisType: AnalysisTypes.PICK_FFT_FRAME,\r\n    parameters: PickFFTFrameParams,\r\n}\r\n\r\nexport interface RadialFourierDetails {\r\n    analysisType: AnalysisTypes.RADIAL_FOURIER,\r\n    parameters: RadialFourierParams,\r\n}\r\n\r\nexport interface ClustDetails {\r\n    analysisType: AnalysisTypes.CLUST,\r\n    parameters: ClustParams,\r\n}\r\n\r\nexport type AnalysisParameters = MaskDefRing | MaskDefDisk | CenterOfMassParams | PointDef | PickFrameParams | RadialFourierParams | FFTParams | PickFFTFrameParams | FFTSumFramesParams | ClustParams;\r\nexport type AnalysisDetails = RingMaskDetails | DiskMaskDetails | CenterOfMassDetails | PointDefDetails | SumFramesDetails | SDFramesDetails | PickFrameDetails | RadialFourierDetails | FEMDetails | FFTDetails | FFTSumFramesDetails | PickFFTFrameDetails | SumSigDetails | ClustDetails;\r\n\r\nexport interface MsgPartAnalysis {\r\n    analysis: string,\r\n    dataset: string,\r\n    details: AnalysisDetails,\r\n    jobs: JobList,\r\n}\r\n\r\nexport type CreateOrUpdateAnalysisRequest = Omit<MsgPartAnalysis, \"analysis\" | \"jobs\">;\r\n\r\nexport type CreateAnalysisResponse = {\r\n    status: \"ok\",\r\n    messageType: \"ANALYSIS_CREATED\",\r\n} & MsgPartAnalysis\r\n\r\nexport type UpdateAnalysisResponse = {\r\n    status: \"ok\",\r\n    messageType: \"ANALYSIS_UPDATED\",\r\n} & MsgPartAnalysis\r\n\r\nexport type RemoveAnalysisResponse = {\r\n    status: \"ok\"\r\n    messageType: \"ANALYSIS_REMOVED\",\r\n    analysis: string,\r\n} | {\r\n    status: \"error\",\r\n    messageType: \"ANALYSIS_REMOVAL_FAILED\",\r\n    msg: string,\r\n    analysis: string,\r\n}\r\n\r\nexport interface CompoundAnalysisDetails {\r\n    mainType: AnalysisTypes,\r\n    analyses: string[],\r\n}\r\n\r\nexport interface MsgPartCompoundAnalysis {\r\n    compoundAnalysis: string,\r\n    dataset: string,\r\n    details: CompoundAnalysisDetails,\r\n}\r\n\r\nexport interface CreateOrUpdateCompoundAnalysisRequest {\r\n    dataset: string,\r\n    details: CompoundAnalysisDetails,\r\n}\r\n\r\nexport type CreateCompoundAnalysisResponse = {\r\n    status: \"ok\",\r\n    messageType: \"COMPOUND_ANALYSIS_CREATED\",\r\n} & MsgPartCompoundAnalysis;\r\n\r\nexport type RemoveCompoundAnalysisResponse = {\r\n    status: \"ok\"\r\n    messageType: \"COMPOUND_ANALYSIS_REMOVED\",\r\n    analysis: string,\r\n} | {\r\n    status: \"error\",\r\n    messageType: \"COMPOUND_ANALYSIS_REMOVAL_FAILED\",\r\n    msg: string,\r\n    analysis: string,\r\n}\r\n\r\nexport interface StartJobRequest {\r\n    job: {\r\n        analysis: string,\r\n    }\r\n}\r\n\r\nexport interface StartJobResponse {\r\n    status: \"ok\",\r\n    job: string,\r\n    details: MsgPartJob,\r\n}\r\n\r\nexport interface CancelJobResponse {\r\n    status: \"ok\",\r\n    job: string,\r\n}\r\n\r\n/*\r\n * fs browser\r\n */\r\n\r\n// some named place, i.e. \"Documents\", \"Home\", ...\r\nexport interface FSPlace {\r\n    title: string,\r\n    path: string,\r\n    key: string,\r\n}\r\n\r\nexport interface DirectoryListingDetails {\r\n    name: string,\r\n    size: number,\r\n    ctime: number,\r\n    mtime: number,\r\n    owner: string,\r\n}\r\n\r\nexport interface DirectoryListingResponseOK {\r\n    status: \"ok\",\r\n    path: string,\r\n    files: DirectoryListingDetails[],\r\n    dirs: DirectoryListingDetails[],\r\n    drives: string[],\r\n    places: FSPlace[],\r\n}\r\n\r\nexport interface DirectoryListingResponseError {\r\n    status: \"error\",\r\n    path: string,\r\n    code: string,\r\n    msg: string,\r\n    alternative?: string,\r\n}\r\n\r\nexport type DirectoryListingResponse = DirectoryListingResponseOK | DirectoryListingResponseError;\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { DatasetFormParams, DirectoryListingDetails, FSPlace } from \"../messages\";\r\n\r\nexport enum ActionTypes {\r\n    LIST_DIRECTORY = 'BROWSER_LIST_DIRECTORY',\r\n    LIST_FULL_PATH = 'BROWSER_LIST_DIRECTORY_FULL',\r\n    DIRECTORY_LISTING = 'BROWSER_DIRECTORY_LISTING',\r\n    DETECT_PARAMS = 'BROWSER_DETECT_PARAMS',\r\n    PARAMS_DETECTED = 'BROWSER_PARAMS_DETECTED',\r\n    ERROR = 'BROWSER_ERROR',\r\n    OPEN = 'BROWSER_OPEN',\r\n    CANCEL = 'BROWSER_CANCEL',\r\n    SELECT = 'BROWSER_SELECT',\r\n    SELECT_FULL_PATH = 'BROWSER_SELECT_FULL_PATH',\r\n}\r\n\r\nexport const Actions = {\r\n    list: (path: string, name?: string) => createAction(ActionTypes.LIST_DIRECTORY, { path, name }),\r\n    dirListing: (path: string, dirs: DirectoryListingDetails[], files: DirectoryListingDetails[], drives: string[], places: FSPlace[]) => createAction(ActionTypes.DIRECTORY_LISTING, { path, dirs, files, drives, places }),\r\n    open: () => createAction(ActionTypes.OPEN),\r\n    cancel: () => createAction(ActionTypes.CANCEL),\r\n    select: (path: string, name: string) => createAction(ActionTypes.SELECT, { path, name }),\r\n    selectFullPath: (path: string) => createAction(ActionTypes.SELECT_FULL_PATH, { path }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n    detectParams: (path: string) => createAction(ActionTypes.DETECT_PARAMS, { path }),\r\n    paramsDetected: (path: string, params: DatasetFormParams) => createAction(ActionTypes.PARAMS_DETECTED, { path, params }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { ConfigState } from \"../../config/reducers\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { ClusterTypes, ConnectRequestLocalCluster } from \"../../messages\";\r\n\r\ntype FormValues = Omit<ConnectRequestLocalCluster, \"type\">;\r\n\r\ninterface FormProps {\r\n    onSubmit: (params: ConnectRequestLocalCluster) => void,\r\n    config: ConfigState,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & FormProps;\r\n\r\nconst LocalConnectionForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"numWorkers\">Number of Workers:</label>\r\n                <input type=\"number\" name=\"numWorkers\" value={values.numWorkers}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur} />\r\n                {errors.numWorkers && touched.numWorkers && errors.numWorkers}\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Connect</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<FormProps, FormValues>({\r\n    mapPropsToValues: (ownProps: FormProps) => ({\r\n        numWorkers: ownProps.config.localCores,\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onSubmit } = formikBag.props;\r\n        onSubmit({\r\n            type: ClusterTypes.LOCAL,\r\n            ...values,\r\n        });\r\n    }\r\n})(LocalConnectionForm);\r\n","\r\nimport { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { ConfigState } from \"../../config/reducers\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { ClusterTypes, ConnectRequestTCP } from \"../../messages\";\r\n\r\ntype FormValues = Omit<ConnectRequestTCP, \"type\">;\r\n\r\ninterface FormProps {\r\n    onSubmit: (params: ConnectRequestTCP) => void,\r\n    config: ConfigState,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & FormProps;\r\n\r\nconst TCPConnectionForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"address\">Scheduler URI</label>\r\n                <input type=\"text\" name=\"address\" value={values.address}\r\n                    onChange={handleChange}\r\n                    onBlur={handleBlur} />\r\n                {errors.address && touched.address && errors.address}\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Connect</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<FormProps, FormValues>({\r\n    mapPropsToValues: (ownProps: FormProps) => ({\r\n        address: ownProps.config.lastConnection.address,\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onSubmit } = formikBag.props;\r\n        onSubmit({\r\n            type: ClusterTypes.TCP,\r\n            ...values\r\n        });\r\n    }\r\n})(TCPConnectionForm);\r\n","\r\nimport * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dropdown, DropdownProps, Segment } from \"semantic-ui-react\";\r\nimport * as clusterActions from \"../../cluster/actions\";\r\nimport { getEnumValues } from \"../../helpers\";\r\nimport { ClusterTypeMetadata, ClusterTypes, ConnectRequestParams } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport LocalConnectionForm from \"./LocalConnectionForm\";\r\nimport TCPConnectionForm from \"./TCPConnectionForm\";\r\n\r\n\r\nconst mapDispatchToProps = {\r\n    connectToCluster: clusterActions.Actions.connect,\r\n};\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        config: state.config,\r\n        lastConnectionType: state.config.lastConnection.type\r\n    }\r\n}\r\n\r\ntype MergedProps = DispatchProps<typeof mapDispatchToProps> & ReturnType<typeof mapStateToProps>;\r\n\r\nconst clusterTypeKeys = getEnumValues(ClusterTypes);\r\nconst clusterTypeOptions = clusterTypeKeys.map(t => ({\r\n    text: ClusterTypeMetadata[ClusterTypes[t]].label,\r\n    value: ClusterTypes[t],\r\n}));\r\n\r\ninterface ConnectionParamsState {\r\n    clusterType: ClusterTypes\r\n}\r\n\r\nclass ClusterConnectionForm extends React.Component<MergedProps, ConnectionParamsState> {\r\n    public state = {\r\n        clusterType: this.props.lastConnectionType,\r\n    }\r\n\r\n    public setType = (type: ClusterTypes) => {\r\n        this.setState({\r\n            clusterType: type,\r\n        });\r\n    }\r\n\r\n    public handleChange = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        const value = data.value as ClusterTypes;\r\n        this.setType(value);\r\n    }\r\n\r\n    public handleSubmit = (params: ConnectRequestParams) => {\r\n        this.props.connectToCluster(params);\r\n    }\r\n\r\n    public renderForm() {\r\n        const { clusterType } = this.state;\r\n        const { config } = this.props;\r\n\r\n        switch (clusterType) {\r\n            case ClusterTypes.LOCAL: {\r\n                return <LocalConnectionForm config={config} onSubmit={this.handleSubmit} />\r\n            }\r\n            case ClusterTypes.TCP: {\r\n                return <TCPConnectionForm config={config} onSubmit={this.handleSubmit} />\r\n            }\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <>\r\n                <div>\r\n                    <Dropdown\r\n                        inline={true}\r\n                        options={clusterTypeOptions}\r\n                        value={this.state.clusterType}\r\n                        onChange={this.handleChange}\r\n                    />\r\n                </div>\r\n                <Segment>\r\n                    {this.renderForm()}\r\n                </Segment>\r\n            </>\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ClusterConnectionForm);","import * as React from 'react';\r\nimport { Icon, Message } from 'semantic-ui-react';\r\n\r\ninterface ChannelConnectingProps {\r\n    msg: string,\r\n}\r\n\r\nconst ChannelConnecting: React.SFC<ChannelConnectingProps> = ({ msg }) => (\r\n    <Message icon={true}>\r\n        <Icon name='cog' loading={true} />\r\n        <Message.Content>\r\n            <Message.Header>Connecting to LiberTEM</Message.Header>\r\n            {msg}\r\n        </Message.Content>\r\n    </Message>\r\n)\r\n\r\nexport default ChannelConnecting;","import * as React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport ClusterConnectionForm from \"../../cluster/components/ClusterConnectionForm\";\r\nimport { assertNotReached } from \"../../helpers\";\r\nimport { RootReducer } from \"../../store\";\r\nimport ChannelConnecting from \"./ChannelConnecting\";\r\n\r\nconst messages = {\r\n    waiting: \"Waiting...\",\r\n    connecting: \"Connecting...\",\r\n}\r\n\r\nconst clusterMessages = {\r\n    connected: \"Connected, waiting for initial state...\",\r\n    unknown: \"Connected, fetching cluster status...\",\r\n    connecting : \"Connecting to cluster\"\r\n}\r\n\r\nconst ConnectedNotReady: React.SFC = () => {\r\n    const haveConfig = useSelector((state: RootReducer) => state.config.haveConfig);\r\n    const clusterConnection = useSelector((state: RootReducer) => state.clusterConnection);\r\n\r\n    if (!haveConfig) {\r\n        return <ChannelConnecting msg=\"waiting for configuration...\" />;\r\n    }\r\n    if (clusterConnection.status === \"disconnected\") {\r\n        return <ClusterConnectionForm />\r\n    } else if (clusterConnection.status === \"connected\") {\r\n        return <ChannelConnecting msg={clusterMessages.connected} />;\r\n    } else if (clusterConnection.status === \"unknown\") {\r\n        return <ChannelConnecting msg={clusterMessages.unknown} />;\r\n    } else if (clusterConnection.status === \"connecting\") {\r\n        return <ChannelConnecting msg={clusterMessages.connecting} />\r\n    }\r\n    assertNotReached(\"should not happen\");\r\n}\r\n\r\nconst ChannelStatus: React.SFC = ({ children }) => {\r\n    const channelStatus = useSelector((state: RootReducer) => state.channelStatus);\r\n\r\n    switch (channelStatus.status) {\r\n        case \"waiting\":\r\n        case \"connecting\": {\r\n            return <ChannelConnecting msg={messages[channelStatus.status]} />;\r\n        }\r\n        case \"connected\": {\r\n            return <ConnectedNotReady />\r\n        }\r\n        case \"ready\":\r\n            return <>{children}</>;\r\n        default:\r\n            assertNotReached(\"should not happen\");\r\n    }\r\n}\r\n\r\nexport default ChannelStatus;","import * as React from \"react\";\r\nimport { Icon, SemanticICONS } from \"semantic-ui-react\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\n\r\n\r\ninterface FileBrowserEntryProps {\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n    onClick?: () => void,\r\n    icon?: SemanticICONS,\r\n}\r\n\r\ninterface TimeStampProps {\r\n    ts: number,\r\n}\r\n\r\nexport const TimeStamp: React.SFC<TimeStampProps> = ({ ts }) => {\r\n    const date = new Date(ts * 1000);\r\n    const fmtDate = date.toLocaleDateString();\r\n    const fmtTime = date.toLocaleTimeString();\r\n    const title = `${fmtDate} ${fmtTime}`;\r\n    return (\r\n        <div style={{ display: \"flex\", whiteSpace: \"nowrap\" }} title={title}>\r\n            <div style={{ width: \"50%\", marginRight: \"10px\" }}>{fmtDate}</div>\r\n            <div style={{ width: \"45%\" }}>{fmtTime}</div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// adapted from https://stackoverflow.com/a/14919494/540644\r\nfunction humanFileSize(bytes: number, si: boolean = false) {\r\n    const thresh = si ? 1000 : 1024;\r\n    if (Math.abs(bytes) < thresh) {\r\n        return {\r\n            size: bytes,\r\n            unit: 'B',\r\n        }\r\n    }\r\n    const units = si\r\n        ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n        : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\r\n    let u = -1;\r\n    do {\r\n        bytes /= thresh;\r\n        ++u;\r\n    } while (Math.abs(bytes) >= thresh && u < units.length - 1);\r\n\r\n    return {\r\n        size: bytes.toFixed(1),\r\n        unit: units[u],\r\n    }\r\n}\r\n\r\ninterface FileSizeProps {\r\n    size: number,\r\n    si?: boolean,\r\n}\r\n\r\nexport const FileSize: React.SFC<FileSizeProps> = ({ size, si }) => {\r\n    const fmtSize = humanFileSize(size, si)\r\n    return (\r\n        <div style={{ textAlign: \"right\" }}>\r\n            {fmtSize.size} {fmtSize.unit}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const Cell: React.SFC<{ title?: string }> = ({ children, title }) => {\r\n    const styles: React.CSSProperties = {\r\n        whiteSpace: \"nowrap\",\r\n        overflow: \"hidden\",\r\n        textOverflow: \"ellipsis\",\r\n        marginRight: \"10px\",\r\n    }\r\n    return (\r\n        <div style={styles} title={title}>{children}</div>\r\n    );\r\n}\r\n\r\n\r\nclass FileBrowserEntry extends React.Component<FileBrowserEntryProps> {\r\n    public onClick = (e: React.MouseEvent) => {\r\n        const { onClick } = this.props;\r\n        if (onClick) {\r\n            onClick();\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { details, style, icon } = this.props;\r\n        const myStyle: React.CSSProperties = {\r\n            cursor: \"pointer\",\r\n            ...style,\r\n        };\r\n\r\n        const tsStyles: React.CSSProperties = {\r\n            textAlign: \"right\",\r\n        };\r\n\r\n        return (\r\n            <div onClick={this.onClick} style={myStyle}>\r\n                <div style={{ display: \"flex\", paddingRight: \"10px\" }}>\r\n                    <div style={{ width: \"20%\", flexGrow: 1 }}>\r\n                        <Cell title={details.name}>\r\n                            {icon && <Icon name={icon} />}\r\n                            {details.name}\r\n                        </Cell>\r\n                    </div>\r\n                    <div style={{ width: \"10%\" }}><Cell><FileSize size={details.size} si={false} /></Cell></div>\r\n                    <div style={{ width: \"10%\" }}><Cell>{details.owner}</Cell></div>\r\n                    <div style={{ width: \"18%\", ...tsStyles }}>\r\n                        <Cell><TimeStamp ts={details.ctime} /></Cell>\r\n                    </div>\r\n                    <div style={{ width: \"18%\", ...tsStyles }}>\r\n                        <Cell><TimeStamp ts={details.mtime} /></Cell>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default FileBrowserEntry;","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { ConfigParams } from \"./reducers\";\r\n\r\nexport enum ActionTypes {\r\n    FETCHED = \"CONFIG_FETCHED\",\r\n    FETCH = \"CONFIG_FETCH\",\r\n    FETCH_FAILED = \"CONFIG_FETCH_FAILED\",\r\n    TOGGLE_STAR = \"CONFIG_TOGGLE_STAR\",\r\n}\r\n\r\nexport const Actions = {\r\n    fetch: () => createAction(ActionTypes.FETCH),\r\n    fetched: (config: ConfigParams) => createAction(ActionTypes.FETCHED, { config }),\r\n    fetchFailed: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.FETCH_FAILED, { msg, timestamp, id }),\r\n    toggleStar: (path: string) => createAction(ActionTypes.TOGGLE_STAR, { path }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import * as React from \"react\";\r\nimport { Cell } from \"./FileBrowserEntry\";\r\n\r\nconst FileBrowserHeader: React.SFC = () => {\r\n    const alignRight: React.CSSProperties = {\r\n        textAlign: \"right\",\r\n    };\r\n\r\n    // ugly hack: padding-right to compensate for scrollbar size\r\n    return (\r\n        <div style={{ paddingRight: \"20px\", paddingBottom: \"10px\" }}>\r\n            <div style={{ display: \"flex\" }}>\r\n                <div style={{ width: \"20%\", flexGrow: 1 }}>\r\n                    <Cell>Name</Cell>\r\n                </div>\r\n                <div style={{ width: \"10%\", ...alignRight }}>\r\n                    <Cell>Size</Cell>\r\n                </div>\r\n                <div style={{ width: \"10%\" }}>\r\n                    <Cell>Owner</Cell>\r\n                </div>\r\n                <div style={{ width: \"18%\", ...alignRight }}>\r\n                    <Cell>Created</Cell>\r\n                </div>\r\n                <div style={{ width: \"18%\", ...alignRight }}>\r\n                    <Cell>Modified</Cell>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FileBrowserHeader;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserEntry from \"./FileBrowserEntry\";\r\n\r\ninterface FileEntryProps {\r\n    path: string,\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: FileEntryProps) => {\r\n    return {\r\n        select: () => dispatch(browserActions.Actions.select(ownProps.path, ownProps.details.name)),\r\n    };\r\n}\r\n\r\ntype MergedProps = FileEntryProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nclass FileEntry extends React.Component<MergedProps> {\r\n    public render() {\r\n        const { details, style, select } = this.props;\r\n\r\n        return (\r\n            <FileBrowserEntry onClick={select} style={style} details={details}\r\n                icon=\"file outline\" />\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(FileEntry);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserEntry from \"./FileBrowserEntry\";\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: FolderEntryProps) => {\r\n    return {\r\n        list: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.path, ownProps.details.name));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n    };\r\n}\r\n\r\ninterface FolderEntryProps {\r\n    path: string,\r\n    style: object,\r\n    details: DirectoryListingDetails,\r\n    onChange: () => void,\r\n}\r\n\r\ntype MergedProps = FolderEntryProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst FolderEntry: React.SFC<MergedProps> = ({ list, details, style, onChange }) => {\r\n    return (\r\n        <FileBrowserEntry onClick={list} style={style} details={details} icon=\"folder\" />\r\n    )\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(FolderEntry);\r\n","import * as React from 'react';\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from 'redux';\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport * as browserActions from '../actions';\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DropdownItemProps) => {\r\n    return {\r\n        list: () => {\r\n            if (ownProps.value !== undefined) {\r\n                dispatch(browserActions.Actions.list(ownProps.value.toString()));\r\n                window.setTimeout(() => ownProps.onChange(), 0);\r\n            }\r\n        },\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapDispatchToProps> & DropdownItemProps & {\r\n    onChange: () => void,\r\n};\r\n\r\nconst PathDropDownItem: React.SFC<MergedProps> = ({ list, ...props }) => {\r\n    const newProps = {\r\n        onClick: list,\r\n        ...props,\r\n    }\r\n    return <Dropdown.Item {...newProps} />;\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(PathDropDownItem);","import { FormikProps, withFormik } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Form, Input } from \"semantic-ui-react\";\r\n\r\ninterface FormValues {\r\n    path: string,\r\n}\r\n\r\ninterface PathInputProps {\r\n    onChange: (path: string) => void,\r\n    initialPath: string,\r\n}\r\n\r\ntype MergedProps = FormikProps<FormValues> & PathInputProps;\r\n\r\nconst PathInput: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit} style={{ flexGrow: 1 }}>\r\n            <Form.Field>\r\n                <Input autoComplete=\"off\" onBlur={handleBlur} onChange={handleChange} value={values.path} name=\"path\" />\r\n            </Form.Field>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withFormik<PathInputProps, FormValues>({\r\n    mapPropsToValues: ({ initialPath }) => ({\r\n        path: initialPath,\r\n    }),\r\n    handleSubmit: (values, formikBag) => {\r\n        const { onChange } = formikBag.props;\r\n        onChange(values.path);\r\n    },\r\n    enableReinitialize: true,\r\n})(PathInput);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport { DatasetTypes } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\n\r\n\r\ntype DropdownOptions = Array<{\r\n    text: string,\r\n    value: {\r\n        type: DatasetTypes,\r\n        path: string,\r\n    },\r\n}>;\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        lastOpened: state.config.lastOpened,\r\n        fileHistory: state.config.fileHistory,\r\n        separator: state.config.separator,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => {\r\n    return {\r\n        select: (path: string) => dispatch(browserActions.Actions.selectFullPath(path)),\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst RecentFiles: React.SFC<MergedProps> = ({ lastOpened, fileHistory, select }) => {\r\n\r\n    const recentFiles: DropdownOptions = fileHistory.filter((path: string) => lastOpened[path]).map((path: string) => {\r\n        const item = lastOpened[path];\r\n        return {\r\n            text: item.path,\r\n            value: {\r\n                type: item.type,\r\n                path: item.path,\r\n            },\r\n        };\r\n    });\r\n\r\n    const onClick = (e: React.MouseEvent<HTMLDivElement>, data: DropdownItemProps) => data.value && select(data.value.toString())\r\n\r\n    return (\r\n        <Dropdown item={true} text=\"Recent\" floating={true}>\r\n            <Dropdown.Menu>\r\n                <Dropdown.Header content=\"recent datasets\" />\r\n                {recentFiles.map((option, idx) => (\r\n                    <Dropdown.Item key={idx} value={option.value.path} content={option.text} onClick={onClick} />\r\n                ))}\r\n            </Dropdown.Menu>\r\n        </Dropdown>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(RecentFiles);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Dropdown, Menu } from \"semantic-ui-react\";\r\nimport * as configActions from '../../config/actions';\r\nimport * as browserActions from '../actions';\r\nimport { FSPlaces } from \"../types\";\r\nimport PathDropDownItem from \"./PathDropDownItem\";\r\nimport PathInput from \"./PathInput\";\r\nimport RecentFiles from \"./RecentFiles\";\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: PathBarProps) => {\r\n    return {\r\n        refresh: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.currentPath));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n        handleInputChange: (path: string) => {\r\n            dispatch(browserActions.Actions.list(path));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n        goUp: () => {\r\n            dispatch(browserActions.Actions.list(ownProps.currentPath, '..'));\r\n            window.setTimeout(() => ownProps.onChange(), 0);\r\n        },\r\n        toggleStar: () => {\r\n            dispatch(configActions.Actions.toggleStar(ownProps.currentPath));\r\n        }\r\n    };\r\n}\r\n\r\ninterface PathBarProps {\r\n    currentPath: string,\r\n    onChange: () => void,\r\n    drives: string[],\r\n    places: FSPlaces,\r\n    starred: string[],\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapDispatchToProps> & PathBarProps;\r\n\r\nconst PathBar: React.SFC<MergedProps> = ({ currentPath, drives, places, starred, onChange, refresh, goUp, handleInputChange, toggleStar }) => {\r\n    const driveOptions = drives.map((path) => ({ key: path, text: path }));\r\n    const placeOptions = Object.keys(places).map((key) => ({ key: places[key].path, text: places[key].title }));\r\n    const starOptions = starred.map((path) => ({ key: path, text: path }));\r\n    const isStarred = starred.includes(currentPath);\r\n    const starredIcon = isStarred ? \"star\" : \"star outline\";\r\n    const bookmarkTitle = isStarred ? \"Remove from bookmarks\" : \"Bookmark this location\";\r\n\r\n    return (\r\n        <Menu>\r\n            <RecentFiles />\r\n            <Dropdown text=\"Go to...\" floating={true} item={true}>\r\n                <Dropdown.Menu>\r\n                    <Dropdown.Header content=\"Drives\" />\r\n                    {driveOptions.map((option) => {\r\n                        return <PathDropDownItem key={option.key} value={option.key} content={option.text} onChange={onChange} />\r\n                    })}\r\n                    <Dropdown.Header content=\"Places\" />\r\n                    {placeOptions.map((option) => {\r\n                        return <PathDropDownItem key={option.key} value={option.key} content={option.text} onChange={onChange} />\r\n                    })}\r\n                    <Dropdown.Header content=\"Starred\" />\r\n                    {starOptions.length === 0 && \r\n                        <Dropdown.Item key=\"empty\" value=\"empty\" content=\"No bookmarks yet\" />\r\n                    }\r\n                    {starOptions.map((option) => {\r\n                        return <PathDropDownItem key={option.key} value={option.key} content={option.text} onChange={onChange} />\r\n                    })}\r\n                </Dropdown.Menu>\r\n            </Dropdown>\r\n            <Menu.Item title={bookmarkTitle} icon={starredIcon} onClick={toggleStar} />\r\n            <Menu.Item icon=\"arrow up\" onClick={goUp} />\r\n            <Menu.Item style={{ flexGrow: 1 }}>\r\n                <PathInput onChange={handleInputChange} initialPath={currentPath} />\r\n            </Menu.Item>\r\n            <Menu.Item icon=\"refresh\" onClick={refresh} />\r\n        </Menu>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(PathBar);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { FixedSizeList as List } from \"react-window\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Button, Header, Segment } from \"semantic-ui-react\";\r\nimport { DirectoryListingDetails } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowserHeader from \"./FileBrowserHeader\";\r\nimport FileEntry from \"./FileEntry\";\r\nimport FolderEntry from \"./FolderEntry\";\r\nimport PathBar from \"./PathBar\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    const { browser, config } = state;\r\n    return {\r\n        files: browser.files,\r\n        dirs: browser.dirs,\r\n        path: browser.path,\r\n        drives: browser.drives,\r\n        places: browser.places,\r\n        isLoading: browser.isLoading,\r\n        starred: config.starred,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => {\r\n    return {\r\n        cancel: () => dispatch(browserActions.Actions.cancel()),\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;\r\n\r\ninterface EntryFnArgs {\r\n    index: number,\r\n    style: object\r\n}\r\ntype EntryFn = (arg: EntryFnArgs) => void\r\n\r\nconst listRef = React.createRef<List>();\r\n\r\nconst scrollToTop = () => {\r\n    if (listRef.current === null) {\r\n        return;\r\n    }\r\n    listRef.current.scrollToItem(0);\r\n}\r\n\r\nfunction sortByKey<T extends object>(array: T[], getKey: (item: T) => any) {\r\n    return array.sort((a, b) => {\r\n        const x = getKey(a);\r\n        const y = getKey(b);\r\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n    });\r\n}\r\n\r\nconst FileBrowser: React.SFC<MergedProps> = ({ files, dirs, path, drives, places, starred, cancel, isLoading }) => {\r\n    const getSortKey = (item: DirectoryListingDetails) => item.name.toLowerCase();\r\n    const dirEntries = sortByKey(dirs, getSortKey).map((dir) => (style: object) => <FolderEntry style={style} onChange={scrollToTop} path={path} details={dir} />);\r\n    const fileEntries = sortByKey(files, getSortKey).map((f) => ((style: object) => <FileEntry style={style} path={path} details={f} />));\r\n    const entries = dirEntries.concat(fileEntries);\r\n\r\n    const cellFn: EntryFn = ({ index, style }) => {\r\n        return entries[index](style)\r\n    }\r\n\r\n    let list = (\r\n        <List style={{ overflowY: \"scroll\" }} ref={listRef} height={300} width=\"100%\" itemCount={entries.length} itemSize={35}>\r\n            {cellFn}\r\n        </List>\r\n    );\r\n\r\n    if (isLoading) {\r\n        // FIXME: hardcoded height\r\n        list = (\r\n            <Segment loading={true} style={{ height: \"300px\" }} />\r\n        )\r\n    }\r\n\r\n    return (\r\n        <Segment.Group>\r\n            <Segment>\r\n                <Header as=\"h2\">Open dataset</Header>\r\n            </Segment>\r\n            <Segment>\r\n                <PathBar currentPath={path} drives={drives} places={places} starred={starred} onChange={scrollToTop} />\r\n            </Segment>\r\n            <Segment>\r\n                <FileBrowserHeader />\r\n                {list}\r\n            </Segment>\r\n            <Segment>\r\n                <Button onClick={cancel}>Cancel</Button>\r\n            </Segment>\r\n        </Segment.Group>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(FileBrowser);","\r\nexport interface JobResultType {\r\n    imageURL: string,\r\n    description: { title: string, desc: string, includeInDownload: boolean },\r\n}\r\n\r\nexport enum JobRunning {\r\n    CREATING = 'CREATING',\r\n    RUNNING = 'RUNNING',\r\n    DONE = 'DONE',\r\n}\r\n\r\nexport enum JobStatus {\r\n    CREATING = 'CREATING',\r\n    IN_PROGRESS = 'IN_PROGRESS',\r\n    CANCELLED = 'CANCELLED',\r\n    SUCCESS = 'SUCCESS',\r\n    ERROR = 'ERROR',\r\n}\r\n\r\nexport interface JobStateCommon {\r\n    id: string,\r\n    analysis: string,\r\n    status: JobStatus,\r\n    startTimestamp: number,\r\n    results: JobResultType[],\r\n}\r\n\r\nexport type JobStateStart = JobStateCommon & {\r\n    running: JobRunning.CREATING | JobRunning.RUNNING,\r\n}\r\n\r\nexport type JobStateDone = JobStateCommon & {\r\n    running: JobRunning.DONE,\r\n    endTimestamp: number,\r\n}\r\n\r\nexport type JobState = JobStateStart | JobStateDone;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Button, Icon } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as browserActions from '../actions';\r\nimport FileBrowser from \"./FileBrowser\";\r\n\r\nexport const mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        isOpen: state.browser.isOpen,\r\n        busy: state.openDataset.busy,\r\n        formVisible: state.openDataset.formVisible,\r\n    }\r\n}\r\n\r\nexport const mapDispatchToProps = {\r\n    open: browserActions.Actions.open,\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps> & DispatchProps<typeof mapDispatchToProps>;\r\n\r\nconst BrowserWrapper: React.SFC<MergedProps> = ({ formVisible, isOpen, open, busy }) => {\r\n    if(formVisible || busy) {\r\n        return null;\r\n    } else if (!isOpen) {\r\n        return (\r\n            <Button icon={true} labelPosition=\"left\" onClick={open}>\r\n                <Icon name='add' />\r\n                Browse\r\n            </Button>\r\n        );\r\n    } else {\r\n        return (\r\n            <FileBrowser />\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(BrowserWrapper)\r\n","import * as React from \"react\";\r\nimport { Icon } from \"semantic-ui-react\";\r\n\r\nconst BusySpinner: React.SFC = () => {\r\n    const styles: React.CSSProperties = {\r\n        margin: 0,\r\n        padding: 0,\r\n        position: \"absolute\",\r\n        bottom: \"10px\",\r\n        right: \"10px\",\r\n        color: \"white\",\r\n        opacity: 0.7,\r\n        filter: \"drop-shadow(0 0 3px #000)\",\r\n    };\r\n    return (\r\n        <Icon name=\"cog\" loading={true} style={styles} />\r\n    )\r\n}\r\n\r\nexport default BusySpinner;","import * as React from \"react\";\r\nimport BusySpinner from \"./BusySpinner\";\r\n\r\ninterface BusyWrapperProps {\r\n    busy: boolean,\r\n}\r\n\r\nconst BusyWrapper: React.SFC<BusyWrapperProps> = ({ children, busy }) => {\r\n    const styles: React.CSSProperties = {\r\n        position: \"relative\",\r\n    };\r\n    return (\r\n        <div style={styles}>\r\n            {children}\r\n            {busy && <BusySpinner />}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BusyWrapper;","import * as React from \"react\";\r\nimport { DraggableHandle } from \"./DraggableHandle\";\r\nimport { HandleRenderFunction } from \"./types\";\r\n\r\nexport interface HandleParentProps {\r\n    width: number,\r\n    height: number,\r\n    onKeyboardEvent?: React.KeyboardEventHandler<SVGElement>,\r\n    handles: HandleRenderFunction[],\r\n}\r\n\r\nexport class HandleParent extends React.Component<HandleParentProps> {\r\n    public currentHandle: DraggableHandle | undefined;\r\n\r\n    public handleDragStart = (h: DraggableHandle): void => {\r\n        this.currentHandle = h;\r\n    }\r\n\r\n    public handleDrop = (): void => {\r\n        this.currentHandle = undefined;\r\n    }\r\n\r\n    public handleMouseMove = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            return this.currentHandle.externalMouseMove(e);\r\n        }\r\n    }\r\n\r\n    public handleMouseLeave = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            this.currentHandle.externalLeave(e);\r\n        }\r\n    }\r\n\r\n    public handleMouseUp = (e: React.MouseEvent<SVGElement>): void => {\r\n        if (this.currentHandle) {\r\n            this.currentHandle.externalMouseUp(e);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { width, height } = this.props;\r\n        const styles = {\r\n            outline: \"1px dashed black\"\r\n        }\r\n        return (\r\n            <g\r\n                onMouseMove={this.handleMouseMove}\r\n                onMouseLeave={this.handleMouseLeave}\r\n                onMouseUp={this.handleMouseUp}\r\n                onKeyDown={this.props.onKeyboardEvent}\r\n                style={styles}\r\n                tabIndex={0}\r\n            >\r\n                <rect style={{ fill: \"transparent\" }}\r\n                    x={0} y={0} width={width} height={height}\r\n                />\r\n                {this.renderHandles()}\r\n            </g>\r\n        );\r\n    }\r\n\r\n    public renderHandles() {\r\n        const { handles, onKeyboardEvent } = this.props;\r\n        // we need to inform the handle when there are move/up/leave events\r\n        // on this parent element, for which we need to know the current handle.\r\n        // so we pass the handle a dragstart/drop function and kindly ask it\r\n        // to call us if it starts to be dragged or is dropped.\r\n        return handles.map((h, i) => {\r\n            const elem = h(this.handleDragStart, this.handleDrop, onKeyboardEvent);\r\n            if (React.isValidElement(elem)) {\r\n                return React.cloneElement(elem, { key: i });\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n}\r\n\r\nexport default HandleParent;","import * as React from \"react\";\r\nimport { JobState } from \"../types\";\r\nimport styles from \"./ResultImage.module.css\";\r\n\r\ninterface ResultImageProps {\r\n    job: JobState,\r\n    channel: number,\r\n    width: number,\r\n    height: number,\r\n}\r\n\r\nconst ResultImage: React.SFC<ResultImageProps> = ({ job, channel, width, height }) => {\r\n    const result = job.results[channel];\r\n    if (result === undefined) {\r\n        return (\r\n            <svg className={styles.fallback} width={width} height={height} viewBox={`0 0 ${width} ${height}`} key={-1} />\r\n        )\r\n    }\r\n    return (\r\n        <image className={styles.default} xlinkHref={result.imageURL} width={width} height={height} />\r\n    );\r\n}\r\n\r\nexport default ResultImage;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport styled from 'styled-components';\r\nimport BusyWrapper from \"../../widgets/BusyWrapper\";\r\nimport HandleParent from \"../../widgets/HandleParent\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport { JobRunning, JobState } from \"../types\";\r\nimport ResultImage from \"./ResultImage\";\r\n\r\ninterface ResultProps {\r\n    width: number,\r\n    height: number,\r\n    job: JobState,\r\n    extraHandles?: HandleRenderFunction,\r\n    extraWidgets?: React.ReactElement<SVGElement>,\r\n    channel: number,\r\n}\r\n\r\nconst ResultWrapper = styled.svg`\r\n    display: block;\r\n    border: 1px solid black;\r\n    width: 100%;\r\n    height: auto;\r\n`;\r\n\r\ntype MergedProps = ResultProps;\r\n\r\nclass Result extends React.Component<MergedProps> {\r\n    public renderHandles() {\r\n        const { width, height, extraHandles } = this.props;\r\n        let handles: HandleRenderFunction[] = [];\r\n        if (extraHandles) {\r\n            handles = [...handles, extraHandles];\r\n        }\r\n\r\n        return (\r\n            <HandleParent width={width} height={height} handles={handles} />\r\n        )\r\n    }\r\n\r\n    public render() {\r\n        const { job, channel, width, height, extraWidgets } = this.props;\r\n        const busy = job.running !== JobRunning.DONE;\r\n\r\n        return (\r\n            <BusyWrapper busy={busy}>\r\n                <ResultWrapper width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\r\n                    <ResultImage job={job} channel={channel} width={width} height={height} />\r\n                    {extraWidgets}\r\n                    {this.renderHandles()}\r\n                </ResultWrapper>\r\n            </BusyWrapper>\r\n        );\r\n    }\r\n};\r\n\r\nexport default connect(null, null)(Result);","import styled from 'styled-components';\r\n\r\n\r\nconst Selectors = styled.div`\r\n    display: flex;\r\n    & > * {\r\n        margin-right: 10px;\r\n    }\r\n`;\r\n\r\n\r\n\r\nexport default Selectors;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport { JobRunning, JobState } from \"../types\";\r\nimport Result from \"./Result\";\r\nimport Selectors from \"./Selectors\";\r\n\r\ninterface ResultListProps {\r\n    width: number,\r\n    height: number,\r\n    selectors?: React.ReactElement<any>,\r\n    extraHandles?: HandleRenderFunction,\r\n    extraWidgets?: React.ReactElement<SVGElement>,\r\n    subtitle?: React.ReactNode,\r\n}\r\n\r\ninterface ExternalResultListProps {\r\n    compoundAnalysis: string,\r\n    analysisIndex: number,\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer, ownProps: ExternalResultListProps) => {\r\n    const compoundAnalysis = state.compoundAnalyses.byId[ownProps.compoundAnalysis];\r\n    const analysis = state.analyses.byId[compoundAnalysis.details.analyses[ownProps.analysisIndex]];\r\n\r\n    return {\r\n        jobsById: state.jobs.byId,\r\n        analysis,\r\n        compoundAnalysis,\r\n        analysisIndex: ownProps.analysisIndex,\r\n    };\r\n};\r\n\r\ntype MergedProps = ResultListProps & ReturnType<typeof mapStateToProps>;\r\n\r\ninterface ResultListState {\r\n    selectedChannel: number,\r\n}\r\n\r\nconst ResultListPlaceholder: React.SFC<{ width: number, height: number }> = ({ width, height }) => {\r\n    return (\r\n        <svg\r\n            style={{\r\n                display: \"block\",\r\n                border: \"1px solid black\",\r\n                width: \"100%\",\r\n                height: \"auto\"\r\n            }}\r\n            width={width} height={height}\r\n            viewBox={`0 0 ${width} ${height}`} key={-1} />\r\n    );\r\n}\r\n\r\n\r\nclass ResultList extends React.Component<MergedProps, ResultListState> {\r\n    public state: ResultListState = { selectedChannel: 0 };\r\n\r\n    public selectChannel = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        const value = data.value as number;\r\n        this.setState({ selectedChannel: value });\r\n    }\r\n\r\n    public getJob() {\r\n        const {\r\n            analysis, jobsById,\r\n        } = this.props;\r\n        if (!analysis || !analysis.displayedJob || !jobsById[analysis.displayedJob]) {\r\n            return undefined;\r\n        }\r\n        return jobsById[analysis.displayedJob];\r\n    }\r\n\r\n    public getMsg(job?: JobState) {\r\n        if (!job) {\r\n            return <>&nbsp;</>;\r\n        }\r\n        if (job.running === JobRunning.DONE) {\r\n            const dt = (job.endTimestamp - job.startTimestamp) / 1000;\r\n            return <>Analysis done in {dt.toFixed(3)}s</>;\r\n        } else {\r\n            return <>Analysis running...</>;\r\n        }\r\n    }\r\n\r\n    public genericRender(currentResult: React.ReactElement, job?: JobState) {\r\n        const { subtitle, children, selectors } = this.props;\r\n        const msg = this.getMsg(job);\r\n        return (\r\n            <div>\r\n                {currentResult}\r\n                {children}\r\n                <Selectors>\r\n                    <ResultImageSelector job={job} handleChange={this.selectChannel} selectedImg={this.state.selectedChannel} />\r\n                    {selectors}\r\n                </Selectors>\r\n                <p>{subtitle} {msg}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public render() {\r\n        const job = this.getJob();\r\n        const {\r\n            width, height,\r\n            extraHandles, extraWidgets\r\n        } = this.props;\r\n\r\n        if (!job) {\r\n            return this.genericRender(<ResultListPlaceholder width={width} height={height} />, job);\r\n        }\r\n\r\n        return this.genericRender(\r\n            <Result job={job}\r\n                extraHandles={extraHandles}\r\n                extraWidgets={extraWidgets}\r\n                width={width} height={height}\r\n                channel={this.state.selectedChannel}\r\n            />,\r\n            job\r\n        );\r\n    }\r\n}\r\n\r\ninterface ImageSelectorProps {\r\n    job?: JobState,\r\n    handleChange: (e: React.SyntheticEvent, data: DropdownProps) => void,\r\n    selectedImg: number,\r\n}\r\n\r\nconst ResultImageSelector: React.SFC<ImageSelectorProps> = ({ job, handleChange, selectedImg }) => {\r\n    if (!job) {\r\n        return null;\r\n    }\r\n    const availableImages = job.results.map((result, idx) => ({ text: result.description.title, value: idx }));\r\n    return (\r\n        <>\r\n            <div>\r\n                Channel:{' '}\r\n                <Dropdown\r\n                    inline={true}\r\n                    options={availableImages}\r\n                    value={selectedImg}\r\n                    onChange={handleChange}\r\n                />\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps)(ResultList);\r\n","export const inRectConstraint = (width: number, height: number) => (p: Point2D) => {\r\n    return {\r\n        x: Math.max(0, Math.min(width - 1, p.x)),\r\n        y: Math.max(0, Math.min(height - 1, p.y)),\r\n    }\r\n}\r\n\r\nexport const dist = (cx: number, cy: number, x: number, y: number) => {\r\n    const dx = cx - x;\r\n    const dy = cy - y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nexport const cbToRadius = (cx: number, cy: number, cb: ((r: number) => void) | undefined) => (x: number, y: number) => cb && cb(dist(cx, cy, x, y))\r\n\r\nexport const keepOnCY = (cy: number) => (p: Point2D) => {\r\n    return {\r\n        x: p.x,\r\n        y: cy,\r\n    }\r\n}\r\n\r\nexport const keepXLargerThan = (otherX: number) => (p: Point2D) => {\r\n    return {\r\n        x: otherX > p.x ? otherX : p.x,\r\n        y: p.y,\r\n    }\r\n}\r\n\r\nexport const keepXSmallerThan = (otherX: number) => (p: Point2D) => {\r\n    return {\r\n        x: otherX < p.x ? otherX : p.x,\r\n        y: p.y,\r\n    }\r\n}\r\n\r\nexport const riConstraint = (outerPos: number, cy: number) => (p: Point2D) => {\r\n    return keepXLargerThan(outerPos)(\r\n        keepOnCY(cy)(p)\r\n    );\r\n}\r\n\r\nexport const roConstraints = (innerPos: number, cy: number) => (p: Point2D) => {\r\n    return keepXSmallerThan(innerPos)(\r\n        keepOnCY(cy)(p)\r\n    );\r\n}","import { CSSProperties } from \"react\";\r\n\r\nexport const defaultMaskStyles = (imageWidth: number): CSSProperties => ({\r\n    fillOpacity: 0.3,\r\n    fill: \"red\",\r\n    strokeOpacity: 0.7,\r\n    stroke: \"red\",\r\n    strokeWidth: imageWidth / 128 / 3,\r\n});","import * as React from \"react\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface DiskProps {\r\n    imageWidth: number,\r\n    imageHeight: number,\r\n    cx: number,\r\n    cy: number,\r\n    r: number,\r\n}\r\n\r\nconst Disk: React.SFC<DiskProps> = ({ imageWidth, imageHeight, cx, cy, r }) => {\r\n    return (\r\n        <circle cx={cx + .5} cy={cy + .5} r={r} style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Disk;","import * as React from \"react\";\r\nimport styled from 'styled-components';\r\nimport { handleKeyEvent, ModifyCoords } from \"./kbdHandler\";\r\n\r\nexport type HandleProps = {\r\n    x: number,\r\n    y: number,\r\n    scale: number,\r\n    withCross?: boolean,\r\n    focusRef: React.RefObject<SVGGElement>,\r\n} & React.SVGProps<SVGGElement>;\r\n\r\nconst StyledCircle = styled.circle`\r\n    stroke: red;\r\n    stroke-width: 1;\r\n    fill: transparent;\r\n    g:focus > & {\r\n        stroke: lightgreen;\r\n    }\r\n`;\r\n\r\nconst Cross = styled.path`\r\n    stroke: red;\r\n    stroke-width: 1;\r\n    fill: transparent;\r\n    g:focus > & {\r\n        stroke: lightgreen;\r\n    }\r\n`;\r\n\r\nconst FocusGroup = styled.g`\r\n    &:focus { outline: none; }\r\n`;\r\n\r\nconst Handle: React.SFC<HandleProps> = ({ scale, x, y, withCross, focusRef, ...args }) => {\r\n    const r = 3;\r\n    // scaleMatrix is needed to set the origin of the scale\r\n    const scaleMatrix = `matrix(${scale}, 0, 0, ${scale}, ${x - scale * x}, ${y - scale * y})`;\r\n    const style: React.CSSProperties = { transform: scaleMatrix };\r\n    const crossSpec = `\r\n        M${x - 4 - r / 2} ${y} L ${x - r / 2} ${y} M${x + r / 2} ${y} L ${x + 4 + r / 2} ${y}\r\n        M${x} ${y - 4 - r / 2} L ${x} ${y - r / 2} M${x} ${y + r / 2} L ${x} ${y + 4 + r / 2}\r\n    `;\r\n    const cross = withCross ? <Cross d={crossSpec} style={style} /> : null;\r\n    return (\r\n        <FocusGroup {...args} ref={focusRef}>\r\n            <StyledCircle cx={x} cy={y} r={r} style={style} />\r\n            {cross}\r\n        </FocusGroup>\r\n    )\r\n}\r\n\r\nexport interface DraggableHandleProps {\r\n    x: number,\r\n    y: number,\r\n    withCross?: boolean,\r\n    imageWidth?: number,\r\n    onDragMove?: (x: number, y: number) => void,\r\n    parentOnDragStart: (h: DraggableHandle) => void,\r\n    parentOnDrop: (x: number, y: number) => void,\r\n    onKeyboardEvent?: (e: React.KeyboardEvent<SVGElement>) => void,\r\n    constraint?: (p: Point2D) => Point2D,\r\n}\r\n\r\nexport function getScalingFactor(elem: SVGElement): number {\r\n    const svg = elem.ownerSVGElement;\r\n    if (svg === null) {\r\n        throw new Error(\"no owner SVG element?\");\r\n    }\r\n    const inWidthAttr = svg.getAttribute(\"width\");\r\n    if (inWidthAttr === null) {\r\n        throw new Error(\"no width on SVG element?\");\r\n    }\r\n    const inWidth = +inWidthAttr;\r\n    const svgMeasurements = svg.getBoundingClientRect();\r\n    return svgMeasurements.width / inWidth;\r\n}\r\n\r\nfunction relativeCoords(e: React.MouseEvent, parent: SVGElement) {\r\n    const f = getScalingFactor(parent);\r\n    const parentPos = parent.getBoundingClientRect();\r\n    const res = {\r\n        x: (e.pageX - (parentPos.left + window.pageXOffset)) / f,\r\n        y: (e.pageY - (parentPos.top + window.pageYOffset)) / f,\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * stateful draggable handle, to be used as part of <svg/>\r\n */\r\nexport class DraggableHandle extends React.Component<DraggableHandleProps> {\r\n    public posRef: React.RefObject<SVGRectElement>;\r\n    public focusRef: React.RefObject<SVGGElement>;\r\n\r\n    public state = {\r\n        dragging: false,\r\n        drag: { x: 0, y: 0 },\r\n    }\r\n\r\n    constructor(props: DraggableHandleProps) {\r\n        super(props);\r\n        this.posRef = React.createRef<SVGRectElement>();\r\n        this.focusRef = React.createRef<SVGGElement>();\r\n    }\r\n\r\n    // mousemove event from outside (delegated from surrounding element)\r\n    public externalMouseMove = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.move(e);\r\n    }\r\n\r\n    // mouseleave event from outside (delegated from surrounding element)\r\n    public externalLeave = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.stopDrag(e);\r\n    }\r\n\r\n    // mouseup event from outside (delegated from surrounding element)\r\n    public externalMouseUp = (e: React.MouseEvent<SVGElement>): void => {\r\n        this.stopDrag(e);\r\n    }\r\n\r\n    public applyConstraint = (p: Point2D) => {\r\n        const { constraint } = this.props;\r\n        if (constraint) {\r\n            return constraint(p);\r\n        } else {\r\n            return p;\r\n        }\r\n    }\r\n\r\n    public startDrag = (e: React.MouseEvent<SVGElement>): void => {\r\n        e.preventDefault();\r\n        const { parentOnDragStart } = this.props;\r\n        if (this.posRef.current) {\r\n            this.setState({\r\n                dragging: true,\r\n                drag: this.applyConstraint(relativeCoords(e, this.posRef.current)),\r\n            });\r\n            if (parentOnDragStart) {\r\n                parentOnDragStart(this);\r\n            }\r\n            if (this.focusRef.current && this.focusRef.current.focus) {\r\n                this.focusRef.current.focus();\r\n            }\r\n        } else {\r\n            throw new Error(\"startDrag without posRef\");\r\n        }\r\n    }\r\n\r\n    public move = (e: React.MouseEvent<SVGElement>): void => {\r\n        const { onDragMove } = this.props;\r\n        if (!this.state.dragging) {\r\n            return;\r\n        }\r\n        if (this.posRef.current) {\r\n            this.setState({\r\n                drag: this.applyConstraint(relativeCoords(e, this.posRef.current)),\r\n            }, () => {\r\n                if (onDragMove) {\r\n                    const constrained = this.applyConstraint(this.state.drag)\r\n                    onDragMove(constrained.x, constrained.y);\r\n                }\r\n            })\r\n        } else {\r\n            throw new Error(\"move without posRef\");\r\n        }\r\n    }\r\n\r\n    public stopDrag = (e: React.MouseEvent<SVGElement>): void => {\r\n        const { parentOnDrop } = this.props;\r\n        const { dragging, drag } = this.state;\r\n        if (!dragging) {\r\n            return;\r\n        }\r\n        this.setState({\r\n            dragging: false,\r\n        })\r\n        if (parentOnDrop) {\r\n            parentOnDrop(drag.x, drag.y);\r\n        }\r\n    }\r\n\r\n    public handleKeyDown = (e: React.KeyboardEvent<SVGElement>) => {\r\n        const update = (fn: ModifyCoords) => {\r\n            const { x, y, onDragMove } = this.props;\r\n            const newCoords = fn(x, y);\r\n            const constrained = this.applyConstraint(newCoords);\r\n            if (onDragMove) {\r\n                onDragMove(constrained.x, constrained.y);\r\n            }\r\n        }\r\n        handleKeyEvent(e, update);\r\n    }\r\n\r\n    public renderCommon(x: number, y: number) {\r\n        const { imageWidth } = this.props;\r\n        const scale = imageWidth === undefined ? 1 : imageWidth / 128;\r\n        // empty zero-size <rect> as relative position reference\r\n        return (\r\n            <g>\r\n                <rect\r\n                    style={{ visibility: \"hidden\" }}\r\n                    ref={this.posRef}\r\n                    x={0} y={0} width={0} height={0}\r\n                />\r\n                <Handle scale={scale} x={x + .5} y={y + .5} withCross={this.props.withCross}\r\n                    focusRef={this.focusRef}\r\n                    onMouseUp={this.stopDrag}\r\n                    onMouseMove={this.move}\r\n                    onMouseDown={this.startDrag}\r\n                    onKeyDown={this.handleKeyDown}\r\n                    tabIndex={0}\r\n                />\r\n            </g>\r\n        );\r\n    }\r\n\r\n    public renderDragging() {\r\n        const { x, y } = this.state.drag;\r\n        return this.renderCommon(x, y);\r\n    }\r\n\r\n    public render() {\r\n        const { x, y } = this.props;\r\n        // either render from state (when dragging) or from props\r\n        if (this.state.dragging) {\r\n            return this.renderDragging();\r\n        } else {\r\n            return this.renderCommon(x, y);\r\n        }\r\n    }\r\n}\r\n\r\nexport default DraggableHandle;\r\n","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { AnalysisDetails, AnalysisTypes, CompoundAnalysisDetails } from \"../messages\";\r\nimport { CompoundAnalysis } from \"./types\";\r\n\r\n\r\nexport enum ActionTypes {\r\n    CREATE = 'COMPOUND_ANALYSIS_CREATE',\r\n    CREATED = 'COMPOUND_ANALYSIS_CREATED',\r\n    UPDATED = 'COMPOUND_ANALYSIS_UPDATED',\r\n    RUN = 'COMPOUND_ANALYSIS_RUN',\r\n    RUNNING = 'COMPOUND_ANALYSIS_RUNNING',\r\n    REMOVE = 'COMPOUND_ANALYSIS_REMOVE',\r\n    REMOVED = 'COMPOUND_ANALYSIS_REMOVED',\r\n    ERROR = 'COMPOUND_ANALYSIS_ERROR',\r\n    ENABLE_AUTOSTART = 'COMPOUND_ANALYSIS_ENABLE_AUTOSTART',\r\n}\r\n\r\nexport const Actions = {\r\n    create: (dataset: string, analysisType: AnalysisTypes) => createAction(ActionTypes.CREATE, { dataset, analysisType }),\r\n    created: (\r\n        compoundAnalysis: CompoundAnalysis, autoStart: boolean\r\n    ) => createAction(ActionTypes.CREATED, { compoundAnalysis, autoStart }),\r\n    enableAutoStart: (\r\n        compoundAnalysisId: string\r\n    ) => createAction(ActionTypes.ENABLE_AUTOSTART, { compoundAnalysisId }),\r\n    updated: (id: string, details: CompoundAnalysisDetails) => createAction(ActionTypes.UPDATED, { id, details }),\r\n    run: (id: string, analysisIndex: number, details: AnalysisDetails) => createAction(ActionTypes.RUN, { id, analysisIndex, details }),\r\n    running: (id: string, job: string, analysisIndex: number) => createAction(ActionTypes.RUNNING, { id, job, jobIndex: analysisIndex }),\r\n    remove: (id: string) => createAction(ActionTypes.REMOVE, { id }),\r\n    removed: (id: string) => createAction(ActionTypes.REMOVED, { id }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n\r\nexport type ActionParts = {\r\n    [K in keyof typeof Actions]: ReturnType<typeof Actions[K]>\r\n}","export type ModifyCoords = ((x: number, y: number) => ({ x: number, y: number }));\r\n\r\n/**\r\n * Call this function whenever a keyboard event happens. The keyboard event is then translated\r\n * to a coordinate transformation, which is passed to the update callback. The update callback is\r\n * only called if relevant keys were pressed (example: arrow keys).\r\n * \r\n * @param e keyboard event\r\n * @param update a callback to handle coordinate updates\r\n */\r\nexport const handleKeyEvent = (e: React.KeyboardEvent<SVGElement>, update: (fn: ModifyCoords) => void) => {\r\n    let delta = 1;\r\n    if (e.shiftKey) {\r\n        delta = 10;\r\n    }\r\n    switch (e.key) {\r\n        case \"ArrowUp\":\r\n            update((x: number, y: number) => ({ x, y: y - delta }));\r\n            break;\r\n        case \"ArrowDown\":\r\n            update((x: number, y: number) => ({ x, y: y + delta }));\r\n            break;\r\n        case \"ArrowLeft\":\r\n            update((x: number, y: number) => ({ x: x - delta, y }));\r\n            break;\r\n        case \"ArrowRight\":\r\n            update((x: number, y: number) => ({ x: x + delta, y }));\r\n            break;\r\n        default:\r\n            return;\r\n    }\r\n    e.preventDefault();\r\n}\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport useFramePicker from \"./FramePicker\";\r\nimport ModeSelector from \"./ModeSelector\";\r\nimport { useDiskROI } from \"./roi/DiskROI\";\r\nimport { useRectROI } from \"./roi/RectROI\";\r\nimport { useRoiPicker } from \"./roi/RoiPicker\";\r\n\r\n\r\nexport enum DefaultModes {\r\n    SUM = \"SUM\",\r\n    SD = \"SD\",\r\n    PICK = \"PICK\",\r\n}\r\n\r\nexport enum DefaultRois {\r\n    ALL = \"ALL\",\r\n    DISK = \"DISK\",\r\n    RECT = \"RECT\",\r\n}\r\n\r\nconst useDefaultFrameView = ({\r\n    scanWidth, scanHeight, compoundAnalysisId, doAutoStart,\r\n}: {\r\n    scanWidth: number, scanHeight: number, compoundAnalysisId: string,\r\n    doAutoStart: boolean,\r\n}) => {\r\n    const availableModes = [\r\n        {\r\n            text: \"Average\",\r\n            value: DefaultModes.SUM,\r\n        },\r\n        {\r\n            text: \"Standard Deviation\",\r\n            value: DefaultModes.SD,\r\n        },\r\n        {\r\n            text: \"Pick\",\r\n            value: DefaultModes.PICK,\r\n        },\r\n    ]\r\n\r\n    const availableRois = [\r\n        {\r\n            text: \"All\",\r\n            value: DefaultRois.ALL,\r\n        },\r\n        {\r\n            text: \"Disk\",\r\n            value: DefaultRois.DISK,\r\n        },\r\n        {\r\n            text: \"Rect\",\r\n            value: DefaultRois.RECT,\r\n        },\r\n    ]\r\n\r\n    const [frameMode, setMode] = useState(DefaultModes.SUM);\r\n    const [roi, setRoi] = useState(DefaultRois.ALL);\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const updateFrameMode = (newMode: DefaultModes) => {\r\n        dispatch(compoundAnalysisActions.Actions.enableAutoStart(compoundAnalysisId));\r\n        setMode(newMode);\r\n    }\r\n\r\n    const updateRoi = (newRoi: DefaultRois) => {\r\n        dispatch(compoundAnalysisActions.Actions.enableAutoStart(compoundAnalysisId));\r\n        setRoi(newRoi);\r\n    }\r\n\r\n    const frameModeSelector = <ModeSelector modes={availableModes} currentMode={frameMode} onModeChange={updateFrameMode} label=\"Mode\" />\r\n\r\n    let roiSelector = <ModeSelector modes={availableRois} currentMode={roi} onModeChange={updateRoi} label=\"ROI\" />\r\n\r\n    if (frameMode === DefaultModes.PICK) {\r\n        roiSelector = <></>;\r\n    }\r\n\r\n    const [cx, setCx] = React.useState(Math.round(scanWidth / 2));\r\n    const [cy, setCy] = React.useState(Math.round(scanHeight / 2));\r\n\r\n    const { coords: pickCoords, handles: pickHandles } = useFramePicker({\r\n        enabled: frameMode === DefaultModes.PICK,\r\n        scanWidth, scanHeight,\r\n        analysisIndex: 0,\r\n        compoundAnalysisId,\r\n        cx, cy, setCx, setCy\r\n    });\r\n\r\n    const { rectRoiHandles, rectRoiWidgets, rectRoiParameters } = useRectROI({ scanHeight, scanWidth })\r\n    const { diskRoiHandles, diskRoiWidgets, diskRoiParameters } = useDiskROI({ scanHeight, scanWidth })\r\n\r\n    const nullHandles: HandleRenderFunction = (onDragStart, onDrop) => null\r\n    let handles = nullHandles;\r\n\r\n    let widgets;\r\n    let params = { roi: {} };\r\n    switch (roi) {\r\n        case DefaultRois.DISK:\r\n            handles = diskRoiHandles;\r\n            widgets = diskRoiWidgets;\r\n            params = diskRoiParameters;\r\n            break;\r\n        case DefaultRois.RECT:\r\n            handles = rectRoiHandles;\r\n            widgets = rectRoiWidgets;\r\n            params = rectRoiParameters;\r\n            break;\r\n    }\r\n\r\n    switch (frameMode) {\r\n        case DefaultModes.PICK:\r\n            handles = pickHandles;\r\n            widgets = undefined;\r\n            break;\r\n    }\r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === DefaultModes.SD && doAutoStart,\r\n        scanWidth, scanHeight,\r\n        analysisIndex: 0,\r\n        compoundAnalysisId,\r\n        roiParameters: params,\r\n        analysisType: AnalysisTypes.SD_FRAMES\r\n    })\r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === DefaultModes.SUM && doAutoStart,\r\n        scanWidth, scanHeight,\r\n        analysisIndex: 0,\r\n        compoundAnalysisId,\r\n        roiParameters: params,\r\n        analysisType: AnalysisTypes.SUM_FRAMES,\r\n    })\r\n\r\n    const frameViewTitle = (\r\n        frameMode !== DefaultModes.PICK ? null : <>Pick: x={pickCoords.cx}, y={pickCoords.cy} &emsp;</>\r\n    )\r\n\r\n    return {\r\n        frameViewTitle,\r\n        frameModeSelector: (<>{frameModeSelector} {roiSelector}</>),\r\n        roiSelector,\r\n        handles,\r\n        widgets,\r\n    }\r\n}\r\n\r\nexport default useDefaultFrameView;","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisParameters, AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\n\r\nconst useFramePicker = ({\r\n    enabled, scanWidth, scanHeight, analysisIndex, compoundAnalysisId, cx, cy, setCx, setCy\r\n}: {\r\n    enabled: boolean, scanWidth: number, scanHeight: number,\r\n    analysisIndex: number, compoundAnalysisId: string,\r\n    cx: number, cy: number, setCx: (newCx: number) => void, setCy: (newCy: number) => void,\r\n}) => {\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            const params: AnalysisParameters = {\r\n                x: cx,\r\n                y: cy,\r\n            };\r\n\r\n            dispatch(compoundAnalysisActions.Actions.run(compoundAnalysisId, analysisIndex, {\r\n                analysisType: AnalysisTypes.PICK_FRAME,\r\n                parameters: params,\r\n            }))\r\n        }\r\n    }, [compoundAnalysisId, cx, cy, enabled, analysisIndex, dispatch]);\r\n\r\n    const onPickChange = (pickX: number, pickY: number) => {\r\n        const newX = Math.round(pickX);\r\n        const newY = Math.round(pickY);\r\n        if (cx === newX && cy === newY) {\r\n            return;\r\n        }\r\n        setCx(newX);\r\n        setCy(newY);\r\n    }\r\n\r\n    const renderPickHandle: HandleRenderFunction = (onDragStart, onDrop) => (\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            imageWidth={scanWidth}\r\n            onDragMove={onPickChange}\r\n            parentOnDragStart={onDragStart}\r\n            parentOnDrop={onDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n    )\r\n\r\n    return { coords: { cx, cy }, handles: renderPickHandle };\r\n}\r\n\r\nexport default useFramePicker;","import * as React from \"react\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\n\r\n\r\ntype ModeOptions = Array<{\r\n    text: string;\r\n    value: any;\r\n}>;\r\n\r\ninterface ModeSelectorProps {\r\n    modes: ModeOptions,\r\n    currentMode: any,\r\n    onModeChange: (mode: any) => void,\r\n    label: string,\r\n}\r\n\r\nconst ModeSelector: React.FunctionComponent<ModeSelectorProps> = ({\r\n    modes, currentMode, onModeChange, label\r\n}) => {\r\n\r\n    const onChange = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        onModeChange(data.value)\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div>\r\n                {label}:{' '}\r\n                <Dropdown\r\n                    inline={true}\r\n                    options={modes}\r\n                    value={currentMode}\r\n                    onChange={onChange}\r\n                />\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default ModeSelector;","import * as React from \"react\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface RectProps {\r\n    imageWidth: number,\r\n    imageHeight: number,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n}\r\n\r\nconst Rect: React.SFC<RectProps> = ({ imageWidth, imageHeight, x, y, width, height }) => {\r\n    let ymin: number;\r\n    let xmin: number;\r\n    if (height*width > 0) {\r\n    ymin = Math.min(y, y+height);\r\n    xmin = Math.min(x, x+width);}\r\n    else if (height > 0 && width < 0) \r\n    {ymin = y;\r\n    xmin = x+width;}\r\n    else \r\n    {ymin = y+height;\r\n    xmin = x;}\r\n    return (\r\n        <rect x={xmin + .5} y={ymin + .5} width={Math.abs(width)} height={Math.abs(height)} style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Rect;\r\n\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\n\r\nimport { FrameParams } from \"../../../messages\";\r\nimport DraggableHandle from \"../../../widgets/DraggableHandle\";\r\nimport Rect from \"../../../widgets/Rect\";\r\nimport { HandleRenderFunction } from \"../../../widgets/types\";\r\n\r\n\r\nconst useRectROI = ({ scanWidth, scanHeight }: {\r\n    scanWidth: number;\r\n    scanHeight: number;\r\n}) => {\r\n    const minLength = Math.min(scanWidth, scanHeight);\r\n    const [x, setx] = useState(scanWidth / 2);\r\n    const [y, sety] = useState(scanHeight / 2);\r\n    const [width, setwidth] = useState(minLength / 8);\r\n    const [height, setheight] = useState(minLength / 8);\r\n\r\n\r\n    const rectRoiParameters: FrameParams = {\r\n        roi: {\r\n            shape: \"rect\",\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n        },\r\n    }\r\n\r\n\r\n    const handleCornerChange = (newx: number, newy: number) => {\r\n        setx(newx);\r\n        sety(newy);\r\n    };\r\n\r\n    const handleShapeChange = (newx: number, newy: number) => {\r\n        setwidth(newx - x);\r\n        setheight(newy - y);\r\n    };\r\n\r\n    const smthHandle = {\r\n        x: x + width,\r\n        y: y + height,\r\n    }\r\n\r\n    const rectRoiHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={x} y={y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleCornerChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop} />\r\n        <DraggableHandle x={smthHandle.x} y={smthHandle.y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleShapeChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop} />\r\n    </>);\r\n\r\n    const rectRoiWidgets = (\r\n        <Rect x={x} y={y} width={width} height={height}\r\n            imageWidth={scanWidth} imageHeight={scanHeight}\r\n        />\r\n    );\r\n\r\n    return {\r\n        rectRoiParameters,\r\n        rectRoiHandles,\r\n        rectRoiWidgets,\r\n    };\r\n};\r\n\r\nexport { useRectROI };\r\n\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes, FrameParams } from \"../../../messages\";\r\nimport * as analysisActions from \"../../actions\";\r\n\r\n\r\nconst useRoiPicker = ({ compoundAnalysisId, enabled, analysisIndex, roiParameters, analysisType }: {\r\n    scanWidth: number;\r\n    scanHeight: number;\r\n    enabled: boolean;\r\n    analysisIndex: number,\r\n    compoundAnalysisId: string;\r\n    roiParameters: FrameParams;\r\n    analysisType: AnalysisTypes.SD_FRAMES | AnalysisTypes.SUM_FRAMES\r\n}) => {\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        const handle = setTimeout(() => {\r\n            if (enabled) {\r\n                const analysisDetails = {\r\n                    analysisType,\r\n                    parameters: roiParameters,\r\n                };\r\n                dispatch(analysisActions.Actions.run(compoundAnalysisId, analysisIndex, analysisDetails))\r\n            }\r\n        }, 100);\r\n\r\n        return () => clearTimeout(handle);\r\n        // rules-of-hooks can't be statically validated here\r\n        // eslint-disable-next-line\r\n    }, [analysisType, compoundAnalysisId, enabled, analysisIndex, JSON.stringify(roiParameters), dispatch]);\r\n\r\n    return {\r\n    };\r\n};\r\n\r\nexport { useRoiPicker };\r\n\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\n\r\nimport { FrameParams } from \"../../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../../widgets/constraints\";\r\nimport Disk from \"../../../widgets/Disk\";\r\nimport DraggableHandle from \"../../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../../widgets/types\";\r\n\r\nconst useDiskROI = ({ scanWidth, scanHeight }: {\r\n    scanWidth: number;\r\n    scanHeight: number;\r\n}) => {\r\n    const minLength = Math.min(scanWidth, scanHeight);\r\n    const [cx, setCx] = useState(scanWidth / 2);\r\n    const [cy, setCy] = useState(scanHeight / 2);\r\n    const [r, setR] = useState(minLength / 8);\r\n\r\n\r\n    const diskRoiParameters: FrameParams = {\r\n        roi: {\r\n            shape: \"disk\",\r\n            cx,\r\n            cy,\r\n            r,\r\n        },\r\n    }\r\n\r\n\r\n    const handleCenterChange = (newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    };\r\n\r\n    const handleRChange = (newR: number) => {\r\n        setR(newR);\r\n    };\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const diskRoiHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={scanWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={scanWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const diskRoiWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={scanWidth} imageHeight={scanHeight}\r\n        />\r\n    );\r\n\r\n    return {\r\n        diskRoiParameters,\r\n        diskRoiHandles,\r\n        diskRoiWidgets,\r\n    };\r\n};\r\n\r\nexport { useDiskROI };\r\n\r\n","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutTwoColProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    right: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutTwoColProps;\r\n\r\nconst AnalysisLayoutTwoCol: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, right,\r\n    toolbar,\r\n}) => {\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={2}>\r\n                    <Grid.Row>\r\n                        <Grid.Column>\r\n                            {left}\r\n                            <p>{subtitle}</p>\r\n                        </Grid.Column>\r\n                        <Grid.Column>\r\n                            {right}\r\n                        </Grid.Column>\r\n                    </Grid.Row>\r\n                </Grid>\r\n            </Segment>\r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutTwoCol","export function getApiBasePath() {\r\n    const loc = window.location.pathname;\r\n\r\n    if(loc.endsWith('/')) {\r\n        return `${loc}api/`;\r\n    } else {\r\n        return `${loc}/api/`;\r\n    }\r\n}\r\n\r\nexport function getApiWSURL() {\r\n    const basePath = getApiBasePath();\r\n    return `ws://${window.location.hostname}:${window.location.port}${basePath}events/`;\r\n}\r\n\r\nexport async function genericDelete(path: string) {\r\n    const basePath = getApiBasePath();\r\n    const r = await fetch(`${basePath}${path}`, {\r\n        credentials: \"same-origin\",\r\n        method: \"DELETE\",\r\n    });\r\n    return await r.json();\r\n}\r\n\r\nexport async function genericPut(path: string, payload: object) {\r\n    const basePath = getApiBasePath();\r\n    const r = await fetch(`${basePath}${path}`, {\r\n        body: JSON.stringify(payload),\r\n        credentials: \"same-origin\",\r\n        method: \"PUT\",\r\n    });\r\n    return await r.json();\r\n}","import { AnalysisTypes } from \"../messages\";\r\nimport { CompoundAnalysisMetadata, CompoundAnalysisMetadataItem } from \"./types\";\r\n// keyof typeof: https://stackoverflow.com/a/42623905/540644\r\nexport const getMetadata = (typeName: keyof typeof AnalysisTypes): CompoundAnalysisMetadataItem => {\r\n    const type: AnalysisTypes = AnalysisTypes[typeName];\r\n    return CompoundAnalysisMetadata[type];\r\n};\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { Button, Dropdown, DropdownProps, Header, Icon, Modal, Popup } from \"semantic-ui-react\";\r\nimport { AnalysisState } from \"../../analysis/types\";\r\nimport { getApiBasePath } from \"../../helpers/apiHelpers\";\r\nimport { JobStatus } from \"../../job/types\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { getMetadata } from \"../getMetadata\";\r\nimport { CompoundAnalysisState } from \"../types\";\r\n\r\ninterface DownloadItemsProps {\r\n    compoundAnalysis: CompoundAnalysisState,\r\n    currentFormat?: string,\r\n}\r\n\r\nconst DownloadItems: React.SFC<DownloadItemsProps> = ({\r\n    compoundAnalysis, currentFormat\r\n}) => {\r\n\r\n    const basePath = getApiBasePath();\r\n    const downloadUrl = (analysisId: string) => (\r\n        `${basePath}compoundAnalyses/${compoundAnalysis.compoundAnalysis}/analyses/${analysisId}/download/${currentFormat}/`\r\n    )\r\n\r\n    const analysesById = useSelector((state: RootReducer) => {\r\n        return state.analyses.byId;\r\n    });\r\n\r\n    const jobsById = useSelector((state: RootReducer) => {\r\n        return state.jobs.byId;\r\n    });\r\n\r\n    const analyses = compoundAnalysis.details.analyses.map(analysis => {\r\n        return analysesById[analysis];\r\n    }).filter(analysis => {\r\n        return analysis.jobs.some(jobId => jobsById[jobId].status === JobStatus.SUCCESS);\r\n    })\r\n\r\n    const getAnalysisDescription = (analysis: AnalysisState) => {\r\n        return getMetadata(analysis.details.analysisType).desc;\r\n    }\r\n\r\n    const getDownloadChannels = (analysis: AnalysisState) => {\r\n        if(!analysis.displayedJob) {\r\n            return [];\r\n        }\r\n        return jobsById[analysis.displayedJob].results.filter(\r\n            result => result.description.includeInDownload\r\n        ).map(\r\n            result => result.description.title\r\n        )\r\n    }\r\n\r\n    return (\r\n        <ul>\r\n            {analyses.map((analysis) => {\r\n                return (\r\n                    <li key={analysis.id}>\r\n                        <a href={downloadUrl(analysis.id)}>\r\n                            {getAnalysisDescription(analysis)} (channels: {getDownloadChannels(analysis).join(\", \")})\r\n                        </a>\r\n                    </li>\r\n                );\r\n            })}\r\n        </ul>\r\n    )\r\n}\r\n\r\ninterface DownloadProps {\r\n    compoundAnalysis: CompoundAnalysisState,\r\n}\r\n\r\ntype FormatOptions = Array<{\r\n    text: string;\r\n    value: any;\r\n}>;\r\n\r\nconst Download: React.SFC<DownloadProps> = ({ compoundAnalysis }) => {\r\n    const formats = useSelector((state: RootReducer) => state.config.resultFileFormats);\r\n    const formatOptions: FormatOptions = Object.keys(formats).map(identifier => {\r\n        return {\r\n            value: identifier,\r\n            text: formats[identifier].description,\r\n        }\r\n    });\r\n\r\n    const [currentFormat, setFormat] = useState(formatOptions[0]?.value);\r\n\r\n    // we may be called before the config is completely loaded, so we\r\n    // need to set the format after the list of formats is available\r\n    React.useEffect(() => {\r\n        if(formatOptions.length !== 0 && !currentFormat) {\r\n            setFormat(formatOptions[0].value);\r\n        }\r\n    }, [formatOptions, currentFormat])\r\n\r\n    const onFormatChange = (e: React.SyntheticEvent, data: DropdownProps) => {\r\n        setFormat(data.value);\r\n    }\r\n\r\n    return (\r\n        <Modal trigger={\r\n            <Button icon={true}>\r\n                <Icon name='download' />\r\n                Download\r\n            </Button>\r\n        }>\r\n            <Popup.Header>\r\n                Download Results, format: <Dropdown inline={true} options={formatOptions} onChange={onFormatChange} value={currentFormat} />\r\n            </Popup.Header>\r\n            <Popup.Content>\r\n                <Header as=\"h3\">Available results:</Header>\r\n                <DownloadItems compoundAnalysis={compoundAnalysis} currentFormat={currentFormat} />\r\n            </Popup.Content>\r\n        </Modal>\r\n    );\r\n}\r\n\r\nexport default Download;","import * as React from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Button, Icon, IconProps, Segment } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { getAnalysisStatus } from \"../helpers\";\r\nimport { CompoundAnalysisState } from \"../types\";\r\nimport Download from \"./Download\";\r\n\r\ninterface ToolbarProps {\r\n    compoundAnalysis: CompoundAnalysisState,\r\n    busyIdxs: number[],\r\n    onApply: () => void,\r\n}\r\n\r\n\r\ntype MergedProps = ToolbarProps;\r\n\r\nconst Toolbar: React.SFC<MergedProps> = ({ busyIdxs, onApply, compoundAnalysis }) => {\r\n    const dispatch = useDispatch();\r\n    const handleRemove = () => dispatch(analysisActions.Actions.remove(compoundAnalysis.compoundAnalysis));\r\n    const analyses = useSelector((state: RootReducer) => state.analyses);\r\n    const jobs = useSelector((state: RootReducer) => state.jobs);\r\n    const status = getAnalysisStatus(\r\n        compoundAnalysis, analyses, jobs,\r\n        busyIdxs\r\n    );\r\n    const running = status === \"busy\";\r\n    const applyIconProps: IconProps = running ? { name: 'cog', loading: true } : { name: 'check' }\r\n\r\n    return (\r\n        <Segment attached=\"bottom\">\r\n            <Button.Group>\r\n                <Button primary={true} onClick={onApply} icon={true}>\r\n                    <Icon {...applyIconProps} />\r\n                    Apply\r\n                </Button>\r\n                <Download compoundAnalysis={compoundAnalysis} />\r\n                <Button onClick={handleRemove} icon={true}>\r\n                    <Icon name='remove' />\r\n                    Remove\r\n                </Button>\r\n            </Button.Group>\r\n        </Segment>\r\n    );\r\n}\r\n\r\nexport default Toolbar;","import { AnalysisReducerState } from \"../analysis/reducers\";\r\nimport { JobReducerState } from \"../job/reducers\";\r\nimport { JobRunning } from \"../job/types\";\r\nimport { CompoundAnalysisState } from \"./types\";\r\n\r\nexport const getAnalysisStatus = (compoundAnalysis: CompoundAnalysisState, analyses: AnalysisReducerState, jobs: JobReducerState, analysisIdxsToInclude: number[] = []): \"idle\" | \"busy\" => {\r\n    let filteredAnalyses = compoundAnalysis.details.analyses;\r\n\r\n    if (analysisIdxsToInclude.length > 0) {\r\n        filteredAnalyses = filteredAnalyses.filter((analysisId: string, idx: number) => {\r\n            return analysisIdxsToInclude.indexOf(idx) !== -1;\r\n        })\r\n    }\r\n\r\n    return filteredAnalyses.reduce((prevValue: \"idle\" | \"busy\", analysisId: string) => {\r\n        const analysis = analyses.byId[analysisId];\r\n        if(!analysis) {\r\n            return prevValue; // no analysis, so \"all jobs\" are done\r\n        }\r\n        const allDone = analysis.jobs.every(\r\n            jobId => jobs.byId[jobId].running === JobRunning.DONE\r\n        );\r\n        return allDone ? prevValue : \"busy\";\r\n    }, \"idle\");\r\n}","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport { DraggableHandle } from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst CenterOfMassAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [r, setR] = useState(minLength / 4);\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRChange = defaultDebounce(setR);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={imageWidth} imageHeight={imageHeight} />\r\n    )\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles, widgets: resultWidgets\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = <>{frameViewTitle} Disk: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), r={r.toFixed(2)}</>;\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.CENTER_OF_MASS,\r\n            parameters: {\r\n                shape: \"com\",\r\n                cx,\r\n                cy,\r\n                r\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"COM analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default CenterOfMassAnalysis;","// from https://stackoverflow.com/a/45100420/540644\r\nexport function getPathArc(center: { x: number, y: number }, start: number, end: number, radius: number) {\r\n    if (end === start) { end += 360; }\r\n    let degree = end - start;\r\n    degree = degree < 0 ? (degree + 360) : degree;\r\n    const points = [];\r\n    points.push(getLocationFromAngle(start, radius, center));\r\n    points.push(getLocationFromAngle(start + degree / 3, radius, center));\r\n    points.push(getLocationFromAngle(start + degree * 2 / 3, radius, center));\r\n    points.push(getLocationFromAngle(end, radius, center));\r\n    return getCirclePath(points, radius, (degree < 180) ? 0 : 1);\r\n}\r\n\r\nfunction getCirclePath(points: Array<{ x: number, y: number }>, radius: number, clockWise: 0 | 1) {\r\n    return ['M', points[0].x, points[0].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[1].x, points[1].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[2].x, points[2].y,\r\n        'A', radius, radius, 0, 0, clockWise, points[3].x, points[3].y\r\n    ].join(' ');\r\n}\r\n\r\nfunction getLocationFromAngle(degree: number, radius: number, center: { x: number, y: number }) {\r\n    const radian = (degree * Math.PI) / 180;\r\n    return {\r\n        x: Math.cos(radian) * radius + center.x,\r\n        y: Math.sin(radian) * radius + center.y\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport { getPathArc } from \"../helpers/svg\";\r\nimport { defaultMaskStyles } from \"./styles\";\r\n\r\nexport interface RingProps {\r\n    imageWidth: number,\r\n    cx: number,\r\n    cy: number,\r\n    ri: number,\r\n    ro: number,\r\n}\r\n\r\nconst Ring: React.SFC<RingProps> = ({ imageWidth, cx, cy, ri, ro }) => {\r\n    // see also: https://stackoverflow.com/a/37883328/540644\r\n    const pathSpecs = [\r\n        getPathArc({ x: cx + .5, y: cy + .5 }, 90, 90, ro),\r\n        getPathArc({ x: cx + .5, y: cy + .5 }, 90, 90, ri)\r\n    ]\r\n    const pathSpec = pathSpecs.join(' ');\r\n\r\n    return (\r\n        <path d={pathSpec} fillRule=\"evenodd\" style={{ ...defaultMaskStyles(imageWidth) }} />\r\n    );\r\n}\r\n\r\nexport default Ring;","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutTwoResProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    mid: React.ReactNode,\r\n    right: React.ReactNode,\r\n    clustparams: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n    title1: string, \r\n    title2: React.ReactNode,\r\n    title3:string,\r\n\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutTwoResProps;\r\n\r\nconst AnalysisLayoutTwoRes: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, mid, right,\r\n    toolbar, clustparams, title1, title2, title3\r\n}) => {\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={3}>\r\n                    <Grid.Row>\r\n                        <Grid.Column width={4}>\r\n                            <p>{title1}</p>\r\n                        </Grid.Column> \r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title2}</p>   \r\n\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title3}</p>\r\n                        </Grid.Column>    \r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={4}>\r\n                            {left}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {mid}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {right}\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={16}>\r\n\r\n                            <div>{clustparams}</div>\r\n                            <p>{subtitle}</p>\r\n\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n                </Grid>\r\n                \r\n            </Segment>\r\n            \r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutTwoRes","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { Accordion, Form, Icon } from \"semantic-ui-react\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoRes from \"./layouts/AnalysisLayoutTwoRes\";\r\nimport { useRectROI } from \"./roi/RectROI\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\nconst ClustAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const [minDist, setMinDist] = React.useState(1);\r\n\r\n    const minDistChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setMinDist(event.target.valueAsNumber);\r\n    }\r\n\r\n    const [nPeaks, setNPeaks] = React.useState(500);\r\n\r\n    const peakChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setNPeaks(event.target.valueAsNumber);\r\n    }\r\n\r\n    const [nClust, setNClust] = React.useState(20);\r\n\r\n    const clustChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        setNClust(event.target.valueAsNumber);\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n    const { rectRoiParameters, rectRoiHandles, rectRoiWidgets } = useRectROI({ scanWidth, scanHeight });\r\n\r\n    React.useEffect(() => {\r\n        if (compoundAnalysis.doAutoStart) {\r\n            dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n                analysisType: AnalysisTypes.SUM_SIG,\r\n                parameters: {},\r\n            }))\r\n        }\r\n    }, [compoundAnalysis.compoundAnalysis, dispatch, compoundAnalysis.doAutoStart]);\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 2, {\r\n            analysisType: AnalysisTypes.CLUST,\r\n            parameters: {\r\n                roi: rectRoiParameters.roi,\r\n                cx,\r\n                cy,\r\n                ri,\r\n                ro,\r\n                n_clust: nClust,\r\n                n_peaks: nPeaks,\r\n                min_dist: minDist\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[2]} />\r\n\r\n    const [paramsVisible, setParamsVisible] = React.useState(false);\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        setParamsVisible(!paramsVisible);\r\n    }\r\n\r\n    const clustparams =\r\n        <Accordion>\r\n            <Accordion.Title active={paramsVisible} index={0} onClick={handleClick}>\r\n                <Icon name='dropdown' />\r\n                Parameters\r\n            </Accordion.Title>\r\n            <Accordion.Content active={paramsVisible}>\r\n                <Form>\r\n                    <Form.Field>\r\n                        <label> Number of clusters  <input type=\"number\" value={nClust} step=\"1\" min=\"2\" max=\"100\" onChange={clustChange} /> </label>\r\n                    </Form.Field>\r\n                    <Form.Field>\r\n                        <label>  Maximal number of possible peak positions to detect (better put higher value,\r\n        the output is limited to the number of peaks the algorithm could find)  <input type=\"number\" value={nPeaks} step=\"1\" min=\"5\" max=\"200\" onChange={peakChange} /> </label>\r\n                    </Form.Field>\r\n                    <Form.Field>\r\n                        <label>  Minimal distance in pixels between peaks  <input type=\"number\" value={minDist} step=\"1\" min=\"0\" max=\"100\" onChange={minDistChange} />  </label>\r\n                    </Form.Field>\r\n                </Form>\r\n            </Accordion.Content>\r\n        </Accordion>\r\n    return (\r\n        <AnalysisLayoutTwoRes\r\n            title=\"Region clustering\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            mid={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={rectRoiHandles}\r\n                    extraWidgets={rectRoiWidgets}\r\n                />\r\n            </>}\r\n\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={2} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n            clustparams={clustparams}\r\n\r\n            title1=\"Peaks inside the ring will be considered\"\r\n            title2=\"Choose specimen region\"\r\n            title3=\"Clustering result\"\r\n\r\n        />\r\n    );\r\n}\r\n\r\nexport default ClustAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst DiskMaskAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [r, setR] = useState(minLength / 4);\r\n\r\n    const handleCenterChange = (newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    };\r\n    const handleRChange = setR;\r\n\r\n    const rHandle = {\r\n        x: cx - r,\r\n        y: cy,\r\n    }\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Disk cx={cx} cy={cy} r={r}\r\n            imageWidth={imageWidth} imageHeight={imageHeight}\r\n        />\r\n    );\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.APPLY_DISK_MASK,\r\n            parameters: {\r\n                shape: \"disk\",\r\n                cx, cy, r\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles, widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    });\r\n\r\n    const subtitle = <>{frameViewTitle} Disk: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), r={r.toFixed(2)}</>;\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Disk analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default DiskMaskAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst FEMAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.FEM,\r\n            parameters: {\r\n                shape: \"ring\",\r\n                cx, cy, ri, ro,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Fluctuation EM (SD over Ring analysis)\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default FEMAnalysis;","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\n\r\nconst useFFTFramePicker = ({\r\n    enabled, scanWidth, scanHeight, analysisIndex, compoundAnalysisId,\r\n    cx, cy, real_rad, real_centerx, real_centery, setCx, setCy\r\n}: {\r\n    enabled: boolean, scanWidth: number, scanHeight: number,\r\n    analysisIndex: number, compoundAnalysisId: string,\r\n    cx: number, cy: number, setCx: (newCx: number) => void, setCy: (newCy: number) => void,\r\n    real_rad: number | null, real_centerx: number | null, real_centery: number | null\r\n}) => {\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            dispatch(compoundAnalysisActions.Actions.run(compoundAnalysisId, analysisIndex, {\r\n                analysisType: AnalysisTypes.PICK_FFT_FRAME,\r\n                parameters: { x: cx, y: cy, real_rad, real_centerx, real_centery },\r\n            }));\r\n        }\r\n    }, [compoundAnalysisId, cx, cy, enabled, analysisIndex, real_rad, real_centerx, real_centery, dispatch]);\r\n\r\n    const onPickChange = (pickX: number, pickY: number) => {\r\n        const newX = Math.round(pickX);\r\n        const newY = Math.round(pickY);\r\n        if (cx === newX && cy === newY) {\r\n            return;\r\n        }\r\n        setCx(newX);\r\n        setCy(newY);\r\n    }\r\n\r\n    const renderPickHandle: HandleRenderFunction = (onDragStart, onDrop) => (\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            imageWidth={scanWidth}\r\n            onDragMove={onPickChange}\r\n            parentOnDragStart={onDragStart}\r\n            parentOnDrop={onDrop}\r\n            constraint={inRectConstraint(scanWidth, scanHeight)} />\r\n    )\r\n\r\n    return { coords: { cx, cy }, handles: renderPickHandle };\r\n}\r\n\r\nexport default useFFTFramePicker;","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport * as analysisActions from \"../actions\";\r\n\r\nconst useFFTSumFrames = ({\r\n    enabled, analysisIndex: jobIndex, compoundAnalysisId: analysisId, real_rad, real_centerx, real_centery\r\n}: {\r\n    enabled: boolean, analysisIndex: number, compoundAnalysisId: string, real_rad: number | null, real_centerx: number | null, real_centery: number | null\r\n}) => {\r\n    const dispatch = useDispatch();\r\n\r\n    React.useEffect(() => {\r\n        if (enabled) {\r\n            dispatch(analysisActions.Actions.run(analysisId, jobIndex, {\r\n                analysisType: AnalysisTypes.FFTSUM_FRAMES,\r\n                parameters: { real_rad, real_centerx, real_centery },\r\n            }));\r\n        }\r\n    }, [analysisId, enabled, jobIndex, real_rad, real_centerx, real_centery, dispatch]);\r\n};\r\n\r\nexport default useFFTSumFrames;\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport useFFTFramePicker from \"./FFTFramePicker\";\r\nimport useFFTSumFrames from \"./FFTSumFrames\";\r\nimport useFramePicker from \"./FramePicker\";\r\nimport ModeSelector from \"./ModeSelector\";\r\nimport { useRoiPicker } from \"./roi/RoiPicker\";\r\n\r\nconst useFFTFrameView = ({\r\n    scanWidth, scanHeight, compoundAnalysisId, real_rad, real_centerx,\r\n    real_centery, doAutoStart,\r\n}: {\r\n    scanWidth: number, scanHeight: number, compoundAnalysisId: string,\r\n    real_rad: number | null, real_centerx: number | null, real_centery: number | null,\r\n    doAutoStart: boolean,\r\n}) => {\r\n    const availableModes = [\r\n        {\r\n            text: \"Pick\",\r\n            value: AnalysisTypes.PICK_FRAME,\r\n        },\r\n        {\r\n            text: \"Average\",\r\n            value: AnalysisTypes.SUM_FRAMES,\r\n        },\r\n    ];\r\n\r\n    const [frameMode, setMode] = useState(AnalysisTypes.SUM_FRAMES);\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const updateMode = (newMode: AnalysisTypes) => {\r\n        dispatch(compoundAnalysisActions.Actions.enableAutoStart(compoundAnalysisId));\r\n        setMode(newMode);\r\n    }\r\n\r\n    const frameModeSelector = <ModeSelector modes={availableModes} currentMode={frameMode} onModeChange={updateMode} label=\"Mode\" />\r\n\r\n    const [cx, setCx] = React.useState(Math.round(scanWidth / 2));\r\n    const [cy, setCy] = React.useState(Math.round(scanHeight / 2));\r\n\r\n    const { coords: pickCoords, handles: pickHandles } = useFramePicker({\r\n        enabled: frameMode === AnalysisTypes.PICK_FRAME && doAutoStart,\r\n        scanWidth, scanHeight,\r\n        analysisIndex: 1,\r\n        compoundAnalysisId,\r\n        cx, cy, setCx, setCy\r\n    });\r\n\r\n    useFFTFramePicker({\r\n        enabled: frameMode === AnalysisTypes.PICK_FRAME && doAutoStart,\r\n        scanWidth, scanHeight,\r\n        analysisIndex: 0,\r\n        compoundAnalysisId,\r\n        cx, cy, setCx, setCy, real_rad, real_centerx, real_centery\r\n    });\r\n\r\n    useRoiPicker({\r\n        enabled: frameMode === AnalysisTypes.SUM_FRAMES && doAutoStart,\r\n        analysisIndex: 1,\r\n        compoundAnalysisId,\r\n        scanWidth, scanHeight,\r\n        roiParameters: { roi: {} },\r\n        analysisType: AnalysisTypes.SUM_FRAMES,\r\n    })\r\n    useFFTSumFrames({\r\n        enabled: frameMode === AnalysisTypes.SUM_FRAMES && doAutoStart,\r\n        analysisIndex: 0,\r\n        compoundAnalysisId,\r\n        real_rad,\r\n        real_centerx,\r\n        real_centery\r\n    })\r\n\r\n    const frameViewTitle = (\r\n        frameMode !== AnalysisTypes.PICK_FRAME ? null : <>Pick: x={pickCoords.cx}, y={pickCoords.cy} &emsp;</>\r\n    )\r\n\r\n    const nullHandles: HandleRenderFunction = (onDragStart, onDrop) => null\r\n\r\n    return {\r\n        frameViewTitle,\r\n        handles: frameMode !== AnalysisTypes.PICK_FRAME ? nullHandles : pickHandles,\r\n\r\n        frameModeSelector,\r\n    }\r\n}\r\n\r\nexport default useFFTFrameView;","import * as React from \"react\";\r\nimport { Grid, Header, Icon, Segment } from \"semantic-ui-react\";\r\n\r\ninterface AnalysisLayoutThreeColProps {\r\n    title: string,\r\n    subtitle: React.ReactNode,\r\n    left: React.ReactNode,\r\n    mid: React.ReactNode,\r\n    right: React.ReactNode,\r\n    toolbar?: React.ReactNode,\r\n    title1: string,\r\n    title2: React.ReactNode,\r\n    title3: string,\r\n}\r\n\r\ntype MergedProps = AnalysisLayoutThreeColProps;\r\n\r\nconst AnalysisLayoutThreeCol: React.SFC<MergedProps> = ({\r\n    title, subtitle,\r\n    left, mid, right,\r\n    toolbar, title1, title2, title3\r\n}) => {\r\n    return (\r\n        <>\r\n            <Header as='h3' attached=\"top\">\r\n                <Icon name=\"cog\" />\r\n                <Header.Content>{title}</Header.Content>\r\n            </Header>\r\n            <Segment attached={true}>\r\n                <Grid columns={3}>\r\n                    <Grid.Row>\r\n                        <Grid.Column width={5}>\r\n                            <p>{title1}</p>\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={5}>\r\n                            <p>{title2}</p>\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            <p>{title3}</p>\r\n                        </Grid.Column>\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={5}>\r\n                            {left}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={5}>\r\n                            {mid}\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6}>\r\n                            {right}\r\n                        </Grid.Column>\r\n\r\n                    </Grid.Row>\r\n\r\n                    <Grid.Row>\r\n                        <Grid.Column width={10}>\r\n                            <p>{subtitle}</p>\r\n                        </Grid.Column>\r\n\r\n                        <Grid.Column width={6} />\r\n                    </Grid.Row>\r\n                </Grid>\r\n            </Segment>\r\n            {toolbar}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AnalysisLayoutThreeCol","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, keepOnCY, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport Disk from \"../../widgets/Disk\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as compoundAnalysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useFFTFrameView from \"./FFTFrameView\";\r\nimport AnalysisLayoutThreeCol from \"./layouts/AnalysisLayoutThreeCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\nconst FFTAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const cx = imageWidth / 2;\r\n    const cy = imageHeight / 2;\r\n    const [radIn, setRi] = useState(minLength / 4);\r\n    const [radOut, setRo] = useState(minLength / 2);\r\n\r\n    const dispatch = useDispatch();\r\n    const riHandle = {\r\n        x: cx - radIn,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - radOut,\r\n        y: cy,\r\n    }\r\n\r\n\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandlesfft: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgetsfft = (\r\n        <Ring cx={cx} cy={cy} ri={radIn} ro={radOut}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const [check, setCheck] = React.useState(true);\r\n\r\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        dispatch(compoundAnalysisActions.Actions.enableAutoStart(compoundAnalysis.compoundAnalysis));\r\n        setCheck(event.target.checked);\r\n    }\r\n\r\n    const [realCenterX, setCx] = useState(imageWidth / 2);\r\n    const [realCenterY, setCy] = useState(imageHeight / 2);\r\n    const [realRad, setR] = useState(minLength / 4);\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        dispatch(compoundAnalysisActions.Actions.enableAutoStart(compoundAnalysis.compoundAnalysis));\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRChange = defaultDebounce(setR);\r\n\r\n    const rHandle = {\r\n        x: realCenterX - realRad,\r\n        y: realCenterY,\r\n    }\r\n\r\n    const frameViewHandlesreal: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={realCenterX} y={realCenterY}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={rHandle.x} y={rHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(realCenterX, realCenterY, handleRChange)}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={keepOnCY(realCenterY)} />\r\n    </>);\r\n\r\n    const frameViewWidgetsreal = (\r\n        <Disk cx={realCenterX} cy={realCenterY} r={realRad}\r\n            imageWidth={imageWidth} imageHeight={imageHeight}\r\n        />\r\n    );\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(compoundAnalysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 2, {\r\n            analysisType: AnalysisTypes.APPLY_FFT_MASK,\r\n            parameters: {\r\n                rad_in: radIn,\r\n                rad_out: radOut,\r\n                real_rad: check ? realRad : null,\r\n                real_centerx: check ? realCenterX : null,\r\n                real_centery: check ? realCenterY : null\r\n            }\r\n        }));\r\n    };\r\n\r\n    const { frameViewTitle, frameModeSelector, handles: resultHandles } = useFFTFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        real_rad: check ? realRad : null,\r\n        real_centerx: check ? realCenterX : null,\r\n        real_centery: check ? realCenterY : null,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    });\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[2]} />\r\n\r\n    let subtitle;\r\n    let mid: React.ReactNode;\r\n    if (check) {\r\n        mid = (<>\r\n            <ResultList\r\n                extraHandles={frameViewHandlesreal} extraWidgets={frameViewWidgetsreal}\r\n                analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                width={imageWidth} height={imageHeight}\r\n                selectors={frameModeSelector}\r\n            />\r\n        </>)\r\n        subtitle = (\r\n            <>{frameViewTitle} real_rad={radIn.toFixed(2)}, real_center=(x={realCenterX.toFixed(2)}, y={realCenterY.toFixed(2)}), fourier_rad_in={radIn.toFixed(2)}, fourier_rad_out={radOut.toFixed(2)}</>\r\n        )\r\n    }\r\n    else {\r\n        mid = (<>\r\n            <ResultList\r\n                analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                width={imageWidth} height={imageHeight}\r\n                selectors={frameModeSelector}\r\n            />\r\n        </>)\r\n        subtitle = (\r\n            <>{frameViewTitle} fourier_rad_in={radIn.toFixed(2)}, fourier_rad_out={radOut.toFixed(2)}</>\r\n        )\r\n    }\r\n\r\n\r\n    return (\r\n        <AnalysisLayoutThreeCol\r\n            title=\"FFT analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandlesfft} extraWidgets={frameViewWidgetsfft}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                />\r\n            </>}\r\n            mid={mid}\r\n\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={2} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n\r\n            title2={<><label> Masking out of zero order diffraction peak <input type=\"checkbox\" name=\"check\" onChange={handleChange} checked={check} /> </label>\r\n            </>}\r\n            title1=\"Masking of integration region in Fourier space\"\r\n            title3=\"Result of analysis\"\r\n\r\n        />\r\n    );\r\n}\r\n\r\n\r\nexport default FFTAnalysis;\r\n","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { inRectConstraint } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\n\r\nconst PointSelectionAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset, }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy} withCross={true}\r\n            onDragMove={handleCenterChange}\r\n            imageWidth={imageWidth}\r\n            parentOnDragStart={handleDragStart}\r\n            parentOnDrop={handleDrop}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n    </>);\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Point: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)})</>\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.APPLY_POINT_SELECTOR,\r\n            parameters: {\r\n                shape: \"point\",\r\n                cx,\r\n                cy,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Point analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default PointSelectionAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst RadialFourierAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n    const [nBins] = useState(1);\r\n    const [maxOrder] = useState(8);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.RADIAL_FOURIER,\r\n            parameters: {\r\n                shape: \"radial_fourier\",\r\n                cx, cy, ri, ro,\r\n                n_bins: nBins,\r\n                max_order: maxOrder,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Radial Fourier analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default RadialFourierAnalysis;","import * as React from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { defaultDebounce } from \"../../helpers\";\r\nimport ResultList from \"../../job/components/ResultList\";\r\nimport { AnalysisTypes } from \"../../messages\";\r\nimport { cbToRadius, inRectConstraint, riConstraint, roConstraints } from \"../../widgets/constraints\";\r\nimport DraggableHandle from \"../../widgets/DraggableHandle\";\r\nimport Ring from \"../../widgets/Ring\";\r\nimport { HandleRenderFunction } from \"../../widgets/types\";\r\nimport * as analysisActions from \"../actions\";\r\nimport { CompoundAnalysisProps } from \"../types\";\r\nimport useDefaultFrameView from \"./DefaultFrameView\";\r\nimport AnalysisLayoutTwoCol from \"./layouts/AnalysisLayoutTwoCol\";\r\nimport Toolbar from \"./Toolbar\";\r\n\r\nconst RingMaskAnalysis: React.SFC<CompoundAnalysisProps> = ({ compoundAnalysis, dataset }) => {\r\n    const { shape } = dataset.params;\r\n    const [scanHeight, scanWidth, imageHeight, imageWidth] = shape;\r\n    const minLength = Math.min(imageWidth, imageHeight);\r\n\r\n    const [cx, setCx] = useState(imageWidth / 2);\r\n    const [cy, setCy] = useState(imageHeight / 2);\r\n    const [ri, setRi] = useState(minLength / 4);\r\n    const [ro, setRo] = useState(minLength / 2);\r\n\r\n    const riHandle = {\r\n        x: cx - ri,\r\n        y: cy,\r\n    }\r\n    const roHandle = {\r\n        x: cx - ro,\r\n        y: cy,\r\n    }\r\n\r\n    const handleCenterChange = defaultDebounce((newCx: number, newCy: number) => {\r\n        setCx(newCx);\r\n        setCy(newCy);\r\n    });\r\n    const handleRIChange = defaultDebounce(setRi);\r\n    const handleROChange = defaultDebounce(setRo);\r\n\r\n    const frameViewHandles: HandleRenderFunction = (handleDragStart, handleDrop) => (<>\r\n        <DraggableHandle x={cx} y={cy}\r\n            imageWidth={imageWidth}\r\n            onDragMove={handleCenterChange}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={inRectConstraint(imageWidth, imageHeight)} />\r\n        <DraggableHandle x={roHandle.x} y={roHandle.y}\r\n            imageWidth={imageWidth}\r\n            onDragMove={cbToRadius(cx, cy, handleROChange)}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            constraint={roConstraints(riHandle.x, cy)} />\r\n        <DraggableHandle x={riHandle.x} y={riHandle.y}\r\n            imageWidth={imageWidth}\r\n            parentOnDrop={handleDrop}\r\n            parentOnDragStart={handleDragStart}\r\n            onDragMove={cbToRadius(cx, cy, handleRIChange)}\r\n            constraint={riConstraint(roHandle.x, cy)} />\r\n    </>);\r\n\r\n    const frameViewWidgets = (\r\n        <Ring cx={cx} cy={cy} ri={ri} ro={ro}\r\n            imageWidth={imageWidth} />\r\n    )\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const runAnalysis = () => {\r\n        dispatch(analysisActions.Actions.run(compoundAnalysis.compoundAnalysis, 1, {\r\n            analysisType: AnalysisTypes.APPLY_RING_MASK,\r\n            parameters: {\r\n                shape: \"ring\",\r\n                cx, cy, ri, ro,\r\n            }\r\n        }));\r\n    };\r\n\r\n    const {\r\n        frameViewTitle, frameModeSelector,\r\n        handles: resultHandles,\r\n        widgets: resultWidgets,\r\n    } = useDefaultFrameView({\r\n        scanWidth,\r\n        scanHeight,\r\n        compoundAnalysisId: compoundAnalysis.compoundAnalysis,\r\n        doAutoStart: compoundAnalysis.doAutoStart,\r\n    })\r\n\r\n    const subtitle = (\r\n        <>{frameViewTitle} Ring: center=(x={cx.toFixed(2)}, y={cy.toFixed(2)}), ri={ri.toFixed(2)}, ro={ro.toFixed(2)}</>\r\n    )\r\n\r\n    const toolbar = <Toolbar compoundAnalysis={compoundAnalysis} onApply={runAnalysis} busyIdxs={[1]} />\r\n\r\n    return (\r\n        <AnalysisLayoutTwoCol\r\n            title=\"Ring analysis\" subtitle={subtitle}\r\n            left={<>\r\n                <ResultList\r\n                    extraHandles={frameViewHandles} extraWidgets={frameViewWidgets}\r\n                    analysisIndex={0} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={imageWidth} height={imageHeight}\r\n                    selectors={frameModeSelector}\r\n                />\r\n            </>}\r\n            right={<>\r\n                <ResultList\r\n                    analysisIndex={1} compoundAnalysis={compoundAnalysis.compoundAnalysis}\r\n                    width={scanWidth} height={scanHeight}\r\n                    extraHandles={resultHandles}\r\n                    extraWidgets={resultWidgets}\r\n                />\r\n            </>}\r\n            toolbar={toolbar}\r\n        />\r\n    );\r\n}\r\n\r\nexport default RingMaskAnalysis;","import { AnalysisTypes, DatasetOpen, PickFrameDetails, SumFramesDetails } from \"../messages\";\r\nimport CenterOfMassAnalysis from \"./components/CenterOfMassAnalysis\";\r\nimport ClustAnalysis from \"./components/Clustering\";\r\nimport DiskMaskAnalysis from \"./components/DiskMaskAnalysis\";\r\nimport FEM from \"./components/FEM\";\r\nimport FFTAnalysis from \"./components/FFTAnalysis\";\r\nimport PointSelectionAnalysis from \"./components/PointSelectionAnalysis\";\r\nimport RadialFourierAnalysis from \"./components/RadialFourierAnalysis\";\r\nimport RingMaskAnalysis from \"./components/RingMaskAnalysis\";\r\n\r\n\r\nexport type CompoundAnalysisStatus = \"busy\" | \"idle\";\r\n\r\nexport type JobHistory = string[][];\r\n\r\nexport type FrameAnalysisDetails = PickFrameDetails | SumFramesDetails;\r\n\r\nexport interface CompoundAnalysis {\r\n    compoundAnalysis: string,\r\n    dataset: string,\r\n    details: {\r\n        mainType: AnalysisTypes,\r\n        analyses: string[],\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * CompoundAnalysisProps is the interface you should implement with your\r\n * CompoundAnalysis, as a functional component. For example:\r\n * \r\n * const MyAnalysis: React.FunctionalComponent<CompoundAnalysisProps> = ({ analysis, dataset }) = { ... }\r\n * \r\n */\r\n\r\nexport type CompoundAnalysisState = CompoundAnalysis & {\r\n    doAutoStart: boolean,\r\n};\r\n\r\nexport interface CompoundAnalysisProps {\r\n    compoundAnalysis: CompoundAnalysisState,\r\n    dataset: DatasetOpen,\r\n}\r\n\r\nexport interface CompoundAnalysisMetadataItem {\r\n    desc: string,\r\n    title: string,\r\n    component?: React.FunctionComponent<CompoundAnalysisProps>,\r\n}\r\n\r\n\r\n/**\r\n * list of all analyses; those having a component will be available for selection in the UI\r\n * \r\n * please fill in a title and description, and reference your component.\r\n */\r\nexport const CompoundAnalysisMetadata: { [s: string]: CompoundAnalysisMetadataItem } = {\r\n    [AnalysisTypes.APPLY_RING_MASK]: {\r\n        desc: \"Application of a ring mask\",\r\n        title: \"Ring\",\r\n        component: RingMaskAnalysis,\r\n    },\r\n    [AnalysisTypes.APPLY_DISK_MASK]: {\r\n        desc: \"Application of a disk mask\",\r\n        title: \"Disk\",\r\n        component: DiskMaskAnalysis,\r\n    },\r\n    [AnalysisTypes.FEM]: {\r\n        desc: \"Application of a ring mask\",\r\n        title: \"FEM (SD over Ring)\",\r\n        component: FEM,\r\n    },\r\n    [AnalysisTypes.CENTER_OF_MASS]: {\r\n        desc: \"The center of mass of all diffraction images\",\r\n        title: \"Center of mass\",\r\n        component: CenterOfMassAnalysis,\r\n    },\r\n    [AnalysisTypes.APPLY_POINT_SELECTOR]: {\r\n        desc: \"Image from a single pixel selected in the detector\",\r\n        title: \"Point selection\",\r\n        component: PointSelectionAnalysis,\r\n    },\r\n    [AnalysisTypes.SUM_FRAMES]: {\r\n        desc: \"A sum of all (or selected) detector frames\",\r\n        title: \"Sum all frames\",\r\n    },\r\n    [AnalysisTypes.SD_FRAMES]: {\r\n        desc: \"A SD of all (or selected) detector frames\",\r\n        title: \"SD all frames\",\r\n    },\r\n    [AnalysisTypes.PICK_FRAME]: {\r\n        desc: \"A single picked frame\",\r\n        title: \"Pick frame\",\r\n    },\r\n    [AnalysisTypes.PICK_FFT_FRAME]: {\r\n        desc: \"Fourier transform of a picked frame\",\r\n        title: \"Pick frame\",\r\n    },\r\n    [AnalysisTypes.APPLY_FFT_MASK]: {\r\n        desc: \"Application of a ring mask in Fourier space\",\r\n        title: \"FFT analysis\",\r\n        component: FFTAnalysis\r\n    },\r\n    [AnalysisTypes.FFTSUM_FRAMES]: {\r\n        desc: \"Fourier transform of sum of all detector frames\",\r\n        title: \"FFT of Sum all frames\",\r\n    },\r\n    [AnalysisTypes.RADIAL_FOURIER]: {\r\n        desc: \"Radial Fourier analysis over the selected ring\",\r\n        title: \"Radial Fourier\",\r\n        component: RadialFourierAnalysis,\r\n    },\r\n    [AnalysisTypes.CLUST]: {\r\n        desc: \"Region clustering based on non-zero order diffraction peaks positions\",\r\n        title: \"Clustering\",\r\n        component: ClustAnalysis,\r\n    },\r\n    [AnalysisTypes.SUM_SIG]: {\r\n        desc: \"Frame integration\",\r\n        title: \"Sum\",\r\n    },\r\n}","import * as React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { DatasetStatus } from \"../../../messages\";\r\nimport { RootReducer } from \"../../../store\";\r\nimport { CompoundAnalysisMetadata, CompoundAnalysisState } from \"../../types\";\r\n\r\ninterface AnalysisDispatcherProps {\r\n    analysis: CompoundAnalysisState,\r\n}\r\n\r\nconst AnalysisDispatcherComponent: React.SFC<AnalysisDispatcherProps> = ({ analysis }) => {\r\n    const dataset = useSelector((state: RootReducer) => state.datasets.byId[analysis.dataset])\r\n\r\n    if (dataset.status !== DatasetStatus.OPEN) {\r\n        return null;\r\n    }\r\n\r\n    const AnalysisComponent = CompoundAnalysisMetadata[analysis.details.mainType].component;\r\n    if (!AnalysisComponent) {\r\n        throw new Error(\"unknown analysis type\");\r\n    }\r\n\r\n    return <AnalysisComponent dataset={dataset} compoundAnalysis={analysis} />;\r\n}\r\n\r\nexport default AnalysisDispatcherComponent;","import * as React from \"react\";\r\nimport { CompoundAnalysisReducerState } from \"../../reducers\";\r\nimport Analysis from \"./Analysis\";\r\n\r\ninterface AnalysisProps {\r\n    analyses: CompoundAnalysisReducerState,\r\n}\r\n\r\nconst AnalysisList: React.SFC<AnalysisProps> = ({ analyses }) => {\r\n    return (<>{\r\n        analyses.ids.map(analysisId => <Analysis key={analysisId} analysis={analyses.byId[analysisId]} />)\r\n    }</>);\r\n}\r\n\r\nexport default AnalysisList;","// tslint:disable-next-line:ban-types\r\ntype ImmutablePrimitive = undefined | null | boolean | string | number | Function;\r\n\r\nexport type Immutable<T> =\r\n    T extends ImmutablePrimitive ? T :\r\n    T extends Array<infer U> ? ImmutableArray<U> :\r\n    T extends Map<infer K, infer V> ? ImmutableMap<K, V> :\r\n    T extends Set<infer M> ? ImmutableSet<M> : ImmutableObject<T>;\r\n\r\nexport type ImmutableArray<T> = ReadonlyArray<Immutable<T>>;\r\nexport type ImmutableMap<K, V> = ReadonlyMap<Immutable<K>, Immutable<V>>;\r\nexport type ImmutableSet<T> = ReadonlySet<Immutable<T>>;\r\nexport type ImmutableObject<T> = { readonly [K in keyof T]: Immutable<T[K]> };\r\n\r\n\r\ntype DeepReadonly<T> =\r\n    T extends Array<infer R> ? DeepReadonlyArray<R> :\r\n    // tslint:disable-next-line:ban-types\r\n    T extends Function ? T :\r\n    T extends object ? DeepReadonlyObject<T> :\r\n    T;\r\n\r\ninterface DeepReadonlyArray<T> extends ReadonlyArray<DeepReadonly<T>> { }\r\n\r\ntype DeepReadonlyObject<T> = {\r\n    readonly [P in keyof T]: DeepReadonly<T[P]>;\r\n};\r\n\r\ninterface IdMap<R> {\r\n    [s: string]: R\r\n}\r\n\r\nexport interface ById<R> {\r\n    ids: string[],\r\n    byId: IdMap<R>,\r\n};\r\n\r\nexport type ByIdReadOnly<R> = DeepReadonly<ById<R>>;\r\n\r\nexport function updateById<R>(state: ById<R>, id: string, partialRecord: Partial<R>): ById<R> {\r\n    const newObj = Object.assign({}, state.byId[id], partialRecord);\r\n    const newById = Object.assign({}, state.byId, { [id]: newObj });\r\n    return Object.assign({}, state, { byId: newById });\r\n}\r\n\r\nexport function insertById<R>(state: ById<R>, id: string, record: R): ById<R> {\r\n    const newById = Object.assign({}, state.byId, { [id]: record });\r\n    const newIds = [...state.ids, id];\r\n    return { byId: newById, ids: newIds };\r\n}\r\n\r\nexport function constructById<R>(items: R[], key: (k: R) => string): IdMap<R> {\r\n    const byId = items.reduce((acc, item) => Object.assign(acc, {\r\n        [key(item)]: item,\r\n    }), {} as IdMap<R>);\r\n    return byId;\r\n}\r\n\r\nexport type Predicate<R> = (item: R) => boolean;\r\n\r\nexport function filterWithPred<R>(state: ById<R>, pred: Predicate<R>): ById<R> {\r\n    const ids: string[] = state.ids.filter(id => pred(state.byId[id]));\r\n    const byId: IdMap<R> = ids.reduce((acc, id) => Object.assign(acc, {\r\n        [id]: state.byId[id],\r\n    }), {});\r\n    return {\r\n        byId,\r\n        ids,\r\n    };\r\n}\r\n\r\nexport function filterWithPredReadOnly<R>(state: ByIdReadOnly<R>, pred: Predicate<DeepReadonly<R>>): ByIdReadOnly<R> {\r\n    const ids: DeepReadonly<string[]> = state.ids.filter(id => pred(state.byId[id]));\r\n    const byId: DeepReadonly<IdMap<R>> = ids.reduce((acc, id) => Object.assign(acc, {\r\n        [id]: state.byId[id],\r\n    }), {});\r\n    return {\r\n        byId,\r\n        ids,\r\n    };\r\n}\r\n\r\nexport function toggleItemInList<T>(list: T[], item: T): T[] {\r\n    if (list.includes(item)) {\r\n        return list.filter(i => i !== item)\r\n    } else {\r\n        return [item, ...list];\r\n    }\r\n}","import * as React from \"react\";\r\nimport { Dropdown, DropdownItemProps } from \"semantic-ui-react\";\r\nimport { getEnumValues } from \"../../../helpers\";\r\nimport { AnalysisTypes } from \"../../../messages\";\r\nimport { getMetadata } from \"../../getMetadata\";\r\n\r\nconst analysisTypeKeys = getEnumValues(AnalysisTypes);\r\nconst analysisTypeOptions = analysisTypeKeys.filter(t => getMetadata(t).component !== undefined).map(t => ({\r\n    text: getMetadata(t).title,\r\n    value: AnalysisTypes[t],\r\n}));\r\n\r\ninterface AnalysisSelectProps {\r\n    onClick: (analysisType: AnalysisTypes) => void,\r\n    label: string,\r\n}\r\n\r\nconst selectData = (fn: (v: AnalysisTypes) => void) => (e: React.MouseEvent, data: DropdownItemProps) => {\r\n    return fn(data.value as AnalysisTypes);\r\n}\r\n\r\nconst AnalysisSelect: React.SFC<AnalysisSelectProps> = ({ onClick, label }) => {\r\n    return (\r\n        <Dropdown text={label} icon='add' floating={true} labeled={true} button={true} className='icon'>\r\n            <Dropdown.Menu>\r\n                <Dropdown.Header content='implemented analyses' />\r\n                {analysisTypeOptions.map(option => <Dropdown.Item key={option.value} onClick={selectData(onClick)} {...option} />)}\r\n            </Dropdown.Menu>\r\n        </Dropdown>\r\n    );\r\n}\r\n\r\nexport default AnalysisSelect;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport * as compoundAnalysisActions from \"../../compoundAnalysis/actions\";\r\nimport AnalysisSelect from \"../../compoundAnalysis/components/base/AnalysisSelect\";\r\nimport { AnalysisTypes, DatasetState } from \"../../messages\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DatasetProps) => {\r\n    return {\r\n        handleAddAnalysis: (type: AnalysisTypes) => {\r\n            dispatch(compoundAnalysisActions.Actions.create(ownProps.dataset.id, type));\r\n        },\r\n    }\r\n}\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst AddAnalysis: React.SFC<MergedProps> = ({ handleAddAnalysis }) => {\r\n    return <AnalysisSelect onClick={handleAddAnalysis} label='Add analysis' />\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(AddAnalysis);","import { genericDelete, genericPut, getApiBasePath } from \"../helpers/apiHelpers\";\r\nimport { DataSetOpenSchemaResponse, DeleteDatasetResponse, DetectDatasetResponse, OpenDatasetRequest, OpenDatasetResponse } from \"../messages\";\r\n\r\nexport async function openDataset(id: string, dataset: OpenDatasetRequest): Promise<OpenDatasetResponse> {\r\n    return await genericPut(`datasets/${id}/`, dataset);\r\n}\r\n\r\nexport async function deleteDataset(id: string): Promise<DeleteDatasetResponse> {\r\n    return await genericDelete(`datasets/${id}/`);\r\n}\r\n\r\n\r\nexport async function detectDataset(path: string): Promise<DetectDatasetResponse> {\r\n    const basePath = getApiBasePath();\r\n    const r = await fetch(`${basePath}datasets/detect/?path=${encodeURIComponent(path)}`, {\r\n        credentials: \"same-origin\",\r\n        method: \"GET\",\r\n    });\r\n    return await r.json();\r\n}\r\n\r\ninterface SchemaCache {\r\n    [type: string]: DataSetOpenSchemaResponse,\r\n}\r\n\r\nconst schemaCache: SchemaCache = {};\r\n\r\nexport async function getSchema(type: string): Promise<DataSetOpenSchemaResponse> {\r\n    const basePath = getApiBasePath();\r\n    const cached = schemaCache[type];\r\n    if (cached) {\r\n        return new Promise((resolve) => resolve(cached));\r\n    } else {\r\n        const r = await fetch(`${basePath}datasets/schema/?type=${encodeURIComponent(type)}`, {\r\n            credentials: \"same-origin\",\r\n            method: \"GET\",\r\n        });\r\n        const schemaResponse = await r.json();\r\n        schemaCache[type] = schemaResponse;\r\n        return schemaResponse;\r\n    }\r\n}","import Ajv, { ErrorObject } from 'ajv';\r\nimport { FormikErrors, FormikValues } from 'formik';\r\nimport { DataSetOpenSchemaResponse } from '../messages';\r\nimport { getSchema } from './api';\r\n\r\nexport function convertErrors(errors: ErrorObject[]): FormikErrors<FormikValues> {\r\n    const res: FormikErrors<FormikValues> = {};\r\n    errors.forEach(err => {\r\n        // flatten field names, convert from array to object\r\n        // FIXME: doesn't support multiple errors per field yet (formik limitation?)\r\n        const expr = /^\\.([^[]+)(\\[[^]+\\])?$/\r\n        const fieldName = err.dataPath.replace(expr, (match, plainName) => {\r\n            return plainName;\r\n        });\r\n        res[fieldName] = err.message;\r\n    });\r\n    return res;\r\n}\r\n\r\nexport async function validateOpen(type: string, data: object) {\r\n    return getSchema(type).then((schemaResponse: DataSetOpenSchemaResponse) => {\r\n        if (schemaResponse.status === \"error\") {\r\n            throw new Error(schemaResponse.msg);\r\n        }\r\n        // FIXME: cache compiled schema\r\n        const schema = schemaResponse.schema;\r\n        const ajv = new Ajv();\r\n        const validate = ajv.compile(schema);\r\n        const valid = validate(data);\r\n        if (!valid) {\r\n            if (validate.errors) {\r\n                const converted = convertErrors(validate.errors);\r\n                throw converted;\r\n            } else {\r\n                throw new Error(\"unspecified error while validating fields\");\r\n            }\r\n        }\r\n    })\r\n}","import { withFormik } from \"formik\";\r\nimport * as pathfind from 'path';\r\nimport { AdditionalInfo, DatasetTypes } from \"../messages\";\r\nimport { OpenFormProps } from \"./types\";\r\nimport { validateOpen } from \"./validate\";\r\n\r\nexport function parseNumList(nums: string) {\r\n    return nums.split(\",\").filter(part => part.trim() !== \"\").map(part => +part);\r\n}\r\n\r\nexport function parseNumListWithPadding(nums: string, minLength: number) {\r\n    let initialList = new Array(minLength).fill(\"\");\r\n    if(nums) {\r\n      const value = nums.split(\",\");\r\n      if((minLength - value.length)>0) {\r\n        initialList = [...value, ...Array(minLength - value.length).fill(\"\")];\r\n      } else {\r\n          initialList = [...value];\r\n      }\r\n    }\r\n    return initialList;\r\n}\r\n\r\nexport function getInitial<T extends object, K extends keyof T, V>(key: K, otherwise: V, values?: T): V | T[K] {\r\n    if (!values) {\r\n        return otherwise;\r\n    }\r\n    const res = values[key] !== undefined ? values[key] : otherwise;\r\n    return res;\r\n}\r\n\r\nexport function getInitialName<T extends object, K extends keyof T>(key: K, otherwise: string, values?: T): string | T[K] {\r\n    if (!values) {\r\n        return pathfind.basename(otherwise);\r\n    }\r\n    const res = values[key] !== undefined ? values[key] : pathfind.basename(otherwise);\r\n    return res;\r\n}\r\n\r\nexport function isKnownDatasetType(detectedType: string) {\r\n  return (Object.keys(DatasetTypes).some((v) => v === detectedType) ? true : false);\r\n}\r\n\r\nexport function isAdditionalInfo(param: string) {\r\n  return (Object.keys(AdditionalInfo).some((v) => v === param) ? true : false);\r\n}\r\n\r\nexport function hasKey<O>(obj: O, key: keyof any): key is keyof O {\r\n  return key in obj\r\n}\r\n\r\ntype FormToJsonFn<SubmitParams, FormParams> = (inParams: FormParams, path: string) => SubmitParams;\r\ntype PropsToValuesFn<SubmitParams, FormParams> = (props: OpenFormProps<SubmitParams>) => FormParams;\r\n\r\ninterface WithValidationOpts<SubmitParams extends object, FormParams> {\r\n    formToJson: FormToJsonFn<SubmitParams, FormParams>,\r\n    mapPropsToValues: PropsToValuesFn<SubmitParams, FormParams>,\r\n    type: DatasetTypes,\r\n    // WrappedComponent: React.FunctionComponent<FormikProps<FormParams> & OpenFormProps<SubmitParams>>\r\n}\r\n\r\nexport function withValidation<SubmitParams extends object, FormParams>(\r\n    opts: WithValidationOpts<SubmitParams, FormParams>\r\n) {\r\n    return withFormik<OpenFormProps<SubmitParams>, FormParams>({\r\n        mapPropsToValues: opts.mapPropsToValues,\r\n        handleSubmit: (values, formikBag) => {\r\n            const { onSubmit, path } = formikBag.props;\r\n            const submitData = opts.formToJson(values, path);\r\n            onSubmit(submitData);\r\n            formikBag.setSubmitting(false);\r\n        },\r\n        validate: (values, props) => {\r\n            return validateOpen(opts.type, opts.formToJson(values, props.path));\r\n        },\r\n        enableReinitialize: true,\r\n        validateOnChange: true,\r\n        validateOnBlur: true,\r\n    });\r\n}\r\n","import * as React from \"react\";\r\nimport { Table } from \"semantic-ui-react\";\r\nimport { DatasetState } from \"../../messages\";\r\nimport { isAdditionalInfo } from \"../helpers\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst renderParamValue = (value: any) => {\r\n    if (value instanceof Array) {\r\n        return `(${value.join(\",\")})`;\r\n    } else {\r\n        return value;\r\n    }\r\n}\r\n\r\nconst renderParams = (params: any) => {\r\n    return Object.keys(params).map((key: string, idx: number) => {\r\n        // Only show parameters, not additional info\r\n        if(!isAdditionalInfo(key)) {\r\n            return (\r\n                <Table.Row key={idx}>\r\n                    <Table.Cell>{key}</Table.Cell>\r\n                    <Table.Cell>{renderParamValue(params[key])}</Table.Cell>\r\n                </Table.Row>\r\n            );\r\n        }\r\n        else {\r\n          return null;\r\n        }\r\n    })\r\n}\r\n\r\n\r\nconst DatasetParams: React.SFC<DatasetProps> = ({ dataset }) => {\r\n    return (\r\n        <Table>\r\n            <Table.Header>\r\n                <Table.Row>\r\n                    <Table.HeaderCell>Parameter</Table.HeaderCell>\r\n                    <Table.HeaderCell>Value</Table.HeaderCell>\r\n                </Table.Row>\r\n            </Table.Header>\r\n            <Table.Body>\r\n                {renderParams(dataset.params)}\r\n            </Table.Body>\r\n        </Table>\r\n    );\r\n}\r\n\r\n\r\nexport default DatasetParams;\r\n","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { DatasetCreateParams, DatasetFormParams, DatasetState } from '../messages';\r\n\r\nexport enum ActionTypes {\r\n    OPEN = 'DATASET_OPEN',\r\n    CANCEL_OPEN = 'DATASET_CANCEL_OPEN',\r\n    CREATE = 'DATASET_CREATE',\r\n    CREATED = 'DATASET_CREATED',\r\n    ERROR = 'DATASET_ERROR',\r\n    DELETE = 'DATASET_DELETE',\r\n    DELETED = 'DATASET_DELETED',\r\n    DETECT = 'DATASET_DETECT',\r\n    DETECTED = 'DATASET_DETECTED',\r\n    DETECT_FAILED = 'DATASET_DETECT_FAILED',\r\n}\r\n\r\nexport const Actions = {\r\n    open: (path: string, cachedParams?: DatasetFormParams, detectedParams?: DatasetFormParams) => createAction(ActionTypes.OPEN, { path, cachedParams, detectedParams }),\r\n    cancelOpen: () => createAction(ActionTypes.CANCEL_OPEN),\r\n    create: (dataset: DatasetCreateParams) => createAction(ActionTypes.CREATE, { dataset }),\r\n    created: (dataset: DatasetState) => createAction(ActionTypes.CREATED, { dataset }),\r\n    error: (dataset: string, msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { dataset, msg, timestamp, id }),\r\n    delete: (dataset: string) => createAction(ActionTypes.DELETE, { dataset }),\r\n    deleted: (dataset: string) => createAction(ActionTypes.DELETED, { dataset }),\r\n    detect: (path: string) => createAction(ActionTypes.DETECT, { path }),\r\n    detected: (path: string, params: DatasetFormParams) => createAction(ActionTypes.DETECTED, { path, params }),\r\n    detectFailed: (path: string) => createAction(ActionTypes.DETECT_FAILED, { path }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n","import * as React from \"react\";\r\nimport { Table } from \"semantic-ui-react\";\r\nimport { DatasetOpen, DiagElemMsg } from \"../../messages\";\r\nimport DatasetParams from \"./DatasetParams\";\r\n\r\ninterface DatasetInfoProps {\r\n    dataset: DatasetOpen,\r\n}\r\n\r\nconst renderValue = (elem: DiagElemMsg) => {\r\n    if (elem.value instanceof Array) {\r\n        return <DiagElems diagnostics={elem.value} />\r\n    } else {\r\n        return elem.value;\r\n    }\r\n}\r\n\r\nconst DiagElem: React.SFC<{ elem: DiagElemMsg }> = ({ elem }) => {\r\n    return (\r\n        <Table.Row>\r\n            <Table.Cell>{elem.name}</Table.Cell>\r\n            <Table.Cell>{renderValue(elem)}</Table.Cell>\r\n        </Table.Row>\r\n    )\r\n}\r\n\r\nconst DiagElems: React.SFC<{ diagnostics: DiagElemMsg[] }> = ({ diagnostics }) => {\r\n    if (diagnostics.length === 0) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Table>\r\n            <Table.Header>\r\n                <Table.Row>\r\n                    <Table.HeaderCell>Name</Table.HeaderCell>\r\n                    <Table.HeaderCell>Value</Table.HeaderCell>\r\n                </Table.Row>\r\n            </Table.Header>\r\n            <Table.Body>\r\n                {diagnostics.map((elem, idx) => (\r\n                    <DiagElem elem={elem} key={idx} />\r\n                ))}\r\n            </Table.Body>\r\n        </Table>\r\n    );\r\n}\r\n\r\nconst DatasetInfo: React.SFC<DatasetInfoProps> = ({ dataset }) => {\r\n    return (\r\n        <>\r\n            <DatasetParams dataset={dataset} />\r\n            <DiagElems diagnostics={dataset.diagnostics} />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default DatasetInfo;","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\n\r\nexport enum ActionTypes {\r\n    DISMISS = \"ERROR_DISMISS\",\r\n    DISMISS_ALL = \"ERROR_DISMISS_ALL\",\r\n}\r\n\r\nexport const Actions = {\r\n    dismiss: (id: string) => createAction(ActionTypes.DISMISS, { id }),\r\n    dismissAll: () => createAction(ActionTypes.DISMISS_ALL),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Dispatch } from \"redux\";\r\nimport { Button } from \"semantic-ui-react\";\r\nimport { DatasetState } from \"../../messages\";\r\nimport * as datasetActions from \"../actions\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState,\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: DatasetProps) => {\r\n    return {\r\n        handleRemoveDataset: () => {\r\n            dispatch(datasetActions.Actions.delete(ownProps.dataset.id));\r\n        }\r\n    }\r\n}\r\n\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst DatasetToolbar: React.SFC<MergedProps> = ({ dataset, handleRemoveDataset }) => {\r\n    return (\r\n        <>\r\n            <Button icon=\"remove\" labelPosition=\"left\" onClick={handleRemoveDataset} content='Close Dataset' />\r\n        </>\r\n    );\r\n}\r\n\r\n\r\nexport default connect(null, mapDispatchToProps)(DatasetToolbar);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, Icon, Message, Modal, Popup, Segment } from 'semantic-ui-react';\r\nimport AnalysisList from \"../../compoundAnalysis/components/base/AnalysisList\";\r\nimport { CompoundAnalysisState } from \"../../compoundAnalysis/types\";\r\nimport { filterWithPred, Immutable, Predicate } from \"../../helpers/reducerHelpers\";\r\nimport { DatasetState, DatasetStatus } from \"../../messages\";\r\nimport { RootReducer } from \"../../store\";\r\nimport AddAnalysis from \"./AddAnalysis\";\r\nimport DatasetInfo from \"./DatasetInfo\";\r\nimport DatasetToolbar from \"./DatasetToolbar\";\r\n\r\ninterface DatasetProps {\r\n    dataset: DatasetState\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer, ownProps: DatasetProps) => {\r\n    const p: Predicate<Immutable<CompoundAnalysisState>> = (analysis: Immutable<CompoundAnalysisState>) => analysis.dataset === ownProps.dataset.id;\r\n    return {\r\n        analyses: filterWithPred(state.compoundAnalyses, p),\r\n    }\r\n}\r\n\r\ntype MergedProps = DatasetProps & ReturnType<typeof mapStateToProps>;\r\n\r\nconst DatasetComponent: React.SFC<MergedProps> = ({ dataset, analyses }) => {\r\n    const msg = {\r\n        [DatasetStatus.OPENING]: `Opening dataset ${dataset.params.name}`,\r\n        [DatasetStatus.DELETING]: `Closing dataset ${dataset.params.name}`,\r\n    }\r\n    if (dataset.status === DatasetStatus.OPENING || dataset.status === DatasetStatus.DELETING) {\r\n        return (\r\n            <>\r\n                <Header as=\"h2\" dividing={true}>{dataset.params.name}</Header>\r\n                <Message icon={true}>\r\n                    <Icon name='cog' loading={true} />\r\n                    <Message.Content>\r\n                        <Message.Header>{msg[dataset.status]}</Message.Header>\r\n                    </Message.Content>\r\n                </Message>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Segment.Group style={{ marginTop: \"3em\", marginBottom: \"3em\" }}>\r\n            <Segment.Group horizontal={true}>\r\n                <Segment>\r\n                    <Header as=\"h2\">\r\n                        <Icon name=\"database\" />\r\n                        <Modal trigger={\r\n                            <Header.Content>\r\n                                {dataset.params.name}\r\n                                {' '}\r\n                                <Icon name=\"info circle\" size=\"small\" link={true} />\r\n                            </Header.Content>\r\n                        }>\r\n                            <Popup.Header>{dataset.params.type} Dataset {dataset.params.name}</Popup.Header>\r\n                            <Popup.Content>\r\n                                <DatasetInfo dataset={dataset} />\r\n                            </Popup.Content>\r\n                        </Modal>\r\n                    </Header>\r\n                </Segment>\r\n                <Segment style={{ flexShrink: 1, flexGrow: 0 }}>\r\n                    <DatasetToolbar dataset={dataset} />\r\n                </Segment>\r\n            </Segment.Group>\r\n            {\r\n                analyses.ids.length > 0 ? (\r\n                    <>\r\n                        <Segment>\r\n                            <AnalysisList analyses={analyses} />\r\n                        </Segment>\r\n                    </>\r\n                ) : null\r\n            }\r\n            <Segment textAlign=\"center\">\r\n                <AddAnalysis dataset={dataset} />\r\n            </Segment>\r\n        </Segment.Group>\r\n    );\r\n}\r\n\r\nconst DatasetContainer = connect(mapStateToProps)(DatasetComponent);\r\n\r\nexport default DatasetContainer;","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsBLO, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsBLOForForm = Omit<DatasetParamsBLO, \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsBLOForForm> & OpenFormProps<DatasetParamsBLO>;\r\n\r\nconst BLOFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    isValidating,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting || isValidating}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsBLO, DatasetParamsBLOForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.BLO,\r\n            name: values.name,\r\n        };\r\n    },\r\n    type: DatasetTypes.BLO,\r\n})(BLOFileParamsForm);\r\n","import * as React from \"react\";\r\nimport { Dropdown, DropdownProps } from \"semantic-ui-react\";\r\nimport { getEnumValues } from \"../../helpers\";\r\nimport { DatasetTypes } from \"../../messages\";\r\n\r\n\r\nconst datasetTypeKeys = getEnumValues(DatasetTypes);\r\nconst datasetTypeOptions = datasetTypeKeys.map(t => ({\r\n    // text: DatasetTypeMetadata[DatasetTypes[t as any]].short,\r\n    text: DatasetTypes[t],\r\n    value: DatasetTypes[t],\r\n}));\r\n\r\ninterface DatasetTypeSelectProps {\r\n    onClick: (e: React.SyntheticEvent, data: DropdownProps) => void,\r\n    currentType: DatasetTypes,\r\n}\r\n\r\nconst DatasetTypeSelect: React.SFC<DatasetTypeSelectProps> = ({ currentType, onClick }) => {\r\n    return (\r\n        <>\r\n            <Dropdown\r\n                inline={true}\r\n                options={datasetTypeOptions}\r\n                value={currentType}\r\n                onChange={onClick}\r\n            />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default DatasetTypeSelect;","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsEMPAD, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsEMPADForForm = Omit<DatasetParamsEMPAD,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"scan_size\"\r\n> & {\r\n    scan_size: string,\r\n};\r\n\r\ntype MergedProps = FormikProps<DatasetParamsEMPADForForm> & OpenFormProps<DatasetParamsEMPAD>;\r\n\r\nconst EMPADParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <Field name=\"scan_size\" id=\"id_scan_size\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsEMPAD, DatasetParamsEMPADForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.EMPAD,\r\n            name: values.name,\r\n            scan_size: parseNumList(values.scan_size),\r\n        };\r\n    },\r\n    type: DatasetTypes.EMPAD,\r\n})(EMPADParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsFRMS6, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsFRMS6ForForm = Omit<DatasetParamsFRMS6,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsFRMS6ForForm> & OpenFormProps<DatasetParamsFRMS6>;\r\nconst FRMS6ParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsFRMS6, DatasetParamsFRMS6ForForm>({\r\n    mapPropsToValues: ({ path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.FRMS6,\r\n            name: values.name,\r\n        };\r\n    },\r\n    type: DatasetTypes.FRMS6,\r\n})(FRMS6ParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Dropdown, DropdownProps, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsHDF5, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\ntype DatasetParamsHDF5ForForm = Omit<DatasetParamsHDF5, \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsHDF5ForForm> & OpenFormProps<DatasetParamsHDF5>;\r\n\r\nconst HDF5ParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n    setFieldValue,\r\n}) => {\r\n\r\n    const dsPathOptions = values.dataset_paths.map(dsPath => ({ key: dsPath, text: dsPath, value: dsPath }));\r\n\r\n    // semantic-ui requires value to be set manually on option selection\r\n    const onDSPathChange = (e: React.SyntheticEvent, result: DropdownProps) => {\r\n      const { value } = result;\r\n      if (value) {\r\n        setFieldValue(\"ds_path\", value.toString());\r\n      }\r\n    };\r\n\r\n    let dsPathInput;\r\n    const isTimeOut = (values.dataset_paths.length === 0 ) ? true : false;\r\n    if (isTimeOut) {\r\n      dsPathInput = <Field name=\"ds_path\" id=\"id_ds_path\" />;\r\n    } else {\r\n      dsPathInput = <Dropdown name=\"ds_path\" id=\"id_ds_path\" placeholder=\"Select dataset\" fluid={true} search={true} selection={true} defaultValue={values.ds_path} onChange={onDSPathChange} options={dsPathOptions} />;\r\n    }\r\n\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_ds_path\">HDF5 Dataset Path:</label>\r\n                <ErrorMessage name=\"ds_path\" />\r\n                {dsPathInput}\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button onClick={onCancel} >Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsHDF5, DatasetParamsHDF5ForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        dataset_paths: getInitial(\"dataset_paths\", [], initial),\r\n        ds_path: getInitial(\"ds_path\", \"\", initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.HDF5,\r\n            name: values.name,\r\n            ds_path: values.ds_path,\r\n            dataset_paths: values.dataset_paths,\r\n        };\r\n    },\r\n    type: DatasetTypes.HDF5,\r\n})(HDF5ParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsK2IS, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsK2ISForForm = Omit<DatasetParamsK2IS,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsK2ISForForm> & OpenFormProps<DatasetParamsK2IS>;\r\n\r\nconst K2ISFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsK2IS, DatasetParamsK2ISForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.K2IS,\r\n            name: values.name,\r\n        }\r\n    },\r\n    type: DatasetTypes.K2IS,\r\n})(K2ISFileParamsForm);\r\n","import * as React from \"react\";\r\n\r\ninterface TupleInputPartProps {\r\n    name: string,\r\n    id: string,\r\n    tupleKey: number,\r\n    value: number,\r\n    tupleInputChangeHandle: (idx: number, value: string) => void,\r\n    commaPressHandle: (idx: number) => void,\r\n    tupleRef: (ref:HTMLInputElement) => void,\r\n}\r\n\r\nconst TupleInputPart: React.FC<TupleInputPartProps> = ({ name, id, tupleKey, tupleInputChangeHandle, value, commaPressHandle, tupleRef }) => {\r\n\r\n   const onPartChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      tupleInputChangeHandle(tupleKey, e.target.value);\r\n   }\r\n\r\n   const onCommaPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n     if(e.keyCode === 188) {\r\n       commaPressHandle(tupleKey);\r\n     }\r\n   }\r\n\r\n   return <input type=\"number\" name={name} id={id} key={tupleKey} onChange={onPartChange} value={value} onKeyDown={onCommaPress} ref={tupleRef} />;\r\n}\r\n\r\nexport default TupleInputPart;\r\n","import * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { parseNumListWithPadding } from \"../helpers\";\r\nimport TupleInputPart from \"./TupleInputPart\";\r\n\r\ninterface TupleInputProps {\r\n    value: string,\r\n    minLen: number,\r\n    maxLen: number,\r\n    fieldName: string,\r\n    setFieldValue: (field: string, value: any, shouldValidate?: boolean) => void,\r\n}\r\n\r\nconst TupleInput: React.FC<TupleInputProps> = ({ value, minLen, maxLen, fieldName, setFieldValue }) => {\r\n\r\n    const tupleInputValue = parseNumListWithPadding(value, minLen);\r\n\r\n    const tupleInputRefsArray = React.useRef<HTMLInputElement[]>([]);\r\n\r\n    const tupleInputChangeHandle = (idx: number, val: string) => {\r\n      const newTupleInputValue = [...tupleInputValue];\r\n      newTupleInputValue[idx] = val;\r\n      setFieldValue(fieldName, newTupleInputValue.toString());\r\n    };\r\n\r\n    const commaPressHandle = (idx: number) => {\r\n      if(idx===(tupleInputValue.length-1)) {\r\n        newTupleDim();\r\n      } else {\r\n          tupleInputRefsArray.current[idx+1].focus();\r\n      }\r\n    }\r\n\r\n    const newTupleDim = () => {\r\n      if(tupleInputValue.length < maxLen) {\r\n        const newTupleInputValue = [...tupleInputValue];\r\n        newTupleInputValue.push(\"\");\r\n        setFieldValue(fieldName, newTupleInputValue.toString());\r\n      }\r\n    }\r\n\r\n    React.useEffect(() => {\r\n      if(tupleInputValue.length > minLen) {\r\n        tupleInputRefsArray.current[tupleInputValue.length-1].focus();\r\n      }\r\n    }, [tupleInputValue.length, minLen]);\r\n\r\n    const delTupleDim = () => {\r\n      if(tupleInputValue.length > minLen) {\r\n        const newTupleInputValue = [...tupleInputValue];\r\n        newTupleInputValue.pop();\r\n        setFieldValue(fieldName, newTupleInputValue.toString());\r\n      }\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <Form.Group>\r\n          {tupleInputValue.map((val, idx) => {\r\n            const tupleRef = (ref:HTMLInputElement) => { tupleInputRefsArray.current[idx] = ref; }\r\n            return <Form.Field width={2} key={idx}><TupleInputPart tupleKey={idx} name={fieldName + \"_\" + idx} id={\"id_\" + fieldName + \"_\" + idx} value={val} tupleRef={tupleRef} tupleInputChangeHandle={tupleInputChangeHandle} commaPressHandle={commaPressHandle} /></Form.Field>\r\n          })}\r\n          <Form.Field hidden={minLen === maxLen}>\r\n            <Button onClick={newTupleDim} disabled={tupleInputValue.length === maxLen} type=\"button\" icon=\"add\" title=\"Add dimension\" basic={false} />\r\n            <Button onClick={delTupleDim} disabled={tupleInputValue.length === minLen} type=\"button\" icon=\"minus\" title=\"Remove dimension\" basic={false} />\r\n          </Form.Field>\r\n        </Form.Group>\r\n      </>\r\n    );\r\n}\r\n\r\nexport default TupleInput;\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsMIB, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\nimport TupleInput from \"./TupleInput\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsMIBForForm = Omit<DatasetParamsMIB,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"scan_size\"\r\n> & {\r\n    scan_size: string,\r\n};\r\n\r\ntype FormValues = DatasetParamsMIBForForm\r\n\r\ntype MergedProps = FormikProps<FormValues> & OpenFormProps<DatasetParamsMIB>;\r\n\r\nconst MIBFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    isValidating,\r\n    onCancel,\r\n    setFieldValue,\r\n}) => {\r\n\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size_0\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <TupleInput value={values.scan_size} minLen={2} maxLen={2} fieldName=\"scan_size\" setFieldValue={setFieldValue} />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting || isValidating}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsMIB, DatasetParamsMIBForForm>({\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.MIB,\r\n            name: values.name,\r\n            scan_size: parseNumList(values.scan_size),\r\n        }\r\n    },\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n    }),\r\n    type: DatasetTypes.MIB,\r\n})(MIBFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsRaw, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\nimport TupleInput from \"./TupleInput\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsRawForForm = Omit<DatasetParamsRaw,\r\n    \"type\"\r\n    | \"path\"\r\n    | \"scan_size\"\r\n    | \"detector_size\"> & {\r\n        scan_size: string\r\n        detector_size: string,\r\n    };\r\n\r\ntype MergedProps = FormikProps<DatasetParamsRawForForm> & OpenFormProps<DatasetParamsRaw>;\r\n\r\nconst RawFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n    setFieldValue,\r\n}) => {\r\n\r\n    return (\r\n\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size_0\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <TupleInput value={values.scan_size} minLen={2} maxLen={2} fieldName=\"scan_size\" setFieldValue={setFieldValue} />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_dtype\">Datatype (uint16, uint32, float32, float64, &gt;u2, ..., can be anything that is <a href=\"https://docs.scipy.org/doc/numpy-1.15.1/reference/arrays.dtypes.html\">understood by numpy as a dtype</a>):</label>\r\n                <ErrorMessage name=\"dtype\" />\r\n                <Field name=\"dtype\" id=\"id_dtype\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_detector_size_0\">Detector Size (pixels, example: 256,256):</label>\r\n                <ErrorMessage name=\"detector_size\" />\r\n                <TupleInput value={values.detector_size} minLen={2} maxLen={2} fieldName=\"detector_size\" setFieldValue={setFieldValue} />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_enable_direct\">Enable Direct I/O (for usage with fast SSDs and files much larger than RAM):</label>\r\n                <ErrorMessage name=\"enable_direct\" />\r\n                <Field type=\"checkbox\" name=\"enable_direct\" checked={values.enable_direct} id=\"id_enable_direct\" />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsRaw, DatasetParamsRawForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n        enable_direct: getInitial(\"enable_direct\", false, initial),\r\n        detector_size: getInitial(\"detector_size\", \"\", initial).toString(),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n        dtype: getInitial(\"dtype\", \"float32\", initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.RAW,\r\n            name: values.name,\r\n            dtype: values.dtype,\r\n            enable_direct: values.enable_direct,\r\n            scan_size: parseNumList(values.scan_size),\r\n            detector_size: parseNumList(values.detector_size),\r\n        }\r\n    },\r\n    type: DatasetTypes.RAW,\r\n})(RawFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsSEQ, DatasetTypes } from \"../../messages\";\r\nimport { getInitial, getInitialName, parseNumList, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\nimport TupleInput from \"./TupleInput\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsSEQForForm = Omit<DatasetParamsSEQ,\r\n    \"path\"\r\n    | \"type\"\r\n    | \"scan_size\"\r\n> & {\r\n    scan_size: string,\r\n};\r\n\r\ntype FormValues = DatasetParamsSEQForForm\r\n\r\ntype MergedProps = FormikProps<FormValues> & OpenFormProps<DatasetParamsSEQ>;\r\n\r\nconst SEQFileParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    isValidating,\r\n    onCancel,\r\n    setFieldValue,\r\n}) => {\r\n\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_scan_size_0\">Scan Size:</label>\r\n                <ErrorMessage name=\"scan_size\" />\r\n                <TupleInput value={values.scan_size} minLen={2} maxLen={2} fieldName=\"scan_size\" setFieldValue={setFieldValue} />\r\n            </Form.Field>\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting || isValidating}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsSEQ, DatasetParamsSEQForForm>({\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.SEQ,\r\n            name: values.name,\r\n            scan_size: parseNumList(values.scan_size),\r\n        }\r\n    },\r\n    mapPropsToValues: ({ path, initial }) => ({\r\n        name: getInitialName(\"name\", path, initial),\r\n        scan_size: getInitial(\"scan_size\", \"\", initial).toString(),\r\n    }),\r\n    type: DatasetTypes.SEQ,\r\n})(SEQFileParamsForm);\r\n","import { ErrorMessage, Field, FormikProps } from \"formik\";\r\nimport * as React from \"react\";\r\nimport { Button, Form } from \"semantic-ui-react\";\r\nimport { Omit } from \"../../helpers/types\";\r\nimport { DatasetParamsSER, DatasetTypes } from \"../../messages\";\r\nimport { getInitialName, withValidation } from \"../helpers\";\r\nimport { OpenFormProps } from \"../types\";\r\n\r\n// some fields have different types in the form vs. in messages\r\ntype DatasetParamsSERForForm = Omit<DatasetParamsSER,\r\n    \"path\" | \"type\">;\r\n\r\ntype MergedProps = FormikProps<DatasetParamsSERForForm> & OpenFormProps<DatasetParamsSER>;\r\nconst SERParamsForm: React.SFC<MergedProps> = ({\r\n    values,\r\n    touched,\r\n    errors,\r\n    dirty,\r\n    isSubmitting,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    handleReset,\r\n    onCancel,\r\n}) => {\r\n    return (\r\n        <Form onSubmit={handleSubmit}>\r\n            <Form.Field>\r\n                <label htmlFor=\"id_name\">Name:</label>\r\n                <ErrorMessage name=\"name\" />\r\n                <Field name=\"name\" id=\"id_name\" />\r\n            </Form.Field>\r\n\r\n            <Button primary={true} type=\"submit\" disabled={isSubmitting}>Load Dataset</Button>\r\n            <Button type=\"button\" onClick={onCancel}>Cancel</Button>\r\n            <Button type=\"button\" onClick={handleReset}>Reset</Button>\r\n        </Form>\r\n    )\r\n}\r\n\r\nexport default withValidation<DatasetParamsSER, DatasetParamsSERForForm>({\r\n    mapPropsToValues: ({path, initial }) => ({\r\n        name: getInitialName(\"name\",path,initial),\r\n    }),\r\n    formToJson: (values, path) => {\r\n        return {\r\n            path,\r\n            type: DatasetTypes.SER,\r\n            name: values.name,\r\n        }\r\n    },\r\n    type: DatasetTypes.SER,\r\n})(SERParamsForm);\r\n","import * as React from \"react\";\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { DropdownProps, Header, Segment } from \"semantic-ui-react\";\r\nimport uuid from \"uuid/v4\";\r\nimport { assertNotReached } from \"../../helpers\";\r\nimport { DatasetFormParams, DatasetTypes } from '../../messages';\r\nimport { RootReducer } from \"../../store\";\r\nimport * as datasetActions from \"../actions\";\r\nimport { hasKey, isAdditionalInfo } from \"../helpers\";\r\nimport { OpenDatasetState } from \"../types\";\r\nimport BLOParamsForm from \"./BLOParamsForm\";\r\nimport DatasetTypeSelect from \"./DatasetTypeSelect\";\r\nimport EMPADParamsForm from \"./EMPADParamsForm\";\r\nimport FRMS6ParamsForm from \"./FRMS6ParamsForm\";\r\nimport HDF5ParamsForm from \"./HDF5ParamsForm\";\r\nimport K2ISParamsForm from \"./K2ISParamsForm\";\r\nimport MIBParamsForm from \"./MIBParamsForm\";\r\nimport RawFileParamsForm from \"./RawFileParamsForm\";\r\nimport SEQParamsForm from \"./SEQParamsForm\";\r\nimport SERParamsForm from \"./SERParamsForm\";\r\n\r\n\r\n/**\r\n * Get the initial selection for the dataset type dropdown. If we have a previous\r\n * user selection, we use it, but only if the reset button was not pressed. If it was,\r\n * we use the detected dataset type, falling back to RAW.\r\n *\r\n * @param didReset flag: was the reset button pressed?\r\n * @param openState complete OpenDatasetState instance\r\n */\r\nconst getDefaultDSType = (didReset: boolean, openState: OpenDatasetState) => {\r\n    const { formCachedParams, formDetectedParams } = openState;\r\n    if (didReset) {\r\n        return formDetectedParams ? formDetectedParams.type : DatasetTypes.RAW;\r\n    }\r\n    if (formCachedParams) {\r\n        return formCachedParams.type;\r\n    }\r\n    if (formDetectedParams) {\r\n        return formDetectedParams.type;\r\n    }\r\n    return DatasetTypes.RAW;\r\n}\r\n\r\n\r\n/**\r\n * Get the initial form field values. If we have previously entered values, we\r\n * use these, otherwise we use the detected parameters. If the reset button was\r\n * clicked, we use the detected params, but keep the original name field,\r\n *\r\n * @param didReset flag: was the reset button pressed?\r\n * @param openState complete OpenDatasetState instance\r\n */\r\n\r\n// Fix this after separating info from params\r\nconst getAdditionalInfo = (formDetectedParams: DatasetFormParams) => {\r\n    const additionalInfo = Object.keys(formDetectedParams)\r\n        .filter(isAdditionalInfo)\r\n        .reduce((allInfo: object, info: string) => {\r\n            return hasKey(formDetectedParams, info) ? { ...allInfo, [info]: formDetectedParams[info] } : { ...allInfo };\r\n        }, {});\r\n    return additionalInfo;\r\n}\r\n\r\nconst getFormInitial = (didReset: boolean, openState: OpenDatasetState) => {\r\n    const { formCachedParams, formDetectedParams } = openState;\r\n    if (didReset) {\r\n        if (formDetectedParams) {\r\n            return {\r\n                name: formCachedParams ? formCachedParams.name : \"\",\r\n                ...formDetectedParams,\r\n            };\r\n        }\r\n        return undefined;\r\n    }\r\n    if (formCachedParams) {\r\n        if (formDetectedParams) {\r\n            const additionalInfo = getAdditionalInfo(formDetectedParams);\r\n            return { ...additionalInfo, ...formCachedParams };\r\n        }\r\n        return formCachedParams;\r\n    } else {\r\n        return formDetectedParams;\r\n    }\r\n}\r\n\r\n/**\r\n * Dispatch to specific dataset opening forms, including a selection of dataset type\r\n * via a dropdown.\r\n */\r\nconst DatasetOpen = () => {\r\n    const dispatch = useDispatch();\r\n    const openState = useSelector((state: RootReducer) => state.openDataset);\r\n\r\n    const [didReset, setReset] = React.useState(false);\r\n    const formInitial = getFormInitial(didReset, openState);\r\n    const defaultType = getDefaultDSType(didReset, openState);\r\n    const [datasetType, setDatasetType] = React.useState(defaultType);\r\n\r\n    const doSetType = (e: React.SyntheticEvent, data: DropdownProps) => setDatasetType(data.value as DatasetTypes);\r\n    // FIXME: find out how to make ts correctly correlate the types of FormComponent\r\n    // and initial and replace the huge switch below with something like:\r\n    // const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n    // const formComponentMap = {\r\n    //     [DatasetTypes.HDF5]: HDF5ParamsForm,\r\n    //     [DatasetTypes.RAW]: RawFileParamsForm,\r\n    //     [DatasetTypes.MIB]: MIBParamsForm,\r\n    //     [DatasetTypes.BLO]: BLOParamsForm,\r\n    //     [DatasetTypes.K2IS]: K2ISParamsForm,\r\n    //     [DatasetTypes.SER]: SERParamsForm,\r\n    //     [DatasetTypes.FRMS6]: FRMS6ParamsForm,\r\n    //     [DatasetTypes.EMPAD]: EMPADParamsForm,\r\n    // }\r\n    // const FormComponent = formComponentMap[datasetType];\r\n\r\n    const renderForm = (form: React.ReactNode) => {\r\n        return (\r\n            <Segment>\r\n                Type: <DatasetTypeSelect onClick={doSetType} currentType={datasetType} />\r\n                <Header as=\"h2\">Open: {openState.formPath}</Header>\r\n                {form}\r\n            </Segment>\r\n        );\r\n    }\r\n\r\n    const commonParams = {\r\n        path: openState.formPath,\r\n        onSubmit: (params: DatasetFormParams) => {\r\n            dispatch(datasetActions.Actions.create({\r\n                id: uuid(),\r\n                params,\r\n            }))\r\n        },\r\n        onCancel: () => dispatch(datasetActions.Actions.cancelOpen()),\r\n        onReset: () => {\r\n            setReset(true);\r\n            setDatasetType(getDefaultDSType(true, openState));\r\n        },\r\n    }\r\n\r\n    switch (datasetType) {\r\n        case DatasetTypes.HDF5: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<HDF5ParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.RAW: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<RawFileParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.MIB: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<MIBParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.BLO: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<BLOParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.K2IS: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<K2ISParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.SER: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<SERParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.FRMS6: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<FRMS6ParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n        case DatasetTypes.EMPAD: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<EMPADParamsForm {...commonParams} initial={initial} />)\r\n        }\r\n        case DatasetTypes.SEQ: {\r\n            const initial = formInitial && datasetType === formInitial.type ? formInitial : undefined;\r\n            return renderForm(<SEQParamsForm {...commonParams} initial={initial} />);\r\n        }\r\n    }\r\n    return assertNotReached(\"unknown dataset type\");\r\n}\r\n\r\nexport default DatasetOpen;\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Header, Icon, Message } from \"semantic-ui-react\";\r\nimport { RootReducer } from \"../../store\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        busy: state.openDataset.busy,\r\n        path: state.openDataset.busyPath,\r\n    };\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst DatasetOpenSpinner: React.SFC<MergedProps> = ({ busy, path }) => {\r\n    if (!busy) {\r\n        return null;\r\n    }\r\n    return (\r\n        <>\r\n            <Header as=\"h2\" dividing={true}>Loading...</Header>\r\n            <Message icon={true}>\r\n                <Icon name='cog' loading={true} />\r\n                <Message.Content>\r\n                    <Message.Header>Detecting parameters for {path}</Message.Header>\r\n                </Message.Content>\r\n            </Message>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(DatasetOpenSpinner);","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport BrowserWrapper from \"../../browser/components/BrowserWrapper\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { DatasetsState } from \"../types\";\r\nimport Dataset from \"./Dataset\";\r\nimport DatasetOpen from \"./DatasetOpen\";\r\nimport DatasetOpenSpinner from \"./DatasetOpenSpinner\";\r\n\r\ninterface DatasetListProps {\r\n    datasets: DatasetsState\r\n}\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        datasets: state.datasets,\r\n        formVisible: state.openDataset.formVisible,\r\n        formPath: state.openDataset.formPath,\r\n    };\r\n}\r\n\r\ntype MergedProps = DatasetListProps & ReturnType<typeof mapStateToProps>;\r\n\r\nclass DatasetList extends React.Component<MergedProps> {\r\n    public render() {\r\n        const { formVisible, datasets } = this.props;\r\n\r\n        return (\r\n            <>\r\n                {datasets.ids.map((dsId: string) => <Dataset dataset={datasets.byId[dsId]} key={dsId} />)}\r\n                <DatasetOpenSpinner />\r\n                {formVisible && <DatasetOpen />}\r\n                <BrowserWrapper />\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(DatasetList);","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Dispatch } from 'redux';\r\nimport { Message } from 'semantic-ui-react';\r\nimport * as errorActions from '../actions';\r\nimport { ErrorMessage } from '../reducers';\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch, ownProps: ErrorProps) => {\r\n    return {\r\n        dismiss: () => dispatch(errorActions.Actions.dismiss(ownProps.error.id)),\r\n    }\r\n}\r\n\r\ninterface ErrorProps {\r\n    error: ErrorMessage,\r\n}\r\n\r\ntype MergedProps = ErrorProps & ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst ErrorComponent: React.SFC<MergedProps> = ({ dismiss, error }) => {\r\n    return (\r\n        <Message negative={true} onDismiss={dismiss}>{error.msg}</Message>\r\n    )\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(ErrorComponent);","import * as React from \"react\";\r\nimport { connect, useDispatch } from \"react-redux\";\r\nimport { Modal } from \"semantic-ui-react\";\r\nimport { useDismissEscape } from \"../../helpers/hooks\";\r\nimport { RootReducer } from \"../../store\";\r\nimport { Actions } from \"../actions\";\r\nimport Error from \"./Error\";\r\n\r\nconst mapStateToProps = (state: RootReducer) => {\r\n    return {\r\n        errors: state.errors,\r\n        channelConnected: (state.channelStatus.status === \"connected\" ||\r\n            state.channelStatus.status === \"ready\"),\r\n    }\r\n}\r\n\r\ntype MergedProps = ReturnType<typeof mapStateToProps>;\r\n\r\nconst ErrorList: React.SFC<MergedProps> = ({ errors, channelConnected }) => {\r\n    const numShown = 3;\r\n    const latestErrors = errors.ids.slice(Math.max(0, errors.ids.length - numShown));\r\n    const showModal = errors.ids.length > 0 && channelConnected;\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const doDismiss = () => {\r\n        dispatch(Actions.dismissAll());\r\n    }\r\n\r\n    useDismissEscape(doDismiss);\r\n\r\n    return (\r\n        <Modal open={showModal}>\r\n            {latestErrors.map(error => <Error error={errors.byId[error]} key={error} />)}\r\n        </Modal>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(ErrorList);","import React from \"react\";\r\n\r\nexport const useDismissEscape = (dismiss: () => void) => {\r\n    React.useEffect(() => {\r\n        const handleEsc = (ev: KeyboardEvent) => {\r\n            if(ev.code === \"Escape\" || ev.keyCode === 27) {\r\n                dismiss();\r\n            }\r\n        }\r\n        document.addEventListener(\"keyup\", handleEsc);\r\n\r\n        return () => {\r\n            document.removeEventListener(\"keyup\", handleEsc);\r\n        };\r\n    });\r\n}","import * as React from 'react';\r\nimport 'semantic-ui-css/semantic.min.css';\r\nimport { Container, Icon, Modal, Popup } from 'semantic-ui-react';\r\nimport About from './About';\r\nimport ChannelStatus from './channel/components/ChannelStatus';\r\nimport DatasetList from './dataset/components/DatasetList';\r\nimport ErrorList from './errors/components/ErrorList';\r\nimport logo from './images/LiberTEM logo-medium.png';\r\n\r\nclass App extends React.Component {\r\n    public render() {\r\n        return (\r\n            <Container style={{ margin: \"5em 1em 5em 1em\" }}>\r\n                <div style={{ display: \"flex\" }}>\r\n                    <img src={logo} width=\"200\" height=\"46\" alt=\"LiberTEM\" style={{ marginBottom: \"20px\" }} />\r\n                    {' '}\r\n                    <Modal trigger={\r\n                        <Icon name=\"info circle\" link={true} style={{ alignSelf: \"flex-start\" }} />\r\n                    }>\r\n                        <Popup.Header>About LiberTEM</Popup.Header>\r\n                        <Popup.Content>\r\n                            <About />\r\n                        </Popup.Content>\r\n                    </Modal>\r\n                </div>\r\n                <ErrorList />\r\n                <ChannelStatus>\r\n                    <DatasetList />\r\n                </ChannelStatus>\r\n            </Container>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// tslint:disable:no-console\r\n// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the 'N+1' visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL!,\r\n      window.location.toString()\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker) {\r\n          installingWorker.onstatechange = () => {\r\n            if (installingWorker.state === 'installed') {\r\n              if (navigator.serviceWorker.controller) {\r\n                // At this point, the old content will have been purged and\r\n                // the fresh content will have been added to the cache.\r\n                // It's the perfect time to display a 'New content is\r\n                // available; please refresh.' message in your web app.\r\n                console.log('New content is available; please refresh.');\r\n              } else {\r\n                // At this point, everything has been precached.\r\n                // It's the perfect time to display a\r\n                // 'Content is cached for offline use.' message.\r\n                console.log('Content is cached for offline use.');\r\n              }\r\n            }\r\n          };\r\n        }\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type')!.indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport { ClusterTypes, MsgPartConfig } from \"../messages\";\r\nimport { ConfigParams, ConfigState, LocalConfig } from \"./reducers\";\r\n\r\nconst CONFIG_KEY = \"LiberTEM.config\";\r\n\r\nexport function joinPaths(config: ConfigState, ...parts: string[]) {\r\n    const removeSep = (part: string) => part.replace(new RegExp(`${_.escapeRegExp(config.separator)}$`), \"\")\r\n    parts = [removeSep(parts[0]), ...parts.slice(1)];\r\n    return parts.map(part => part.trim()).join(config.separator);\r\n}\r\n\r\nexport function mergeLocalStorage(serverConfig: MsgPartConfig): ConfigParams {\r\n    const localSettings = window.localStorage.getItem(CONFIG_KEY);\r\n    if (localSettings === null) {\r\n        return Object.assign({}, getDefaultLocalConfig(), serverConfig);\r\n    }\r\n    const localSettingsParsed = JSON.parse(localSettings);\r\n    const defaultConfig = getDefaultLocalConfig();\r\n    const mergedConfig = Object.assign({}, defaultConfig, serverConfig, localSettingsParsed);\r\n    return mergedConfig;\r\n}\r\n\r\nexport function setLocalStorage(config: ConfigState): void {\r\n    const localSettings: LocalConfig = {\r\n        cwd: config.cwd,\r\n        lastOpened: config.lastOpened,\r\n        fileHistory: config.fileHistory,\r\n        lastConnection: config.lastConnection,\r\n        starred: config.starred,\r\n    }\r\n\r\n    window.localStorage.setItem(CONFIG_KEY, JSON.stringify(localSettings));\r\n}\r\n\r\nexport function clearLocalStorage(): void {\r\n    window.localStorage.removeItem(CONFIG_KEY);\r\n}\r\n\r\nexport function getDefaultLocalConfig(): LocalConfig {\r\n    return {\r\n        lastOpened: {},\r\n        fileHistory: [],\r\n        cwd: \"/\",\r\n        lastConnection: {\r\n            type: ClusterTypes.LOCAL,\r\n            address: \"tcp://localhost:8786\"\r\n        },\r\n        starred: [],\r\n    };\r\n}\r\n\r\nexport function makeUnique<T>(inp: T[]): T[] {\r\n    return inp.reduce((acc: T[], curr: T) => {\r\n        if (acc.indexOf(curr) === -1) {\r\n            return [...acc, curr];\r\n        } else {\r\n            return acc;\r\n        }\r\n    }, [] as T[]);\r\n}","import { getApiBasePath } from \"../helpers/apiHelpers\";\r\nimport { DirectoryListingResponse } from \"../messages\";\r\n\r\nexport async function getDirectoryListing(path: string): Promise<DirectoryListingResponse> {\r\n    const basePath = getApiBasePath();\r\n    const url = `${basePath}browse/localfs/?path=${encodeURIComponent(path)}`;\r\n    const r = await fetch(url, {\r\n        method: 'GET',\r\n        credentials: \"same-origin\",\r\n    });\r\n    return await r.json();\r\n}","import { ActionsUnion, createAction } from '../helpers/actionHelpers';\r\nimport { JobResultType } from '../job/types';\r\nimport { AnalysisDetails, MsgPartAnalysis, MsgPartCompoundAnalysis, MsgPartInitialDataset, MsgPartJob } from '../messages';\r\n\r\n\r\nexport type PartialResultType = JobResultType;\r\n\r\nexport enum ActionTypes {\r\n    INITIAL_STATE = 'CHANNEL_INITIAL_STATE',\r\n    JOB_STARTED = 'CHANNEL_JOB_STARTED',\r\n    FINISH_JOB = 'CHANNEL_FINISH_JOB',\r\n    TASK_RESULT = 'CHANNEL_TASK_RESULT',\r\n    JOB_ERROR = 'CHANNEL_JOB_ERROR',\r\n    OPEN = \"CHANNEL_OPEN\",\r\n    CLOSE = \"CHANNEL_CLOSE\",\r\n    ERROR = \"CHANNEL_ERROR\",\r\n    CANCELLED = \"CANCELLED\",\r\n    ANALYSIS_CREATED = 'ANALYSIS_CREATED',\r\n    ANALYSIS_UPDATED = 'ANALYSIS_UPDATED',\r\n    ANALYSIS_REMOVED = 'ANALYSIS_REMOVED',\r\n}\r\n\r\nexport const Actions = {\r\n    initialState: (jobs: MsgPartJob[], datasets: MsgPartInitialDataset[], compoundAnalyses: MsgPartCompoundAnalysis[], analyses: MsgPartAnalysis[], timestamp: number) => createAction(ActionTypes.INITIAL_STATE, { jobs, datasets, timestamp, compoundAnalyses, analyses }),\r\n    jobStarted: (job: string, dataset: string, timestamp: number) => createAction(ActionTypes.JOB_STARTED, { job, timestamp, dataset }),\r\n    finishJob: (job: string, results: JobResultType[], timestamp: number) => createAction(ActionTypes.FINISH_JOB, { job, results, timestamp }),\r\n    taskResult: (job: string, results: PartialResultType[], timestamp: number) => createAction(ActionTypes.TASK_RESULT, { job, results, timestamp }),\r\n    jobError: (job: string, msg: string, id: string, timestamp: number) => createAction(ActionTypes.JOB_ERROR, { job, msg, id, timestamp }),\r\n    open: (timestamp: number) => createAction(ActionTypes.OPEN, { timestamp }),\r\n    close: (timestamp: number) => createAction(ActionTypes.CLOSE, { timestamp }),\r\n    error: (msg: string, timestamp: number, id: string) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n    cancelled: (job: string) => createAction(ActionTypes.CANCELLED, { job }),\r\n    analysisCreated: (analysis: string, dataset: string, details: AnalysisDetails) => createAction(ActionTypes.ANALYSIS_CREATED, { dataset, analysis, details }),\r\n    analysisUpdated: (analysis: string, dataset: string, details: AnalysisDetails) => createAction(ActionTypes.ANALYSIS_UPDATED, { dataset, analysis, details }),\r\n    analysisRemoved: (analysis: string) => createAction(ActionTypes.ANALYSIS_REMOVED, { analysis }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;","import { call, fork, put, select, take } from \"redux-saga/effects\";\r\nimport uuid from 'uuid/v4';\r\nimport { joinPaths } from \"../config/helpers\";\r\nimport { ConfigState } from \"../config/reducers\";\r\nimport { DirectoryListingResponse } from \"../messages\";\r\nimport { RootReducer } from \"../store\";\r\nimport * as browserActions from './actions';\r\nimport { getDirectoryListing } from \"./api\";\r\nimport { DirectoryBrowserState } from \"./types\";\r\n\r\nexport function* directoryListingSaga() {\r\n    yield fork(fetchOnRequest);\r\n    yield fork(fetchDirectoryListOnOpen);\r\n}\r\n\r\nfunction* fetchOnRequest() {\r\n    while (true) {\r\n        const action: ReturnType<typeof browserActions.Actions.list> = yield take(browserActions.ActionTypes.LIST_DIRECTORY);\r\n\r\n        const { name, path } = action.payload;\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n        const newPath = name !== undefined ? joinPaths(config, path, name) : path;\r\n        yield fork(fetchDirectoryListing, newPath);\r\n    }\r\n}\r\n\r\nfunction* fetchDirectoryListing(path: string) {\r\n    try {\r\n        const result: DirectoryListingResponse = yield call(getDirectoryListing, path);\r\n        if (result.status === \"ok\") {\r\n            yield put(browserActions.Actions.dirListing(result.path, result.dirs, result.files, result.drives, result.places));\r\n        } else if (result.status === \"error\") {\r\n            const browserState: DirectoryBrowserState = yield select((state: RootReducer) => state.browser);\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            const alternative = result.alternative ? result.alternative : browserState.places.home.path;\r\n            // Don't show an error, if it's due to last recent directory not being available\r\n            const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n            if (config.cwd !== path) {\r\n              yield put(browserActions.Actions.error(`Error browsing directory: ${result.msg}`, timestamp, id));\r\n            }\r\n            yield put(browserActions.Actions.list(alternative));\r\n        }\r\n    } catch (e) {\r\n        const browserState: DirectoryBrowserState = yield select((state: RootReducer) => state.browser);\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(browserActions.Actions.error(`Error browsing directory: ${e.toString()}`, timestamp, id));\r\n        yield put(browserActions.Actions.list(browserState.places.home.path));\r\n    }\r\n}\r\n\r\nfunction* fetchDirectoryListOnOpen() {\r\n    while (true) {\r\n        yield take(browserActions.ActionTypes.OPEN);\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n        yield put(browserActions.Actions.list(config.cwd));\r\n    }\r\n}\r\n","import { ActionCreatorsMapObject } from \"redux\";\r\nimport { AnalysisDetails, CompoundAnalysisDetails, FollowupPart, MsgPartAnalysis, MsgPartCompoundAnalysis, MsgPartInitialDataset, MsgPartJob } from \"../messages\";\r\n\r\nexport interface Message<T extends string> {\r\n    messageType: T\r\n}\r\n\r\nexport function createMessage<T extends string, O>(messageType: T, attribs: O) {\r\n    return Object.assign({ messageType }, attribs);\r\n}\r\n\r\nexport enum MessageTypes {\r\n    INITIAL_STATE = \"INITIAL_STATE\",\r\n    JOB_STARTED = \"JOB_STARTED\",\r\n    FINISH_JOB = \"FINISH_JOB\",\r\n    TASK_RESULT = \"TASK_RESULT\",\r\n    JOB_ERROR = \"JOB_ERROR\",\r\n    BINARY = \"BINARY\",\r\n    OPEN = \"OPEN\",\r\n    CLOSE = \"CLOSE\",\r\n    ERROR = \"ERROR\",\r\n    DELETE_DATASET = \"DELETE_DATASET\",\r\n    CREATE_DATASET = \"CREATE_DATASET\",\r\n    CANCEL_JOB_DONE = \"CANCEL_JOB_DONE\",\r\n    ANALYSIS_CREATED = \"ANALYSIS_CREATED\",\r\n    ANALYSIS_UPDATED = \"ANALYSIS_UPDATED\",\r\n    ANALYSIS_REMOVED = \"ANALYSIS_REMOVED\",\r\n    COMPOUND_ANALYSIS_CREATED = \"COMPOUND_ANALYSIS_CREATED\",\r\n    COMPOUND_ANALYSIS_UPDATED = \"COMPOUND_ANALYSIS_UPDATED\",\r\n    COMPOUND_ANALYSIS_REMOVED = \"COMPOUND_ANALYSIS_REMOVED\",\r\n}\r\n\r\nexport const Messages = {\r\n    initialState: (\r\n        jobs: MsgPartJob[],\r\n        datasets: MsgPartInitialDataset[],\r\n        analyses: MsgPartAnalysis[],\r\n        compoundAnalyses: MsgPartCompoundAnalysis[]\r\n    ) => createMessage(MessageTypes.INITIAL_STATE, {\r\n        jobs, datasets, compoundAnalyses, analyses,\r\n    }),\r\n\r\n    startJob: (job: string, dataset: string) => createMessage(MessageTypes.JOB_STARTED, { job, dataset }),\r\n    finishJob: (job: string, followup: FollowupPart) => createMessage(MessageTypes.FINISH_JOB, { job, followup }),\r\n    taskResult: (job: string, followup: FollowupPart) => createMessage(MessageTypes.TASK_RESULT, { job, followup }),\r\n    jobError: (job: string, msg: string) => createMessage(MessageTypes.JOB_ERROR, { job, msg }),\r\n    binary: (objectURL: string) => createMessage(MessageTypes.BINARY, { objectURL }),\r\n    open: () => createMessage(MessageTypes.OPEN, {}),\r\n    close: () => createMessage(MessageTypes.CLOSE, {}),\r\n    error: (msg: string) => createMessage(MessageTypes.ERROR, { msg }),\r\n    deleteDataset: (dataset: string) => createMessage(MessageTypes.DELETE_DATASET, { dataset }),\r\n    cancelled: (job: string) => createMessage(MessageTypes.CANCEL_JOB_DONE, { job }),\r\n    analysisCreated: (analysis: string, dataset: string, details: AnalysisDetails) => createMessage(MessageTypes.ANALYSIS_CREATED, { dataset, analysis, details }),\r\n    analysisUpdated: (analysis: string, dataset: string, details: AnalysisDetails) => createMessage(MessageTypes.ANALYSIS_UPDATED, { dataset, analysis, details }),\r\n    analysisRemoved: (analysis: string) => createMessage(MessageTypes.ANALYSIS_REMOVED, { analysis }),\r\n\r\n    compoundAnalysisCreated: (compoundAnalysis: string, dataset: string, details: CompoundAnalysisDetails) => createMessage(MessageTypes.COMPOUND_ANALYSIS_CREATED, { dataset, compoundAnalysis, details }),\r\n    compoundAnalysisUpdated: (compoundAnalysis: string, dataset: string, details: CompoundAnalysisDetails) => createMessage(MessageTypes.COMPOUND_ANALYSIS_UPDATED, { dataset, compoundAnalysis, details }),\r\n    compoundAnalysisRemoved: (compoundAnalysis: string) => createMessage(MessageTypes.ANALYSIS_REMOVED, { compoundAnalysis }),\r\n}\r\n\r\nexport type MessagesUnion<A extends ActionCreatorsMapObject> = ReturnType<A[keyof A]>\r\nexport type Messages = MessagesUnion<typeof Messages>;\r\n\r\n// types of messages sent by the server:\r\n/*\r\nexport type InitialStateMessage = ReturnType<typeof Messages.initialState>;\r\nexport type StartJobMessage = ReturnType<typeof Messages.startJob>;\r\nexport type FinishJobMessage = ReturnType<typeof Messages.finishJob>;\r\nexport type TaskResultMessage = ReturnType<typeof Messages.taskResult>;\r\n*/\r\n\r\nexport type BinaryMessage = ReturnType<typeof Messages.binary>;","import { END, eventChannel, EventChannel } from \"redux-saga\";\r\nimport { call, delay, fork, put, take } from \"redux-saga/effects\";\r\nimport uuid from 'uuid/v4';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { getApiWSURL } from \"../helpers/apiHelpers\";\r\nimport * as channelActions from \"./actions\";\r\nimport * as channelMessages from './messages';\r\n\r\ntype SocketChannel = EventChannel<channelMessages.Messages>;\r\n\r\n\r\n/**\r\n * create typesafe messages from the websocket messages\r\n * \r\n * also creates some synthetic events like open, close, error\r\n */\r\nfunction createWebSocketChannel(/* addr */): SocketChannel {\r\n    return eventChannel(emit => {\r\n        function onMessage(msg: MessageEvent) {\r\n            if (msg.data instanceof Blob) {\r\n                // TODO: cleanup createObjectURL results somewhere\r\n                emit(channelMessages.Messages.binary(URL.createObjectURL(msg.data)));\r\n            } else {\r\n                const parsed = JSON.parse(msg.data) as channelMessages.Messages;\r\n                emit(parsed);\r\n            }\r\n        }\r\n\r\n        function onOpen() {\r\n            emit(channelMessages.Messages.open());\r\n        }\r\n\r\n        function onClose() {\r\n            emit(channelMessages.Messages.close());\r\n            emit(END);\r\n        }\r\n\r\n        function onError(err: Event) {\r\n            emit(channelMessages.Messages.error(\"Error in weboscket connection\"));\r\n        }\r\n\r\n        const ws = new WebSocket(getApiWSURL());\r\n        ws.addEventListener(\"message\", onMessage);\r\n        ws.addEventListener(\"open\", onOpen);\r\n        ws.addEventListener(\"close\", onClose);\r\n        ws.addEventListener(\"error\", onError);\r\n\r\n        // return cleanup function:\r\n        return () => {\r\n            ws.removeEventListener(\"message\", onMessage);\r\n            ws.removeEventListener(\"open\", onOpen);\r\n            ws.removeEventListener(\"close\", onClose);\r\n            ws.removeEventListener(\"error\", onError);\r\n            // TODO: close connection if still open\r\n            // (or is it guaranteed that if an error was thrown, the connection is closed?)\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * handles the connection lifecycle for our websocket\r\n */\r\nexport function* webSocketSaga() {\r\n    while (true) {\r\n        const socketChannel = yield call(createWebSocketChannel);\r\n        yield fork(actionsFromChannel, socketChannel);\r\n        const action: channelActions.Actions = yield take([\r\n            channelActions.ActionTypes.OPEN,\r\n            channelActions.ActionTypes.CLOSE,\r\n        ]);\r\n        if (action.type === channelActions.ActionTypes.OPEN) {\r\n            yield take([\r\n                channelActions.ActionTypes.CLOSE,\r\n                channelActions.ActionTypes.ERROR,\r\n            ]);\r\n        }\r\n        yield delay(1000);\r\n    }\r\n}\r\n\r\n/**\r\n * translates the messages from the channel to redux actions, handles aggregation etc.\r\n */\r\nexport function* actionsFromChannel(socketChannel: SocketChannel) {\r\n    try {\r\n        while (true) {\r\n            const msg = yield take(socketChannel);\r\n            const timestamp = Date.now();\r\n            switch (msg.messageType) {\r\n                case channelMessages.MessageTypes.OPEN: {\r\n                    yield put(channelActions.Actions.open(timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.CLOSE: {\r\n                    yield put(channelActions.Actions.close(timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.ERROR: {\r\n                    const id = uuid();\r\n                    yield put(channelActions.Actions.error(msg.msg, timestamp, id));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.INITIAL_STATE: {\r\n                    yield put(channelActions.Actions.initialState(msg.jobs, msg.datasets, msg.compoundAnalyses, msg.analyses, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.JOB_STARTED: {\r\n                    yield put(channelActions.Actions.jobStarted(msg.job, msg.details.dataset, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.FINISH_JOB: {\r\n                    yield call(handleFinishJob, msg, socketChannel, timestamp);\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.TASK_RESULT: {\r\n                    yield call(handleTaskResult, msg, socketChannel, timestamp);\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.CREATE_DATASET: {\r\n                    yield put(datasetActions.Actions.created(msg.details));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.DELETE_DATASET: {\r\n                    yield put(datasetActions.Actions.deleted(msg.dataset));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.JOB_ERROR: {\r\n                    const id = uuid();\r\n                    yield put(channelActions.Actions.jobError(msg.job, msg.msg, id, timestamp));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.CANCEL_JOB_DONE: {\r\n                    yield put(channelActions.Actions.cancelled(msg.job));\r\n                    break;\r\n                }\r\n                /*\r\n                // FIXME: server needs to know about compount analyses\r\n                case channelMessages.MessageTypes.ANALYSIS_CREATED: {\r\n                    yield put(channelActions.Actions.analysisCreated(\r\n                        msg.analysis,\r\n                        msg.dataset,\r\n                        msg.details,\r\n                    ));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.ANALYSIS_UPDATED: {\r\n                    yield put(channelActions.Actions.analysisUpdated(\r\n                        msg.analysis,\r\n                        msg.dataset,\r\n                        msg.details,\r\n                    ));\r\n                    break;\r\n                }\r\n                case channelMessages.MessageTypes.ANALYSIS_REMOVED: {\r\n                    yield put(channelActions.Actions.analysisRemoved(\r\n                        msg.analysis,\r\n                    ));\r\n                    break;\r\n                }\r\n                */\r\n            }\r\n        }\r\n    } finally {\r\n        // disconnected\r\n    }\r\n}\r\n\r\nexport function* handleBinaryParts(numParts: number, socketChannel: SocketChannel) {\r\n    const parts: channelMessages.BinaryMessage[] = [];\r\n    while (parts.length < numParts) {\r\n        const binMsg = yield take(socketChannel)\r\n        parts.push(binMsg);\r\n    }\r\n    return parts;\r\n}\r\n\r\nexport function* handleTaskResult(msg: ReturnType<typeof channelMessages.Messages.taskResult>, socketChannel: SocketChannel, timestamp: number) {\r\n    const parts: channelMessages.BinaryMessage[] = yield call(handleBinaryParts, msg.followup.numMessages, socketChannel);\r\n    const images = parts.map((part, idx) => ({ imageURL: part.objectURL, description: msg.followup.descriptions[idx] }));\r\n    yield put(channelActions.Actions.taskResult(msg.job, images, timestamp));\r\n}\r\n\r\nexport function* handleFinishJob(msg: ReturnType<typeof channelMessages.Messages.finishJob>, socketChannel: SocketChannel, timestamp: number) {\r\n    const parts: channelMessages.BinaryMessage[] = yield call(handleBinaryParts, msg.followup.numMessages, socketChannel);\r\n    const images = parts.map((part, idx) => ({ imageURL: part.objectURL, description: msg.followup.descriptions[idx] }));\r\n    yield put(channelActions.Actions.finishJob(msg.job, images, timestamp));\r\n}","import { genericPut, getApiBasePath } from \"../helpers/apiHelpers\";\r\nimport { ConnectRequest, ConnectRequestParams, ConnectResponse } from \"../messages\";\r\n\r\nexport async function connectToCluster(params: ConnectRequestParams): Promise<ConnectResponse> {\r\n    const payload: ConnectRequest = {\r\n        connection: params\r\n    }\r\n    return await genericPut(\"config/connection/\", payload);\r\n}\r\n\r\nexport async function checkClusterConnection(): Promise<ConnectResponse> {\r\n    const basePath = getApiBasePath();\r\n    const r = await fetch(`${basePath}config/connection/`, {\r\n        method: 'GET',\r\n    });\r\n    return await r.json();\r\n}","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\nimport { AnalysisDetails, AnalysisTypes } from \"../messages\";\r\nimport { AnalysisState } from \"./types\";\r\n\r\n\r\nexport enum ActionTypes {\r\n    CREATE = 'ANALYSIS_CREATE',\r\n    CREATED = 'ANALYSIS_CREATED',\r\n    UPDATED = 'ANALYSIS_UPDATED',\r\n    REMOVE = 'ANALYSIS_REMOVE',\r\n    REMOVED = 'ANALYSIS_REMOVED',\r\n    ERROR = 'ANALYSIS_ERROR',\r\n}\r\n\r\nexport const Actions = {\r\n    create: (\r\n        dataset: string, analysisType: AnalysisTypes\r\n    ) => createAction(ActionTypes.CREATE, { dataset, analysisType }),\r\n\r\n    created: (\r\n        analysis: AnalysisState, compoundAnalysis: string, analysisIndex: number\r\n    ) => createAction(ActionTypes.CREATED, {\r\n        analysis, compoundAnalysis, analysisIndex\r\n    }),\r\n\r\n    updated: (\r\n        id: string, details: AnalysisDetails\r\n    ) => createAction(ActionTypes.UPDATED, { id, details }),\r\n\r\n    remove: (id: string) => createAction(ActionTypes.REMOVE, { id }),\r\n    removed: (id: string) => createAction(ActionTypes.REMOVED, { id }),\r\n    error: (\r\n        msg: string, timestamp: number, id: string\r\n    ) => createAction(ActionTypes.ERROR, { msg, timestamp, id }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n\r\nexport type ActionParts = {\r\n    [K in keyof typeof Actions]: ReturnType<typeof Actions[K]>\r\n}\r\n","import { all, call, put, take, takeEvery } from \"redux-saga/effects\";\r\nimport uuid from 'uuid/v4';\r\nimport * as channelActions from '../channel/actions';\r\nimport { ConnectResponse } from \"../messages\";\r\nimport * as clusterActions from './actions';\r\nimport { checkClusterConnection, connectToCluster } from \"./api\";\r\n\r\nfunction* connectSaga(action: ReturnType<typeof clusterActions.Actions.connect>) {\r\n    yield put(clusterActions.Actions.connecting())\r\n    const conn: ConnectResponse = yield call(connectToCluster, action.payload.params);\r\n    yield call(putClusterStatus, conn);\r\n}\r\n\r\nfunction* putClusterStatus(conn: ConnectResponse) {\r\n    if (conn.status === \"ok\") {\r\n        yield put(clusterActions.Actions.connected(conn.connection.connection));\r\n    } else if (conn.status === \"error\") {\r\n        yield put(clusterActions.Actions.notConnected());\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(clusterActions.Actions.error(`error connecting to cluster: ${conn.msg}`,timestamp, id));\r\n    } else {\r\n        yield put(clusterActions.Actions.notConnected());\r\n    }\r\n}\r\n\r\n/**\r\n * when the channel is connected, check if cluster is connected and update status accordingly\r\n */\r\nfunction* trackClusterConnection() {\r\n    while (true) {\r\n        yield take(channelActions.ActionTypes.OPEN)\r\n        const conn: ConnectResponse = yield call(checkClusterConnection);\r\n        yield call(putClusterStatus, conn);\r\n    }\r\n}\r\n\r\nexport function* clusterConnectionSaga() {\r\n    yield takeEvery(clusterActions.ActionTypes.CONNECT, connectSaga);\r\n    yield all([\r\n        trackClusterConnection(),\r\n    ])\r\n}","import { ActionsUnion, createAction } from \"../helpers/actionHelpers\";\r\n\r\nexport enum ActionTypes {\r\n    CREATE = 'JOB_CREATE',\r\n}\r\n\r\nexport const Actions = {\r\n    create: (id: string, analysis: string, timestamp: number) => createAction(ActionTypes.CREATE, { id, analysis, timestamp }),\r\n}\r\n\r\nexport type Actions = ActionsUnion<typeof Actions>;\r\n\r\nexport type ActionParts = {\r\n    [K in keyof typeof Actions]: ReturnType<typeof Actions[K]>\r\n}","import { genericDelete, genericPut } from \"../helpers/apiHelpers\";\r\nimport { CancelJobResponse, StartJobRequest, StartJobResponse } from \"../messages\";\r\n\r\nexport async function startJob(jobId: string, analysis: string): Promise<StartJobResponse> {\r\n    const payload: StartJobRequest = {\r\n        job: {\r\n            analysis,\r\n        }\r\n    }\r\n    return await genericPut(`jobs/${jobId}/`, payload);\r\n}\r\n\r\nexport async function cancelJob(jobId: string): Promise<CancelJobResponse> {\r\n    return await genericDelete(`jobs/${jobId}/`);\r\n}\r\n\r\n\r\n","import { genericDelete, genericPut } from \"../helpers/apiHelpers\";\r\nimport { AnalysisDetails, CompoundAnalysisDetails, CreateAnalysisResponse, CreateCompoundAnalysisResponse, CreateOrUpdateAnalysisRequest, CreateOrUpdateCompoundAnalysisRequest, RemoveAnalysisResponse, RemoveCompoundAnalysisResponse } from \"../messages\";\r\n\r\nexport async function createOrUpdateAnalysis(\r\n    compoundAnalysisId: string, analysisId: string,\r\n    dataset: string, details: AnalysisDetails\r\n): Promise<CreateAnalysisResponse> {\r\n    const payload: CreateOrUpdateAnalysisRequest = {\r\n        dataset,\r\n        details,\r\n    };\r\n    return await genericPut(`compoundAnalyses/${compoundAnalysisId}/analyses/${analysisId}/`, payload);\r\n}\r\n\r\nexport async function removeAnalysis(compoundAnalysisId: string, analysisId: string): Promise<RemoveAnalysisResponse> {\r\n    return await genericDelete(`compoundAnalyses/${compoundAnalysisId}/analyses/${analysisId}/`)\r\n}\r\n\r\nexport async function createOrUpdateCompoundAnalysis(compoundAnalysisId: string, dataset: string, details: CompoundAnalysisDetails): Promise<CreateCompoundAnalysisResponse> {\r\n    const payload: CreateOrUpdateCompoundAnalysisRequest = {\r\n        dataset,\r\n        details,\r\n    };\r\n    return await genericPut(`compoundAnalyses/${compoundAnalysisId}/`, payload);\r\n}\r\n\r\nexport async function removeCompoundAnalysis(compoundAnalysisId: string): Promise<RemoveCompoundAnalysisResponse> {\r\n    return await genericDelete(`compoundAnalyses/${compoundAnalysisId}/`)\r\n}\r\n","import { buffers, Task } from 'redux-saga';\r\nimport { actionChannel, call, cancel, fork, put, select, take, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as analysisActions from '../analysis/actions';\r\nimport { AnalysisState } from '../analysis/types';\r\nimport * as channelActions from '../channel/actions';\r\nimport * as jobActions from '../job/actions';\r\nimport { cancelJob, startJob } from '../job/api';\r\nimport { JobState } from '../job/types';\r\nimport { AnalysisDetails, DatasetState, DatasetStatus } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as compoundAnalysisActions from './actions';\r\nimport { createOrUpdateAnalysis, createOrUpdateCompoundAnalysis, removeAnalysis, removeCompoundAnalysis } from \"./api\";\r\nimport { CompoundAnalysis, CompoundAnalysisState } from './types';\r\n\r\nfunction selectDataset(state: RootReducer, dataset: string) {\r\n    return state.datasets.byId[dataset];\r\n}\r\n\r\nfunction selectCompoundAnalysis(state: RootReducer, id: string) {\r\n    return state.compoundAnalyses.byId[id];\r\n}\r\n\r\nfunction selectAnalysis(state: RootReducer, id: string) {\r\n    return state.analyses.byId[id];\r\n}\r\n\r\nfunction selectJob(state: RootReducer, id: string) {\r\n    return state.jobs.byId[id];\r\n}\r\n\r\nexport function* cleanupOnRemove(compoundAnalysis: CompoundAnalysis, sidecarTask: Task) {\r\n    while (true) {\r\n        const removeAction: ReturnType<typeof compoundAnalysisActions.Actions.remove> = yield take(compoundAnalysisActions.ActionTypes.REMOVE);\r\n        if (removeAction.payload.id === compoundAnalysis.compoundAnalysis) {\r\n            yield cancel(sidecarTask);\r\n        }\r\n    }\r\n}\r\n\r\nexport function* createCompoundAnalysisSaga(action: ReturnType<typeof compoundAnalysisActions.Actions.create>) {\r\n    try {\r\n        const datasetState: DatasetState = yield select(selectDataset, action.payload.dataset)\r\n        if (datasetState.status !== DatasetStatus.OPEN) {\r\n            throw new Error(\"invalid dataset status\");\r\n        }\r\n        const compoundAnalysis: CompoundAnalysis = {\r\n            compoundAnalysis: uuid(),\r\n            dataset: action.payload.dataset,\r\n            details: {\r\n                mainType: action.payload.analysisType,\r\n                analyses: [],\r\n            }\r\n        }\r\n\r\n        yield call(\r\n            createOrUpdateCompoundAnalysis,\r\n            compoundAnalysis.compoundAnalysis,\r\n            compoundAnalysis.dataset,\r\n            compoundAnalysis.details,\r\n        );\r\n\r\n        const sidecarTask = yield fork(analysisSidecar, compoundAnalysis.compoundAnalysis, { doAutoStart: true });\r\n\r\n        yield put(compoundAnalysisActions.Actions.created(compoundAnalysis, true));\r\n        yield fork(cleanupOnRemove, compoundAnalysis, sidecarTask);\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(compoundAnalysisActions.Actions.error(`Error creating analysis: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* createFromServerState(action: ReturnType<typeof channelActions.Actions.initialState>) {\r\n    for (const msgPart of action.payload.compoundAnalyses) {\r\n        const compoundAnalysis: CompoundAnalysisState = yield select(selectCompoundAnalysis, msgPart.compoundAnalysis);\r\n        const sidecarTask = yield fork(analysisSidecar, compoundAnalysis.compoundAnalysis, { doAutoStart: false });\r\n        yield fork(cleanupOnRemove, compoundAnalysis, sidecarTask);\r\n    }\r\n}\r\n\r\nexport function* cancelOldJob(analysis: AnalysisState, jobIndex: number) {\r\n    const jobId = analysis.jobs[jobIndex];\r\n    if (jobId === undefined) {\r\n        return;\r\n    } else {\r\n        const job: JobState = yield select(selectJob, jobId);\r\n        if (job.running !== \"DONE\") {\r\n            yield call(cancelJob, jobId);\r\n        }\r\n    }\r\n}\r\n\r\nexport function* createOrUpdate(\r\n    compoundAnalysis: CompoundAnalysisState, analysisId: string | undefined,\r\n    analysisIndex: number, details: AnalysisDetails\r\n) {\r\n    if (analysisId) {\r\n        // update the analysis on the server:\r\n        yield call(createOrUpdateAnalysis,\r\n            compoundAnalysis.compoundAnalysis, analysisId,\r\n            compoundAnalysis.dataset, details\r\n        );\r\n        yield put(analysisActions.Actions.updated(analysisId, details));\r\n\r\n        const analysis: AnalysisState = yield select(selectAnalysis, analysisId);\r\n        const jobs = analysis.jobs ? analysis.jobs : [];\r\n\r\n        for (const oldJobId of jobs) {\r\n            const job: JobState = yield select(selectJob, oldJobId);\r\n            if (job && job.running !== \"DONE\") {\r\n                // wait until the job is cancelled:\r\n                yield call(cancelJob, oldJobId);\r\n            }\r\n        }\r\n        return analysisId;\r\n    } else {\r\n        // create the analysis on the server:\r\n        const newAnalysisId = uuid();\r\n        yield call(createOrUpdateAnalysis,\r\n            compoundAnalysis.compoundAnalysis, newAnalysisId,\r\n            compoundAnalysis.dataset, details\r\n        );\r\n        yield put(analysisActions.Actions.created({\r\n            id: newAnalysisId,\r\n            dataset: compoundAnalysis.dataset,\r\n            details,\r\n            jobs: [],\r\n        }, compoundAnalysis.compoundAnalysis, analysisIndex));\r\n\r\n        const updatedCompoundAnalysis = yield select(selectCompoundAnalysis, compoundAnalysis.compoundAnalysis);\r\n\r\n        yield call(\r\n            createOrUpdateCompoundAnalysis,\r\n            updatedCompoundAnalysis.compoundAnalysis,\r\n            updatedCompoundAnalysis.dataset,\r\n            updatedCompoundAnalysis.details,\r\n        );\r\n        return newAnalysisId;\r\n    }\r\n}\r\n\r\nexport function* analysisSidecar(compoundAnalysisId: string, options: { doAutoStart: boolean }) {\r\n    // channel for incoming actions:\r\n    // all actions that arrive while we block in `call` will be buffered here.\r\n    // because the buffer is sliding of size 1, we only keep the latest action!\r\n    const runOrParamsChannel = yield actionChannel(compoundAnalysisActions.ActionTypes.RUN, buffers.sliding(2));\r\n\r\n    while (true) {\r\n        try {\r\n            const action: compoundAnalysisActions.ActionParts[\"run\"] = yield take(runOrParamsChannel);\r\n\r\n            // ignore actions meant for other analyses\r\n            if (action.payload.id !== compoundAnalysisId) {\r\n                continue;\r\n            }\r\n\r\n            // get the current state incl. configuration\r\n            const compoundAnalysis: CompoundAnalysisState = yield select(selectCompoundAnalysis, compoundAnalysisId);\r\n            const { analysisIndex, details } = action.payload;\r\n\r\n            const existingAnalysisId = compoundAnalysis.details.analyses[analysisIndex];\r\n            const analysisId = yield call(createOrUpdate, compoundAnalysis, existingAnalysisId, analysisIndex, details);\r\n\r\n            // prepare running the job:\r\n            const jobId = uuid();\r\n            yield put(jobActions.Actions.create(jobId, analysisId, Date.now()));\r\n\r\n            // FIXME: we have a race here, as the websocket msg FINISH_JOB may\r\n            // arrive before call(startJob, ...) returns. this causes the apply button\r\n            // to feel unresponsive (the action gets done, but only after we finish here...)\r\n            // best reproduced in \"Slow 3G\" network simulation mode in devtools\r\n\r\n            // wait until the job is started\r\n            yield call(startJob, jobId, analysisId);\r\n            yield put(compoundAnalysisActions.Actions.running(compoundAnalysis.compoundAnalysis, jobId, analysisIndex));\r\n            // tslint:disable-next-line:no-empty\r\n        } catch (e) {\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            yield put(compoundAnalysisActions.Actions.error(`Error running analysis: ${e.toString()}`, timestamp, id));\r\n        }\r\n    }\r\n}\r\n\r\nfunction* removeJobsForAnalysis(analysis: AnalysisState) {\r\n    for (const oldJobId of analysis.jobs) {\r\n        const job: JobState = yield select(selectJob, oldJobId);\r\n        if (job && job.running !== \"DONE\") {\r\n            // wait until the job is cancelled:\r\n            yield call(cancelJob, oldJobId);\r\n        }\r\n    }\r\n}\r\n\r\nexport function* doRemoveAnalysisSaga(action: ReturnType<typeof compoundAnalysisActions.Actions.remove>) {\r\n    const compoundAnalysis: CompoundAnalysisState = yield select(selectCompoundAnalysis, action.payload.id);\r\n    try {\r\n        for (const analysisId of compoundAnalysis.details.analyses) {\r\n            const analysis: AnalysisState = yield select(selectAnalysis, analysisId);\r\n            yield call(removeJobsForAnalysis, analysis);\r\n            yield call(removeAnalysis, compoundAnalysis.compoundAnalysis, analysisId);\r\n            yield put(analysisActions.Actions.removed(analysisId));\r\n        }\r\n        yield call(removeCompoundAnalysis, action.payload.id);\r\n    } finally {\r\n        yield put(compoundAnalysisActions.Actions.removed(action.payload.id));\r\n    }\r\n}\r\n\r\nexport function* analysisRootSaga() {\r\n    yield takeEvery(compoundAnalysisActions.ActionTypes.CREATE, createCompoundAnalysisSaga);\r\n    yield takeEvery(compoundAnalysisActions.ActionTypes.REMOVE, doRemoveAnalysisSaga);\r\n    yield takeEvery(channelActions.ActionTypes.INITIAL_STATE, createFromServerState);\r\n}","import { getApiBasePath } from \"../helpers/apiHelpers\";\r\nimport { GetConfigResponse } from \"../messages\";\r\n\r\nexport async function getConfig(): Promise<GetConfigResponse> {\r\n    const basePath = getApiBasePath();\r\n    const r = await fetch(`${basePath}config/`, {\r\n        method: \"GET\",\r\n        credentials: \"same-origin\",\r\n    });\r\n    return await r.json();\r\n}","import { call, fork, put, select, take, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as browserActions from '../browser/actions';\r\nimport * as channelActions from '../channel/actions';\r\nimport * as clusterActions from '../cluster/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { GetConfigResponse } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as configActions from './actions';\r\nimport { getConfig } from './api';\r\nimport { clearLocalStorage, getDefaultLocalConfig, mergeLocalStorage, setLocalStorage } from './helpers';\r\nimport { ConfigState } from './reducers';\r\n\r\nfunction* getConfigOnReconnect() {\r\n    yield takeEvery(channelActions.ActionTypes.OPEN, getConfigSaga);\r\n}\r\n\r\n/**\r\n * get config from server and try to merge in the localStorage config\r\n */\r\nfunction* getConfigSaga() {\r\n    yield put(configActions.Actions.fetch());\r\n    const configResponse: GetConfigResponse = yield call(getConfig);\r\n    try {\r\n        const mergedConfig = mergeLocalStorage(configResponse.config);\r\n        yield put(configActions.Actions.fetched(mergedConfig));\r\n    } catch (e) {\r\n        try {\r\n            clearLocalStorage();\r\n            // tslint:disable-next-line:no-empty\r\n        } catch (e) { }\r\n        const defaultConfig = Object.assign({}, configResponse.config, getDefaultLocalConfig());\r\n        yield put(configActions.Actions.fetched(defaultConfig));\r\n    }\r\n}\r\n\r\n/**\r\n * update localStorage config on opening files or using the file browser\r\n */\r\nfunction* updateLocalStorageConfig() {\r\n    while (true) {\r\n        yield take([\r\n            datasetActions.ActionTypes.CREATE,\r\n            browserActions.ActionTypes.DIRECTORY_LISTING,\r\n            clusterActions.ActionTypes.CONNECTED,\r\n            configActions.ActionTypes.TOGGLE_STAR,\r\n        ]);\r\n        const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n        setLocalStorage(config);\r\n    }\r\n}\r\n\r\nexport function* firstConfigFetch() {\r\n    try {\r\n        yield call(getConfigSaga);\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(configActions.Actions.fetchFailed(`failed to fetch config: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* configRootSaga() {\r\n    yield fork(firstConfigFetch);\r\n    yield fork(getConfigOnReconnect);\r\n    yield fork(updateLocalStorageConfig);\r\n}","import { call, put, select, takeEvery } from 'redux-saga/effects';\r\nimport uuid from 'uuid/v4';\r\nimport * as browserActions from '../browser/actions';\r\nimport { joinPaths } from '../config/helpers';\r\nimport { ConfigState } from '../config/reducers';\r\nimport { DetectDatasetResponse, OpenDatasetResponse } from '../messages';\r\nimport { RootReducer } from '../store';\r\nimport * as datasetActions from \"./actions\";\r\nimport { deleteDataset, detectDataset, openDataset } from './api';\r\nimport { isKnownDatasetType } from './helpers';\r\n\r\n\r\nexport function* createDatasetSaga(action: ReturnType<typeof datasetActions.Actions.create>) {\r\n    try {\r\n        const resp: OpenDatasetResponse = yield call(openDataset, action.payload.dataset.id, { dataset: action.payload.dataset });\r\n        if (resp.status === \"ok\") {\r\n            yield put(datasetActions.Actions.created(resp.details));\r\n        } else if (resp.status === \"error\") {\r\n            const timestamp = Date.now();\r\n            const id = uuid();\r\n            yield put(datasetActions.Actions.error(resp.dataset, resp.msg, timestamp, id));\r\n        }\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(datasetActions.Actions.error(action.payload.dataset.id, `Error loading dataset: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* deleteDatasetSaga(action: ReturnType<typeof datasetActions.Actions.delete>) {\r\n    try {\r\n        yield call(deleteDataset, action.payload.dataset);\r\n    } catch (e) {\r\n        const timestamp = Date.now();\r\n        const id = uuid();\r\n        yield put(datasetActions.Actions.error(action.payload.dataset, `Error closing dataset: ${e.toString()}`, timestamp, id));\r\n    }\r\n}\r\n\r\nexport function* doDetectDataset(fullPath: string) {\r\n    yield put(datasetActions.Actions.detect(fullPath));\r\n    const detectResult: DetectDatasetResponse = yield call(detectDataset, fullPath);\r\n    let detectedParams;\r\n    let shouldOpen = true;\r\n    if (detectResult.status === \"ok\") {\r\n        if (isKnownDatasetType(detectResult.datasetParams.type)) {\r\n          detectedParams = detectResult.datasetParams;\r\n          yield put(datasetActions.Actions.detected(fullPath, detectResult.datasetParams));\r\n        }\r\n        else {\r\n          const timestamp = Date.now();\r\n          const id = uuid();\r\n          yield put(datasetActions.Actions.detectFailed(fullPath));\r\n          shouldOpen = false;\r\n          yield put(datasetActions.Actions.error(id, detectResult.datasetParams.type + ` dataset type is currently not supported in the GUI`, timestamp, id));\r\n        }\r\n    } else {\r\n        yield put(datasetActions.Actions.detectFailed(fullPath));\r\n    }\r\n    return [detectedParams, shouldOpen];\r\n}\r\n\r\nexport function* doOpenDataset(fullPath: string) {\r\n    const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n    const cachedParams = config.lastOpened[fullPath];\r\n    let detectedParams;\r\n    let shouldOpen = true;\r\n    try {\r\n      const doDetectDatasetRes = yield call(doDetectDataset, fullPath);\r\n      detectedParams = doDetectDatasetRes[0];\r\n      shouldOpen = doDetectDatasetRes[1];\r\n    } catch (e) {\r\n        yield put(datasetActions.Actions.detectFailed(fullPath));\r\n    }\r\n    if(shouldOpen) {\r\n      yield put(datasetActions.Actions.open(fullPath, cachedParams, detectedParams));\r\n    }\r\n}\r\n\r\nexport function* openDatasetSagaFullPath(action: ReturnType<typeof browserActions.Actions.selectFullPath>) {\r\n    const fullPath = action.payload.path;\r\n    yield call(doOpenDataset, fullPath);\r\n}\r\n\r\nexport function* openDatasetSaga(action: ReturnType<typeof browserActions.Actions.select>) {\r\n    const config: ConfigState = yield select((state: RootReducer) => state.config);\r\n    const fullPath = joinPaths(config, action.payload.path, action.payload.name);\r\n    yield call(doOpenDataset, fullPath);\r\n}\r\n\r\nexport function* datasetRootSaga() {\r\n    yield takeEvery(datasetActions.ActionTypes.CREATE, createDatasetSaga);\r\n    yield takeEvery(datasetActions.ActionTypes.DELETE, deleteDatasetSaga);\r\n    yield takeEvery(browserActions.ActionTypes.SELECT, openDatasetSaga);\r\n    yield takeEvery(browserActions.ActionTypes.SELECT_FULL_PATH, openDatasetSagaFullPath);\r\n}\r\n","import { all } from 'redux-saga/effects';\r\nimport { directoryListingSaga } from './browser/sagas';\r\nimport { webSocketSaga } from './channel/sagas';\r\nimport { clusterConnectionSaga } from './cluster/sagas';\r\nimport { analysisRootSaga } from './compoundAnalysis/sagas';\r\nimport { configRootSaga } from './config/sagas';\r\nimport { datasetRootSaga } from './dataset/sagas';\r\n\r\nexport function* rootSaga() {\r\n    yield all([\r\n        configRootSaga(),\r\n        webSocketSaga(),\r\n        analysisRootSaga(),\r\n        datasetRootSaga(),\r\n        clusterConnectionSaga(),\r\n        directoryListingSaga(),\r\n    ]);\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { ById, constructById, filterWithPred, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport * as jobActions from '../job/actions';\r\nimport * as analysisActions from \"./actions\";\r\nimport { AnalysisState } from \"./types\";\r\n\r\n\r\nexport type AnalysisReducerState = ById<AnalysisState>;\r\n\r\nconst initialAnalysisState: AnalysisReducerState = {\r\n    byId: {},\r\n    ids: [],\r\n}\r\n\r\nexport function analysisReducer(state = initialAnalysisState, action: AllActions): AnalysisReducerState {\r\n    switch (action.type) {\r\n        case analysisActions.ActionTypes.CREATED: {\r\n            return insertById(state, action.payload.analysis.id, action.payload.analysis);\r\n        }\r\n        case analysisActions.ActionTypes.REMOVED: {\r\n            return filterWithPred(state, (r: AnalysisState) => r.id !== action.payload.id);\r\n        }\r\n        case analysisActions.ActionTypes.UPDATED: {\r\n            return updateById(state, action.payload.id, {\r\n                details: action.payload.details,\r\n            });\r\n        }\r\n        case jobActions.ActionTypes.CREATE: {\r\n            const analysis = state.byId[action.payload.analysis];\r\n            // FIXME: remove old jobs\r\n            const oldJobs = analysis.jobs ? analysis.jobs : [];\r\n            return updateById(state, action.payload.analysis, {\r\n                jobs: [action.payload.id, ...oldJobs],\r\n            })\r\n        }\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            const analysisState: AnalysisState[] = action.payload.analyses.map(item => {\r\n                return {\r\n                    doAutoStart: false,\r\n                    id: item.analysis,\r\n                    dataset: item.dataset,\r\n                    details: item.details,\r\n                    // FIXME: add jobs!\r\n                    jobs: item.jobs,\r\n                };\r\n            });\r\n            return {\r\n                byId: constructById(analysisState, analysis => analysis.id),\r\n                ids: action.payload.analyses.map(analysis => analysis.analysis),\r\n            }\r\n        }\r\n        case channelActions.ActionTypes.FINISH_JOB:\r\n        case channelActions.ActionTypes.TASK_RESULT: {\r\n            const analysisIdForJob = state.ids.find(id => {\r\n                const analysis = state.byId[id];\r\n                const jobs = analysis.jobs ? analysis.jobs : [];\r\n                return jobs.some(job => job === action.payload.job)\r\n            });\r\n            if (!analysisIdForJob) {\r\n                return state;\r\n            }\r\n            return updateById(state, analysisIdForJob, {\r\n                displayedJob: action.payload.job,\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n}\r\n","import { AllActions } from \"../actions\";\r\nimport * as configActions from '../config/actions';\r\nimport { DirectoryListingDetails, FSPlace } from \"../messages\";\r\nimport * as browserActions from './actions';\r\nimport { DirectoryBrowserState } from \"./types\";\r\n\r\nconst initialBrowserState: DirectoryBrowserState = {\r\n    isOpen: false,\r\n    isLoading: true,\r\n    path: \"/\",\r\n    drives: [],\r\n    places: {},\r\n    files: [] as DirectoryListingDetails[],\r\n    dirs: [] as DirectoryListingDetails[],\r\n}\r\n\r\nexport function directoryBrowserReducer(state: DirectoryBrowserState = initialBrowserState, action: AllActions): DirectoryBrowserState {\r\n    switch (action.type) {\r\n        case configActions.ActionTypes.FETCHED: {\r\n            return Object.assign({}, state, {\r\n                path: action.payload.config.cwd,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.OPEN: {\r\n            return Object.assign({}, state, {\r\n                isOpen: true,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.CANCEL: {\r\n            return Object.assign({}, state, {\r\n                isOpen: false,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.LIST_DIRECTORY: {\r\n            return Object.assign({}, state, {\r\n                isLoading: true,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.DIRECTORY_LISTING: {\r\n            const places = action.payload.places.reduce((acc, place: FSPlace) => {\r\n                return Object.assign({}, acc, {\r\n                    [place.key]: place,\r\n                })\r\n            }, {});\r\n            return Object.assign({}, state, {\r\n                isLoading: false,\r\n                path: action.payload.path,\r\n                files: action.payload.files,\r\n                dirs: action.payload.dirs,\r\n                drives: action.payload.drives,\r\n                places,\r\n            })\r\n        }\r\n        case browserActions.ActionTypes.SELECT_FULL_PATH:\r\n        case browserActions.ActionTypes.SELECT: {\r\n            return Object.assign({}, state, {\r\n                isLoading: false,\r\n                isOpen: false,\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from './actions';\r\n\r\nexport interface ChannelStatusReducer {\r\n    status: ChannelStatusCodes,\r\n}\r\n\r\nexport enum ChannelStatusCodes {\r\n    CONNECTING = \"connecting\",\r\n    CONNECTED = \"connected\",\r\n    READY = \"ready\",\r\n    WAITING = \"waiting\",\r\n}\r\n\r\nconst initialChannelState: ChannelStatusReducer = {\r\n    status: ChannelStatusCodes.WAITING,\r\n}\r\n\r\nexport function channelStatusReducer(state = initialChannelState, action: AllActions): ChannelStatusReducer {\r\n    switch (action.type) {\r\n        case channelActions.ActionTypes.OPEN: {\r\n            return { status: ChannelStatusCodes.CONNECTED };\r\n        }\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            return { status: ChannelStatusCodes.READY };\r\n        }\r\n        case channelActions.ActionTypes.CLOSE: {\r\n            return { status: ChannelStatusCodes.WAITING };\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport { ConnectRequestParams } from \"../messages\";\r\nimport * as clusterActions from './actions';\r\n\r\nexport type ClusterConnectionState = {\r\n    status: \"connected\",\r\n    params: ConnectRequestParams,\r\n} | {\r\n    status: \"disconnected\",\r\n} | {\r\n    status: \"unknown\",\r\n} | {\r\n    status: \"connecting\"\r\n}\r\n\r\nconst initialClusterConnectionState: ClusterConnectionState = {\r\n    status: \"unknown\"\r\n}\r\n\r\nexport function clusterConnectionReducer(state = initialClusterConnectionState, action: AllActions): ClusterConnectionState {\r\n    switch (action.type) {\r\n        case clusterActions.ActionTypes.NOT_CONNECTED: {\r\n            return {\r\n                status: \"disconnected\"\r\n            };\r\n        }\r\n        case clusterActions.ActionTypes.CONNECTED: {\r\n            return {\r\n                status: \"connected\",\r\n                params: action.payload.params,\r\n            }\r\n        }\r\n        case clusterActions.ActionTypes.CONNECTING: {\r\n            return {\r\n                status: \"connecting\"\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as analysisActions from \"../analysis/actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport * as datasetActions from \"../dataset/actions\";\r\nimport { ById, constructById, filterWithPred, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport * as compoundAnalysisActions from \"./actions\";\r\nimport { CompoundAnalysisState } from \"./types\";\r\n\r\nexport type CompoundAnalysisReducerState = ById<CompoundAnalysisState>;\r\n\r\nconst initialCompoundAnalysisState: CompoundAnalysisReducerState = {\r\n    byId: {},\r\n    ids: [],\r\n}\r\n\r\nexport function compoundAnalysisReducer(state = initialCompoundAnalysisState, action: AllActions): CompoundAnalysisReducerState {\r\n    switch (action.type) {\r\n        case compoundAnalysisActions.ActionTypes.CREATED: {\r\n            const newCompoundAnalysis = {\r\n                doAutoStart: action.payload.autoStart,\r\n                ...action.payload.compoundAnalysis,\r\n            }\r\n            return insertById(state, action.payload.compoundAnalysis.compoundAnalysis, newCompoundAnalysis);\r\n        }\r\n        case compoundAnalysisActions.ActionTypes.REMOVED: {\r\n            return filterWithPred(state, (r: CompoundAnalysisState) => r.compoundAnalysis !== action.payload.id);\r\n        }\r\n        case compoundAnalysisActions.ActionTypes.ENABLE_AUTOSTART: {\r\n            return updateById(state, action.payload.compoundAnalysisId, {\r\n                doAutoStart: true,\r\n            })\r\n        }\r\n        case datasetActions.ActionTypes.DELETE: {\r\n            return filterWithPred(state, (r: CompoundAnalysisState) => r.dataset !== action.payload.dataset);\r\n        }\r\n        case analysisActions.ActionTypes.CREATED: {\r\n            const compoundAnalysis = state.byId[action.payload.compoundAnalysis];\r\n            const newAnalyses = [...compoundAnalysis.details.analyses];\r\n            newAnalyses[action.payload.analysisIndex] = action.payload.analysis.id;\r\n            return updateById(state, action.payload.compoundAnalysis, {\r\n                details: {\r\n                    analyses: newAnalyses,\r\n                    mainType: compoundAnalysis.details.mainType,\r\n                }\r\n            });\r\n        }\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            const compoundAnalyses = action.payload.compoundAnalyses.map(ca => ({ doAutoStart: false, ...ca }));\r\n            return {\r\n                byId: constructById(compoundAnalyses, ca => ca.compoundAnalysis),\r\n                ids: compoundAnalyses.map(ca => ca.compoundAnalysis),\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as browserActions from '../browser/actions';\r\nimport * as clusterActions from '../cluster/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { toggleItemInList } from \"../helpers/reducerHelpers\";\r\nimport { ClusterTypes, DatasetFormParams, MsgPartConfig } from \"../messages\";\r\nimport * as configActions from './actions';\r\nimport { makeUnique } from \"./helpers\";\r\n\r\nexport interface LocalConfig {\r\n    cwd: string,\r\n    fileHistory: string[],\r\n    lastOpened: {\r\n        [path: string]: DatasetFormParams\r\n    },\r\n    lastConnection: {\r\n        type: ClusterTypes,\r\n        address: string\r\n    },\r\n    starred: string[],\r\n}\r\n\r\nexport type ConfigParams = MsgPartConfig & LocalConfig ;\r\nexport type ConfigState = ConfigParams & {\r\n    haveConfig: boolean,\r\n};\r\n\r\nexport const initialConfigState: ConfigState = {\r\n    version: \"\",\r\n    revision: \"\",\r\n    localCores: 0,\r\n    cwd: \"/\",\r\n    separator: \"/\",\r\n    lastOpened: {},\r\n    resultFileFormats: {},\r\n    fileHistory: [],\r\n    haveConfig: false,\r\n    lastConnection: {\r\n        type: ClusterTypes.LOCAL,\r\n        address: \"tcp://localhost:8786\",\r\n    },\r\n    starred: [],\r\n}\r\n\r\nexport function configReducer(state = initialConfigState, action: AllActions): ConfigState {\r\n    switch (action.type) {\r\n        case configActions.ActionTypes.FETCHED: {\r\n            return Object.assign({}, action.payload.config, { haveConfig: true });\r\n        }\r\n        case browserActions.ActionTypes.DIRECTORY_LISTING: {\r\n            return Object.assign({}, state, {\r\n                cwd: action.payload.path,\r\n            });\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            const newLastOpened = Object.assign({}, state.lastOpened, { [action.payload.dataset.params.path]: action.payload.dataset.params });\r\n            const newFileHistory = makeUnique([\r\n                action.payload.dataset.params.path, ...state.fileHistory\r\n            ]).slice(0, 11);\r\n            return Object.assign({}, state, {\r\n                lastOpened: newLastOpened,\r\n                fileHistory: newFileHistory,\r\n            });\r\n        }\r\n        case clusterActions.ActionTypes.CONNECT: {\r\n            if (action.payload.params.type === ClusterTypes.LOCAL){\r\n                const newLastConnection = Object.assign({}, state.lastConnection, {type: ClusterTypes.LOCAL})\r\n                return Object.assign({}, state, {\r\n                    lastConnection : newLastConnection\r\n                })\r\n            }\r\n            else {\r\n                return Object.assign({}, state, {\r\n                    lastConnection: action.payload.params\r\n                })\r\n            }\r\n        }\r\n        case configActions.ActionTypes.TOGGLE_STAR: {\r\n            const path = action.payload.path;\r\n            return {\r\n                ...state,\r\n                starred: toggleItemInList(state.starred, path),\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { constructById, filterWithPred, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport { Dataset, DatasetState, DatasetStatus } from \"../messages\";\r\nimport * as datasetActions from './actions';\r\nimport { DatasetsState, OpenDatasetState } from \"./types\";\r\n\r\nconst initialDatasetState: DatasetsState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function datasetReducer(state = initialDatasetState, action: AllActions): DatasetsState {\r\n    switch (action.type) {\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            const datasets = action.payload.datasets.map(ds => Object.assign({}, ds, { status: DatasetStatus.OPEN }));\r\n            return {\r\n                byId: constructById(datasets, ds => ds.id),\r\n                ids: datasets.map(ds => ds.id),\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            const ds: Dataset = {\r\n                ...action.payload.dataset,\r\n                status: DatasetStatus.OPENING\r\n            };\r\n            return insertById(state, action.payload.dataset.id, ds);\r\n        }\r\n        case datasetActions.ActionTypes.CREATED: {\r\n            const ds = Object.assign({}, action.payload.dataset, { status: DatasetStatus.OPEN });\r\n            if (state.byId[action.payload.dataset.id]) {\r\n                return updateById(state, action.payload.dataset.id, ds);\r\n            } else {\r\n                return insertById(state, action.payload.dataset.id, ds);\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.ERROR: {\r\n            return filterWithPred(state, (r: DatasetState) => r.id !== action.payload.dataset);\r\n        }\r\n        case datasetActions.ActionTypes.DELETE: {\r\n            return updateById(state, action.payload.dataset, { status: DatasetStatus.DELETING });\r\n        }\r\n        case datasetActions.ActionTypes.DELETED: {\r\n            return filterWithPred(state, (r: DatasetState) => r.id !== action.payload.dataset);\r\n        }\r\n    }\r\n    return state;\r\n}\r\n\r\nconst initialOpenDatasetState: OpenDatasetState = {\r\n    busy: false,\r\n    busyPath: \"\",\r\n    formVisible: false,\r\n    formPath: \"/\",\r\n    formCachedParams: undefined,\r\n    formDetectedParams: undefined,\r\n}\r\n\r\nexport function openDatasetReducer(state = initialOpenDatasetState, action: AllActions): OpenDatasetState {\r\n    switch (action.type) {\r\n        case datasetActions.ActionTypes.OPEN: {\r\n            return {\r\n                ...state,\r\n                formVisible: true,\r\n                formPath: action.payload.path,\r\n                formCachedParams: action.payload.cachedParams,\r\n                formDetectedParams: action.payload.detectedParams,\r\n            };\r\n        }\r\n        case datasetActions.ActionTypes.CANCEL_OPEN: {\r\n            return {\r\n                ...state,\r\n                formVisible: false,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.CREATE: {\r\n            return {\r\n                ...state,\r\n                formVisible: false,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.DETECT: {\r\n            return {\r\n                ...state,\r\n                busyPath: action.payload.path,\r\n                busy: true,\r\n            }\r\n        }\r\n        case datasetActions.ActionTypes.DETECTED:\r\n        case datasetActions.ActionTypes.DETECT_FAILED: {\r\n            return {\r\n                ...state,\r\n                busyPath: \"\",\r\n                busy: false,\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as browserActions from '../browser/actions';\r\nimport * as channelActions from '../channel/actions';\r\nimport * as clusterActions from '../cluster/actions';\r\nimport * as analysisActions from '../compoundAnalysis/actions';\r\nimport * as datasetActions from '../dataset/actions';\r\nimport { ById, filterWithPred, insertById } from \"../helpers/reducerHelpers\";\r\nimport * as errorActions from './actions';\r\n\r\nexport interface ErrorMessage {\r\n    id: string,\r\n    msg: string,\r\n    timestamp: number,\r\n}\r\n\r\nexport type ErrorState = ById<ErrorMessage>;\r\n\r\nconst initialErrorState: ErrorState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function errorReducer(state = initialErrorState, action: AllActions): ErrorState {\r\n    switch (action.type) {\r\n        case browserActions.ActionTypes.ERROR:\r\n        case datasetActions.ActionTypes.ERROR:\r\n        case channelActions.ActionTypes.ERROR:\r\n        case clusterActions.ActionTypes.ERROR:\r\n        case analysisActions.ActionTypes.ERROR:\r\n        case channelActions.ActionTypes.JOB_ERROR: {\r\n            return insertById(state, action.payload.id, {\r\n                id: action.payload.id,\r\n                msg: action.payload.msg,\r\n                timestamp: action.payload.timestamp,\r\n            });\r\n        }\r\n        case channelActions.ActionTypes.OPEN: {\r\n            return initialErrorState;\r\n        }\r\n        case errorActions.ActionTypes.DISMISS: {\r\n            return filterWithPred(state, (r: ErrorMessage) => r.id !== action.payload.id);\r\n        }\r\n        case errorActions.ActionTypes.DISMISS_ALL: {\r\n            return initialErrorState;\r\n        }\r\n    }\r\n    return state;\r\n}","import { AllActions } from \"../actions\";\r\nimport * as channelActions from '../channel/actions';\r\nimport { ById, constructById, insertById, updateById } from \"../helpers/reducerHelpers\";\r\nimport * as jobActions from './actions';\r\nimport { JobRunning, JobState, JobStatus } from \"./types\";\r\n\r\nexport type JobReducerState = ById<JobState>;\r\n\r\nconst initialJobState: JobReducerState = {\r\n    byId: {},\r\n    ids: [],\r\n};\r\n\r\nexport function jobReducer(state = initialJobState, action: AllActions): JobReducerState {\r\n    switch (action.type) {\r\n        case jobActions.ActionTypes.CREATE: {\r\n            const createResult = insertById(\r\n                state,\r\n                action.payload.id,\r\n                {\r\n                    id: action.payload.id,\r\n                    analysis: action.payload.analysis,\r\n                    running: JobRunning.CREATING,\r\n                    status: JobStatus.CREATING,\r\n                    results: [],\r\n                    startTimestamp: action.payload.timestamp,\r\n                }\r\n            )\r\n            return createResult;\r\n        }\r\n        case channelActions.ActionTypes.JOB_STARTED: {\r\n            return updateById(\r\n                state,\r\n                action.payload.job,\r\n                {\r\n                    running: JobRunning.RUNNING,\r\n                    status: JobStatus.IN_PROGRESS,\r\n                    startTimestamp: action.payload.timestamp,\r\n                }\r\n            )\r\n        }\r\n        case channelActions.ActionTypes.TASK_RESULT: {\r\n            return updateById(\r\n                state,\r\n                action.payload.job,\r\n                {\r\n                    results: action.payload.results,\r\n                }\r\n            );\r\n        }\r\n        case channelActions.ActionTypes.FINISH_JOB: {\r\n            const { job, timestamp, results } = action.payload;\r\n            return updateById(\r\n                state,\r\n                job,\r\n                {\r\n                    running: JobRunning.DONE,\r\n                    status: JobStatus.SUCCESS,\r\n                    results,\r\n                    endTimestamp: timestamp,\r\n                }\r\n            );\r\n        }\r\n        case channelActions.ActionTypes.JOB_ERROR: {\r\n            const { job, timestamp } = action.payload;\r\n            return updateById(\r\n                state,\r\n                job,\r\n                {\r\n                    running: JobRunning.DONE,\r\n                    status: JobStatus.ERROR,\r\n                    endTimestamp: timestamp,\r\n                }\r\n            )\r\n        }\r\n        case channelActions.ActionTypes.INITIAL_STATE: {\r\n            const jobs = action.payload.jobs;\r\n            const jobState: JobState[] = jobs.map(job => {\r\n                return {\r\n                    id: job.id,\r\n                    analysis: job.analysis,\r\n                    // FIXME: right job status!\r\n                    status: JobStatus.SUCCESS,\r\n                    startTimestamp: 0,\r\n                    // FIXME: result blobs?\r\n                    results: [],\r\n                    // FIXME: right job running status!\r\n                    running: JobRunning.DONE,\r\n                    endTimestamp: 0,\r\n                };\r\n            })\r\n\r\n            return {\r\n                byId: constructById(jobState, job => job.id),\r\n                ids: jobState.map(job => job.id),\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n}","import { combineReducers } from \"redux\";\r\nimport { analysisReducer } from \"./analysis/reducers\";\r\nimport { directoryBrowserReducer } from './browser/reducers';\r\nimport { channelStatusReducer } from \"./channel/reducers\";\r\nimport { clusterConnectionReducer } from \"./cluster/reducers\";\r\nimport { compoundAnalysisReducer } from \"./compoundAnalysis/reducers\";\r\nimport { configReducer } from \"./config/reducers\";\r\nimport { datasetReducer, openDatasetReducer } from \"./dataset/reducers\";\r\nimport { errorReducer } from \"./errors/reducers\";\r\nimport { jobReducer } from \"./job/reducers\";\r\n\r\nexport const rootReducer = combineReducers({\r\n    compoundAnalyses: compoundAnalysisReducer,\r\n    analyses: analysisReducer,\r\n    channelStatus: channelStatusReducer,\r\n    clusterConnection: clusterConnectionReducer,\r\n    datasets: datasetReducer,\r\n    openDataset: openDatasetReducer,\r\n    jobs: jobReducer,\r\n    errors: errorReducer,\r\n    config: configReducer,\r\n    browser: directoryBrowserReducer,\r\n})\r\n\r\nexport type RootReducer = ReturnType<typeof rootReducer>;","// tslint:disable:ordered-imports\r\nimport \"core-js/fn/symbol/iterator.js\";\r\nimport \"core-js/es6/symbol.js\";\r\nimport 'react-app-polyfill/ie11';\r\n// tslint:enable:ordered-imports\r\n\r\nimport * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\nimport { applyMiddleware, compose, createStore } from 'redux';\r\nimport createSagaMiddleware from 'redux-saga';\r\nimport App from './App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport { rootSaga } from './sagas';\r\nimport { rootReducer } from './store';\r\n\r\nconst sagaMiddleware = createSagaMiddleware();\r\n\r\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nconst store = createStore(rootReducer, composeEnhancers(\r\n    applyMiddleware(\r\n        sagaMiddleware,\r\n    )\r\n));\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <App />\r\n    </Provider>,\r\n    document.getElementById('root') as HTMLElement\r\n);\r\nregisterServiceWorker();\r\n\r\nsagaMiddleware.run(rootSaga);"],"sourceRoot":""}