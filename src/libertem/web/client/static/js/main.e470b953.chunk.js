(this["webpackJsonplibertem-client"]=this["webpackJsonplibertem-client"]||[]).push([[0],{231:function(e,t,n){e.exports={default:"ResultImage_default__3K5yi",fallback:"ResultImage_fallback__3V1su"}},373:function(e,t,n){e.exports=n.p+"static/media/LiberTEM logo-medium.7999e0dc.png"},385:function(e,t,n){e.exports=n(672)},672:function(e,t,n){"use strict";n.r(t);n(386),n(398),n(408);var a,r=n(0),c=n.n(r),i=n(61),o=n(12),l=n(53),s=n(89),u=n(32),d=n(33),m=n(35),p=n(34),E=n(36),f=(n(467),n(685)),b=n(687),h=n(66),g=n(688),O=n(697),y=n(691),v=Object(o.b)((function(e){return{version:e.config.version,revision:e.config.revision}}))((function(e){var t=e.version,n=e.revision;return r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h3"},"This is LiberTEM version ",t," (revision ",n.slice(0,8),")"),r.createElement(y.a,null,r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"github"}),r.createElement(y.a.Content,null,"Find us on ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM"},"GitHub"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"bug"}),r.createElement(y.a.Content,null,"Found a bug? Got a feature request? Please ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/issues/new"},"open an issue!"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"legal"}),r.createElement(y.a.Content,null,"LiberTEM is licensed under the ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE"},"GNU General Public License v3.0"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"book"}),r.createElement(y.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/"},"the documentation"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"user"}),r.createElement(y.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/acknowledgments.html"},"the acknowledgments"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"gitter"}),r.createElement(y.a.Content,null,"Join our ",r.createElement("a",{href:"https://gitter.im/LiberTEM/Lobby"},"chat on gitter!"))),r.createElement(y.a.Item,null,r.createElement(y.a.Icon,{name:"linkify"}),r.createElement(y.a.Content,null,r.createElement("a",{href:"https://doi.org/10.5281/zenodo.1477847"},r.createElement("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.1477847.svg",alt:"doi.org/10.5281/zenodo.1477847"}))))))})),j=n(692),x=n(698);function S(e,t,n){return void 0===n&&void 0===t?{type:e}:void 0===n?{type:e,payload:t}:{type:e,payload:t,meta:n}}!function(e){e.NOT_CONNECTED="CLUSTER_NOT_CONNECTED",e.CONNECT="CLUSTER_CONNECT",e.CONNECTED="CLUSTER_CONNECTED"}(a||(a={}));var C={notConnected:function(){return S(a.NOT_CONNECTED)},connect:function(e){return S(a.CONNECT,{params:e})},connected:function(e){return S(a.CONNECTED,{params:e})}},R=n(169),w=n.n(R);function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return R.debounce(e,t,{maxWait:t})}function _(e){return Object.keys(e)}var D,I,A=n(21);!function(e){e.LOCAL="LOCAL",e.TCP="TCP"}(I||(I={}));var P,F,k,L=(D={},Object(A.a)(D,I.LOCAL,{label:"Create local cluster"}),Object(A.a)(D,I.TCP,{label:"Connect to cluster",helpText:"can be either local or remote, connection via TCP"}),D);!function(e){e.HDF5="HDF5",e.RAW="RAW",e.MIB="MIB",e.BLO="BLO",e.K2IS="K2IS",e.SER="SER",e.FRMS6="FRMS6",e.EMPAD="EMPAD"}(P||(P={})),function(e){e.OPEN="OPEN",e.OPENING="OPENING",e.DELETING="DELETING"}(F||(F={})),function(e){e.APPLY_RING_MASK="APPLY_RING_MASK",e.APPLY_DISK_MASK="APPLY_DISK_MASK",e.APPLY_POINT_SELECTOR="APPLY_POINT_SELECTOR",e.CENTER_OF_MASS="CENTER_OF_MASS",e.SUM_FRAMES="SUM_FRAMES",e.SD_FRAMES="SD_FRAMES",e.PICK_FRAME="PICK_FRAME",e.PICK_FFT_FRAME="PICK_FFT_FRAME",e.APPLY_FFT_MASK="APPLY_FFT_MASK",e.FFTSUM_FRAMES="FFTSUM_FRAMES",e.RADIAL_FOURIER="RADIAL_FOURIER",e.FEM="FEM",e.CLUST="CLUST",e.SUM_SIG="SUM_SIG"}(k||(k={}));var M=n(19),N=n(686),H=n(673);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var B=Object(M.c)({mapPropsToValues:function(e){return{numWorkers:e.config.localCores}},handleSubmit:function(e,t){(0,t.props.onSubmit)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:I.LOCAL},e))}})((function(e){var t=e.values,n=e.touched,a=e.errors,c=(e.dirty,e.isSubmitting),i=e.handleChange,o=e.handleBlur,l=e.handleSubmit;e.handleReset;return r.createElement(N.a,{onSubmit:l},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"numWorkers"},"Number of Workers:"),r.createElement("input",{type:"number",name:"numWorkers",value:t.numWorkers,onChange:i,onBlur:o}),a.numWorkers&&n.numWorkers&&a.numWorkers),r.createElement(H.a,{primary:!0,type:"submit",disabled:c},"Connect"))}));function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var G,K=Object(M.c)({mapPropsToValues:function(){return{address:"tcp://localhost:8786"}},handleSubmit:function(e,t){(0,t.props.onSubmit)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:I.TCP},e))}})((function(e){var t=e.values,n=e.touched,a=e.errors,c=(e.dirty,e.isSubmitting),i=e.handleChange,o=e.handleBlur,l=e.handleSubmit;e.handleReset;return r.createElement(N.a,{onSubmit:l},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"address"},"Scheduler URI"),r.createElement("input",{type:"text",name:"address",value:t.address,onChange:i,onBlur:o}),a.address&&n.address&&a.address),r.createElement(H.a,{primary:!0,type:"submit",disabled:c},"Connect"))})),J={connectToCluster:C.connect},z=_(I).map((function(e){return{text:L[I[e]].label,value:I[e]}})),V=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={clusterType:I.LOCAL},n.setType=function(e){n.setState({clusterType:e})},n.handleChange=function(e,t){var a=t.value;n.setType(a)},n.handleSubmit=function(e){n.props.connectToCluster(e)},n}return Object(E.a)(t,e),Object(d.a)(t,[{key:"renderForm",value:function(){var e=this.state.clusterType,t=this.props.config;switch(e){case I.LOCAL:return r.createElement(B,{config:t,onSubmit:this.handleSubmit});case I.TCP:return r.createElement(K,{onSubmit:this.handleSubmit})}}},{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(j.a,{inline:!0,options:z,value:this.state.clusterType,onChange:this.handleChange})),r.createElement(x.a,null,this.renderForm()))}}]),t}(r.Component),Y=Object(o.b)((function(e){return{config:e.config}}),J)(V),X=n(694),$=function(e){var t=e.msg;return r.createElement(X.a,{icon:!0},r.createElement(h.a,{name:"cog",loading:!0}),r.createElement(X.a.Content,null,r.createElement(X.a.Header,null,"Connecting to LiberTEM"),t))},q={waiting:"Waiting...",connecting:"Connecting..."},Z="Connected, waiting for initial state...",Q="Connected, fetching cluster status...",ee=Object(o.b)((function(e){return{channelStatus:e.channelStatus,clusterConnection:e.clusterConnection,haveConfig:e.config.haveConfig}}))((function(e){var t=e.haveConfig,n=e.children,a=e.channelStatus,c=e.clusterConnection;switch(a.status){case"waiting":case"connecting":return r.createElement($,{msg:q[a.status]});case"connected":if(!t)return r.createElement($,{msg:"waiting for configuration..."});if("disconnected"===c.status)return r.createElement(Y,null);if("connected"===c.status)return r.createElement($,{msg:Z});if("unknown"===c.status)return r.createElement($,{msg:Q})}return r.createElement(r.Fragment,null,n)}));!function(e){e.LIST_DIRECTORY="BROWSER_LIST_DIRECTORY",e.LIST_FULL_PATH="BROWSER_LIST_DIRECTORY_FULL",e.DIRECTORY_LISTING="BROWSER_DIRECTORY_LISTING",e.DETECT_PARAMS="BROWSER_DETECT_PARAMS",e.PARAMS_DETECTED="BROWSER_PARAMS_DETECTED",e.ERROR="BROWSER_ERROR",e.OPEN="BROWSER_OPEN",e.CANCEL="BROWSER_CANCEL",e.SELECT="BROWSER_SELECT",e.SELECT_FULL_PATH="BROWSER_SELECT_FULL_PATH"}(G||(G={}));var te={list:function(e,t){return S(G.LIST_DIRECTORY,{path:e,name:t})},dirListing:function(e,t,n,a,r){return S(G.DIRECTORY_LISTING,{path:e,dirs:t,files:n,drives:a,places:r})},open:function(){return S(G.OPEN)},cancel:function(){return S(G.CANCEL)},select:function(e,t){return S(G.SELECT,{path:e,name:t})},selectFullPath:function(e){return S(G.SELECT_FULL_PATH,{path:e})},error:function(e,t,n){return S(G.ERROR,{msg:e,timestamp:t,id:n})},detectParams:function(e){return S(G.DETECT_PARAMS,{path:e})},paramsDetected:function(e,t){return S(G.PARAMS_DETECTED,{path:e,params:t})}},ne=n(375);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce=function(e){var t=e.ts,n=new Date(1e3*t),a=n.toLocaleDateString(),c=n.toLocaleTimeString(),i="".concat(a," ").concat(c);return r.createElement("div",{style:{display:"flex",whiteSpace:"nowrap"},title:i},r.createElement("div",{style:{width:"50%",marginRight:"10px"}},a),r.createElement("div",{style:{width:"45%"}},c))};var ie=function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?1e3:1024;if(Math.abs(e)<n)return{size:e,unit:"B"};var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=n,++r}while(Math.abs(e)>=n&&r<a.length-1);return{size:e.toFixed(1),unit:a[r]}}(e.size,e.si);return r.createElement("div",{style:{textAlign:"right"}},t.size," ",t.unit)},oe=function(e){var t=e.children,n=e.title;return r.createElement("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginRight:"10px"},title:n},t)},le=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){var t=n.props.onClick;t&&t()},n}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.icon,c=re({cursor:"pointer"},n),i={textAlign:"right"};return r.createElement("div",{onClick:this.onClick,style:c},r.createElement("div",{style:{display:"flex",paddingRight:"10px"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(oe,{title:t.name},a&&r.createElement(h.a,{name:a}),t.name)),r.createElement("div",{style:{width:"10%"}},r.createElement(oe,null,r.createElement(ie,{size:t.size,si:!1}))),r.createElement("div",{style:{width:"10%"}},r.createElement(oe,null,t.owner)),r.createElement("div",{style:re({width:"18%"},i)},r.createElement(oe,null,r.createElement(ce,{ts:t.ctime}))),r.createElement("div",{style:re({width:"18%"},i)},r.createElement(oe,null,r.createElement(ce,{ts:t.mtime})))))}}]),t}(r.Component);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var de=function(){var e={textAlign:"right"};return r.createElement("div",{style:{paddingRight:"20px",paddingBottom:"10px"}},r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(oe,null,"Name")),r.createElement("div",{style:ue({width:"10%"},e)},r.createElement(oe,null,"Size")),r.createElement("div",{style:{width:"10%"}},r.createElement(oe,null,"Owner")),r.createElement("div",{style:ue({width:"18%"},e)},r.createElement(oe,null,"Created")),r.createElement("div",{style:ue({width:"18%"},e)},r.createElement(oe,null,"Modified"))))},me=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.select;return r.createElement(le,{onClick:a,style:n,details:t,icon:"file outline"})}}]),t}(r.Component),pe=Object(o.b)(null,(function(e,t){return{select:function(){return e(te.select(t.path,t.details.name))}}}))(me),Ee=Object(o.b)(null,(function(e,t){return{list:function(){e(te.list(t.path,t.details.name)),window.setTimeout((function(){return t.onChange()}),0)}}}))((function(e){var t=e.list,n=e.details,a=e.style;e.onChange;return r.createElement(le,{onClick:t,style:a,details:n,icon:"folder"})})),fe=n(695),be=n(174);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ge=Object(o.b)(null,(function(e,t){return{list:function(){void 0!==t.value&&(e(te.list(t.value.toString())),window.setTimeout((function(){return t.onChange()}),0))}}}))((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({onClick:e.list},Object(be.a)(e,["list"]));return r.createElement(j.a.Item,t)})),Oe=n(682),ye=Object(M.c)({mapPropsToValues:function(e){return{path:e.initialPath}},handleSubmit:function(e,t){(0,t.props.onChange)(e.path)},enableReinitialize:!0})((function(e){var t=e.values,n=(e.touched,e.errors,e.dirty,e.isSubmitting,e.handleChange),a=e.handleBlur,c=e.handleSubmit;e.handleReset;return r.createElement(N.a,{onSubmit:c,style:{flexGrow:1}},r.createElement(N.a.Field,null,r.createElement(Oe.a,{autoComplete:"off",onBlur:a,onChange:n,value:t.path,name:"path"})))})),ve=Object(o.b)((function(e){return{lastOpened:e.config.lastOpened,fileHistory:e.config.fileHistory,separator:e.config.separator}}),(function(e){return{select:function(t){return e(te.selectFullPath(t))}}}))((function(e){var t=e.lastOpened,n=e.fileHistory,a=e.select,c=n.filter((function(e){return t[e]})).map((function(e){var n=t[e];return{text:n.path,value:{type:n.type,path:n.path}}})),i=function(e,t){return t.value&&a(t.value.toString())};return r.createElement(j.a,{item:!0,text:"Recent",floating:!0},r.createElement(j.a.Menu,null,r.createElement(j.a.Header,{content:"recent datasets"}),c.map((function(e,t){return r.createElement(j.a.Item,{key:t,value:e.value.path,content:e.text,onClick:i})}))))})),je=Object(o.b)(null,(function(e,t){return{refresh:function(){e(te.list(t.currentPath)),window.setTimeout((function(){return t.onChange()}),0)},handleInputChange:function(n){e(te.list(n)),window.setTimeout((function(){return t.onChange()}),0)},goUp:function(){e(te.list(t.currentPath,"..")),window.setTimeout((function(){return t.onChange()}),0)}}}))((function(e){var t=e.currentPath,n=e.drives,a=e.places,c=e.onChange,i=e.refresh,o=e.goUp,l=e.handleInputChange,s=n.map((function(e){return{key:e,text:e}})),u=Object.keys(a).map((function(e){return{key:a[e].path,text:a[e].title}}));return r.createElement(fe.a,null,r.createElement(ve,null),r.createElement(j.a,{text:"Go to...",floating:!0,item:!0},r.createElement(j.a.Menu,null,r.createElement(j.a.Header,{content:"Drives"}),s.map((function(e){return r.createElement(ge,{key:e.key,value:e.key,content:e.text,onChange:c})})),r.createElement(j.a.Header,{content:"Places"}),u.map((function(e){return r.createElement(ge,{key:e.key,value:e.key,content:e.text,onChange:c})})))),r.createElement(fe.a.Item,{icon:"arrow up",onClick:o}),r.createElement(fe.a.Item,{style:{flexGrow:1}},r.createElement(ye,{onChange:l,initialPath:t})),r.createElement(fe.a.Item,{icon:"refresh",onClick:i}))})),xe=r.createRef(),Se=function(){null!==xe.current&&xe.current.scrollToItem(0)};function Ce(e,t){return e.sort((function(e,n){var a=t(e),r=t(n);return a<r?-1:a>r?1:0}))}var Re,we,Te=Object(o.b)((function(e){var t=e.browser;return{files:t.files,dirs:t.dirs,path:t.path,drives:t.drives,places:t.places,isLoading:t.isLoading}}),(function(e){return{cancel:function(){return e(te.cancel())}}}))((function(e){var t=e.files,n=e.dirs,a=e.path,c=e.drives,i=e.places,o=e.cancel,l=e.isLoading,s=function(e){return e.name.toLowerCase()},u=Ce(n,s).map((function(e){return function(t){return r.createElement(Ee,{style:t,onChange:Se,path:a,details:e})}})),d=Ce(t,s).map((function(e){return function(t){return r.createElement(pe,{style:t,path:a,details:e})}})),m=u.concat(d),p=r.createElement(ne.a,{style:{overflowY:"scroll"},ref:xe,height:300,width:"100%",itemCount:m.length,itemSize:35},(function(e){var t=e.index,n=e.style;return m[t](n)}));return l&&(p=r.createElement(x.a,{loading:!0,style:{height:"300px"}})),r.createElement(x.a.Group,null,r.createElement(x.a,null,r.createElement(O.a,{as:"h2"},"Open dataset")),r.createElement(x.a,null,r.createElement(je,{currentPath:a,drives:c,places:i,onChange:Se})),r.createElement(x.a,null,r.createElement(de,null),p),r.createElement(x.a,null,r.createElement(H.a,{onClick:o},"Cancel")))})),_e={open:te.open},De=Object(o.b)((function(e){return{isOpen:e.browser.isOpen}}),_e)((function(e){var t=e.isOpen,n=e.open;return t?r.createElement(Te,null):r.createElement(H.a,{icon:!0,labelPosition:"left",onClick:n},r.createElement(h.a,{name:"add"}),"Browse")})),Ie=n(10);!function(e){e.CREATING="CREATING",e.RUNNING="RUNNING",e.DONE="DONE"}(Re||(Re={})),function(e){e.CREATING="CREATING",e.IN_PROGRESS="IN_PROGRESS",e.CANCELLED="CANCELLED",e.SUCCESS="SUCCESS",e.ERROR="ERROR"}(we||(we={}));var Ae=n(46),Pe=n(78),Fe=n(79),ke=function(){return r.createElement(h.a,{name:"cog",loading:!0,style:{margin:0,padding:0,position:"absolute",bottom:"10px",right:"10px",color:"white",opacity:.7,filter:"drop-shadow(0 0 3px #000)"}})},Le=function(e){var t=e.children,n=e.busy;return r.createElement("div",{style:{position:"relative"}},t,n&&r.createElement(ke,null))},Me=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).currentHandle=void 0,n.handleDragStart=function(e){n.currentHandle=e},n.handleDrop=function(){n.currentHandle=void 0},n.handleMouseMove=function(e){if(n.currentHandle)return n.currentHandle.externalMouseMove(e)},n.handleMouseLeave=function(e){n.currentHandle&&n.currentHandle.externalLeave(e)},n.handleMouseUp=function(e){n.currentHandle&&n.currentHandle.externalMouseUp(e)},n}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return r.createElement("g",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp,onKeyDown:this.props.onKeyboardEvent,style:{outline:"1px dashed black"},tabIndex:0},r.createElement("rect",{style:{fill:"transparent"},x:0,y:0,width:t,height:n}),this.renderHandles())}},{key:"renderHandles",value:function(){var e=this,t=this.props,n=t.handles,a=t.onKeyboardEvent;return n.map((function(t,n){var c=t(e.handleDragStart,e.handleDrop,a);return r.isValidElement(c)?r.cloneElement(c,{key:n}):null}))}}]),t}(r.Component),Ne=n(231),He=n.n(Ne),We=function(e){var t=e.job,n=e.idx,a=e.width,c=e.height,i=t.results[n];return void 0===i?r.createElement("svg",{className:He.a.fallback,width:a,height:c,viewBox:"0 0 ".concat(a," ").concat(c),key:-1}):r.createElement("image",{className:He.a.default,xlinkHref:i.imageURL,width:a,height:c})};function Be(){var e=Object(Pe.a)(["\n    display: block;\n    border: 1px solid black;\n    width: 100%;\n    height: auto;\n"]);return Be=function(){return e},e}var Ue=Fe.a.svg(Be()),Ge=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(d.a)(t,[{key:"renderHandles",value:function(){var e=this.props,t=e.width,n=e.height,a=e.extraHandles,c=[];return a&&(c=[].concat(Object(Ae.a)(c),[a])),r.createElement(Me,{width:t,height:n,handles:c})}},{key:"render",value:function(){var e=this.props,t=e.job,n=e.idx,a=e.width,c=e.height,i=e.extraWidgets,o=t.running!==Re.DONE;return r.createElement(Le,{busy:o},r.createElement(Ue,{width:a,height:c,viewBox:"0 0 ".concat(a," ").concat(c)},r.createElement(We,{job:t,idx:n,width:a,height:c}),i,this.renderHandles()))}}]),t}(r.Component),Ke=Object(o.b)(null,null)(Ge);function Je(){var e=Object(Pe.a)(["\n    display: flex;\n    & > * {\n        margin-right: 10px;\n    }\n"]);return Je=function(){return e},e}var ze=Fe.a.div(Je()),Ve=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={selectedChannel:0},n.selectChannel=function(e,t){var a=t.value;n.setState({selectedChannel:a})},n.getJob=function(){var e=n.props,t=e.currentJob,a=e.analysis,r=e.jobsById,c=e.jobIndex;if(t){if(t.results.length>0)return t;var i=a.jobHistory[c];if(void 0!==i){var o=!0,l=!1,s=void 0;try{for(var u,d=i[Symbol.iterator]();!(o=(u=d.next()).done);o=!0){var m=r[u.value];if(m.results.length>0)return m}}catch(p){l=!0,s=p}finally{try{o||null==d.return||d.return()}finally{if(l)throw s}}}}},n}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.selectors,a=t.analysis,c=t.dataset,i=t.children,o=t.width,l=t.height,s=t.jobIndex,u=t.extraHandles,d=t.extraWidgets,m=t.subtitle,p=r.createElement("svg",{style:{display:"block",border:"1px solid black",width:"100%",height:"auto"},width:o,height:l,viewBox:"0 0 ".concat(o," ").concat(l),key:-1}),E=this.getJob();if(E&&c)if(p=r.createElement(Ke,{analysis:a,job:E,dataset:c,extraHandles:u,extraWidgets:d,width:o,height:l,jobIndex:s,idx:this.state.selectedChannel}),E.running===Re.DONE){var f=(E.endTimestamp-E.startTimestamp)/1e3;e=r.createElement(r.Fragment,null,"Analysis done in ",f.toFixed(3),"s")}else e=r.createElement(r.Fragment,null,"Analysis running...");else e=r.createElement(r.Fragment,null,"\xa0");return r.createElement("div",null,p,i,r.createElement(ze,null,r.createElement(Ye,{job:E,handleChange:this.selectChannel,selectedImg:this.state.selectedChannel}),n),r.createElement("p",null,m," ",e))}}]),t}(r.Component),Ye=function(e){var t=e.job,n=e.handleChange,a=e.selectedImg;if(!t)return null;var c=t.results.map((function(e,t){return{text:e.description.title,value:t}}));return r.createElement(r.Fragment,null,r.createElement("div",null,"Channel:"," ",r.createElement(j.a,{inline:!0,options:c,value:a,onChange:n})))},Xe=Object(o.b)((function(e,t){var n=e.analyses.byId[t.analysis],a=n.jobs[t.jobIndex],r=a?e.jobs.byId[a]:void 0,c=r?e.datasets.byId[r.dataset]:void 0;return{currentJob:r,jobsById:e.jobs.byId,analysis:n,dataset:c,jobIndex:t.jobIndex}}))(Ve),$e=function(e,t){return function(n){return{x:Math.max(0,Math.min(e-1,n.x)),y:Math.max(0,Math.min(t-1,n.y))}}},qe=function(e,t,n){return function(a,r){return n&&n(function(e,t,n,a){var r=e-n,c=t-a;return Math.sqrt(r*r+c*c)}(e,t,a,r))}},Ze=function(e){return function(t){return{x:t.x,y:e}}},Qe=function(e,t){return function(n){return(a=e,function(e){return{x:a>e.x?a:e.x,y:e.y}})(Ze(t)(n));var a}},et=function(e,t){return function(n){return(a=e,function(e){return{x:a<e.x?a:e.x,y:e.y}})(Ze(t)(n));var a}},tt=function(e){return{fillOpacity:.3,fill:"red",strokeOpacity:.7,stroke:"red",strokeWidth:e/128/3}};function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rt=function(e){var t=e.imageWidth,n=(e.imageHeight,e.cx),a=e.cy,c=e.r;return r.createElement("circle",{cx:n+.5,cy:a+.5,r:c,style:at({},tt(t))})},ct=n(164),it=function(e,t){var n=1;switch(e.shiftKey&&(n=10),e.key){case"ArrowUp":t((function(e,t){return{x:e,y:t-n}}));break;case"ArrowDown":t((function(e,t){return{x:e,y:t+n}}));break;case"ArrowLeft":t((function(e,t){return{x:e-n,y:t}}));break;case"ArrowRight":t((function(e,t){return{x:e+n,y:t}}));break;default:return}e.preventDefault()};function ot(){var e=Object(Pe.a)(["\n    &:focus { outline: none; }\n"]);return ot=function(){return e},e}function lt(){var e=Object(Pe.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return lt=function(){return e},e}function st(){var e=Object(Pe.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return st=function(){return e},e}var ut=Fe.a.circle(st()),dt=Fe.a.path(lt()),mt=Fe.a.g(ot()),pt=function(e){var t=e.scale,n=e.x,a=e.y,c=e.withCross,i=e.focusRef,o=Object(be.a)(e,["scale","x","y","withCross","focusRef"]),l={transform:"matrix(".concat(t,", 0, 0, ").concat(t,", ").concat(n-t*n,", ").concat(a-t*a,")")},s="\n        M".concat(n-4-1.5," ").concat(a," L ").concat(n-1.5," ").concat(a," M").concat(n+1.5," ").concat(a," L ").concat(n+4+1.5," ").concat(a,"\n        M").concat(n," ").concat(a-4-1.5," L ").concat(n," ").concat(a-1.5," M").concat(n," ").concat(a+1.5," L ").concat(n," ").concat(a+4+1.5,"\n    "),u=c?r.createElement(dt,{d:s,style:l}):null;return r.createElement(mt,Object.assign({},o,{ref:i}),r.createElement(ut,{cx:n,cy:a,r:3,style:l}),u)};function Et(e,t){var n=function(e){var t=e.ownerSVGElement;if(null===t)throw new Error("no owner SVG element?");var n=t.getAttribute("width");if(null===n)throw new Error("no width on SVG element?");var a=+n;return t.getBoundingClientRect().width/a}(t),a=t.getBoundingClientRect();return{x:(e.pageX-(a.left+window.pageXOffset))/n,y:(e.pageY-(a.top+window.pageYOffset))/n}}var ft,bt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).posRef=void 0,n.focusRef=void 0,n.state={dragging:!1,drag:{x:0,y:0}},n.externalMouseMove=function(e){n.move(e)},n.externalLeave=function(e){n.stopDrag(e)},n.externalMouseUp=function(e){n.stopDrag(e)},n.applyConstraint=function(e){var t=n.props.constraint;return t?t(e):e},n.startDrag=function(e){e.preventDefault();var t=n.props.parentOnDragStart;if(!n.posRef.current)throw new Error("startDrag without posRef");n.setState({dragging:!0,drag:n.applyConstraint(Et(e,n.posRef.current))}),t&&t(Object(ct.a)(n)),n.focusRef.current&&n.focusRef.current.focus&&n.focusRef.current.focus()},n.move=function(e){var t=n.props.onDragMove;if(n.state.dragging){if(!n.posRef.current)throw new Error("move without posRef");n.setState({drag:n.applyConstraint(Et(e,n.posRef.current))},(function(){if(t){var e=n.applyConstraint(n.state.drag);t(e.x,e.y)}}))}},n.stopDrag=function(e){var t=n.props.parentOnDrop,a=n.state,r=a.dragging,c=a.drag;r&&(n.setState({dragging:!1}),t&&t(c.x,c.y))},n.handleKeyDown=function(e){it(e,(function(e){var t=n.props,a=t.x,r=t.y,c=t.onDragMove,i=e(a,r),o=n.applyConstraint(i);c&&c(o.x,o.y)}))},n.posRef=r.createRef(),n.focusRef=r.createRef(),n}return Object(E.a)(t,e),Object(d.a)(t,[{key:"renderCommon",value:function(e,t){var n=this.props.imageWidth,a=void 0===n?1:n/128;return r.createElement("g",null,r.createElement("rect",{style:{visibility:"hidden"},ref:this.posRef,x:0,y:0,width:0,height:0}),r.createElement(pt,{scale:a,x:e+.5,y:t+.5,withCross:this.props.withCross,focusRef:this.focusRef,onMouseUp:this.stopDrag,onMouseMove:this.move,onMouseDown:this.startDrag,onKeyDown:this.handleKeyDown,tabIndex:0}))}},{key:"renderDragging",value:function(){var e=this.state.drag,t=e.x,n=e.y;return this.renderCommon(t,n)}},{key:"render",value:function(){var e=this.props,t=e.x,n=e.y;return this.state.dragging?this.renderDragging():this.renderCommon(t,n)}}]),t}(r.Component),ht=bt;!function(e){e.CREATE="ANALYSIS_CREATE",e.CREATED="ANALYSIS_CREATED",e.PREPARE_RUN="ANALYSIS_PREPARE_RUN",e.RUN="ANALYSIS_RUN",e.RUNNING="ANALYSIS_RUNNING",e.REMOVE="ANALYSIS_REMOVE",e.REMOVED="ANALYSIS_REMOVED",e.ERROR="ANALYSIS_ERROR"}(ft||(ft={}));var gt={create:function(e,t){return S(ft.CREATE,{dataset:e,analysisType:t})},created:function(e){return S(ft.CREATED,{analysis:e})},prepareRun:function(e,t,n){return S(ft.PREPARE_RUN,{id:e,jobIndex:t,job:n})},run:function(e,t,n){return S(ft.RUN,{id:e,jobIndex:t,parameters:n})},running:function(e,t,n){return S(ft.RUNNING,{id:e,job:t,jobIndex:n})},remove:function(e){return S(ft.REMOVE,{id:e})},removed:function(e){return S(ft.REMOVED,{id:e})},error:function(e,t,n){return S(ft.ERROR,{msg:e,timestamp:t,id:n})}},Ot=n(696),yt=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.right,i=e.toolbar;return r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h3",attached:"top"},r.createElement(h.a,{name:"cog"}),r.createElement(O.a.Content,null,t)),r.createElement(x.a,{attached:!0},r.createElement(Ot.a,{columns:2},r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,null,a,r.createElement("p",null,n)),r.createElement(Ot.a.Column,null,c)))),i)},vt=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.jobIndex,i=e.analysisId,l=e.cx,s=e.cy,u=e.setCx,d=e.setCy,m=Object(o.c)();c.a.useEffect((function(){if(t){var e={x:l,y:s};m(gt.run(i,r,{type:k.PICK_FRAME,parameters:e}))}}),[i,l,s,t,r,m]);var p=function(e,t){var n=Math.round(e),a=Math.round(t);l===n&&s===a||(u(n),d(a))};return{coords:{cx:l,cy:s},handles:function(e,t){return c.a.createElement(ht,{x:l,y:s,withCross:!0,imageWidth:n,onDragMove:p,parentOnDragStart:e,parentOnDrop:t,constraint:$e(n,a)})}}},jt=function(e){var t=e.modes,n=e.currentMode,a=e.onModeChange,c=e.label;return r.createElement(r.Fragment,null,r.createElement("div",null,c,":"," ",r.createElement(j.a,{inline:!0,options:t,value:n,onChange:function(e,t){a(t.value)}})))};function xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xt(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ct,Rt,wt=function(e){var t,n,a=e.imageWidth,c=(e.imageHeight,e.x),i=e.y,o=e.width,l=e.height;return l*o>0?(t=Math.min(i,i+l),n=Math.min(c,c+o)):l>0&&o<0?(t=i,n=c+o):(t=i+l,n=c),r.createElement("rect",{x:n+.5,y:t+.5,width:Math.abs(o),height:Math.abs(l),style:St({},tt(a))})},Tt=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),c=Object(r.useState)(t/2),i=Object(Ie.a)(c,2),o=i[0],l=i[1],s=Object(r.useState)(n/2),u=Object(Ie.a)(s,2),d=u[0],m=u[1],p=Object(r.useState)(a/8),E=Object(Ie.a)(p,2),f=E[0],b=E[1],h=Object(r.useState)(a/8),g=Object(Ie.a)(h,2),O=g[0],y=g[1],v=function(e,t){l(e),m(t)},j=function(e,t){b(e-o),y(t-d)},x={x:o+f,y:d+O};return{rectRoiParameters:{roi:{shape:"rect",x:o,y:d,width:f,height:O}},rectRoiHandles:function(e,n){return r.createElement(r.Fragment,null,r.createElement(ht,{x:o,y:d,imageWidth:t,onDragMove:v,parentOnDragStart:e,parentOnDrop:n}),r.createElement(ht,{x:x.x,y:x.y,imageWidth:t,onDragMove:j,parentOnDragStart:e,parentOnDrop:n}))},rectRoiWidgets:r.createElement(wt,{x:o,y:d,width:f,height:O,imageWidth:t,imageHeight:n})}},_t=function(e){var t=e.analysisId,n=e.enabled,a=e.jobIndex,c=e.roiParameters,i=e.analysis,l=Object(o.c)();return r.useEffect((function(){var e=setTimeout((function(){if(n){var e={type:i,parameters:c};l(gt.run(t,a,e))}}),100);return function(){return clearTimeout(e)}}),[i,t,n,a,JSON.stringify(c),l]),{}};!function(e){e.SUM="SUM",e.SD="SD",e.PICK="PICK"}(Ct||(Ct={})),function(e){e.ALL="ALL",e.DISK="DISK",e.RECT="RECT"}(Rt||(Rt={}));var Dt=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.analysisId,c=[{text:"Average",value:Ct.SUM},{text:"Standard Deviation",value:Ct.SD},{text:"Pick",value:Ct.PICK}],i=[{text:"All",value:Rt.ALL},{text:"Disk",value:Rt.DISK},{text:"Rect",value:Rt.RECT}],o=Object(r.useState)(Ct.SUM),l=Object(Ie.a)(o,2),s=l[0],u=l[1],d=Object(r.useState)(Rt.ALL),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=r.createElement(jt,{modes:c,currentMode:s,onModeChange:u,label:"Mode"}),b=r.createElement(jt,{modes:i,currentMode:p,onModeChange:E,label:"ROI"});s===Ct.PICK&&(b=r.createElement(r.Fragment,null));var h,g=r.useState(Math.round(t/2)),O=Object(Ie.a)(g,2),y=O[0],v=O[1],j=r.useState(Math.round(n/2)),x=Object(Ie.a)(j,2),S=x[0],C=x[1],R=vt({enabled:s===Ct.PICK,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,cx:y,cy:S,setCx:v,setCy:C}),w=R.coords,T=R.handles,_=Tt({scanHeight:n,scanWidth:t}),D=_.rectRoiHandles,I=_.rectRoiWidgets,A=_.rectRoiParameters,P=function(e){var t=e.scanWidth,n=e.scanHeight,a=Math.min(t,n),c=Object(r.useState)(t/2),i=Object(Ie.a)(c,2),o=i[0],l=i[1],s=Object(r.useState)(n/2),u=Object(Ie.a)(s,2),d=u[0],m=u[1],p=Object(r.useState)(a/8),E=Object(Ie.a)(p,2),f=E[0],b=E[1],h=function(e,t){l(e),m(t)},g=function(e){b(e)},O={x:o-f,y:d};return{diskRoiParameters:{roi:{shape:"disk",cx:o,cy:d,r:f}},diskRoiHandles:function(e,a){return r.createElement(r.Fragment,null,r.createElement(ht,{x:o,y:d,imageWidth:t,onDragMove:h,parentOnDragStart:e,parentOnDrop:a,constraint:$e(t,n)}),r.createElement(ht,{x:O.x,y:O.y,imageWidth:t,onDragMove:qe(o,d,g),parentOnDragStart:e,parentOnDrop:a,constraint:Ze(d)}))},diskRoiWidgets:r.createElement(rt,{cx:o,cy:d,r:f,imageWidth:t,imageHeight:n})}}({scanHeight:n,scanWidth:t}),F=P.diskRoiHandles,L=P.diskRoiWidgets,M=P.diskRoiParameters,N=function(e,t){return null},H={roi:{}};switch(p){case Rt.DISK:N=F,h=L,H=M;break;case Rt.RECT:N=D,h=I,H=A}switch(s){case Ct.PICK:N=T,h=void 0}return _t({enabled:s===Ct.SD,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,roiParameters:H,analysis:k.SD_FRAMES}),_t({enabled:s===Ct.SUM,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,roiParameters:H,analysis:k.SUM_FRAMES}),{frameViewTitle:s!==Ct.PICK?null:r.createElement(r.Fragment,null,"Pick: x=",w.cx,", y=",w.cy," \u2003"),frameModeSelector:r.createElement(r.Fragment,null,f," ",b),roiSelector:b,handles:N,widgets:h}},It=Object(o.b)((function(e,t){return{status:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.jobs;return n.length>0&&(a=e.jobs.filter((function(e,t){return-1!==n.indexOf(t)}))),a.reduce((function(e,n){return t.byId[n].running===Re.DONE?e:"busy"}),"idle")}(t.analysis,e.jobs,t.busyIdxs)}}),(function(e,t){return{handleRemove:function(){return e(gt.remove(t.analysis.id))}}}))((function(e){var t=e.status,n=e.onApply,a=e.handleRemove,c="busy"===t?{name:"cog",loading:!0}:{name:"check"};return r.createElement(x.a,{attached:"bottom"},r.createElement(H.a.Group,null,r.createElement(H.a,{primary:!0,onClick:n,icon:!0},r.createElement(h.a,c),"Apply"),r.createElement(H.a,{onClick:a,icon:!0},r.createElement(h.a,{name:"remove"}),"Remove")))})),At=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(u/4),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=Object(o.c)(),S={x:p-v,y:h},C=T((function(e,t){E(e),g(t)})),R=T(j),w=r.createElement(rt,{cx:p,cy:h,r:v,imageWidth:s,imageHeight:l}),_=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),D=_.frameViewTitle,I=_.frameModeSelector,A=_.handles,P=_.widgets,F=r.createElement(r.Fragment,null,D," Disk: center=(x=",p.toFixed(2),", y=",h.toFixed(2),"), r=",v.toFixed(2)),L=r.createElement(It,{analysis:t,onApply:function(){x(gt.run(t.id,1,{type:k.CENTER_OF_MASS,parameters:{shape:"com",cx:p,cy:h,r:v}}))},busyIdxs:[1]});return r.createElement(yt,{title:"COM analysis",subtitle:F,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(bt,{x:p,y:h,imageWidth:s,onDragMove:C,parentOnDragStart:e,parentOnDrop:t,constraint:$e(s,l)}),r.createElement(bt,{x:S.x,y:S.y,imageWidth:s,onDragMove:qe(p,h,R),parentOnDragStart:e,parentOnDrop:t,constraint:Ze(h)}))},extraWidgets:w,jobIndex:0,analysis:t.id,width:s,height:l,selectors:I})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:A,extraWidgets:P})),toolbar:L})},Pt=n(693);function Ft(e,t,n,a){n===t&&(n+=360);var r=n-t;r=r<0?r+360:r;var c=[];return c.push(kt(t,a,e)),c.push(kt(t+r/3,a,e)),c.push(kt(t+2*r/3,a,e)),c.push(kt(n,a,e)),function(e,t,n){return["M",e[0].x,e[0].y,"A",t,t,0,0,n,e[1].x,e[1].y,"A",t,t,0,0,n,e[2].x,e[2].y,"A",t,t,0,0,n,e[3].x,e[3].y].join(" ")}(c,a,r<180?0:1)}function kt(e,t,n){var a=e*Math.PI/180;return{x:Math.cos(a)*t+n.x,y:Math.sin(a)*t+n.y}}function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nt,Ht=function(e){var t=e.imageWidth,n=e.cx,a=e.cy,c=e.ri,i=[Ft({x:n+.5,y:a+.5},90,90,e.ro),Ft({x:n+.5,y:a+.5},90,90,c)].join(" ");return r.createElement("path",{d:i,fillRule:"evenodd",style:Mt({},tt(t))})},Wt=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.mid,i=e.right,o=e.toolbar,l=e.clustparams,s=e.title1,u=e.title2,d=e.title3;return r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h3",attached:"top"},r.createElement(h.a,{name:"cog"}),r.createElement(O.a.Content,null,t)),r.createElement(x.a,{attached:!0},r.createElement(Ot.a,{columns:3},r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:4},r.createElement("p",null,s)),r.createElement(Ot.a.Column,{width:6},r.createElement("p",null,u)),r.createElement(Ot.a.Column,{width:6},r.createElement("p",null,d))),r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:4},a),r.createElement(Ot.a.Column,{width:6},c),r.createElement(Ot.a.Column,{width:6},i)),r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:16},r.createElement("div",null,l),r.createElement("p",null,n))))),o)},Bt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),g=b[0],O=b[1],y=Object(r.useState)(u/4),v=Object(Ie.a)(y,2),j=v[0],x=v[1],S=Object(r.useState)(u/2),C=Object(Ie.a)(S,2),R=C[0],w=C[1],_={x:p-j,y:g},D={x:p-R,y:g},I=r.useState(1),A=Object(Ie.a)(I,2),P=A[0],F=A[1],L=r.useState(500),M=Object(Ie.a)(L,2),H=M[0],W=M[1],B=r.useState(20),U=Object(Ie.a)(B,2),G=U[0],K=U[1],J=T((function(e,t){E(e),O(t)})),z=T(x),V=T(w),Y=r.createElement(Ht,{cx:p,cy:g,ri:j,ro:R,imageWidth:s}),X=Object(o.c)(),$=Tt({scanWidth:i,scanHeight:c}),q=$.rectRoiParameters,Z=$.rectRoiHandles,Q=$.rectRoiWidgets;r.useEffect((function(){X(gt.run(t.id,1,{type:k.SUM_SIG,parameters:{}}))}),[t.id,X]);var ee=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),te=ee.frameViewTitle,ne=ee.frameModeSelector,ae=ee.handles,re=ee.widgets,ce=r.createElement(r.Fragment,null,te," Ring: center=(x=",p.toFixed(2),", y=",g.toFixed(2),"), ri=",j.toFixed(2),", ro=",R.toFixed(2)),ie=r.createElement(It,{analysis:t,onApply:function(){X(gt.run(t.id,2,{type:k.CLUST,parameters:{roi:q.roi,cx:p,cy:g,ri:j,ro:R,n_clust:G,n_peaks:H,min_dist:P}}))},busyIdxs:[2]}),oe=r.useState(!1),le=Object(Ie.a)(oe,2),se=le[0],ue=le[1],de=r.createElement(Pt.a,null,r.createElement(Pt.a.Title,{active:se,index:0,onClick:function(e){ue(!se)}},r.createElement(h.a,{name:"dropdown"}),"Parameters"),r.createElement(Pt.a.Content,{active:se},r.createElement(N.a,null,r.createElement(N.a.Field,null,r.createElement("label",null," Number of clusters  ",r.createElement("input",{type:"number",value:G,step:"1",min:"2",max:"100",onChange:function(e){K(e.target.valueAsNumber)}})," ")),r.createElement(N.a.Field,null,r.createElement("label",null,"  Maximal number of possible peak positions to detect (better put higher value, the output is limited to the number of peaks the algorithm could find)  ",r.createElement("input",{type:"number",value:H,step:"1",min:"5",max:"200",onChange:function(e){W(e.target.valueAsNumber)}})," ")),r.createElement(N.a.Field,null,r.createElement("label",null,"  Minimal distance in pixels between peaks  ",r.createElement("input",{type:"number",value:P,step:"1",min:"0",max:"100",onChange:function(e){F(e.target.valueAsNumber)}}),"  ")))));return r.createElement(Wt,{title:"Region clustering",subtitle:ce,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:g,imageWidth:s,onDragMove:J,parentOnDrop:t,parentOnDragStart:e,constraint:$e(s,l)}),r.createElement(ht,{x:D.x,y:D.y,imageWidth:s,onDragMove:qe(p,g,V),parentOnDrop:t,parentOnDragStart:e,constraint:et(_.x,g)}),r.createElement(ht,{x:_.x,y:_.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:qe(p,g,z),constraint:Qe(D.x,g)}))},extraWidgets:Y,jobIndex:0,analysis:t.id,width:s,height:l,selectors:ne})),mid:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:Z,extraWidgets:Q})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:2,analysis:t.id,width:i,height:c,extraHandles:ae,extraWidgets:re})),toolbar:ie,clustparams:de,title1:"Peaks inside the ring will be considered",title2:"Choose specimen region",title3:"Clustering result"})},Ut=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(u/4),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=function(e,t){E(e),g(t)},S=j,C={x:p-v,y:h},R=r.createElement(rt,{cx:p,cy:h,r:v,imageWidth:s,imageHeight:l}),w=Object(o.c)(),T=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),_=T.frameViewTitle,D=T.frameModeSelector,I=T.handles,A=T.widgets,P=r.createElement(r.Fragment,null,_," Disk: center=(x=",p.toFixed(2),", y=",h.toFixed(2),"), r=",v.toFixed(2)),F=r.createElement(It,{analysis:t,onApply:function(){w(gt.run(t.id,1,{type:k.APPLY_DISK_MASK,parameters:{shape:"disk",cx:p,cy:h,r:v}}))},busyIdxs:[1]});return r.createElement(yt,{title:"Disk analysis",subtitle:P,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:h,imageWidth:s,onDragMove:x,parentOnDragStart:e,parentOnDrop:t,constraint:$e(s,l)}),r.createElement(ht,{x:C.x,y:C.y,imageWidth:s,onDragMove:qe(p,h,S),parentOnDragStart:e,parentOnDrop:t,constraint:Ze(h)}))},extraWidgets:R,jobIndex:0,analysis:t.id,width:s,height:l,selectors:D})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:I,extraWidgets:A})),toolbar:F})},Gt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(u/4),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=Object(r.useState)(u/2),S=Object(Ie.a)(x,2),C=S[0],R=S[1],w={x:p-v,y:h},_={x:p-C,y:h},D=T((function(e,t){E(e),g(t)})),I=T(j),A=T(R),P=r.createElement(Ht,{cx:p,cy:h,ri:v,ro:C,imageWidth:s}),F=Object(o.c)(),L=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),M=L.frameViewTitle,N=L.frameModeSelector,H=L.handles,W=L.widgets,B=r.createElement(r.Fragment,null,M," Ring: center=(x=",p.toFixed(2),", y=",h.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),U=r.createElement(It,{analysis:t,onApply:function(){F(gt.run(t.id,1,{type:k.FEM,parameters:{shape:"ring",cx:p,cy:h,ri:v,ro:C}}))},busyIdxs:[1]});return r.createElement(yt,{title:"Fluctuation EM (SD over Ring analysis)",subtitle:B,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:h,imageWidth:s,onDragMove:D,parentOnDrop:t,parentOnDragStart:e,constraint:$e(s,l)}),r.createElement(ht,{x:_.x,y:_.y,imageWidth:s,onDragMove:qe(p,h,A),parentOnDrop:t,parentOnDragStart:e,constraint:et(w.x,h)}),r.createElement(ht,{x:w.x,y:w.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:qe(p,h,I),constraint:Qe(_.x,h)}))},extraWidgets:P,jobIndex:0,analysis:t.id,width:s,height:l,selectors:N})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:H,extraWidgets:W})),toolbar:U})},Kt=function(e){var t=e.title,n=e.subtitle,a=e.left,c=e.mid,i=e.right,o=e.toolbar,l=e.title1,s=e.title2,u=e.title3;return r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h3",attached:"top"},r.createElement(h.a,{name:"cog"}),r.createElement(O.a.Content,null,t)),r.createElement(x.a,{attached:!0},r.createElement(Ot.a,{columns:3},r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:5},r.createElement("p",null,l)),r.createElement(Ot.a.Column,{width:5},r.createElement("p",null,s)),r.createElement(Ot.a.Column,{width:6},r.createElement("p",null,u))),r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:5},a),r.createElement(Ot.a.Column,{width:5},c),r.createElement(Ot.a.Column,{width:6},i)),r.createElement(Ot.a.Row,null,r.createElement(Ot.a.Column,{width:10},r.createElement("p",null,n)),r.createElement(Ot.a.Column,{width:6})))),o)},Jt=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.jobIndex,i=e.analysisId,l=e.cx,s=e.cy,u=e.real_rad,d=e.real_centerx,m=e.real_centery,p=e.setCx,E=e.setCy,f=Object(o.c)();c.a.useEffect((function(){t&&f(gt.run(i,r,{type:k.PICK_FFT_FRAME,parameters:{x:l,y:s,real_rad:u,real_centerx:d,real_centery:m}}))}),[i,l,s,t,r,u,d,m,f]);var b=function(e,t){var n=Math.round(e),a=Math.round(t);l===n&&s===a||(p(n),E(a))};return{coords:{cx:l,cy:s},handles:function(e,t){return c.a.createElement(ht,{x:l,y:s,withCross:!0,imageWidth:n,onDragMove:b,parentOnDragStart:e,parentOnDrop:t,constraint:$e(n,a)})}}},zt=function(e){var t=e.enabled,n=e.jobIndex,a=e.analysisId,r=e.real_rad,i=e.real_centerx,l=e.real_centery,s=Object(o.c)();c.a.useEffect((function(){t&&s(gt.run(a,n,{type:k.FFTSUM_FRAMES,parameters:{real_rad:r,real_centerx:i,real_centery:l}}))}),[a,t,n,r,i,l,s])},Vt=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.analysisId,c=e.real_rad,i=e.real_centerx,o=e.real_centery,l=[{text:"Pick",value:k.PICK_FRAME},{text:"Average",value:k.SUM_FRAMES}],s=Object(r.useState)(k.SUM_FRAMES),u=Object(Ie.a)(s,2),d=u[0],m=u[1],p=r.createElement(jt,{modes:l,currentMode:d,onModeChange:m,label:"Mode"}),E=r.useState(Math.round(t/2)),f=Object(Ie.a)(E,2),b=f[0],h=f[1],g=r.useState(Math.round(n/2)),O=Object(Ie.a)(g,2),y=O[0],v=O[1],j=vt({enabled:d===k.PICK_FRAME,scanWidth:t,scanHeight:n,jobIndex:1,analysisId:a,cx:b,cy:y,setCx:h,setCy:v}),x=j.coords,S=j.handles;Jt({enabled:d===k.PICK_FRAME,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,cx:b,cy:y,setCx:h,setCy:v,real_rad:c,real_centerx:i,real_centery:o}),_t({enabled:d===k.SUM_FRAMES,jobIndex:1,analysisId:a,scanWidth:t,scanHeight:n,roiParameters:{roi:{}},analysis:k.SUM_FRAMES}),zt({enabled:d===k.SUM_FRAMES,jobIndex:0,analysisId:a,real_rad:c,real_centerx:i,real_centery:o});return{frameViewTitle:d!==k.PICK_FRAME?null:r.createElement(r.Fragment,null,"Pick: x=",x.cx,", y=",x.cy," \u2003"),handles:d!==k.PICK_FRAME?function(e,t){return null}:S,frameModeSelector:p}},Yt=function(e){var t,n,a=e.analysis,c=e.dataset.params.shape,i=Object(Ie.a)(c,4),l=i[0],s=i[1],u=i[2],d=i[3],m=Math.min(d,u),p=d/2,E=u/2,f=Object(r.useState)(m/4),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(m/2),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=Object(o.c)(),S={x:p-h,y:E},C={x:p-v,y:E},R=T(g),w=T(j),_=r.createElement(Ht,{cx:p,cy:E,ri:h,ro:v,imageWidth:d}),D=r.useState(!0),I=Object(Ie.a)(D,2),A=I[0],P=I[1],F=Object(r.useState)(d/2),L=Object(Ie.a)(F,2),M=L[0],N=L[1],H=Object(r.useState)(u/2),W=Object(Ie.a)(H,2),B=W[0],U=W[1],G=Object(r.useState)(m/4),K=Object(Ie.a)(G,2),J=K[0],z=K[1],V=T((function(e,t){N(e),U(t)})),Y=T(z),X={x:M-J,y:B},$=r.createElement(rt,{cx:M,cy:B,r:J,imageWidth:d,imageHeight:u}),q=Vt({scanWidth:s,scanHeight:l,analysisId:a.id,real_rad:A?J:null,real_centerx:A?M:null,real_centery:A?B:null}),Z=q.frameViewTitle,Q=q.frameModeSelector,ee=q.handles,te=r.createElement(It,{analysis:a,onApply:function(){x(gt.run(a.id,2,{type:k.APPLY_FFT_MASK,parameters:{rad_in:h,rad_out:v,real_rad:A?J:null,real_centerx:A?M:null,real_centery:A?B:null}}))},busyIdxs:[2]});return A?(n=r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:M,y:B,imageWidth:d,onDragMove:V,parentOnDragStart:e,parentOnDrop:t,constraint:$e(d,u)}),r.createElement(ht,{x:X.x,y:X.y,imageWidth:d,onDragMove:qe(M,B,Y),parentOnDragStart:e,parentOnDrop:t,constraint:Ze(B)}))},extraWidgets:$,jobIndex:1,analysis:a.id,width:d,height:u,selectors:Q})),t=r.createElement(r.Fragment,null,Z," real_rad=",h.toFixed(2),", real_center=(x=",M.toFixed(2),", y=",B.toFixed(2),"), fourier_rad_in=",h.toFixed(2),", fourier_rad_out=",v.toFixed(2))):(n=r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:a.id,width:d,height:u,selectors:Q})),t=r.createElement(r.Fragment,null,Z," fourier_rad_in=",h.toFixed(2),", fourier_rad_out=",v.toFixed(2))),r.createElement(Kt,{title:"FFT analysis",subtitle:t,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:C.x,y:C.y,imageWidth:d,onDragMove:qe(p,E,w),parentOnDrop:t,parentOnDragStart:e,constraint:et(S.x,E)}),r.createElement(ht,{x:S.x,y:S.y,imageWidth:d,parentOnDrop:t,parentOnDragStart:e,onDragMove:qe(p,E,R),constraint:Qe(C.x,E)}))},extraWidgets:_,jobIndex:0,analysis:a.id,width:d,height:u})),mid:n,right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:2,analysis:a.id,width:s,height:l,extraHandles:ee})),toolbar:te,title2:r.createElement(r.Fragment,null,r.createElement("label",null," Masking out of zero order diffraction peak ",r.createElement("input",{type:"checkbox",name:"check",onChange:function(e){P(e.target.checked)},checked:A})," ")),title1:"Masking of intergation region in Fourier space",title3:"Result of analysis"})},Xt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Object(r.useState)(s/2),d=Object(Ie.a)(u,2),m=d[0],p=d[1],E=Object(r.useState)(l/2),f=Object(Ie.a)(E,2),b=f[0],h=f[1],g=T((function(e,t){p(e),h(t)})),O=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),y=O.frameViewTitle,v=O.frameModeSelector,j=O.handles,x=O.widgets,S=r.createElement(r.Fragment,null,y," Point: center=(x=",m.toFixed(2),", y=",b.toFixed(2),")"),C=Object(o.c)(),R=r.createElement(It,{analysis:t,onApply:function(){C(gt.run(t.id,1,{type:k.APPLY_POINT_SELECTOR,parameters:{shape:"point",cx:m,cy:b}}))},busyIdxs:[1]});return r.createElement(yt,{title:"Point analysis",subtitle:S,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:m,y:b,withCross:!0,onDragMove:g,imageWidth:s,parentOnDragStart:e,parentOnDrop:t,constraint:$e(s,l)}))},jobIndex:0,analysis:t.id,width:s,height:l,selectors:v})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:j,extraWidgets:x})),toolbar:R})},$t=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(u/4),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=Object(r.useState)(u/2),S=Object(Ie.a)(x,2),C=S[0],R=S[1],w=Object(r.useState)(1),_=Object(Ie.a)(w,1)[0],D=Object(r.useState)(8),I=Object(Ie.a)(D,1)[0],A={x:p-v,y:h},P={x:p-C,y:h},F=T((function(e,t){E(e),g(t)})),L=T(j),M=T(R),N=r.createElement(Ht,{cx:p,cy:h,ri:v,ro:C,imageWidth:s}),H=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),W=H.frameViewTitle,B=H.frameModeSelector,U=H.handles,G=H.widgets,K=r.createElement(r.Fragment,null,W," Ring: center=(x=",p.toFixed(2),", y=",h.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),J=Object(o.c)(),z=r.createElement(It,{analysis:t,onApply:function(){J(gt.run(t.id,1,{type:k.RADIAL_FOURIER,parameters:{shape:"radial_fourier",cx:p,cy:h,ri:v,ro:C,n_bins:_,max_order:I}}))},busyIdxs:[1]});return r.createElement(yt,{title:"Radial Fourier analysis",subtitle:K,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:h,imageWidth:s,onDragMove:F,parentOnDrop:t,parentOnDragStart:e,constraint:$e(s,l)}),r.createElement(ht,{x:P.x,y:P.y,imageWidth:s,onDragMove:qe(p,h,M),parentOnDrop:t,parentOnDragStart:e,constraint:et(A.x,h)}),r.createElement(ht,{x:A.x,y:A.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:qe(p,h,L),constraint:Qe(P.x,h)}))},extraWidgets:N,jobIndex:0,analysis:t.id,width:s,height:l,selectors:B})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:U,extraWidgets:G})),toolbar:z})},qt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Ie.a)(n,4),c=a[0],i=a[1],l=a[2],s=a[3],u=Math.min(s,l),d=Object(r.useState)(s/2),m=Object(Ie.a)(d,2),p=m[0],E=m[1],f=Object(r.useState)(l/2),b=Object(Ie.a)(f,2),h=b[0],g=b[1],O=Object(r.useState)(u/4),y=Object(Ie.a)(O,2),v=y[0],j=y[1],x=Object(r.useState)(u/2),S=Object(Ie.a)(x,2),C=S[0],R=S[1],w={x:p-v,y:h},_={x:p-C,y:h},D=T((function(e,t){E(e),g(t)})),I=T(j),A=T(R),P=r.createElement(Ht,{cx:p,cy:h,ri:v,ro:C,imageWidth:s}),F=Object(o.c)(),L=Dt({scanWidth:i,scanHeight:c,analysisId:t.id}),M=L.frameViewTitle,N=L.frameModeSelector,H=L.handles,W=L.widgets,B=r.createElement(r.Fragment,null,M," Ring: center=(x=",p.toFixed(2),", y=",h.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),U=r.createElement(It,{analysis:t,onApply:function(){F(gt.run(t.id,1,{type:k.APPLY_RING_MASK,parameters:{shape:"ring",cx:p,cy:h,ri:v,ro:C}}))},busyIdxs:[1]});return r.createElement(yt,{title:"Ring analysis",subtitle:B,left:r.createElement(r.Fragment,null,r.createElement(Xe,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ht,{x:p,y:h,imageWidth:s,onDragMove:D,parentOnDrop:t,parentOnDragStart:e,constraint:$e(s,l)}),r.createElement(ht,{x:_.x,y:_.y,imageWidth:s,onDragMove:qe(p,h,A),parentOnDrop:t,parentOnDragStart:e,constraint:et(w.x,h)}),r.createElement(ht,{x:w.x,y:w.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:qe(p,h,I),constraint:Qe(_.x,h)}))},extraWidgets:P,jobIndex:0,analysis:t.id,width:s,height:l,selectors:N})),right:r.createElement(r.Fragment,null,r.createElement(Xe,{jobIndex:1,analysis:t.id,width:i,height:c,extraHandles:H,extraWidgets:W})),toolbar:U})},Zt=(Nt={},Object(A.a)(Nt,k.APPLY_RING_MASK,{desc:"Apply a ring mask with center cx, cy; inner radius ri, outer radius ro",title:"Ring",component:qt}),Object(A.a)(Nt,k.APPLY_DISK_MASK,{desc:"Apply a disk mask with center cx, cy; radius r",title:"Disk",component:Ut}),Object(A.a)(Nt,k.FEM,{desc:"Apply a ring mask with center cx, cy; radius r",title:"FEM (SD over Ring)",component:Gt}),Object(A.a)(Nt,k.CENTER_OF_MASS,{desc:"Compute the center of mass of all diffraction images",title:"Center of mass",component:At}),Object(A.a)(Nt,k.APPLY_POINT_SELECTOR,{desc:"Create an image from a single pixel selected in the detector",title:"Point selection",component:Xt}),Object(A.a)(Nt,k.SUM_FRAMES,{desc:"Create a sum of all detector frames",title:"Sum all frames"}),Object(A.a)(Nt,k.SD_FRAMES,{desc:"Create a SD of all detector frames",title:"SD all frames"}),Object(A.a)(Nt,k.PICK_FRAME,{desc:"Pick a single frame",title:"Pick frame"}),Object(A.a)(Nt,k.PICK_FFT_FRAME,{desc:"Pick a single frame",title:"Pick frame"}),Object(A.a)(Nt,k.APPLY_FFT_MASK,{desc:"Apply a ring mask with inner radius fourier_rad_in and outer radius fourier_rad_out in Fourier space",title:"FFT analysis",component:Yt}),Object(A.a)(Nt,k.FFTSUM_FRAMES,{desc:"Fourier transform of sum of all detector frames",title:"FFT of Sum all frames"}),Object(A.a)(Nt,k.RADIAL_FOURIER,{desc:"Compute a radial Fourier analysis",title:"Radial Fourier",component:$t}),Object(A.a)(Nt,k.CLUST,{desc:"Region clustering based on non-zero order diffraction peaks positions",title:"Clustering",component:Bt}),Object(A.a)(Nt,k.SUM_SIG,{desc:"Frame integration",title:"Sum"}),Nt),Qt=function(e){var t=e.analysis,n=Object(o.d)((function(e){return e.datasets.byId[t.dataset]}));if(n.status!==F.OPEN)return null;var a=Zt[t.mainAnalysisType].component;if(!a)throw new Error("unknown analysis type");return r.createElement(a,{dataset:n,analysis:t})},en=function(e){var t=e.analyses;return r.createElement(r.Fragment,null,t.ids.map((function(e){return r.createElement(Qt,{key:e,analysis:t.byId[e]})})))};function tn(e,t,n){var a=Object.assign({},e.byId[t],n),r=Object.assign({},e.byId,Object(A.a)({},t,a));return Object.assign({},e,{byId:r})}function nn(e,t,n){return{byId:Object.assign({},e.byId,Object(A.a)({},t,n)),ids:[].concat(Object(Ae.a)(e.ids),[t])}}function an(e,t){var n=e.ids.filter((function(n){return t(e.byId[n])}));return{byId:n.reduce((function(t,n){return Object.assign(t,Object(A.a)({},n,e.byId[n]))}),{}),ids:n}}var rn,cn=function(e){var t=k[e];return Zt[t]},on=_(k).filter((function(e){return void 0!==cn(e).component})).map((function(e){return{text:cn(e).title,value:k[e]}})),ln=function(e){var t=e.onClick,n=e.label;return r.createElement(j.a,{text:n,icon:"add",floating:!0,labeled:!0,button:!0,className:"icon"},r.createElement(j.a.Menu,null,r.createElement(j.a.Header,{content:"implemented analyses"}),on.map((function(e){return r.createElement(j.a.Item,Object.assign({key:e.value,onClick:(n=t,function(e,t){return n(t.value)})},e));var n}))))},sn=Object(o.b)(null,(function(e,t){return{handleAddAnalysis:function(n){e(gt.create(t.dataset.id,n))}}}))((function(e){var t=e.handleAddAnalysis;return r.createElement(ln,{onClick:t,label:"Add analysis"})})),un=n(690),dn=function(e){return Object.keys(e).map((function(t,n){return r.createElement(un.a.Row,{key:n},r.createElement(un.a.Cell,null,t),r.createElement(un.a.Cell,null,(a=e[t])instanceof Array?"(".concat(a.join(","),")"):a));var a}))},mn=function(e){var t=e.dataset;return r.createElement(un.a,null,r.createElement(un.a.Header,null,r.createElement(un.a.Row,null,r.createElement(un.a.HeaderCell,null,"Parameter"),r.createElement(un.a.HeaderCell,null,"Value"))),r.createElement(un.a.Body,null,dn(t.params)))},pn=function(e){var t=e.elem;return r.createElement(un.a.Row,null,r.createElement(un.a.Cell,null,t.name),r.createElement(un.a.Cell,null,function(e){return e.value instanceof Array?r.createElement(En,{diagnostics:e.value}):e.value}(t)))},En=function(e){var t=e.diagnostics;return 0===t.length?null:r.createElement(un.a,null,r.createElement(un.a.Header,null,r.createElement(un.a.Row,null,r.createElement(un.a.HeaderCell,null,"Name"),r.createElement(un.a.HeaderCell,null,"Value"))),r.createElement(un.a.Body,null,t.map((function(e,t){return r.createElement(pn,{elem:e,key:t})}))))},fn=function(e){var t=e.dataset;return r.createElement(r.Fragment,null,r.createElement(mn,{dataset:t}),r.createElement(En,{diagnostics:t.diagnostics}))};!function(e){e.OPEN="DATASET_OPEN",e.CANCEL_OPEN="DATASET_CANCEL_OPEN",e.CREATE="DATASET_CREATE",e.CREATED="DATASET_CREATED",e.ERROR="DATASET_ERROR",e.DELETE="DATASET_DELETE",e.DELETED="DATASET_DELETED",e.DETECT="DATASET_DETECT",e.DETECTED="DATASET_DETECTED",e.DETECT_FAILED="DATASET_DETECT_FAILED"}(rn||(rn={}));var bn={open:function(e,t,n){return S(rn.OPEN,{path:e,cachedParams:t,detectedParams:n})},cancelOpen:function(){return S(rn.CANCEL_OPEN)},create:function(e){return S(rn.CREATE,{dataset:e})},created:function(e){return S(rn.CREATED,{dataset:e})},error:function(e,t,n,a){return S(rn.ERROR,{dataset:e,msg:t,timestamp:n,id:a})},delete:function(e){return S(rn.DELETE,{dataset:e})},deleted:function(e){return S(rn.DELETED,{dataset:e})},detect:function(e){return S(rn.DETECT,{path:e})},detected:function(e,t){return S(rn.DETECTED,{path:e,params:t})},detectFailed:function(e){return S(rn.DETECT_FAILED,{path:e})}},hn=Object(o.b)(null,(function(e,t){return{handleRemoveDataset:function(){e(bn.delete(t.dataset.id))}}}))((function(e){e.dataset;var t=e.handleRemoveDataset;return r.createElement(r.Fragment,null,r.createElement(H.a,{icon:"remove",labelPosition:"left",onClick:t,content:"Close Dataset"}))})),gn=Object(o.b)((function(e,t){return{analyses:an(e.analyses,(function(e){return e.dataset===t.dataset.id}))}}))((function(e){var t,n=e.dataset,a=e.analyses,c=(t={},Object(A.a)(t,F.OPENING,"Opening dataset ".concat(n.params.name)),Object(A.a)(t,F.DELETING,"Closing dataset ".concat(n.params.name)),t);return n.status===F.OPENING||n.status===F.DELETING?r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h2",dividing:!0},n.params.name),r.createElement(X.a,{icon:!0},r.createElement(h.a,{name:"cog",loading:!0}),r.createElement(X.a.Content,null,r.createElement(X.a.Header,null,c[n.status])))):r.createElement(x.a.Group,{style:{marginTop:"3em",marginBottom:"3em"}},r.createElement(x.a.Group,{horizontal:!0},r.createElement(x.a,null,r.createElement(O.a,{as:"h2"},r.createElement(h.a,{name:"database"}),r.createElement(b.a,{trigger:r.createElement(O.a.Content,null,n.params.name," ",r.createElement(h.a,{name:"info circle",size:"small",link:!0}))},r.createElement(g.a.Header,null,n.params.type," Dataset ",n.params.name),r.createElement(g.a.Content,null,r.createElement(fn,{dataset:n}))))),r.createElement(x.a,{style:{flexShrink:1,flexGrow:0}},r.createElement(hn,{dataset:n}))),a.ids.length>0?r.createElement(r.Fragment,null,r.createElement(x.a,null,r.createElement(en,{analyses:a}))):null,r.createElement(x.a,{textAlign:"center"},r.createElement(sn,{dataset:n})))})),On=n(29),yn=n.n(On),vn=n(234),jn=n(11),xn=n.n(jn),Sn=n(173),Cn=n(372),Rn=n.n(Cn);function wn(e,t){return fetch("/api/datasets/".concat(e,"/"),{body:JSON.stringify(t),credentials:"same-origin",method:"PUT"}).then((function(e){return e.json()}))}function Tn(e){return fetch("/api/datasets/".concat(e,"/"),{credentials:"same-origin",method:"DELETE"}).then((function(e){return e.json()}))}function _n(e){return fetch("/api/datasets/detect/?path=".concat(encodeURIComponent(e)),{credentials:"same-origin",method:"GET"}).then((function(e){return e.json()}))}var Dn={};function In(e){return An.apply(this,arguments)}function An(){return(An=Object(Sn.a)(xn.a.mark((function e(t){var n,a,r;return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=Dn[t])){e.next=5;break}return e.abrupt("return",new Promise((function(e){return e(n)})));case 5:return e.next=7,fetch("/api/datasets/schema/?type=".concat(encodeURIComponent(t)),{credentials:"same-origin",method:"GET"});case 7:return a=e.sent,e.next=10,a.json();case 10:return r=e.sent,Dn[t]=r,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(e){var t={};return e.forEach((function(e){var n=e.dataPath.replace(/^\.([^[]+)(\[[^]+\])?$/,(function(e,t){return t}));t[n]=e.message})),t}function Fn(){return(Fn=Object(Sn.a)(xn.a.mark((function e(t,n){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",In(t).then((function(e){if("error"===e.status)throw new Error(e.msg);var t=e.schema,a=(new Rn.a).compile(t);if(!a(n)){if(a.errors)throw Pn(a.errors);throw new Error("unspecified error while validating fields")}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kn(e){return e.split(",").filter((function(e){return""!==e.trim()})).map((function(e){return+e}))}function Ln(e,t,n){return n&&void 0!==n[e]?n[e]:t}function Mn(e,t,n){return n&&void 0!==n[e]?n[e]:vn.basename(t)}function Nn(e){return Object(M.c)({mapPropsToValues:e.mapPropsToValues,handleSubmit:function(t,n){var a=n.props,r=a.onSubmit,c=a.path;r(e.formToJson(t,c)),n.setSubmitting(!1)},validate:function(t,n){return function(e,t){return Fn.apply(this,arguments)}(e.type,e.formToJson(t,n.path))},enableReinitialize:!0,validateOnChange:!0,validateOnBlur:!0})}var Hn=Nn({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:Mn("name",t,n),tileshape:Ln("tileshape","1, 8, 128, 128",n).toString()}},formToJson:function(e,t){return{path:t,type:P.BLO,name:e.name,tileshape:kn(e.tileshape)}},type:P.BLO})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.isValidating,i=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement(M.a,{name:"tileshape"}),r.createElement(M.b,{name:"tileshape",id:"id_tileshape"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t||c},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:i},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Wn=_(P).map((function(e){return{text:P[e],value:P[e]}})),Bn=function(e){var t=e.currentType,n=e.onClick;return r.createElement(r.Fragment,null,r.createElement(j.a,{inline:!0,options:Wn,value:t,onChange:n}))},Un=Nn({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:Mn("name",t,n),scan_size:Ln("scan_size","",n).toString()}},formToJson:function(e,t){return{path:t,type:P.EMPAD,name:e.name,scan_size:kn(e.scan_size)}},type:P.EMPAD})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement(M.a,{name:"scan_size"}),r.createElement(M.b,{name:"scan_size",id:"id_scan_size"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Gn=Nn({mapPropsToValues:function(e){return{name:Mn("name",e.path,e.initial)}},formToJson:function(e,t){return{path:t,type:P.FRMS6,name:e.name}},type:P.FRMS6})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Kn=Nn({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:Mn("name",t,n),tileshape:Ln("tileshape","1, 8, 128, 128",n).toString(),ds_path:Ln("ds_path","",n)}},formToJson:function(e,t){return{path:t,type:P.HDF5,name:e.name,ds_path:e.ds_path,tileshape:kn(e.tileshape)}},type:P.HDF5})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_ds_path"},"HDF5 Dataset Path:"),r.createElement(M.a,{name:"ds_path"}),r.createElement(M.b,{name:"ds_path",id:"id_ds_path"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement(M.a,{name:"tileshape"}),r.createElement(M.b,{name:"tileshape",id:"id_tileshape"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Jn=Nn({mapPropsToValues:function(e){return{name:Mn("name",e.path,e.initial)}},formToJson:function(e,t){return{path:t,type:P.K2IS,name:e.name}},type:P.K2IS})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),zn=Nn({formToJson:function(e,t){return{path:t,type:P.MIB,name:e.name,tileshape:kn(e.tileshape),scan_size:kn(e.scan_size)}},mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:Mn("name",t,n),tileshape:Ln("tileshape","1, 8, 256, 256",n).toString(),scan_size:Ln("scan_size","",n).toString()}},type:P.MIB})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.isValidating,i=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement(M.a,{name:"tileshape"}),r.createElement(M.b,{name:"tileshape",id:"id_tileshape"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement(M.a,{name:"scan_size"}),r.createElement(M.b,{name:"scan_size",id:"id_scan_size"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t||c},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:i},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Vn=Nn({mapPropsToValues:function(e){var t=e.path,n=e.initial;return{name:Mn("name",t,n),enable_direct:Ln("enable_direct",!1,n),detector_size:Ln("detector_size","",n).toString(),scan_size:Ln("scan_size","",n).toString(),dtype:Ln("dtype","float32",n)}},formToJson:function(e,t){return{path:t,type:P.RAW,name:e.name,dtype:e.dtype,enable_direct:e.enable_direct,scan_size:kn(e.scan_size),detector_size:kn(e.detector_size)}},type:P.RAW})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement(M.a,{name:"scan_size"}),r.createElement(M.b,{name:"scan_size",id:"id_scan_size"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_dtype"},"Datatype (uint16, uint32, float32, float64, >u2, ..., can be anything that is ",r.createElement("a",{href:"https://docs.scipy.org/doc/numpy-1.15.1/reference/arrays.dtypes.html"},"understood by numpy as a dtype"),"):"),r.createElement(M.a,{name:"dtype"}),r.createElement(M.b,{name:"dtype",id:"id_dtype"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_detector_size"},"Detector Size (pixels, example: 256,256):"),r.createElement(M.a,{name:"detector_size"}),r.createElement(M.b,{name:"detector_size",id:"id_detector_size"})),r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_enable_direct"},"Enable Direct I/O (for usage with fast SSDs and files much larger than RAM):"),r.createElement(M.a,{name:"enable_direct"}),r.createElement(M.b,{type:"checkbox",name:"enable_direct",id:"id_enable_direct"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))})),Yn=Nn({mapPropsToValues:function(e){return{name:Mn("name",e.path,e.initial)}},formToJson:function(e,t){return{path:t,type:P.SER,name:e.name}},type:P.SER})((function(e){e.values,e.touched,e.errors,e.dirty;var t=e.isSubmitting,n=(e.handleChange,e.handleBlur,e.handleSubmit),a=e.handleReset,c=e.onCancel;return r.createElement(N.a,{onSubmit:n},r.createElement(N.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement(M.a,{name:"name"}),r.createElement(M.b,{name:"name",id:"id_name"})),r.createElement(H.a,{primary:!0,type:"submit",disabled:t},"Load Dataset"),r.createElement(H.a,{type:"button",onClick:c},"Cancel"),r.createElement(H.a,{type:"button",onClick:a},"Reset"))}));function Xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var $n,qn=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;return e?a?a.type:P.RAW:n?n.type:a?a.type:P.RAW},Zn=function(e,t){var n=t.formCachedParams,a=t.formDetectedParams;return e?a?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xn(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({name:n?n.name:""},a):void 0:n||a},Qn=function(){var e=Object(o.c)(),t=Object(o.d)((function(e){return e.openDataset})),n=r.useState(!1),a=Object(Ie.a)(n,2),c=a[0],i=a[1],l=Zn(c,t),s=qn(c,t),u=r.useState(s),d=Object(Ie.a)(u,2),m=d[0],p=d[1],E=function(e,t){return p(t.value)},f=function(e){return r.createElement(x.a,null,"Type: ",r.createElement(Bn,{onClick:E,currentType:m}),r.createElement(O.a,{as:"h2"},"Open: ",t.formPath),e)},b={path:t.formPath,onSubmit:function(t){e(bn.create({id:yn()(),params:t}))},onCancel:function(){return e(bn.cancelOpen())},onReset:function(){i(!0),p(qn(!0,t))}};switch(m){case P.HDF5:var h=l&&m===l.type?l:void 0;return f(r.createElement(Kn,Object.assign({},b,{initial:h})));case P.RAW:var g=l&&m===l.type?l:void 0;return f(r.createElement(Vn,Object.assign({},b,{initial:g})));case P.MIB:var y=l&&m===l.type?l:void 0;return f(r.createElement(zn,Object.assign({},b,{initial:y})));case P.BLO:var v=l&&m===l.type?l:void 0;return f(r.createElement(Hn,Object.assign({},b,{initial:v})));case P.K2IS:var j=l&&m===l.type?l:void 0;return f(r.createElement(Jn,Object.assign({},b,{initial:j})));case P.SER:var S=l&&m===l.type?l:void 0;return f(r.createElement(Yn,Object.assign({},b,{initial:S})));case P.FRMS6:var C=l&&m===l.type?l:void 0;return f(r.createElement(Gn,Object.assign({},b,{initial:C})));case P.EMPAD:var R=l&&m===l.type?l:void 0;return f(r.createElement(Un,Object.assign({},b,{initial:R})))}return null},ea=Object(o.b)((function(e){return{busy:e.openDataset.busy,path:e.openDataset.busyPath}}))((function(e){var t=e.busy,n=e.path;return t?r.createElement(r.Fragment,null,r.createElement(O.a,{as:"h2",dividing:!0},"Loading..."),r.createElement(X.a,{icon:!0},r.createElement(h.a,{name:"cog",loading:!0}),r.createElement(X.a.Content,null,r.createElement(X.a.Header,null,"Detecting parameters for ",n)))):null})),ta=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.formVisible,n=e.datasets;return r.createElement(r.Fragment,null,n.ids.map((function(e){return r.createElement(gn,{dataset:n.byId[e],key:e})})),r.createElement(ea,null),t&&r.createElement(Qn,null),r.createElement(De,null))}}]),t}(r.Component),na=Object(o.b)((function(e){return{datasets:e.datasets,formVisible:e.openDataset.formVisible,formPath:e.openDataset.formPath}}))(ta);!function(e){e.DISMISS="ERROR_DISMISS",e.DISMISS_ALL="ERROR_DISMISS_ALL"}($n||($n={}));var aa=function(e){return S($n.DISMISS,{id:e})},ra=function(){return S($n.DISMISS_ALL)},ca=Object(o.b)(null,(function(e,t){return{dismiss:function(){return e(aa(t.error.id))}}}))((function(e){var t=e.dismiss,n=e.error;return r.createElement(X.a,{negative:!0,onDismiss:t},n.msg)})),ia=Object(o.b)((function(e){return{errors:e.errors,clusterConnected:"connected"===e.clusterConnection.status,channelConnected:"connected"===e.channelStatus.status||"ready"===e.channelStatus.status}}))((function(e){var t=e.errors,n=e.clusterConnected,a=e.channelConnected,c=t.ids.slice(Math.max(0,t.ids.length-3)),i=t.ids.length>0&&n&&a,l=Object(o.c)();return r.useEffect((function(){var e=function(e){"Escape"!==e.code&&27!==e.keyCode||l(ra())};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}})),r.createElement(b.a,{open:i},c.map((function(e){return r.createElement(ca,{error:t.byId[e],key:e})})))})),oa=n(373),la=n.n(oa),sa=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.createElement(f.a,{style:{margin:"5em 1em 5em 1em"}},r.createElement("div",{style:{display:"flex"}},r.createElement("img",{src:la.a,width:"200",height:"46",alt:"LiberTEM",style:{marginBottom:"20px"}})," ",r.createElement(b.a,{trigger:r.createElement(h.a,{name:"info circle",link:!0,style:{alignSelf:"flex-start"}})},r.createElement(g.a.Header,null,"About LiberTEM"),r.createElement(g.a.Content,null,r.createElement(v,null)))),r.createElement(ia,null),r.createElement(ee,null,r.createElement(na,null)))}}]),t}(r.Component),ua=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function da(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ma,pa=n(7);!function(e){e.CREATE="JOB_CREATE"}(ma||(ma={}));var Ea={create:function(e,t,n){return S(ma.CREATE,{id:e,dataset:t,timestamp:n})}};function fa(e,t,n){var a={job:{dataset:t,analysis:n}};return fetch("/api/jobs/".concat(e,"/"),{body:JSON.stringify(a),credentials:"same-origin",method:"PUT"}).then((function(e){return e.json()}))}function ba(e){return fetch("/api/jobs/".concat(e,"/"),{method:"DELETE",credentials:"same-origin"}).then((function(e){return e.json()}))}var ha=xn.a.mark(Sa),ga=xn.a.mark(Ca),Oa=xn.a.mark(Ra),ya=xn.a.mark(wa);function va(e,t){return e.datasets.byId[t]}function ja(e,t){return e.analyses.byId[t]}function xa(e,t){return e.jobs.byId[t]}function Sa(e){var t,n,a,r;return xn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(pa.h)(va,e.payload.dataset);case 3:if(c.sent.status===F.OPEN){c.next=6;break}throw new Error("invalid dataset status");case 6:return t={id:yn()(),dataset:e.payload.dataset,mainAnalysisType:e.payload.analysisType,jobs:[],jobHistory:[]},c.next=9,Object(pa.f)(Ca,t.id);case 9:return n=c.sent,c.next=12,Object(pa.g)(gt.created(t));case 12:return c.next=15,Object(pa.i)(ft.REMOVE);case 15:if(c.sent.payload.id!==t.id){c.next=19;break}return c.next=19,Object(pa.d)(n);case 19:c.next=12;break;case 21:c.next=29;break;case 23:return c.prev=23,c.t0=c.catch(0),a=Date.now(),r=yn()(),c.next=29,Object(pa.g)(gt.error("Error creating analysis: ".concat(c.t0.toString()),a,r));case 29:case"end":return c.stop()}}),ha,null,[[0,23]])}function Ca(e){var t,n,a,r,c,i,o,l,u,d,m;return xn.a.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Object(pa.a)(ft.RUN,s.b.sliding(2));case 2:t=p.sent;case 3:return p.prev=4,p.next=7,Object(pa.i)(t);case 7:if((n=p.sent).payload.id===e){p.next=10;break}return p.abrupt("continue",3);case 10:return p.next=12,Object(pa.h)(ja,e);case 12:return a=p.sent,r=n.payload,c=r.jobIndex,i=r.parameters,o=yn()(),p.next=17,Object(pa.g)(Ea.create(o,a.dataset,Date.now()));case 17:return p.next=19,Object(pa.g)(gt.prepareRun(a.id,c,o));case 19:if(void 0===(l=a.jobs[c])){p.next=27;break}return p.next=23,Object(pa.h)(xa,l);case 23:if(!(u=p.sent)||"DONE"===u.running){p.next=27;break}return p.next=27,Object(pa.c)(ba,l);case 27:return p.next=29,Object(pa.c)(fa,o,a.dataset,i);case 29:return p.next=31,Object(pa.g)(gt.running(a.id,o,c));case 31:p.next=39;break;case 33:return p.prev=33,p.t0=p.catch(4),d=Date.now(),m=yn()(),p.next=39,Object(pa.g)(gt.error("Error running analysis: ".concat(p.t0.toString()),d,m));case 39:p.next=3;break;case 41:case"end":return p.stop()}}),ga,null,[[4,33]])}function Ra(e){return xn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:return t.prev=1,t.next=4,Object(pa.g)(gt.removed(e.payload.id));case 4:return t.finish(1);case 5:case"end":return t.stop()}}),Oa,null,[[0,,1,5]])}function wa(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.j)(ft.CREATE,Sa);case 2:return e.next=4,Object(pa.j)(ft.REMOVE,Ra);case 4:case"end":return e.stop()}}),ya)}var Ta="LiberTEM.config";function _a(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r;return(n=[(r=n[0],r.replace(new RegExp("".concat(w.a.escapeRegExp(e.separator),"$")),""))].concat(Object(Ae.a)(n.slice(1)))).map((function(e){return e.trim()})).join(e.separator)}function Da(e){var t=window.localStorage.getItem(Ta);if(null===t)return Object.assign({},e,{lastOpened:{},fileHistory:[],cwd:"/"});var n=JSON.parse(t),a={lastOpened:{},fileHistory:[],cwd:"/"};return Object.assign({},a,e,n)}function Ia(e){var t={cwd:e.cwd,lastOpened:e.lastOpened,fileHistory:e.fileHistory};window.localStorage.setItem(Ta,JSON.stringify(t))}function Aa(e){var t="/api/browse/localfs/?path=".concat(encodeURIComponent(e));return fetch(t,{method:"GET",credentials:"same-origin"}).then((function(e){return e.json()}))}var Pa,Fa=xn.a.mark(Na),ka=xn.a.mark(Ha),La=xn.a.mark(Wa),Ma=xn.a.mark(Ba);function Na(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.f)(Ha);case 2:return e.next=4,Object(pa.f)(Ba);case 4:case"end":return e.stop()}}),Fa)}function Ha(){var e,t,n,a,r,c;return xn.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=3,Object(pa.i)(G.LIST_DIRECTORY);case 3:return e=i.sent,t=e.payload,n=t.name,a=t.path,i.next=7,Object(pa.h)((function(e){return e.config}));case 7:return r=i.sent,c=void 0!==n?_a(r,a,n):a,i.next=11,Object(pa.f)(Wa,c);case 11:i.next=0;break;case 13:case"end":return i.stop()}}),ka)}function Wa(e){var t,n,a,r,c,i,o,l;return xn.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(pa.c)(Aa,e);case 3:if("ok"!==(t=s.sent).status){s.next=9;break}return s.next=7,Object(pa.g)(te.dirListing(t.path,t.dirs,t.files,t.drives,t.places));case 7:s.next=20;break;case 9:if("error"!==t.status){s.next=20;break}return s.next=12,Object(pa.h)((function(e){return e.browser}));case 12:return n=s.sent,a=Date.now(),r=yn()(),c=t.alternative?t.alternative:n.places.home.path,s.next=18,Object(pa.g)(te.error("Error browsing directory: ".concat(t.msg),a,r));case 18:return s.next=20,Object(pa.g)(te.list(c));case 20:s.next=33;break;case 22:return s.prev=22,s.t0=s.catch(0),s.next=26,Object(pa.h)((function(e){return e.browser}));case 26:return i=s.sent,o=Date.now(),l=yn()(),s.next=31,Object(pa.g)(te.error("Error browsing directory: ".concat(s.t0.toString()),o,l));case 31:return s.next=33,Object(pa.g)(te.list(i.places.home.path));case 33:case"end":return s.stop()}}),La,null,[[0,22]])}function Ba(){var e;return xn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(pa.i)(G.OPEN);case 3:return t.next=5,Object(pa.h)((function(e){return e.config}));case 5:return e=t.sent,t.next=8,Object(pa.g)(te.list(e.cwd));case 8:t.next=0;break;case 10:case"end":return t.stop()}}),Ma)}!function(e){e.INITIAL_STATE="CHANNEL_INITIAL_STATE",e.JOB_STARTED="CHANNEL_JOB_STARTED",e.FINISH_JOB="CHANNEL_FINISH_JOB",e.TASK_RESULT="CHANNEL_TASK_RESULT",e.JOB_ERROR="CHANNEL_JOB_ERROR",e.OPEN="CHANNEL_OPEN",e.CLOSE="CHANNEL_CLOSE",e.ERROR="CHANNEL_ERROR",e.CANCELLED="CANCELLED"}(Pa||(Pa={}));var Ua,Ga={initialState:function(e,t,n){return S(Pa.INITIAL_STATE,{jobs:e,datasets:t,timestamp:n})},jobStarted:function(e,t,n){return S(Pa.JOB_STARTED,{job:e,timestamp:n,dataset:t})},finishJob:function(e,t,n){return S(Pa.FINISH_JOB,{job:e,results:t,timestamp:n})},taskResult:function(e,t,n){return S(Pa.TASK_RESULT,{job:e,results:t,timestamp:n})},jobError:function(e,t,n,a){return S(Pa.JOB_ERROR,{job:e,msg:t,id:n,timestamp:a})},open:function(e){return S(Pa.OPEN,{timestamp:e})},close:function(e){return S(Pa.CLOSE,{timestamp:e})},error:function(e,t,n){return S(Pa.ERROR,{msg:e,timestamp:t,id:n})},cancelled:function(e){return S(Pa.CANCELLED,{job:e})}};function Ka(e,t){return Object.assign({messageType:e},t)}!function(e){e.INITIAL_STATE="INITIAL_STATE",e.JOB_STARTED="JOB_STARTED",e.FINISH_JOB="FINISH_JOB",e.TASK_RESULT="TASK_RESULT",e.JOB_ERROR="JOB_ERROR",e.BINARY="BINARY",e.OPEN="OPEN",e.CLOSE="CLOSE",e.ERROR="ERROR",e.DELETE_DATASET="DELETE_DATASET",e.CANCEL_JOB_DONE="CANCEL_JOB_DONE"}(Ua||(Ua={}));var Ja={initialState:function(e,t){return Ka(Ua.INITIAL_STATE,{jobs:e,datasets:t})},startJob:function(e,t){return Ka(Ua.JOB_STARTED,{job:e,dataset:t})},finishJob:function(e,t){return Ka(Ua.FINISH_JOB,{job:e,followup:t})},taskResult:function(e,t){return Ka(Ua.TASK_RESULT,{job:e,followup:t})},jobError:function(e,t){return Ka(Ua.JOB_ERROR,{job:e,msg:t})},binary:function(e){return Ka(Ua.BINARY,{objectURL:e})},open:function(){return Ka(Ua.OPEN,{})},close:function(){return Ka(Ua.CLOSE,{})},error:function(e){return Ka(Ua.ERROR,{msg:e})},deleteDataset:function(e){return Ka(Ua.DELETE_DATASET,{dataset:e})},cancelled:function(e){return Ka(Ua.CANCEL_JOB_DONE,{job:e})}},za=xn.a.mark(Za),Va=xn.a.mark(Qa),Ya=xn.a.mark(er),Xa=xn.a.mark(tr),$a=xn.a.mark(nr);function qa(){return Object(s.d)((function(e){function t(t){if(t.data instanceof Blob)e(Ja.binary(URL.createObjectURL(t.data)));else{var n=JSON.parse(t.data);e(n)}}function n(){e(Ja.open())}function a(){e(Ja.close()),e(s.a)}function r(t){e(Ja.error("Error in weboscket connection"))}var c=new WebSocket("ws://".concat(window.location.hostname,":").concat(window.location.port,"/api/events/"));return c.addEventListener("message",t),c.addEventListener("open",n),c.addEventListener("close",a),c.addEventListener("error",r),function(){c.removeEventListener("message",t),c.removeEventListener("open",n),c.removeEventListener("close",a),c.removeEventListener("error",r)}}))}function Za(){var e;return xn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(pa.c)(qa);case 3:return e=t.sent,t.next=6,Object(pa.f)(Qa,e);case 6:return t.next=8,Object(pa.i)([Pa.OPEN,Pa.CLOSE]);case 8:if(t.sent.type!==Pa.OPEN){t.next=12;break}return t.next=12,Object(pa.i)([Pa.CLOSE,Pa.ERROR]);case 12:return t.next=14,Object(pa.e)(1e3);case 14:t.next=0;break;case 16:case"end":return t.stop()}}),za)}function Qa(e){var t,n,a,r;return xn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:c.prev=0;case 1:return c.next=4,Object(pa.i)(e);case 4:t=c.sent,n=Date.now(),c.t0=t.messageType,c.next=c.t0===Ua.OPEN?9:c.t0===Ua.CLOSE?12:c.t0===Ua.ERROR?15:c.t0===Ua.INITIAL_STATE?19:c.t0===Ua.JOB_STARTED?22:c.t0===Ua.FINISH_JOB?25:c.t0===Ua.TASK_RESULT?28:c.t0===Ua.DELETE_DATASET?31:c.t0===Ua.JOB_ERROR?34:c.t0===Ua.CANCEL_JOB_DONE?38:41;break;case 9:return c.next=11,Object(pa.g)(Ga.open(n));case 11:return c.abrupt("break",41);case 12:return c.next=14,Object(pa.g)(Ga.close(n));case 14:return c.abrupt("break",41);case 15:return a=yn()(),c.next=18,Object(pa.g)(Ga.error(t.msg,n,a));case 18:return c.abrupt("break",41);case 19:return c.next=21,Object(pa.g)(Ga.initialState(t.jobs,t.datasets,n));case 21:return c.abrupt("break",41);case 22:return c.next=24,Object(pa.g)(Ga.jobStarted(t.job,t.details.dataset,n));case 24:return c.abrupt("break",41);case 25:return c.next=27,Object(pa.c)(nr,t,e,n);case 27:return c.abrupt("break",41);case 28:return c.next=30,Object(pa.c)(tr,t,e,n);case 30:return c.abrupt("break",41);case 31:return c.next=33,Object(pa.g)(bn.deleted(t.dataset));case 33:return c.abrupt("break",41);case 34:return r=yn()(),c.next=37,Object(pa.g)(Ga.jobError(t.job,t.msg,r,n));case 37:return c.abrupt("break",41);case 38:return c.next=40,Object(pa.g)(Ga.cancelled(t.job));case 40:return c.abrupt("break",41);case 41:c.next=1;break;case 43:return c.prev=43,c.finish(43);case 45:case"end":return c.stop()}}),Va,null,[[0,,43,45]])}function er(e,t){var n,a;return xn.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=[];case 1:if(!(n.length<e)){r.next=8;break}return r.next=4,Object(pa.i)(t);case 4:a=r.sent,n.push(a),r.next=1;break;case 8:return r.abrupt("return",n);case 9:case"end":return r.stop()}}),Ya)}function tr(e,t,n){var a,r;return xn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Object(pa.c)(er,e.followup.numMessages,t);case 2:return a=c.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),c.next=6,Object(pa.g)(Ga.taskResult(e.job,r,n));case 6:case"end":return c.stop()}}),Xa)}function nr(e,t,n){var a,r;return xn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Object(pa.c)(er,e.followup.numMessages,t);case 2:return a=c.sent,r=a.map((function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}})),c.next=6,Object(pa.g)(Ga.finishJob(e.job,r,n));case 6:case"end":return c.stop()}}),$a)}function ar(e){var t={connection:e};return fetch("/api/config/connection/",{body:JSON.stringify(t),credentials:"same-origin",method:"PUT"}).then((function(e){return e.json()}))}function rr(){return fetch("/api/config/connection/",{method:"GET"}).then((function(e){return e.json()}))}var cr,ir=xn.a.mark(ur),or=xn.a.mark(dr),lr=xn.a.mark(mr),sr=xn.a.mark(pr);function ur(e){var t;return xn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(pa.c)(ar,e.payload.params);case 2:return t=n.sent,n.next=5,Object(pa.c)(dr,t);case 5:case"end":return n.stop()}}),ir)}function dr(e){return xn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("ok"!==e.status){t.next=5;break}return t.next=3,Object(pa.g)(C.connected(e.connection.connection));case 3:t.next=7;break;case 5:return t.next=7,Object(pa.g)(C.notConnected());case 7:case"end":return t.stop()}}),or)}function mr(){var e;return xn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(pa.i)(Pa.OPEN);case 3:return t.next=5,Object(pa.c)(rr);case 5:return e=t.sent,t.next=8,Object(pa.c)(dr,e);case 8:t.next=0;break;case 10:case"end":return t.stop()}}),lr)}function pr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.j)(a.CONNECT,ur);case 2:return e.next=4,Object(pa.b)([mr()]);case 4:case"end":return e.stop()}}),sr)}!function(e){e.FETCHED="CONFIG_FETCHED",e.FETCH="CONFIG_FETCH",e.FETCH_FAILED="CONFIG_FETCH_FAILED"}(cr||(cr={}));var Er={fetch:function(){return S(cr.FETCH)},fetched:function(e){return S(cr.FETCHED,{config:e})},fetchFailed:function(e,t,n){return S(cr.FETCH_FAILED,{msg:e,timestamp:t,id:n})}};function fr(){return fetch("/api/config/",{method:"GET",credentials:"same-origin"}).then((function(e){return e.json()}))}var br=xn.a.mark(vr),hr=xn.a.mark(jr),gr=xn.a.mark(xr),Or=xn.a.mark(Sr),yr=xn.a.mark(Cr);function vr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.j)(Pa.OPEN,jr);case 2:case"end":return e.stop()}}),br)}function jr(){var e,t,n;return xn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(pa.g)(Er.fetch());case 2:return a.next=4,Object(pa.c)(fr);case 4:return e=a.sent,a.prev=5,t=Da(e.config),a.next=9,Object(pa.g)(Er.fetched(t));case 9:a.next=17;break;case 11:a.prev=11,a.t0=a.catch(5);try{window.localStorage.removeItem(Ta)}catch(r){}return n=Object.assign({},e.config,(e.config,{lastOpened:{},fileHistory:[],cwd:"/"})),a.next=17,Object(pa.g)(Er.fetched(n));case 17:case"end":return a.stop()}}),hr,null,[[5,11]])}function xr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(pa.i)([rn.CREATE,G.DIRECTORY_LISTING]);case 3:return e.next=5,Object(pa.h)((function(e){return e.config}));case 5:Ia(e.sent),e.next=0;break;case 9:case"end":return e.stop()}}),gr)}function Sr(){var e,t;return xn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(pa.c)(jr);case 3:n.next=11;break;case 5:return n.prev=5,n.t0=n.catch(0),e=Date.now(),t=yn()(),n.next=11,Object(pa.g)(Er.fetchFailed("failed to fetch config: ".concat(n.t0.toString()),e,t));case 11:case"end":return n.stop()}}),Or,null,[[0,5]])}function Cr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.f)(Sr);case 2:return e.next=4,Object(pa.f)(vr);case 4:return e.next=6,Object(pa.f)(xr);case 6:case"end":return e.stop()}}),yr)}var Rr=xn.a.mark(Ar),wr=xn.a.mark(Pr),Tr=xn.a.mark(Fr),_r=xn.a.mark(kr),Dr=xn.a.mark(Lr),Ir=xn.a.mark(Mr);function Ar(e){var t,n,a,r,c;return xn.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Object(pa.c)(wn,e.payload.dataset.id,{dataset:e.payload.dataset});case 3:if("ok"!==(t=i.sent).status){i.next=9;break}return i.next=7,Object(pa.g)(bn.created(t.details));case 7:i.next=14;break;case 9:if("error"!==t.status){i.next=14;break}return n=Date.now(),a=yn()(),i.next=14,Object(pa.g)(bn.error(t.dataset,t.msg,n,a));case 14:i.next=22;break;case 16:return i.prev=16,i.t0=i.catch(0),r=Date.now(),c=yn()(),i.next=22,Object(pa.g)(bn.error(e.payload.dataset.id,"Error loading dataset: ".concat(i.t0.toString()),r,c));case 22:case"end":return i.stop()}}),Rr,null,[[0,16]])}function Pr(e){var t,n;return xn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(pa.c)(Tn,e.payload.dataset);case 3:a.next=11;break;case 5:return a.prev=5,a.t0=a.catch(0),t=Date.now(),n=yn()(),a.next=11,Object(pa.g)(bn.error(e.payload.dataset,"Error closing dataset: ".concat(a.t0.toString()),t,n));case 11:case"end":return a.stop()}}),wr,null,[[0,5]])}function Fr(e){var t,n,a,r,c,i;return xn.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(pa.h)((function(e){return e.config}));case 2:return t=o.sent,n=t.lastOpened[e],o.prev=4,o.next=7,Object(pa.g)(bn.detect(e));case 7:return o.next=9,Object(pa.c)(_n,e);case 9:if("ok"!==(r=o.sent).status){o.next=25;break}if(!e.includes(".dm")&&!e.includes(".DM")){o.next=20;break}return c=Date.now(),i=yn()(),o.next=16,Object(pa.g)(bn.detectFailed(e));case 16:return o.next=18,Object(pa.g)(bn.error("DM","DM dataset is currently not supported in the GUI",c,i));case 18:o.next=23;break;case 20:return a=r.datasetParams,o.next=23,Object(pa.g)(bn.detected(e,r.datasetParams));case 23:o.next=27;break;case 25:return o.next=27,Object(pa.g)(bn.detectFailed(e));case 27:o.next=33;break;case 29:return o.prev=29,o.t0=o.catch(4),o.next=33,Object(pa.g)(bn.detectFailed(e));case 33:return o.next=35,Object(pa.g)(bn.open(e,n,a));case 35:case"end":return o.stop()}}),Tr,null,[[4,29]])}function kr(e){var t;return xn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.payload.path,n.next=3,Object(pa.c)(Fr,t);case 3:case"end":return n.stop()}}),_r)}function Lr(e){var t,n;return xn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(pa.h)((function(e){return e.config}));case 2:return t=a.sent,n=_a(t,e.payload.path,e.payload.name),a.next=6,Object(pa.c)(Fr,n);case 6:case"end":return a.stop()}}),Dr)}function Mr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.j)(rn.CREATE,Ar);case 2:return e.next=4,Object(pa.j)(rn.DELETE,Pr);case 4:return e.next=6,Object(pa.j)(G.SELECT,Lr);case 6:return e.next=8,Object(pa.j)(G.SELECT_FULL_PATH,kr);case 8:case"end":return e.stop()}}),Ir)}var Nr=xn.a.mark(Hr);function Hr(){return xn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(pa.b)([Cr(),Za(),wa(),Mr(),pr(),Na()]);case 2:case"end":return e.stop()}}),Nr)}var Wr={byId:{},ids:[]};var Br,Ur={isOpen:!1,isLoading:!0,path:"/",drives:[],places:{},files:[],dirs:[]};!function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.READY="ready",e.WAITING="waiting"}(Br||(Br={}));var Gr={status:Br.WAITING};var Kr={status:"unknown"};var Jr={version:"",revision:"",localCores:0,cwd:"/",separator:"/",lastOpened:{},fileHistory:[],haveConfig:!1};function zr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zr(n,!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yr={byId:{},ids:[]};var Xr={busy:!1,busyPath:"",formVisible:!1,formPath:"/",formCachedParams:void 0,formDetectedParams:void 0};var $r={byId:{},ids:[]};var qr={byId:{},ids:[]};var Zr=Object(l.c)({analyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ft.CREATED:return nn(e,t.payload.analysis.id,t.payload.analysis);case ft.PREPARE_RUN:var n=t.payload,a=n.jobIndex,r=n.id,c=e.byId[r],i=c.jobs[a],o=Object(Ae.a)(c.jobHistory);if(void 0!==i){var l=o[a]?o[a]:[];o[a]=[i].concat(Object(Ae.a)(l))}var s=Object(Ae.a)(c.jobs);return s[a]=t.payload.job,tn(e,t.payload.id,{jobs:s,jobHistory:o});case ft.REMOVED:return an(e,(function(e){return e.id!==t.payload.id}));case rn.DELETE:return an(e,(function(e){return e.dataset!==t.payload.dataset}))}return e},channelStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gr;switch((arguments.length>1?arguments[1]:void 0).type){case Pa.OPEN:return{status:Br.CONNECTED};case Pa.INITIAL_STATE:return{status:Br.READY};case Pa.CLOSE:return{status:Br.WAITING}}return e},clusterConnection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.NOT_CONNECTED:return{status:"disconnected"};case a.CONNECTED:return{status:"connected",params:t.payload.params}}return e},datasets:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yr,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case Pa.INITIAL_STATE:var r=a.payload.datasets.map((function(e){return Object.assign({},e,{status:F.OPEN})}));return{byId:(e=r,t=function(e){return e.id},e.reduce((function(e,n){return Object.assign(e,Object(A.a)({},t(n),n))}),{})),ids:r.map((function(e){return e.id}))};case rn.CREATE:var c=Vr({},a.payload.dataset,{status:F.OPENING});return nn(n,a.payload.dataset.id,c);case rn.CREATED:var i=Object.assign({},a.payload.dataset,{status:F.OPEN});return tn(n,a.payload.dataset.id,i);case rn.ERROR:return an(n,(function(e){return e.id!==a.payload.dataset}));case rn.DELETE:return tn(n,a.payload.dataset,{status:F.DELETING});case rn.DELETED:return an(n,(function(e){return e.id!==a.payload.dataset}))}return n},openDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case rn.OPEN:return Vr({},e,{formVisible:!0,formPath:t.payload.path,formCachedParams:t.payload.cachedParams,formDetectedParams:t.payload.detectedParams});case rn.CANCEL_OPEN:case rn.CREATE:return Vr({},e,{formVisible:!1});case rn.DETECT:return Vr({},e,{busyPath:t.payload.path,busy:!0});case rn.DETECTED:case rn.DETECT_FAILED:return Vr({},e,{busyPath:"",busy:!1})}return e},jobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ma.CREATE:return nn(e,t.payload.id,{id:t.payload.id,dataset:t.payload.dataset,running:Re.CREATING,status:we.CREATING,results:[],startTimestamp:t.payload.timestamp});case Pa.JOB_STARTED:return tn(e,t.payload.job,{running:Re.RUNNING,status:we.IN_PROGRESS,startTimestamp:t.payload.timestamp});case Pa.TASK_RESULT:return tn(e,t.payload.job,{results:t.payload.results});case Pa.FINISH_JOB:var n=t.payload,a=n.job,r=n.timestamp,c=n.results;return tn(e,a,{running:Re.DONE,status:we.SUCCESS,results:c,endTimestamp:r});case Pa.JOB_ERROR:var i=t.payload,o=i.job,l=i.timestamp;return tn(e,o,{running:Re.DONE,status:we.ERROR,endTimestamp:l})}return e},errors:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G.ERROR:case rn.ERROR:case Pa.ERROR:case ft.ERROR:case Pa.JOB_ERROR:return nn(e,t.payload.id,{id:t.payload.id,msg:t.payload.msg,timestamp:t.payload.timestamp});case Pa.OPEN:return $r;case $n.DISMISS:return an(e,(function(e){return e.id!==t.payload.id}));case $n.DISMISS_ALL:return $r}return e},config:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jr,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case cr.FETCHED:return Object.assign({},n.payload.config,{haveConfig:!0});case G.DIRECTORY_LISTING:return Object.assign({},t,{cwd:n.payload.path});case rn.CREATE:var a=Object.assign({},t.lastOpened,Object(A.a)({},n.payload.dataset.params.path,n.payload.dataset.params)),r=(e=[n.payload.dataset.params.path].concat(Object(Ae.a)(t.fileHistory)),e.reduce((function(e,t){return-1===e.indexOf(t)?[].concat(Object(Ae.a)(e),[t]):e}),[])).slice(0,11);return Object.assign({},t,{lastOpened:a,fileHistory:r})}return t},browser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ur,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case cr.FETCHED:return Object.assign({},e,{path:t.payload.config.cwd});case G.OPEN:return Object.assign({},e,{isOpen:!0});case G.CANCEL:return Object.assign({},e,{isOpen:!1});case G.LIST_DIRECTORY:return Object.assign({},e,{isLoading:!0});case G.DIRECTORY_LISTING:var n=t.payload.places.reduce((function(e,t){return Object.assign({},e,Object(A.a)({},t.key,t))}),{});return Object.assign({},e,{isLoading:!1,path:t.payload.path,files:t.payload.files,dirs:t.payload.dirs,drives:t.payload.drives,places:n});case G.SELECT_FULL_PATH:case G.SELECT:return Object.assign({},e,{isLoading:!1,isOpen:!1})}return e}}),Qr=Object(s.c)(),ec=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.d,tc=Object(l.e)(Zr,ec(Object(l.a)(Qr)));i.render(r.createElement(o.a,{store:tc},r.createElement(sa,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/static",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/static","/service-worker.js");ua?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):da(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):da(e)}))}}(),Qr.run(Hr)}},[[385,1,2]]]);
//# sourceMappingURL=main.e470b953.chunk.js.map