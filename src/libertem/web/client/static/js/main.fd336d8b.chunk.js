(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{208:function(e,t,n){e.exports={default:"ResultImage_default__3UGMF",fallback:"ResultImage_fallback__7NTHF"}},327:function(e,t,n){e.exports=n.p+"static/media/LiberTEM logo-medium.7999e0dc.png"},338:function(e,t,n){e.exports=n(581)},581:function(e,t,n){"use strict";n.r(t);n(339),n(351),n(361);var a,r=n(0),i=n.n(r),c=n(47),l=n(10),o=n(66),s=n(71),u=n(28),d=n(29),m=n(32),E=n(30),p=n(33),h=(n(401),n(591)),f=n(593),b=n(199),g=n(603),y=n(601),O=n(596),v=Object(l.b)(function(e){return{version:e.config.version,revision:e.config.revision}})(function(e){var t=e.version,n=e.revision;return r.createElement(r.Fragment,null,r.createElement(y.a,{as:"h3"},"This is LiberTEM version ",t," (revision ",n.slice(0,8),")"),r.createElement(O.a,null,r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"github"}),r.createElement(O.a.Content,null,"Find us on ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM"},"GitHub"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"bug"}),r.createElement(O.a.Content,null,"Found a bug? Got a feature request? Please ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/issues/new"},"open an issue!"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"legal"}),r.createElement(O.a.Content,null,"LiberTEM is licensed under the ",r.createElement("a",{href:"https://github.com/LiberTEM/LiberTEM/blob/master/LICENSE"},"GNU General Public License v3.0"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"book"}),r.createElement(O.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/"},"the documentation"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"user"}),r.createElement(O.a.Content,null,"Read ",r.createElement("a",{href:"https://libertem.github.io/LiberTEM/acknowledgments.html"},"the acknowledgments"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"gitter"}),r.createElement(O.a.Content,null,"Join our ",r.createElement("a",{href:"https://gitter.im/LiberTEM/Lobby"},"chat on gitter!"))),r.createElement(O.a.Item,null,r.createElement(O.a.Icon,{name:"linkify"}),r.createElement(O.a.Content,null,r.createElement("a",{href:"https://doi.org/10.5281/zenodo.1478763"},r.createElement("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.1478763.svg",alt:"DOI"}))))))}),x=n(595),j=n(600);function S(e,t,n){return void 0===n&&void 0===t?{type:e}:void 0===n?{type:e,payload:t}:{type:e,payload:t,meta:n}}!function(e){e.NOT_CONNECTED="CLUSTER_NOT_CONNECTED",e.CONNECT="CLUSTER_CONNECT",e.CONNECTED="CLUSTER_CONNECTED"}(a||(a={}));var C={notConnected:function(){return S(a.NOT_CONNECTED)},connect:function(e){return S(a.CONNECT,{params:e})},connected:function(e){return S(a.CONNECTED,{params:e})}},R=n(146);function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return R.debounce(e,t,{maxWait:t})}function T(e){return Object.keys(e)}var I,w,A=n(22);!function(e){e.LOCAL="LOCAL",e.TCP="TCP"}(w||(w={}));var D,F,N,L=(I={},Object(A.a)(I,w.LOCAL,{label:"Create local cluster"}),Object(A.a)(I,w.TCP,{label:"Connect to cluster",helpText:"can be either local or remote, connection via TCP"}),I);!function(e){e.HDF5="HDF5",e.HDFS="HDFS",e.RAW="RAW",e.MIB="MIB",e.BLO="BLO",e.K2IS="K2IS",e.SER="SER",e.FRMS6="FRMS6",e.EMPAD="EMPAD"}(D||(D={})),function(e){e.OPEN="OPEN",e.OPENING="OPENING",e.DELETING="DELETING"}(F||(F={})),function(e){e.APPLY_RING_MASK="APPLY_RING_MASK",e.APPLY_DISK_MASK="APPLY_DISK_MASK",e.APPLY_POINT_SELECTOR="APPLY_POINT_SELECTOR",e.CENTER_OF_MASS="CENTER_OF_MASS",e.SUM_FRAMES="SUM_FRAMES",e.SUM_FRAMES_ROI="SUM_FRAMES_ROI",e.PICK_FRAME="PICK_FRAME",e.PICK_FFT_FRAME="PICK_FFT_FRAME",e.APPLY_FFT_MASK="APPLY_FFT_MASK",e.FFTSUM_FRAMES="FFTSUM_FRAMES",e.RADIAL_FOURIER="RADIAL_FOURIER",e.FEM="FEM"}(N||(N={}));var M,k=n(24),P=n(25),H=n(592),B=n(599),W=Object(P.a)({mapPropsToValues:function(e){return{numWorkers:e.config.localCores}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(k.a)({type:w.LOCAL},e))}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit;e.handleReset;return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"numWorkers"},"Number of Workers:"),r.createElement("input",{type:"number",name:"numWorkers",value:t.numWorkers,onChange:c,onBlur:l}),a.numWorkers&&n.numWorkers&&a.numWorkers),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Connect"))}),U=Object(P.a)({mapPropsToValues:function(){return{address:"tcp://localhost:8786"}},handleSubmit:function(e,t){(0,t.props.onSubmit)(Object(k.a)({type:w.TCP},e))}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit;e.handleReset;return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"address"},"Scheduler URI"),r.createElement("input",{type:"text",name:"address",value:t.address,onChange:c,onBlur:l}),a.address&&n.address&&a.address),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Connect"))}),G={connectToCluster:C.connect},K=T(w).map(function(e){return{text:L[w[e]].label,value:w[e]}}),z=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(r)))).state={clusterType:w.LOCAL},n.setType=function(e){n.setState({clusterType:e})},n.handleChange=function(e,t){var a=t.value;n.setType(a)},n.handleSubmit=function(e){n.props.connectToCluster(e)},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"renderForm",value:function(){var e=this.state.clusterType,t=this.props.config;switch(e){case w.LOCAL:return r.createElement(W,{config:t,onSubmit:this.handleSubmit});case w.TCP:return r.createElement(U,{onSubmit:this.handleSubmit})}}},{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(x.a,{inline:!0,options:K,value:this.state.clusterType,onChange:this.handleChange})),r.createElement(j.a,null,this.renderForm()))}}]),t}(r.Component),J=Object(l.b)(function(e){return{config:e.config}},G)(z),Y=n(597),V=function(e){var t=e.msg;return r.createElement(Y.a,{icon:!0},r.createElement(b.a,{name:"cog",loading:!0}),r.createElement(Y.a.Content,null,r.createElement(Y.a.Header,null,"Connecting to LiberTEM"),t))},X={waiting:"Waiting...",connecting:"Connecting..."},q="Connected, waiting for initial state...",Z="Connected, fetching cluster status...",$=Object(l.b)(function(e){return{channelStatus:e.channelStatus,clusterConnection:e.clusterConnection,haveConfig:e.config.haveConfig}})(function(e){var t=e.haveConfig,n=e.children,a=e.channelStatus,i=e.clusterConnection;switch(a.status){case"waiting":case"connecting":return r.createElement(V,{msg:X[a.status]});case"connected":if(!t)return r.createElement(V,{msg:"waiting for configuration..."});if("disconnected"===i.status)return r.createElement(J,null);if("connected"===i.status)return r.createElement(V,{msg:q});if("unknown"===i.status)return r.createElement(V,{msg:Z})}return r.createElement(r.Fragment,null,n)});!function(e){e.LIST_DIRECTORY="BROWSER_LIST_DIRECTORY",e.LIST_FULL_PATH="BROWSER_LIST_DIRECTORY_FULL",e.DIRECTORY_LISTING="BROWSER_DIRECTORY_LISTING",e.DETECT_PARAMS="BROWSER_DETECT_PARAMS",e.PARAMS_DETECTED="BROWSER_PARAMS_DETECTED",e.ERROR="BROWSER_ERROR",e.OPEN="BROWSER_OPEN",e.CANCEL="BROWSER_CANCEL",e.SELECT="BROWSER_SELECT",e.SELECT_FULL_PATH="BROWSER_SELECT_FULL_PATH"}(M||(M={}));var Q={list:function(e,t){return S(M.LIST_DIRECTORY,{path:e,name:t})},dirListing:function(e,t,n,a,r){return S(M.DIRECTORY_LISTING,{path:e,dirs:t,files:n,drives:a,places:r})},open:function(){return S(M.OPEN)},cancel:function(){return S(M.CANCEL)},select:function(e,t){return S(M.SELECT,{path:e,name:t})},selectFullPath:function(e){return S(M.SELECT_FULL_PATH,{path:e})},error:function(e,t,n){return S(M.ERROR,{msg:e,timestamp:t,id:n})},detectParams:function(e){return S(M.DETECT_PARAMS,{path:e})},paramsDetected:function(e,t){return S(M.PARAMS_DETECTED,{path:e,params:t})}},ee=n(328),te=function(e){var t=e.ts,n=new Date(1e3*t),a=n.toLocaleDateString(),i=n.toLocaleTimeString(),c="".concat(a," ").concat(i);return r.createElement("div",{style:{display:"flex",whiteSpace:"nowrap"},title:c},r.createElement("div",{style:{width:"50%",marginRight:"10px"}},a),r.createElement("div",{style:{width:"45%"}},i))};var ne=function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?1e3:1024;if(Math.abs(e)<n)return{size:e,unit:"B"};var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=n,++r}while(Math.abs(e)>=n&&r<a.length-1);return{size:e.toFixed(1),unit:a[r]}}(e.size,e.si);return r.createElement("div",{style:{textAlign:"right"}},t.size," ",t.unit)},ae=function(e){var t=e.children,n=e.title;return r.createElement("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginRight:"10px"},title:n},t)},re=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(e){var t=n.props.onClick;t&&t()},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.icon,i=Object(k.a)({cursor:"pointer"},n),c={textAlign:"right"};return r.createElement("div",{onClick:this.onClick,style:i},r.createElement("div",{style:{display:"flex",paddingRight:"10px"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(ae,{title:t.name},a&&r.createElement(b.a,{name:a}),t.name)),r.createElement("div",{style:{width:"10%"}},r.createElement(ae,null,r.createElement(ne,{size:t.size,si:!1}))),r.createElement("div",{style:{width:"10%"}},r.createElement(ae,null,t.owner)),r.createElement("div",{style:Object(k.a)({width:"18%"},c)},r.createElement(ae,null,r.createElement(te,{ts:t.ctime}))),r.createElement("div",{style:Object(k.a)({width:"18%"},c)},r.createElement(ae,null,r.createElement(te,{ts:t.mtime})))))}}]),t}(r.Component),ie=function(){var e={textAlign:"right"};return r.createElement("div",{style:{paddingRight:"20px",paddingBottom:"10px"}},r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:{width:"20%",flexGrow:1}},r.createElement(ae,null,"Name")),r.createElement("div",{style:Object(k.a)({width:"10%"},e)},r.createElement(ae,null,"Size")),r.createElement("div",{style:{width:"10%"}},r.createElement(ae,null,"Owner")),r.createElement("div",{style:Object(k.a)({width:"18%"},e)},r.createElement(ae,null,"Created")),r.createElement("div",{style:Object(k.a)({width:"18%"},e)},r.createElement(ae,null,"Modified"))))},ce=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.details,n=e.style,a=e.select;return r.createElement(re,{onClick:a,style:n,details:t,icon:"file outline"})}}]),t}(r.Component),le=Object(l.b)(null,function(e,t){return{select:function(){return e(Q.select(t.path,t.details.name))}}})(ce),oe=Object(l.b)(null,function(e,t){return{list:function(){e(Q.list(t.path,t.details.name)),window.setTimeout(function(){return t.onChange()},0)}}})(function(e){var t=e.list,n=e.details,a=e.style;e.onChange;return r.createElement(re,{onClick:t,style:a,details:n,icon:"folder"})}),se=n(598),ue=n(150),de=Object(l.b)(null,function(e,t){return{list:function(){void 0!==t.value&&(e(Q.list(t.value.toString())),window.setTimeout(function(){return t.onChange()},0))}}})(function(e){var t=e.list,n=Object(ue.a)(e,["list"]),a=Object(k.a)({onClick:t},n);return r.createElement(x.a.Item,a)}),me=n(590),Ee=Object(P.a)({mapPropsToValues:function(e){return{path:e.initialPath}},handleSubmit:function(e,t){(0,t.props.onChange)(e.path)},enableReinitialize:!0})(function(e){var t=e.values,n=(e.touched,e.errors,e.dirty,e.isSubmitting,e.handleChange),a=e.handleBlur,i=e.handleSubmit;e.handleReset;return r.createElement(H.a,{onSubmit:i,style:{flexGrow:1}},r.createElement(H.a.Field,null,r.createElement(me.a,{autoComplete:"off",onBlur:a,onChange:n,value:t.path,name:"path"})))}),pe=Object(l.b)(function(e){return{lastOpened:e.config.lastOpened,fileHistory:e.config.fileHistory,separator:e.config.separator}},function(e){return{select:function(t){return e(Q.selectFullPath(t))}}})(function(e){var t=e.lastOpened,n=e.fileHistory,a=e.select,i=n.filter(function(e){return t[e]}).map(function(e){var n=t[e];return{text:n.path,value:{type:n.type,path:n.path}}}),c=function(e,t){return t.value&&a(t.value.toString())};return r.createElement(x.a,{item:!0,text:"Recent",floating:!0},r.createElement(x.a.Menu,null,r.createElement(x.a.Header,{content:"recent datasets"}),i.map(function(e,t){return r.createElement(x.a.Item,{key:t,value:e.value.path,content:e.text,onClick:c})})))}),he=Object(l.b)(null,function(e,t){return{refresh:function(){e(Q.list(t.currentPath)),window.setTimeout(function(){return t.onChange()},0)},handleInputChange:function(n){e(Q.list(n)),window.setTimeout(function(){return t.onChange()},0)},goUp:function(){e(Q.list(t.currentPath,"..")),window.setTimeout(function(){return t.onChange()},0)}}})(function(e){var t=e.currentPath,n=e.drives,a=e.places,i=e.onChange,c=e.refresh,l=e.goUp,o=e.handleInputChange,s=n.map(function(e){return{key:e,text:e}}),u=Object.keys(a).map(function(e){return{key:a[e].path,text:a[e].title}});return r.createElement(se.a,null,r.createElement(pe,null),r.createElement(x.a,{text:"Go to...",floating:!0,item:!0},r.createElement(x.a.Menu,null,r.createElement(x.a.Header,{content:"Drives"}),s.map(function(e){return r.createElement(de,{key:e.key,value:e.key,content:e.text,onChange:i})}),r.createElement(x.a.Header,{content:"Places"}),u.map(function(e){return r.createElement(de,{key:e.key,value:e.key,content:e.text,onChange:i})}))),r.createElement(se.a.Item,{icon:"arrow up",onClick:l}),r.createElement(se.a.Item,{style:{flexGrow:1}},r.createElement(Ee,{onChange:o,initialPath:t})),r.createElement(se.a.Item,{icon:"refresh",onClick:c}))}),fe=r.createRef(),be=function(){null!==fe.current&&fe.current.scrollToItem(0)};function ge(e,t){return e.sort(function(e,n){var a=t(e),r=t(n);return a<r?-1:a>r?1:0})}var ye,Oe,ve=Object(l.b)(function(e){var t=e.browser;return{files:t.files,dirs:t.dirs,path:t.path,drives:t.drives,places:t.places,isLoading:t.isLoading}},function(e){return{cancel:function(){return e(Q.cancel())}}})(function(e){var t=e.files,n=e.dirs,a=e.path,i=e.drives,c=e.places,l=e.cancel,o=e.isLoading,s=function(e){return e.name.toLowerCase()},u=ge(n,s).map(function(e){return function(t){return r.createElement(oe,{style:t,onChange:be,path:a,details:e})}}),d=ge(t,s).map(function(e){return function(t){return r.createElement(le,{style:t,path:a,details:e})}}),m=u.concat(d),E=r.createElement(ee.a,{style:{overflowY:"scroll"},ref:fe,height:300,width:"100%",itemCount:m.length,itemSize:35},function(e){var t=e.index,n=e.style;return m[t](n)});return o&&(E=r.createElement(j.a,{loading:!0,style:{height:"300px"}})),r.createElement(j.a.Group,null,r.createElement(j.a,null,r.createElement(y.a,{as:"h2"},"Open dataset")),r.createElement(j.a,null,r.createElement(he,{currentPath:a,drives:i,places:c,onChange:be})),r.createElement(j.a,null,r.createElement(ie,null),E),r.createElement(j.a,null,r.createElement(B.a,{onClick:l},"Cancel")))}),xe={open:Q.open},je=Object(l.b)(function(e){return{isOpen:e.browser.isOpen}},xe)(function(e){var t=e.isOpen,n=e.open;return t?r.createElement(ve,null):r.createElement(B.a,{icon:!0,labelPosition:"left",onClick:n},r.createElement(b.a,{name:"add"}),"Browse")}),Se=n(15);!function(e){e.CREATING="CREATING",e.RUNNING="RUNNING",e.DONE="DONE"}(ye||(ye={})),function(e){e.CREATING="CREATING",e.IN_PROGRESS="IN_PROGRESS",e.CANCELLED="CANCELLED",e.SUCCESS="SUCCESS",e.ERROR="ERROR"}(Oe||(Oe={}));var Ce=n(41),Re=n(69),_e=n(70),Te=function(){return r.createElement(b.a,{name:"cog",loading:!0,style:{margin:0,padding:0,position:"absolute",bottom:"10px",right:"10px",color:"white",opacity:.7,filter:"drop-shadow(0 0 3px #000)"}})},Ie=function(e){var t=e.children,n=e.busy;return r.createElement("div",{style:{position:"relative"}},t,n&&r.createElement(Te,null))},we=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(r)))).currentHandle=void 0,n.handleDragStart=function(e){n.currentHandle=e},n.handleDrop=function(){n.currentHandle=void 0},n.handleMouseMove=function(e){if(n.currentHandle)return n.currentHandle.externalMouseMove(e)},n.handleMouseLeave=function(e){n.currentHandle&&n.currentHandle.externalLeave(e)},n.handleMouseUp=function(e){n.currentHandle&&n.currentHandle.externalMouseUp(e)},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return r.createElement("g",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp,onKeyDown:this.props.onKeyboardEvent,style:{outline:"1px dashed black"},tabIndex:0},r.createElement("rect",{style:{fill:"transparent"},x:0,y:0,width:t,height:n}),this.renderHandles())}},{key:"renderHandles",value:function(){var e=this,t=this.props,n=t.handles,a=t.onKeyboardEvent;return n.map(function(t,n){var i=t(e.handleDragStart,e.handleDrop,a);if(r.isValidElement(i))return r.cloneElement(i,{key:n})})}}]),t}(r.Component),Ae=n(208),De=n.n(Ae),Fe=function(e){var t=e.job,n=e.idx,a=e.width,i=e.height,c=t.results[n];return void 0===c?r.createElement("svg",{className:De.a.fallback,width:a,height:i,viewBox:"0 0 ".concat(a," ").concat(i),key:-1}):r.createElement("image",{className:De.a.default,xlinkHref:c.imageURL,width:a,height:i})};function Ne(){var e=Object(Re.a)(["\n    display: block;\n    border: 1px solid black;\n    width: 100%;\n    height: auto;\n"]);return Ne=function(){return e},e}var Le=_e.a.svg(Ne()),Me=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"renderHandles",value:function(){var e=this.props,t=e.width,n=e.height,a=e.extraHandles,i=[];return a&&(i=[].concat(Object(Ce.a)(i),[a])),r.createElement(we,{width:t,height:n,handles:i})}},{key:"render",value:function(){var e=this.props,t=e.job,n=e.idx,a=e.width,i=e.height,c=e.extraWidgets,l=t.running!==ye.DONE;return r.createElement(Ie,{busy:l},r.createElement(Le,{width:a,height:i,viewBox:"0 0 ".concat(a," ").concat(i)},r.createElement(Fe,{job:t,idx:n,width:a,height:i}),c,this.renderHandles()))}}]),t}(r.Component),ke=Object(l.b)(null,null)(Me);function Pe(){var e=Object(Re.a)(["\n    display: flex;\n    & > * {\n        margin-right: 10px;\n    }\n"]);return Pe=function(){return e},e}var He=_e.a.div(Pe()),Be=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(r)))).state={selectedChannel:0},n.selectChannel=function(e,t){var a=t.value;n.setState({selectedChannel:a})},n.getJob=function(){var e=n.props,t=e.currentJob,a=e.analysis,r=e.jobsById,i=e.jobIndex;if(t){if(t.results.length>0)return t;var c=a.jobHistory[i];if(void 0!==c){var l=!0,o=!1,s=void 0;try{for(var u,d=c[Symbol.iterator]();!(l=(u=d.next()).done);l=!0){var m=r[u.value];if(m.results.length>0)return m}}catch(E){o=!0,s=E}finally{try{l||null==d.return||d.return()}finally{if(o)throw s}}}}},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.selectors,a=t.analysis,i=t.dataset,c=t.children,l=t.width,o=t.height,s=t.jobIndex,u=t.extraHandles,d=t.extraWidgets,m=t.subtitle,E=r.createElement("svg",{style:{display:"block",border:"1px solid black",width:"100%",height:"auto"},width:l,height:o,viewBox:"0 0 ".concat(l," ").concat(o),key:-1}),p=this.getJob();if(p&&i)if(E=r.createElement(ke,{analysis:a,job:p,dataset:i,extraHandles:u,extraWidgets:d,width:l,height:o,jobIndex:s,idx:this.state.selectedChannel}),p.running===ye.DONE){var h=(p.endTimestamp-p.startTimestamp)/1e3;e=r.createElement(r.Fragment,null,"Analysis done in ",h.toFixed(3),"s")}else e=r.createElement(r.Fragment,null,"Analysis running...");else e=r.createElement(r.Fragment,null,"\xa0");return r.createElement("div",null,E,c,r.createElement(He,null,r.createElement(We,{job:p,handleChange:this.selectChannel,selectedImg:this.state.selectedChannel}),n),r.createElement("p",null,m," ",e))}}]),t}(r.Component),We=function(e){var t=e.job,n=e.handleChange,a=e.selectedImg;if(!t)return null;var i=t.results.map(function(e,t){return{text:e.description.title,value:t}});return r.createElement(r.Fragment,null,r.createElement("div",null,"Channel:"," ",r.createElement(x.a,{inline:!0,options:i,value:a,onChange:n})))},Ue=Object(l.b)(function(e,t){var n=e.analyses.byId[t.analysis],a=n.jobs[t.jobIndex],r=a?e.jobs.byId[a]:void 0,i=r?e.datasets.byId[r.dataset]:void 0;return{currentJob:r,jobsById:e.jobs.byId,analysis:n,dataset:i,jobIndex:t.jobIndex}})(Be),Ge=function(e,t){return function(n){return{x:Math.max(0,Math.min(e-1,n.x)),y:Math.max(0,Math.min(t-1,n.y))}}},Ke=function(e,t,n){return function(a,r){return n&&n(function(e,t,n,a){var r=e-n,i=t-a;return Math.sqrt(r*r+i*i)}(e,t,a,r))}},ze=function(e){return function(t){return{x:t.x,y:e}}},Je=function(e,t){return function(n){return(a=e,function(e){return{x:a>e.x?a:e.x,y:e.y}})(ze(t)(n));var a}},Ye=function(e,t){return function(n){return(a=e,function(e){return{x:a<e.x?a:e.x,y:e.y}})(ze(t)(n));var a}},Ve=function(e){return{fillOpacity:.3,fill:"red",strokeOpacity:.7,stroke:"red",strokeWidth:e/128/3}},Xe=function(e){var t=e.imageWidth,n=(e.imageHeight,e.cx),a=e.cy,i=e.r;return r.createElement("circle",{cx:n+.5,cy:a+.5,r:i,style:Object(k.a)({},Ve(t))})},qe=n(112),Ze=function(e,t){var n=1;switch(e.shiftKey&&(n=10),e.key){case"ArrowUp":t(function(e,t){return{x:e,y:t-n}});break;case"ArrowDown":t(function(e,t){return{x:e,y:t+n}});break;case"ArrowLeft":t(function(e,t){return{x:e-n,y:t}});break;case"ArrowRight":t(function(e,t){return{x:e+n,y:t}});break;default:return}e.preventDefault()};function $e(){var e=Object(Re.a)(["\n    &:focus { outline: none; }\n"]);return $e=function(){return e},e}function Qe(){var e=Object(Re.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return Qe=function(){return e},e}function et(){var e=Object(Re.a)(["\n    stroke: red;\n    stroke-width: 1;\n    fill: transparent;\n    g:focus > & {\n        stroke: lightgreen;\n    }\n"]);return et=function(){return e},e}var tt=_e.a.circle(et()),nt=_e.a.path(Qe()),at=_e.a.g($e()),rt=function(e){var t=e.scale,n=e.x,a=e.y,i=e.withCross,c=e.focusRef,l=Object(ue.a)(e,["scale","x","y","withCross","focusRef"]),o={transform:"matrix(".concat(t,", 0, 0, ").concat(t,", ").concat(n-t*n,", ").concat(a-t*a,")")},s="\n        M".concat(n-1.5," ").concat(a," L ").concat(n+1.5," ").concat(a,"\n        M").concat(n," ").concat(a-1.5," L ").concat(n," ").concat(a+1.5,"\n    "),u=i?r.createElement(nt,{d:s,style:o}):null;return r.createElement(at,Object.assign({},l,{ref:c}),r.createElement(tt,{cx:n,cy:a,r:3,style:o}),u)};function it(e,t){var n=function(e){var t=e.ownerSVGElement;if(null===t)throw new Error("no owner SVG element?");var n=t.getAttribute("width");if(null===n)throw new Error("no width on SVG element?");var a=+n;return t.getBoundingClientRect().width/a}(t),a=t.getBoundingClientRect();return{x:(e.pageX-(a.left+window.pageXOffset))/n,y:(e.pageY-(a.top+window.pageYOffset))/n}}var ct,lt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(E.a)(t).call(this,e))).posRef=void 0,n.focusRef=void 0,n.state={dragging:!1,drag:{x:0,y:0}},n.externalMouseMove=function(e){n.move(e)},n.externalLeave=function(e){n.stopDrag(e)},n.externalMouseUp=function(e){n.stopDrag(e)},n.applyConstraint=function(e){var t=n.props.constraint;return t?t(e):e},n.startDrag=function(e){e.preventDefault();var t=n.props.parentOnDragStart;if(!n.posRef.current)throw new Error("startDrag without posRef");n.setState({dragging:!0,drag:n.applyConstraint(it(e,n.posRef.current))}),t&&t(Object(qe.a)(Object(qe.a)(n))),n.focusRef.current&&n.focusRef.current.focus&&n.focusRef.current.focus()},n.move=function(e){var t=n.props.onDragMove;if(n.state.dragging){if(!n.posRef.current)throw new Error("move without posRef");n.setState({drag:n.applyConstraint(it(e,n.posRef.current))},function(){if(t){var e=n.applyConstraint(n.state.drag);t(e.x,e.y)}})}},n.stopDrag=function(e){var t=n.props.parentOnDrop,a=n.state,r=a.dragging,i=a.drag;r&&(n.setState({dragging:!1}),t&&t(i.x,i.y))},n.handleKeyDown=function(e){Ze(e,function(e){var t=n.props,a=t.x,r=t.y,i=t.onDragMove,c=e(a,r),l=n.applyConstraint(c);i&&i(l.x,l.y)})},n.posRef=r.createRef(),n.focusRef=r.createRef(),n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"renderCommon",value:function(e,t){var n=this.props.imageWidth,a=void 0===n?1:n/128;return r.createElement("g",null,r.createElement("rect",{style:{visibility:"hidden"},ref:this.posRef,x:0,y:0,width:0,height:0}),r.createElement(rt,{scale:a,x:e+.5,y:t+.5,withCross:this.props.withCross,focusRef:this.focusRef,onMouseUp:this.stopDrag,onMouseMove:this.move,onMouseDown:this.startDrag,onKeyDown:this.handleKeyDown,tabIndex:0}))}},{key:"renderDragging",value:function(){var e=this.state.drag,t=e.x,n=e.y;return this.renderCommon(t,n)}},{key:"render",value:function(){var e=this.props,t=e.x,n=e.y;return this.state.dragging?this.renderDragging():this.renderCommon(t,n)}}]),t}(r.Component),ot=lt;!function(e){e.CREATE="ANALYSIS_CREATE",e.CREATED="ANALYSIS_CREATED",e.PREPARE_RUN="ANALYSIS_PREPARE_RUN",e.RUN="ANALYSIS_RUN",e.RUNNING="ANALYSIS_RUNNING",e.REMOVE="ANALYSIS_REMOVE",e.REMOVED="ANALYSIS_REMOVED",e.ERROR="ANALYSIS_ERROR"}(ct||(ct={}));var st={create:function(e,t){return S(ct.CREATE,{dataset:e,analysisType:t})},created:function(e){return S(ct.CREATED,{analysis:e})},prepareRun:function(e,t,n){return S(ct.PREPARE_RUN,{id:e,jobIndex:t,job:n})},run:function(e,t,n){return S(ct.RUN,{id:e,jobIndex:t,parameters:n})},running:function(e,t,n){return S(ct.RUNNING,{id:e,job:t,jobIndex:n})},remove:function(e){return S(ct.REMOVE,{id:e})},removed:function(e){return S(ct.REMOVED,{id:e})},error:function(e,t,n){return S(ct.ERROR,{msg:e,timestamp:t,id:n})}},ut=n(602),dt=function(e){var t=e.title,n=e.subtitle,a=e.left,i=e.right,c=e.toolbar;return r.createElement(r.Fragment,null,r.createElement(y.a,{as:"h3",attached:"top"},r.createElement(b.a,{name:"cog"}),r.createElement(y.a.Content,null,t)),r.createElement(j.a,{attached:!0},r.createElement(ut.a,{columns:2},r.createElement(ut.a.Row,null,r.createElement(ut.a.Column,null,a,r.createElement("p",null,n)),r.createElement(ut.a.Column,null,i)))),c)},mt=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.jobIndex,c=e.analysisId,o=e.cx,s=e.cy,u=e.setCx,d=e.setCy,m=Object(l.c)();i.a.useEffect(function(){if(t){var e={x:o,y:s};m(st.run(c,r,{type:N.PICK_FRAME,parameters:e}))}},[c,o,s,t,r]);var E=function(e,t){var n=Math.round(e),a=Math.round(t);o===n&&s===a||(u(n),d(a))};return{coords:{cx:o,cy:s},handles:function(e,t){return i.a.createElement(ot,{x:o,y:s,withCross:!0,imageWidth:n,onDragMove:E,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(n,a)})}}},Et=function(e){var t=e.modes,n=e.currentMode,a=e.onModeChange;return r.createElement(r.Fragment,null,r.createElement("div",null,"Mode:"," ",r.createElement(x.a,{inline:!0,options:t,value:n,onChange:function(e,t){a(t.value)}})))},pt=function(e){var t=e.enabled,n=e.jobIndex,a=e.analysisId,r=Object(l.c)();i.a.useEffect(function(){t&&r(st.run(a,n,{type:N.SUM_FRAMES,parameters:{}}))},[a,t,n])},ht=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.analysisId,i=[{text:"Average",value:N.SUM_FRAMES},{text:"Pick",value:N.PICK_FRAME},{text:"Average over ROI (disk)",value:N.SUM_FRAMES_ROI}],c=Object(r.useState)(N.SUM_FRAMES),o=Object(Se.a)(c,2),s=o[0],u=o[1],d=r.createElement(Et,{modes:i,currentMode:s,onModeChange:u}),m=r.useState(Math.round(t/2)),E=Object(Se.a)(m,2),p=E[0],h=E[1],f=r.useState(Math.round(n/2)),b=Object(Se.a)(f,2),g=b[0],y=b[1],O=mt({enabled:s===N.PICK_FRAME,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,cx:p,cy:g,setCx:h,setCy:y}),v=O.coords,x=O.handles,j=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.analysisId,i=e.enabled,c=e.jobIndex,o=Math.min(t,n),s=Object(r.useState)(t/2),u=Object(Se.a)(s,2),d=u[0],m=u[1],E=Object(r.useState)(n/2),p=Object(Se.a)(E,2),h=p[0],f=p[1],b=Object(r.useState)(o/8),g=Object(Se.a)(b,2),y=g[0],O=g[1],v=Object(l.c)(),x={roi:{shape:"disk",cx:d,cy:h,r:y}};r.useEffect(function(){var e=setTimeout(function(){i&&v(st.run(a,c,{type:N.SUM_FRAMES,parameters:x}))},100);return function(){return clearTimeout(e)}},[a,i,c,d,h,y]);var j=function(e,t){m(e),f(t)},S=function(e){O(e)},C={x:d-y,y:h},R=r.createElement(Xe,{cx:d,cy:h,r:y,imageWidth:t,imageHeight:n});return{roiParameters:x,sumRoiHandles:function(e,a){return r.createElement(r.Fragment,null,r.createElement(ot,{x:d,y:h,imageWidth:t,onDragMove:j,parentOnDragStart:e,parentOnDrop:a,constraint:Ge(t,n)}),r.createElement(ot,{x:C.x,y:C.y,imageWidth:t,onDragMove:Ke(d,h,S),parentOnDragStart:e,parentOnDrop:a,constraint:ze(h)}))},sumRoiWidgets:R}}({enabled:s===N.SUM_FRAMES_ROI,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a}),S=j.sumRoiHandles,C=j.sumRoiWidgets;pt({enabled:s===N.SUM_FRAMES,jobIndex:0,analysisId:a});var R,_=s!==N.PICK_FRAME?null:r.createElement(r.Fragment,null,"Pick: x=",v.cx,", y=",v.cy," \u2003"),T=function(e,t){return null};switch(s){case N.PICK_FRAME:T=x;break;case N.SUM_FRAMES_ROI:T=S}switch(s){case N.SUM_FRAMES_ROI:R=C}return{frameViewTitle:_,frameModeSelector:d,handles:T,widgets:R}},ft=Object(l.b)(function(e,t){return{status:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.jobs;return n.length>0&&(a=e.jobs.filter(function(e,t){return-1!==n.indexOf(t)})),a.reduce(function(e,n){return t.byId[n].running===ye.DONE?e:"busy"},"idle")}(t.analysis,e.jobs,t.busyIdxs)}},function(e,t){return{handleRemove:function(){return e(st.remove(t.analysis.id))}}})(function(e){var t=e.status,n=e.onApply,a=e.handleRemove,i="busy"===t?{name:"cog",loading:!0}:{name:"check"};return r.createElement(j.a,{attached:"bottom"},r.createElement(B.a.Group,null,r.createElement(B.a,{primary:!0,onClick:n,icon:!0},r.createElement(b.a,i),"Apply"),r.createElement(B.a,{onClick:a,icon:!0},r.createElement(b.a,{name:"remove"}),"Remove")))}),bt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Math.min(s,o),d=Object(r.useState)(s/2),m=Object(Se.a)(d,2),E=m[0],p=m[1],h=Object(r.useState)(o/2),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(u/4),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=Object(l.c)(),S={x:E-v,y:b},C=_(function(e,t){p(e),g(t)}),R=_(x),T=r.createElement(Xe,{cx:E,cy:b,r:v,imageWidth:s,imageHeight:o}),I=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),w=I.frameViewTitle,A=I.frameModeSelector,D=I.handles,F=I.widgets,L=r.createElement(r.Fragment,null,w," Disk: center=(x=",E.toFixed(2),", y=",b.toFixed(2),"), r=",v.toFixed(2)),M=r.createElement(ft,{analysis:t,onApply:function(){j(st.run(t.id,1,{type:N.CENTER_OF_MASS,parameters:{shape:"com",cx:E,cy:b,r:v}}))},busyIdxs:[1]});return r.createElement(dt,{title:"COM analysis",subtitle:L,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(lt,{x:E,y:b,imageWidth:s,onDragMove:C,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(s,o)}),r.createElement(lt,{x:S.x,y:S.y,imageWidth:s,onDragMove:Ke(E,b,R),parentOnDragStart:e,parentOnDrop:t,constraint:ze(b)}))},extraWidgets:T,jobIndex:0,analysis:t.id,width:s,height:o,selectors:A})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:D,extraWidgets:F})),toolbar:M})},gt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Math.min(s,o),d=Object(r.useState)(s/2),m=Object(Se.a)(d,2),E=m[0],p=m[1],h=Object(r.useState)(o/2),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(u/4),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=function(e,t){p(e),g(t)},S=x,C={x:E-v,y:b},R=r.createElement(Xe,{cx:E,cy:b,r:v,imageWidth:s,imageHeight:o}),_=Object(l.c)(),T=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),I=T.frameViewTitle,w=T.frameModeSelector,A=T.handles,D=T.widgets,F=r.createElement(r.Fragment,null,I," Disk: center=(x=",E.toFixed(2),", y=",b.toFixed(2),"), r=",v.toFixed(2)),L=r.createElement(ft,{analysis:t,onApply:function(){_(st.run(t.id,1,{type:N.APPLY_DISK_MASK,parameters:{shape:"disk",cx:E,cy:b,r:v}}))},busyIdxs:[1]});return r.createElement(dt,{title:"Disk analysis",subtitle:F,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:E,y:b,imageWidth:s,onDragMove:j,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(s,o)}),r.createElement(ot,{x:C.x,y:C.y,imageWidth:s,onDragMove:Ke(E,b,S),parentOnDragStart:e,parentOnDrop:t,constraint:ze(b)}))},extraWidgets:R,jobIndex:0,analysis:t.id,width:s,height:o,selectors:w})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:A,extraWidgets:D})),toolbar:L})};function yt(e,t,n,a){n===t&&(n+=360);var r=n-t;r=r<0?r+360:r;var i=[];return i.push(Ot(t,a,e)),i.push(Ot(t+r/3,a,e)),i.push(Ot(t+2*r/3,a,e)),i.push(Ot(n,a,e)),function(e,t,n){return["M",e[0].x,e[0].y,"A",t,t,0,0,n,e[1].x,e[1].y,"A",t,t,0,0,n,e[2].x,e[2].y,"A",t,t,0,0,n,e[3].x,e[3].y].join(" ")}(i,a,r<180?0:1)}function Ot(e,t,n){var a=e*Math.PI/180;return{x:Math.cos(a)*t+n.x,y:Math.sin(a)*t+n.y}}var vt,xt=function(e){var t=e.imageWidth,n=e.cx,a=e.cy,i=e.ri,c=[yt({x:n+.5,y:a+.5},90,90,e.ro),yt({x:n+.5,y:a+.5},90,90,i)].join(" ");return r.createElement("path",{d:c,fillRule:"evenodd",style:Object(k.a)({},Ve(t))})},jt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Math.min(s,o),d=Object(r.useState)(s/2),m=Object(Se.a)(d,2),E=m[0],p=m[1],h=Object(r.useState)(o/2),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(u/4),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=Object(r.useState)(u/2),S=Object(Se.a)(j,2),C=S[0],R=S[1],T={x:E-v,y:b},I={x:E-C,y:b},w=_(function(e,t){p(e),g(t)}),A=_(x),D=_(R),F=r.createElement(xt,{cx:E,cy:b,ri:v,ro:C,imageWidth:s}),L=Object(l.c)(),M=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),k=M.frameViewTitle,P=M.frameModeSelector,H=M.handles,B=M.widgets,W=r.createElement(r.Fragment,null,k," Ring: center=(x=",E.toFixed(2),", y=",b.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),U=r.createElement(ft,{analysis:t,onApply:function(){L(st.run(t.id,1,{type:N.FEM,parameters:{shape:"ring",cx:E,cy:b,ri:v,ro:C}}))},busyIdxs:[1]});return r.createElement(dt,{title:"Fluctuation EM (SD over Ring analysis)",subtitle:W,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:E,y:b,imageWidth:s,onDragMove:w,parentOnDrop:t,parentOnDragStart:e,constraint:Ge(s,o)}),r.createElement(ot,{x:I.x,y:I.y,imageWidth:s,onDragMove:Ke(E,b,D),parentOnDrop:t,parentOnDragStart:e,constraint:Ye(T.x,b)}),r.createElement(ot,{x:T.x,y:T.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ke(E,b,A),constraint:Je(I.x,b)}))},extraWidgets:F,jobIndex:0,analysis:t.id,width:s,height:o,selectors:P})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:H,extraWidgets:B})),toolbar:U})},St=function(e){var t=e.title,n=e.subtitle,a=e.left,i=e.mid,c=e.right,l=e.toolbar,o=e.title1,s=e.title2,u=e.title3;return r.createElement(r.Fragment,null,r.createElement(y.a,{as:"h3",attached:"top"},r.createElement(b.a,{name:"cog"}),r.createElement(y.a.Content,null,t)),r.createElement(j.a,{attached:!0},r.createElement(ut.a,{columns:3},r.createElement(ut.a.Row,null,r.createElement(ut.a.Column,{width:5},r.createElement("p",null,o)),r.createElement(ut.a.Column,{width:5},r.createElement("p",null,s)),r.createElement(ut.a.Column,{width:6},r.createElement("p",null,u))),r.createElement(ut.a.Row,null,r.createElement(ut.a.Column,{width:5},a),r.createElement(ut.a.Column,{width:5},i),r.createElement(ut.a.Column,{width:6},c)),r.createElement(ut.a.Row,null,r.createElement(ut.a.Column,{width:10},r.createElement("p",null,n)),r.createElement(ut.a.Column,{width:6})))),l)},Ct=function(e){var t=e.enabled,n=e.scanWidth,a=e.scanHeight,r=e.jobIndex,c=e.analysisId,o=e.cx,s=e.cy,u=e.real_rad,d=e.real_centerx,m=e.real_centery,E=e.setCx,p=e.setCy,h=Object(l.c)();i.a.useEffect(function(){t&&h(st.run(c,r,{type:N.PICK_FFT_FRAME,parameters:{x:o,y:s,real_rad:u,real_centerx:d,real_centery:m}}))},[c,o,s,t,r,u,d,m]);var f=function(e,t){var n=Math.round(e),a=Math.round(t);o===n&&s===a||(E(n),p(a))};return{coords:{cx:o,cy:s},handles:function(e,t){return i.a.createElement(ot,{x:o,y:s,withCross:!0,imageWidth:n,onDragMove:f,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(n,a)})}}},Rt=function(e){var t=e.enabled,n=e.jobIndex,a=e.analysisId,r=e.real_rad,c=e.real_centerx,o=e.real_centery,s=Object(l.c)();i.a.useEffect(function(){t&&s(st.run(a,n,{type:N.FFTSUM_FRAMES,parameters:{real_rad:r,real_centerx:c,real_centery:o}}))},[a,t,n,r,c,o])},_t=function(e){var t=e.scanWidth,n=e.scanHeight,a=e.analysisId,i=e.real_rad,c=e.real_centerx,l=e.real_centery,o=[{text:"Pick",value:N.PICK_FRAME},{text:"Average",value:N.SUM_FRAMES}],s=Object(r.useState)(N.SUM_FRAMES),u=Object(Se.a)(s,2),d=u[0],m=u[1],E=r.createElement(Et,{modes:o,currentMode:d,onModeChange:m}),p=r.useState(Math.round(t/2)),h=Object(Se.a)(p,2),f=h[0],b=h[1],g=r.useState(Math.round(n/2)),y=Object(Se.a)(g,2),O=y[0],v=y[1],x=mt({enabled:d===N.PICK_FRAME,scanWidth:t,scanHeight:n,jobIndex:1,analysisId:a,cx:f,cy:O,setCx:b,setCy:v}),j=x.coords,S=x.handles;Ct({enabled:d===N.PICK_FRAME,scanWidth:t,scanHeight:n,jobIndex:0,analysisId:a,cx:f,cy:O,setCx:b,setCy:v,real_rad:i,real_centerx:c,real_centery:l}),pt({enabled:d===N.SUM_FRAMES,jobIndex:1,analysisId:a}),Rt({enabled:d===N.SUM_FRAMES,jobIndex:0,analysisId:a,real_rad:i,real_centerx:c,real_centery:l});return{frameViewTitle:d!==N.PICK_FRAME?null:r.createElement(r.Fragment,null,"Pick: x=",j.cx,", y=",j.cy," \u2003"),handles:d!==N.PICK_FRAME?function(e,t){return null}:S,frameModeSelector:E}},Tt=function(e){var t,n,a=e.analysis,i=e.dataset.params.shape,c=Object(Se.a)(i,4),o=c[0],s=c[1],u=c[2],d=c[3],m=Math.min(d,u),E=d/2,p=u/2,h=Object(r.useState)(m/4),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(m/2),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=Object(l.c)(),S={x:E-b,y:p},C={x:E-v,y:p},R=_(g),T=_(x),I=r.createElement(xt,{cx:E,cy:p,ri:b,ro:v,imageWidth:d}),w=r.useState(!0),A=Object(Se.a)(w,2),D=A[0],F=A[1],L=Object(r.useState)(d/2),M=Object(Se.a)(L,2),k=M[0],P=M[1],H=Object(r.useState)(u/2),B=Object(Se.a)(H,2),W=B[0],U=B[1],G=Object(r.useState)(m/4),K=Object(Se.a)(G,2),z=K[0],J=K[1],Y=_(function(e,t){P(e),U(t)}),V=_(J),X={x:k-z,y:W},q=r.createElement(Xe,{cx:k,cy:W,r:z,imageWidth:d,imageHeight:u}),Z=_t({scanWidth:s,scanHeight:o,analysisId:a.id,real_rad:D?z:null,real_centerx:D?k:null,real_centery:D?W:null}),$=Z.frameViewTitle,Q=Z.frameModeSelector,ee=Z.handles,te=r.createElement(ft,{analysis:a,onApply:function(){j(st.run(a.id,2,{type:N.APPLY_FFT_MASK,parameters:{rad_in:b,rad_out:v,real_rad:D?z:null,real_centerx:D?k:null,real_centery:D?W:null}}))},busyIdxs:[2]});return D?(n=r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:k,y:W,imageWidth:d,onDragMove:Y,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(d,u)}),r.createElement(ot,{x:X.x,y:X.y,imageWidth:d,onDragMove:Ke(k,W,V),parentOnDragStart:e,parentOnDrop:t,constraint:ze(W)}))},extraWidgets:q,jobIndex:1,analysis:a.id,width:d,height:u,selectors:Q})),t=r.createElement(r.Fragment,null,$," real_rad=",b.toFixed(2),", real_center=(x=",k.toFixed(2),", y=",W.toFixed(2),"), fourier_rad_in=",b.toFixed(2),", fourier_rad_out=",v.toFixed(2))):(n=r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:a.id,width:d,height:u,selectors:Q})),t=r.createElement(r.Fragment,null,$," fourier_rad_in=",b.toFixed(2),", fourier_rad_out=",v.toFixed(2))),r.createElement(St,{title:"FFT analysis",subtitle:t,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:C.x,y:C.y,imageWidth:d,onDragMove:Ke(E,p,T),parentOnDrop:t,parentOnDragStart:e,constraint:Ye(S.x,p)}),r.createElement(ot,{x:S.x,y:S.y,imageWidth:d,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ke(E,p,R),constraint:Je(C.x,p)}))},extraWidgets:I,jobIndex:0,analysis:a.id,width:d,height:u})),mid:n,right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:2,analysis:a.id,width:s,height:o,extraHandles:ee})),toolbar:te,title2:r.createElement(r.Fragment,null,r.createElement("label",null," Masking out of zero order diffraction peak ",r.createElement("input",{type:"checkbox",name:"check",onChange:function(e){F(e.target.checked)},checked:D})," ")),title1:"Masking of intergation region in Fourier space",title3:"Result of analysis"})},It=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Object(r.useState)(s/2),d=Object(Se.a)(u,2),m=d[0],E=d[1],p=Object(r.useState)(o/2),h=Object(Se.a)(p,2),f=h[0],b=h[1],g=_(function(e,t){E(e),b(t)}),y=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),O=y.frameViewTitle,v=y.frameModeSelector,x=y.handles,j=y.widgets,S=r.createElement(r.Fragment,null,O," Point: center=(x=",m.toFixed(2),", y=",f.toFixed(2),")"),C=Object(l.c)(),R=r.createElement(ft,{analysis:t,onApply:function(){C(st.run(t.id,1,{type:N.APPLY_POINT_SELECTOR,parameters:{shape:"point",cx:m,cy:f}}))},busyIdxs:[1]});return r.createElement(dt,{title:"Point analysis",subtitle:S,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:m,y:f,withCross:!0,onDragMove:g,imageWidth:s,parentOnDragStart:e,parentOnDrop:t,constraint:Ge(s,o)}))},jobIndex:0,analysis:t.id,width:s,height:o,selectors:v})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:x,extraWidgets:j})),toolbar:R})},wt=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Math.min(s,o),d=Object(r.useState)(s/2),m=Object(Se.a)(d,2),E=m[0],p=m[1],h=Object(r.useState)(o/2),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(u/4),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=Object(r.useState)(u/2),S=Object(Se.a)(j,2),C=S[0],R=S[1],T=Object(r.useState)(1),I=Object(Se.a)(T,1)[0],w=Object(r.useState)(8),A=Object(Se.a)(w,1)[0],D={x:E-v,y:b},F={x:E-C,y:b},L=_(function(e,t){p(e),g(t)}),M=_(x),k=_(R),P=r.createElement(xt,{cx:E,cy:b,ri:v,ro:C,imageWidth:s}),H=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),B=H.frameViewTitle,W=H.frameModeSelector,U=H.handles,G=H.widgets,K=r.createElement(r.Fragment,null,B," Ring: center=(x=",E.toFixed(2),", y=",b.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),z=Object(l.c)(),J=r.createElement(ft,{analysis:t,onApply:function(){z(st.run(t.id,1,{type:N.RADIAL_FOURIER,parameters:{shape:"radial_fourier",cx:E,cy:b,ri:v,ro:C,n_bins:I,max_order:A}}))},busyIdxs:[1]});return r.createElement(dt,{title:"Radial Fourier analysis",subtitle:K,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:E,y:b,imageWidth:s,onDragMove:L,parentOnDrop:t,parentOnDragStart:e,constraint:Ge(s,o)}),r.createElement(ot,{x:F.x,y:F.y,imageWidth:s,onDragMove:Ke(E,b,k),parentOnDrop:t,parentOnDragStart:e,constraint:Ye(D.x,b)}),r.createElement(ot,{x:D.x,y:D.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ke(E,b,M),constraint:Je(F.x,b)}))},extraWidgets:P,jobIndex:0,analysis:t.id,width:s,height:o,selectors:W})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:U,extraWidgets:G})),toolbar:J})},At=function(e){var t=e.analysis,n=e.dataset.params.shape,a=Object(Se.a)(n,4),i=a[0],c=a[1],o=a[2],s=a[3],u=Math.min(s,o),d=Object(r.useState)(s/2),m=Object(Se.a)(d,2),E=m[0],p=m[1],h=Object(r.useState)(o/2),f=Object(Se.a)(h,2),b=f[0],g=f[1],y=Object(r.useState)(u/4),O=Object(Se.a)(y,2),v=O[0],x=O[1],j=Object(r.useState)(u/2),S=Object(Se.a)(j,2),C=S[0],R=S[1],T={x:E-v,y:b},I={x:E-C,y:b},w=_(function(e,t){p(e),g(t)}),A=_(x),D=_(R),F=r.createElement(xt,{cx:E,cy:b,ri:v,ro:C,imageWidth:s}),L=Object(l.c)(),M=ht({scanWidth:c,scanHeight:i,analysisId:t.id}),k=M.frameViewTitle,P=M.frameModeSelector,H=M.handles,B=M.widgets,W=r.createElement(r.Fragment,null,k," Ring: center=(x=",E.toFixed(2),", y=",b.toFixed(2),"), ri=",v.toFixed(2),", ro=",C.toFixed(2)),U=r.createElement(ft,{analysis:t,onApply:function(){L(st.run(t.id,1,{type:N.APPLY_RING_MASK,parameters:{shape:"ring",cx:E,cy:b,ri:v,ro:C}}))},busyIdxs:[1]});return r.createElement(dt,{title:"Ring analysis",subtitle:W,left:r.createElement(r.Fragment,null,r.createElement(Ue,{extraHandles:function(e,t){return r.createElement(r.Fragment,null,r.createElement(ot,{x:E,y:b,imageWidth:s,onDragMove:w,parentOnDrop:t,parentOnDragStart:e,constraint:Ge(s,o)}),r.createElement(ot,{x:I.x,y:I.y,imageWidth:s,onDragMove:Ke(E,b,D),parentOnDrop:t,parentOnDragStart:e,constraint:Ye(T.x,b)}),r.createElement(ot,{x:T.x,y:T.y,imageWidth:s,parentOnDrop:t,parentOnDragStart:e,onDragMove:Ke(E,b,A),constraint:Je(I.x,b)}))},extraWidgets:F,jobIndex:0,analysis:t.id,width:s,height:o,selectors:P})),right:r.createElement(r.Fragment,null,r.createElement(Ue,{jobIndex:1,analysis:t.id,width:c,height:i,extraHandles:H,extraWidgets:B})),toolbar:U})},Dt=(vt={},Object(A.a)(vt,N.APPLY_RING_MASK,{desc:"Apply a ring mask with center cx, cy; inner radius ri, outer radius ro",title:"Ring",component:At}),Object(A.a)(vt,N.APPLY_DISK_MASK,{desc:"Apply a disk mask with center cx, cy; radius r",title:"Disk",component:gt}),Object(A.a)(vt,N.FEM,{desc:"Apply a ring mask with center cx, cy; radius r",title:"FEM (SD over Ring)",component:jt}),Object(A.a)(vt,N.CENTER_OF_MASS,{desc:"Compute the center of mass of all diffraction images",title:"Center of mass",component:bt}),Object(A.a)(vt,N.APPLY_POINT_SELECTOR,{desc:"Create an image from a single pixel selected in the detector",title:"Point selection",component:It}),Object(A.a)(vt,N.SUM_FRAMES,{desc:"Create a sum of all detector frames",title:"Sum all frames"}),Object(A.a)(vt,N.SUM_FRAMES_ROI,{desc:"Create a sum of ROI",title:"Sum over ROI"}),Object(A.a)(vt,N.PICK_FRAME,{desc:"Pick a single frame",title:"Pick frame"}),Object(A.a)(vt,N.PICK_FFT_FRAME,{desc:"Pick a single frame",title:"Pick frame"}),Object(A.a)(vt,N.APPLY_FFT_MASK,{desc:"Apply a ring mask with inner radius fourier_rad_in and outer radius fourier_rad_out in Fourier space",title:"FFT analysis",component:Tt}),Object(A.a)(vt,N.FFTSUM_FRAMES,{desc:"Fourier transform of sum of all detector frames",title:"FFT of Sum all frames"}),Object(A.a)(vt,N.RADIAL_FOURIER,{desc:"Compute a radial Fourier analysis",title:"Radial Fourier",component:wt}),vt),Ft=function(e){var t=e.analysis,n=Object(l.d)(function(e){return e.datasets.byId[t.dataset]});if(n.status!==F.OPEN)return null;var a=Dt[t.mainAnalysisType].component;if(!a)throw new Error("unknown analysis type");return r.createElement(a,{dataset:n,analysis:t})},Nt=function(e){var t=e.analyses;return r.createElement(r.Fragment,null,t.ids.map(function(e){return r.createElement(Ft,{key:e,analysis:t.byId[e]})}))};function Lt(e,t,n){var a=Object.assign({},e.byId[t],n),r=Object.assign({},e.byId,Object(A.a)({},t,a));return Object.assign({},e,{byId:r})}function Mt(e,t,n){return{byId:Object.assign({},e.byId,Object(A.a)({},t,n)),ids:[].concat(Object(Ce.a)(e.ids),[t])}}function kt(e,t){var n=e.ids.filter(function(n){return t(e.byId[n])});return{byId:n.reduce(function(t,n){return Object.assign(t,Object(A.a)({},n,e.byId[n]))},{}),ids:n}}var Pt,Ht=function(e){return Dt[N[e]]},Bt=T(N).filter(function(e){return void 0!==Ht(e).component}).map(function(e){return{text:Ht(e).title,value:N[e]}}),Wt=function(e){var t=e.onClick,n=e.label;return r.createElement(x.a,{text:n,icon:"add",floating:!0,labeled:!0,button:!0,className:"icon"},r.createElement(x.a.Menu,null,r.createElement(x.a.Header,{content:"implemented analyses"}),Bt.map(function(e){return r.createElement(x.a.Item,Object.assign({key:e.value,onClick:(n=t,function(e,t){return n(t.value)})},e));var n})))},Ut=Object(l.b)(null,function(e,t){return{handleAddAnalysis:function(n){e(st.create(t.dataset.id,n))}}})(function(e){var t=e.handleAddAnalysis;return r.createElement(Wt,{onClick:t,label:"Add analysis"})}),Gt=n(594),Kt=function(e){return Object.keys(e).map(function(t,n){return r.createElement(Gt.a.Row,{key:n},r.createElement(Gt.a.Cell,null,t),r.createElement(Gt.a.Cell,null,(a=e[t])instanceof Array?"(".concat(a.join(","),")"):a));var a})},zt=function(e){var t=e.dataset;return r.createElement(Gt.a,null,r.createElement(Gt.a.Header,null,r.createElement(Gt.a.Row,null,r.createElement(Gt.a.HeaderCell,null,"Parameter"),r.createElement(Gt.a.HeaderCell,null,"Value"))),r.createElement(Gt.a.Body,null,Kt(t.params)))},Jt=function(e){var t=e.elem;return r.createElement(Gt.a.Row,null,r.createElement(Gt.a.Cell,null,t.name),r.createElement(Gt.a.Cell,null,function(e){return e.value instanceof Array?r.createElement(Yt,{diagnostics:e.value}):e.value}(t)))},Yt=function(e){var t=e.diagnostics;return 0===t.length?null:r.createElement(Gt.a,null,r.createElement(Gt.a.Header,null,r.createElement(Gt.a.Row,null,r.createElement(Gt.a.HeaderCell,null,"Name"),r.createElement(Gt.a.HeaderCell,null,"Value"))),r.createElement(Gt.a.Body,null,t.map(function(e,t){return r.createElement(Jt,{elem:e,key:t})})))},Vt=function(e){var t=e.dataset;return r.createElement(r.Fragment,null,r.createElement(zt,{dataset:t}),r.createElement(Yt,{diagnostics:t.diagnostics}))};!function(e){e.OPEN="DATASET_OPEN",e.CANCEL_OPEN="DATASET_CANCEL_OPEN",e.CREATE="DATASET_CREATE",e.CREATED="DATASET_CREATED",e.ERROR="DATASET_ERROR",e.DELETE="DATASET_DELETE",e.DELETED="DATASET_DELETED",e.DETECT="DATASET_DETECT",e.DETECTED="DATASET_DETECTED",e.DETECT_FAILED="DATASET_DETECT_FAILED"}(Pt||(Pt={}));var Xt={open:function(e,t){return S(Pt.OPEN,{path:e,initialParams:t})},cancelOpen:function(){return S(Pt.CANCEL_OPEN)},create:function(e){return S(Pt.CREATE,{dataset:e})},created:function(e){return S(Pt.CREATED,{dataset:e})},error:function(e,t,n,a){return S(Pt.ERROR,{dataset:e,msg:t,timestamp:n,id:a})},delete:function(e){return S(Pt.DELETE,{dataset:e})},deleted:function(e){return S(Pt.DELETED,{dataset:e})},detect:function(e){return S(Pt.DETECT,{path:e})},detected:function(e,t){return S(Pt.DETECTED,{path:e,params:t})},detectFailed:function(e){return S(Pt.DETECT_FAILED,{path:e})}},qt=Object(l.b)(null,function(e,t){return{handleRemoveDataset:function(){e(Xt.delete(t.dataset.id))}}})(function(e){e.dataset;var t=e.handleRemoveDataset;return r.createElement(r.Fragment,null,r.createElement(B.a,{icon:"remove",labelPosition:"left",onClick:t,content:"Close Dataset"}))}),Zt=Object(l.b)(function(e,t){return{analyses:kt(e.analyses,function(e){return e.dataset===t.dataset.id})}})(function(e){var t,n=e.dataset,a=e.analyses,i=(t={},Object(A.a)(t,F.OPENING,"Opening dataset ".concat(n.params.name)),Object(A.a)(t,F.DELETING,"Closing dataset ".concat(n.params.name)),t);return n.status===F.OPENING||n.status===F.DELETING?r.createElement(r.Fragment,null,r.createElement(y.a,{as:"h2",dividing:!0},n.params.name),r.createElement(Y.a,{icon:!0},r.createElement(b.a,{name:"cog",loading:!0}),r.createElement(Y.a.Content,null,r.createElement(Y.a.Header,null,i[n.status])))):r.createElement(j.a.Group,{style:{marginTop:"3em",marginBottom:"3em"}},r.createElement(j.a.Group,{horizontal:!0},r.createElement(j.a,null,r.createElement(y.a,{as:"h2"},r.createElement(b.a,{name:"database"}),r.createElement(f.a,{trigger:r.createElement(y.a.Content,null,n.params.name," ",r.createElement(b.a,{name:"info circle",size:"small",link:!0}))},r.createElement(g.a.Header,null,n.params.type," Dataset ",n.params.name),r.createElement(g.a.Content,null,r.createElement(Vt,{dataset:n}))))),r.createElement(j.a,{style:{flexShrink:1,flexGrow:0}},r.createElement(qt,{dataset:n}))),a.ids.length>0?r.createElement(r.Fragment,null,r.createElement(j.a,null,r.createElement(Nt,{analyses:a}))):null,r.createElement(j.a,{textAlign:"center"},r.createElement(Ut,{dataset:n})))}),$t=n(34),Qt=n.n($t);function en(e){return e.split(",").map(function(e){return+e})}function tn(e,t,n){return n&&void 0!==n[e]?n[e]:t}var nn,an=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),tileshape:tn("tileshape","1, 8, 128, 128",t).toString()}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.BLO,name:e.name,tileshape:en(e.tileshape)})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement("input",{type:"text",name:"tileshape",id:"id_tileshape",value:t.tileshape,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),rn=T(D).map(function(e){return{text:D[e],value:D[e]}}),cn=function(e){var t=e.currentType,n=e.onClick;return r.createElement(r.Fragment,null,r.createElement(x.a,{inline:!0,options:rn,value:t,onChange:n}))},ln=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),scan_size:tn("scan_size","",t).toString()}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.EMPAD,name:e.name,scan_size:en(e.scan_size)})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement("input",{type:"text",name:"scan_size",id:"id_scan_size",value:t.scan_size,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),on=Object(P.a)({mapPropsToValues:function(e){return{name:tn("name","",e.initial)}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.FRMS6,name:e.name})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),sn=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),tileshape:tn("tileshape","1, 8, 128, 128",t).toString(),ds_path:tn("ds_path","",t)}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.HDF5,name:e.name,ds_path:e.ds_path,tileshape:e.tileshape.split(",").map(function(e){return+e})})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_ds_path"},"HDF5 Dataset Path:"),r.createElement("input",{type:"text",name:"ds_path",id:"id_ds_path",value:t.ds_path,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement("input",{type:"text",name:"tileshape",id:"id_tileshape",value:t.tileshape,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{onClick:s},"Cancel"))}),un=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),tileshape:tn("tileshape","1, 8, 128, 128",t).toString()}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.HDFS,name:e.name,tileshape:e.tileshape.split(",").map(function(e){return+e})})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement("input",{type:"text",name:"tileshape",id:"id_tileshape",value:t.tileshape,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),dn=Object(P.a)({mapPropsToValues:function(e){return{name:tn("name","",e.initial)}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.K2IS,name:e.name})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),mn=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),tileshape:tn("tileshape","1, 8, 256, 256",t).toString(),scan_size:tn("scan_size","",t).toString()}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.MIB,name:e.name,tileshape:en(e.tileshape),scan_size:en(e.scan_size)})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement("input",{type:"text",name:"tileshape",id:"id_tileshape",value:t.tileshape,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement("input",{type:"text",name:"scan_size",id:"id_scan_size",value:t.scan_size,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),En=Object(P.a)({mapPropsToValues:function(e){var t=e.initial;return{name:tn("name","",t),enable_direct:tn("enable_direct",!1,t),tileshape:tn("tileshape","1, 8, 128, 128",t).toString(),detector_size:tn("detector_size","",t).toString(),scan_size:tn("scan_size","",t).toString(),dtype:tn("dtype","float32",t)}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.RAW,name:e.name,dtype:e.dtype,enable_direct:e.enable_direct,tileshape:en(e.tileshape),scan_size:en(e.scan_size),detector_size:en(e.detector_size)})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_tileshape"},"Tileshape:"),r.createElement("input",{type:"text",name:"tileshape",id:"id_tileshape",value:t.tileshape,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_scan_size"},"Scan Size:"),r.createElement("input",{type:"text",name:"scan_size",id:"id_scan_size",value:t.scan_size,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_dtype"},"Datatype (uint16, uint32, float32, float64, >u2, ..., can be anything that is ",r.createElement("a",{href:"https://docs.scipy.org/doc/numpy-1.15.1/reference/arrays.dtypes.html"},"understood by numpy as a dtype"),"):"),r.createElement("input",{type:"text",name:"dtype",id:"id_dtype",value:t.dtype,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_detector_size"},"Detector Size (as in the file):"),r.createElement("input",{type:"text",name:"detector_size",id:"id_detector_size",value:t.detector_size,onChange:c,onBlur:l})),r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_enable_direct"},"Enable Direct I/O (for usage with fast SSDs and files much larger than RAM):"),r.createElement("input",{type:"checkbox",name:"enable_direct",id:"id_enable_direct",checked:t.enable_direct,onChange:c,onBlur:l})),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),pn=Object(P.a)({mapPropsToValues:function(e){return{name:tn("name","",e.initial)}},handleSubmit:function(e,t){var n=t.props;(0,n.onSubmit)({path:n.path,type:D.SER,name:e.name})}})(function(e){var t=e.values,n=e.touched,a=e.errors,i=(e.dirty,e.isSubmitting),c=e.handleChange,l=e.handleBlur,o=e.handleSubmit,s=(e.handleReset,e.onCancel);return r.createElement(H.a,{onSubmit:o},r.createElement(H.a.Field,null,r.createElement("label",{htmlFor:"id_name"},"Name:"),r.createElement("input",{type:"text",name:"name",id:"id_name",value:t.name,onChange:c,onBlur:l}),a.name&&n.name&&a.name),r.createElement(B.a,{primary:!0,type:"submit",disabled:i},"Load Dataset"),r.createElement(B.a,{type:"button",onClick:s},"Cancel"))}),hn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(E.a)(t).call(this,e))).state={datasetType:D.RAW},n.setDatasetType=function(e,t){var a=t.value;n.setState({datasetType:a})},void 0!==e.formInitial&&(n.state={datasetType:e.formInitial.type}),n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.formPath,a=t.formInitial,i=t.createDataset,c=t.onCancel,l=this.state.datasetType,o=function(t){return r.createElement(j.a,null,"Type: ",r.createElement(cn,{onClick:e.setDatasetType,currentType:l}),r.createElement(y.a,{as:"h2"},"Open: ",n),t)};switch(l){case D.HDF5:var s=a&&l===a.type?a:void 0;return o(r.createElement(sn,{path:n,initial:s,onSubmit:i,onCancel:c}));case D.HDFS:var u=a&&l===a.type?a:void 0;return o(r.createElement(un,{path:n,initial:u,onSubmit:i,onCancel:c}));case D.RAW:var d=a&&l===a.type?a:void 0;return o(r.createElement(En,{path:n,initial:d,onSubmit:i,onCancel:c}));case D.MIB:var m=a&&l===a.type?a:void 0;return o(r.createElement(mn,{path:n,initial:m,onSubmit:i,onCancel:c}));case D.BLO:var E=a&&l===a.type?a:void 0;return o(r.createElement(an,{path:n,initial:E,onSubmit:i,onCancel:c}));case D.K2IS:var p=a&&l===a.type?a:void 0;return o(r.createElement(dn,{path:n,initial:p,onSubmit:i,onCancel:c}));case D.SER:var h=a&&l===a.type?a:void 0;return o(r.createElement(pn,{path:n,initial:h,onSubmit:i,onCancel:c}));case D.FRMS6:var f=a&&l===a.type?a:void 0;return o(r.createElement(on,{path:n,initial:f,onSubmit:i,onCancel:c}));case D.EMPAD:var b=a&&l===a.type?a:void 0;return o(r.createElement(ln,{path:n,initial:b,onSubmit:i,onCancel:c}))}return function(e){throw new Error(e)}("unknown dataset type")}}]),t}(r.Component),fn=Object(l.b)(function(e){return{formVisible:e.openDataset.formVisible,formPath:e.openDataset.formPath,formInitial:e.openDataset.formInitialParams}},function(e){return{createDataset:function(t){e(Xt.create({id:Qt()(),params:t}))},onCancel:function(){return e(Xt.cancelOpen())}}})(hn),bn=Object(l.b)(function(e){return{busy:e.openDataset.busy,path:e.openDataset.busyPath}})(function(e){var t=e.busy,n=e.path;return t?r.createElement(r.Fragment,null,r.createElement(y.a,{as:"h2",dividing:!0},"Loading..."),r.createElement(Y.a,{icon:!0},r.createElement(b.a,{name:"cog",loading:!0}),r.createElement(Y.a.Content,null,r.createElement(Y.a.Header,null,"Detecting parameters for ",n)))):null}),gn=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.formVisible,n=e.datasets;return r.createElement(r.Fragment,null,n.ids.map(function(e){return r.createElement(Zt,{dataset:n.byId[e],key:e})}),r.createElement(bn,null),t&&r.createElement(fn,null),r.createElement(je,null))}}]),t}(r.Component),yn=Object(l.b)(function(e){return{datasets:e.datasets,formVisible:e.openDataset.formVisible,formPath:e.openDataset.formPath}})(gn);(nn||(nn={})).DISMISS="ERROR_DISMISS";var On=function(e){return S(nn.DISMISS,{id:e})},vn=Object(l.b)(null,function(e,t){return{dismiss:function(){return e(On(t.error.id))}}})(function(e){var t=e.dismiss,n=e.error;return r.createElement(Y.a,{negative:!0,onDismiss:t},n.msg)}),xn=Object(l.b)(function(e){return{errors:e.errors,clusterConnected:"connected"===e.clusterConnection.status,channelConnected:"connected"===e.channelStatus.status||"ready"===e.channelStatus.status}})(function(e){var t=e.errors,n=e.clusterConnected,a=e.channelConnected,i=t.ids.slice(Math.max(0,t.ids.length-3)),c=t.ids.length>0&&n&&a;return r.createElement(f.a,{open:c},i.map(function(e){return r.createElement(vn,{error:t.byId[e],key:e})}))}),jn=n(327),Sn=n.n(jn),Cn=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.createElement(h.a,{style:{margin:"5em 1em 5em 1em"}},r.createElement("div",{style:{display:"flex"}},r.createElement("img",{src:Sn.a,width:"200",height:"46",alt:"LiberTEM",style:{marginBottom:"20px"}})," ",r.createElement(f.a,{trigger:r.createElement(b.a,{name:"info circle",link:!0,style:{alignSelf:"flex-start"}})},r.createElement(g.a.Header,null,"About LiberTEM"),r.createElement(g.a.Content,null,r.createElement(v,null)))),r.createElement(xn,null),r.createElement($,null,r.createElement(yn,null)))}}]),t}(r.Component),Rn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function _n(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var Tn,In=n(11),wn=n.n(In),An=n(7);(Tn||(Tn={})).CREATE="JOB_CREATE";var Dn={create:function(e,t,n){return S(Tn.CREATE,{id:e,dataset:t,timestamp:n})}};function Fn(e,t,n){var a={job:{dataset:t,analysis:n}};return fetch("/api/jobs/".concat(e,"/"),{body:JSON.stringify(a),credentials:"same-origin",method:"PUT"}).then(function(e){return e.json()})}function Nn(e){return fetch("/api/jobs/".concat(e,"/"),{method:"DELETE",credentials:"same-origin"}).then(function(e){return e.json()})}var Ln=wn.a.mark(Un),Mn=wn.a.mark(Gn),kn=wn.a.mark(Kn),Pn=wn.a.mark(zn);function Hn(e,t){return e.datasets.byId[t]}function Bn(e,t){return e.analyses.byId[t]}function Wn(e,t){return e.jobs.byId[t]}function Un(e){var t,n,a,r;return wn.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Object(An.g)(Hn,e.payload.dataset);case 3:if(i.sent.status===F.OPEN){i.next=6;break}throw new Error("invalid dataset status");case 6:return t={id:Qt()(),dataset:e.payload.dataset,mainAnalysisType:e.payload.analysisType,jobs:[],jobHistory:[]},i.next=9,Object(An.e)(Gn,t.id);case 9:return n=i.sent,i.next=12,Object(An.f)(st.created(t));case 12:return i.next=15,Object(An.h)(ct.REMOVE);case 15:if(i.sent.payload.id!==t.id){i.next=19;break}return i.next=19,Object(An.d)(n);case 19:i.next=12;break;case 21:i.next=29;break;case 23:return i.prev=23,i.t0=i.catch(0),a=Date.now(),r=Qt()(),i.next=29,Object(An.f)(st.error("Error creating analysis: ".concat(i.t0.toString()),a,r));case 29:case"end":return i.stop()}},Ln,this,[[0,23]])}function Gn(e){var t,n,a,r,i,c,l,o,u,d,m;return wn.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,Object(An.a)(ct.RUN,s.b.sliding(2));case 2:t=E.sent;case 3:return E.prev=4,E.next=7,Object(An.h)(t);case 7:if((n=E.sent).payload.id===e){E.next=10;break}return E.abrupt("continue",3);case 10:return E.next=12,Object(An.g)(Bn,e);case 12:return a=E.sent,r=n.payload,i=r.jobIndex,c=r.parameters,l=Qt()(),E.next=17,Object(An.f)(Dn.create(l,a.dataset,Date.now()));case 17:return E.next=19,Object(An.f)(st.prepareRun(a.id,i,l));case 19:if(void 0===(o=a.jobs[i])){E.next=27;break}return E.next=23,Object(An.g)(Wn,o);case 23:if(!(u=E.sent)||"DONE"===u.running){E.next=27;break}return E.next=27,Object(An.c)(Nn,o);case 27:return E.next=29,Object(An.c)(Fn,l,a.dataset,c);case 29:return E.next=31,Object(An.f)(st.running(a.id,l,i));case 31:E.next=39;break;case 33:return E.prev=33,E.t0=E.catch(4),d=Date.now(),m=Qt()(),E.next=39,Object(An.f)(st.error("Error running analysis: ".concat(E.t0.toString()),d,m));case 39:E.next=3;break;case 41:case"end":return E.stop()}},Mn,this,[[4,33]])}function Kn(e){return wn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:return t.prev=1,t.next=4,Object(An.f)(st.removed(e.payload.id));case 4:return t.finish(1);case 5:case"end":return t.stop()}},kn,this,[[0,,1,5]])}function zn(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.i)(ct.CREATE,Un);case 2:return e.next=4,Object(An.i)(ct.REMOVE,Kn);case 4:case"end":return e.stop()}},Pn,this)}var Jn="LiberTEM.config";function Yn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r;return(n=[(r=n[0],r.replace(new RegExp("".concat(R.escapeRegExp(e.separator),"$")),""))].concat(Object(Ce.a)(n.slice(1)))).map(function(e){return e.trim()}).join(e.separator)}function Vn(e){var t=window.localStorage.getItem(Jn);if(null===t)return Object.assign({},e,{lastOpened:{},fileHistory:[]});var n=JSON.parse(t),a={lastOpened:{},fileHistory:[]};return Object.assign({},a,e,n)}function Xn(e){var t=["cwd","lastOpened","fileHistory"].reduce(function(t,n){return t[n]=e[n],t},{});window.localStorage.setItem(Jn,JSON.stringify(t))}function qn(e){var t="/api/browse/localfs/?path=".concat(encodeURIComponent(e));return fetch(t,{method:"GET",credentials:"same-origin"}).then(function(e){return e.json()})}var Zn,$n=wn.a.mark(na),Qn=wn.a.mark(aa),ea=wn.a.mark(ra),ta=wn.a.mark(ia);function na(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.e)(aa);case 2:return e.next=4,Object(An.e)(ia);case 4:case"end":return e.stop()}},$n,this)}function aa(){var e,t,n,a,r,i;return wn.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=3,Object(An.h)(M.LIST_DIRECTORY);case 3:return e=c.sent,t=e.payload,n=t.name,a=t.path,c.next=7,Object(An.g)(function(e){return e.config});case 7:return r=c.sent,i=void 0!==n?Yn(r,a,n):a,c.next=11,Object(An.e)(ra,i);case 11:c.next=0;break;case 13:case"end":return c.stop()}},Qn,this)}function ra(e){var t,n,a,r,i,c,l,o;return wn.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(An.c)(qn,e);case 3:if("ok"!==(t=s.sent).status){s.next=9;break}return s.next=7,Object(An.f)(Q.dirListing(t.path,t.dirs,t.files,t.drives,t.places));case 7:s.next=20;break;case 9:if("error"!==t.status){s.next=20;break}return s.next=12,Object(An.g)(function(e){return e.browser});case 12:return n=s.sent,a=Date.now(),r=Qt()(),i=t.alternative?t.alternative:n.places.home.path,s.next=18,Object(An.f)(Q.error("Error browsing directory: ".concat(t.msg),a,r));case 18:return s.next=20,Object(An.f)(Q.list(i));case 20:s.next=33;break;case 22:return s.prev=22,s.t0=s.catch(0),s.next=26,Object(An.g)(function(e){return e.browser});case 26:return c=s.sent,l=Date.now(),o=Qt()(),s.next=31,Object(An.f)(Q.error("Error browsing directory: ".concat(s.t0.toString()),l,o));case 31:return s.next=33,Object(An.f)(Q.list(c.places.home.path));case 33:case"end":return s.stop()}},ea,this,[[0,22]])}function ia(){var e;return wn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(An.h)(M.OPEN);case 3:return t.next=5,Object(An.g)(function(e){return e.config});case 5:return e=t.sent,t.next=8,Object(An.f)(Q.list(e.cwd));case 8:t.next=0;break;case 10:case"end":return t.stop()}},ta,this)}!function(e){e.INITIAL_STATE="CHANNEL_INITIAL_STATE",e.JOB_STARTED="CHANNEL_JOB_STARTED",e.FINISH_JOB="CHANNEL_FINISH_JOB",e.TASK_RESULT="CHANNEL_TASK_RESULT",e.JOB_ERROR="CHANNEL_JOB_ERROR",e.OPEN="CHANNEL_OPEN",e.CLOSE="CHANNEL_CLOSE",e.ERROR="CHANNEL_ERROR",e.CANCELLED="CANCELLED"}(Zn||(Zn={}));var ca,la={initialState:function(e,t,n){return S(Zn.INITIAL_STATE,{jobs:e,datasets:t,timestamp:n})},jobStarted:function(e,t,n){return S(Zn.JOB_STARTED,{job:e,timestamp:n,dataset:t})},finishJob:function(e,t,n){return S(Zn.FINISH_JOB,{job:e,results:t,timestamp:n})},taskResult:function(e,t,n){return S(Zn.TASK_RESULT,{job:e,results:t,timestamp:n})},jobError:function(e,t,n,a){return S(Zn.JOB_ERROR,{job:e,msg:t,id:n,timestamp:a})},open:function(e){return S(Zn.OPEN,{timestamp:e})},close:function(e){return S(Zn.CLOSE,{timestamp:e})},error:function(e,t,n){return S(Zn.ERROR,{msg:e,timestamp:t,id:n})},cancelled:function(e){return S(Zn.CANCELLED,{job:e})}};function oa(e,t){return Object.assign({messageType:e},t)}!function(e){e.INITIAL_STATE="INITIAL_STATE",e.JOB_STARTED="JOB_STARTED",e.FINISH_JOB="FINISH_JOB",e.TASK_RESULT="TASK_RESULT",e.JOB_ERROR="JOB_ERROR",e.BINARY="BINARY",e.OPEN="OPEN",e.CLOSE="CLOSE",e.ERROR="ERROR",e.DELETE_DATASET="DELETE_DATASET",e.CANCEL_JOB_DONE="CANCEL_JOB_DONE"}(ca||(ca={}));var sa={initialState:function(e,t){return oa(ca.INITIAL_STATE,{jobs:e,datasets:t})},startJob:function(e,t){return oa(ca.JOB_STARTED,{job:e,dataset:t})},finishJob:function(e,t){return oa(ca.FINISH_JOB,{job:e,followup:t})},taskResult:function(e,t){return oa(ca.TASK_RESULT,{job:e,followup:t})},jobError:function(e,t){return oa(ca.JOB_ERROR,{job:e,msg:t})},binary:function(e){return oa(ca.BINARY,{objectURL:e})},open:function(){return oa(ca.OPEN,{})},close:function(){return oa(ca.CLOSE,{})},error:function(e){return oa(ca.ERROR,{msg:e})},deleteDataset:function(e){return oa(ca.DELETE_DATASET,{dataset:e})},cancelled:function(e){return oa(ca.CANCEL_JOB_DONE,{job:e})}},ua=wn.a.mark(fa),da=wn.a.mark(ba),ma=wn.a.mark(ga),Ea=wn.a.mark(ya),pa=wn.a.mark(Oa);function ha(){return Object(s.e)(function(e){function t(t){if(t.data instanceof Blob)e(sa.binary(URL.createObjectURL(t.data)));else{var n=JSON.parse(t.data);e(n)}}function n(){e(sa.open())}function a(){e(sa.close()),e(s.a)}function r(t){e(sa.error("Error in weboscket connection"))}var i=new WebSocket("ws://".concat(window.location.hostname,":").concat(window.location.port,"/api/events/"));return i.addEventListener("message",t),i.addEventListener("open",n),i.addEventListener("close",a),i.addEventListener("error",r),function(){i.removeEventListener("message",t),i.removeEventListener("open",n),i.removeEventListener("close",a),i.removeEventListener("error",r)}})}function fa(){var e;return wn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(An.c)(ha);case 3:return e=t.sent,t.next=6,Object(An.e)(ba,e);case 6:return t.next=8,Object(An.h)([Zn.OPEN,Zn.CLOSE]);case 8:if(t.sent.type!==Zn.OPEN){t.next=12;break}return t.next=12,Object(An.h)([Zn.CLOSE,Zn.ERROR]);case 12:return t.next=14,Object(s.d)(1e3);case 14:t.next=0;break;case 16:case"end":return t.stop()}},ua,this)}function ba(e){var t,n,a,r;return wn.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.prev=0;case 1:return i.next=4,Object(An.h)(e);case 4:t=i.sent,n=Date.now(),i.t0=t.messageType,i.next=i.t0===ca.OPEN?9:i.t0===ca.CLOSE?12:i.t0===ca.ERROR?15:i.t0===ca.INITIAL_STATE?19:i.t0===ca.JOB_STARTED?22:i.t0===ca.FINISH_JOB?25:i.t0===ca.TASK_RESULT?28:i.t0===ca.DELETE_DATASET?31:i.t0===ca.JOB_ERROR?34:i.t0===ca.CANCEL_JOB_DONE?37:39;break;case 9:return i.next=11,Object(An.f)(la.open(n));case 11:return i.abrupt("break",39);case 12:return i.next=14,Object(An.f)(la.close(n));case 14:return i.abrupt("break",39);case 15:return a=Qt()(),i.next=18,Object(An.f)(la.error(t.msg,n,a));case 18:return i.abrupt("break",39);case 19:return i.next=21,Object(An.f)(la.initialState(t.jobs,t.datasets,n));case 21:return i.abrupt("break",39);case 22:return i.next=24,Object(An.f)(la.jobStarted(t.job,t.details.dataset,n));case 24:return i.abrupt("break",39);case 25:return i.next=27,Object(An.c)(Oa,t,e,n);case 27:return i.abrupt("break",39);case 28:return i.next=30,Object(An.c)(ya,t,e,n);case 30:return i.abrupt("break",39);case 31:return i.next=33,Object(An.f)(Xt.deleted(t.dataset));case 33:return i.abrupt("break",39);case 34:return r=Qt()(),i.next=37,Object(An.f)(la.jobError(t.job,t.msg,r,n));case 37:return i.next=39,Object(An.f)(la.cancelled(t.job));case 39:i.next=1;break;case 41:return i.prev=41,i.finish(41);case 43:case"end":return i.stop()}},da,this,[[0,,41,43]])}function ga(e,t){var n,a;return wn.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=[];case 1:if(!(n.length<e)){r.next=8;break}return r.next=4,Object(An.h)(t);case 4:a=r.sent,n.push(a),r.next=1;break;case 8:return r.abrupt("return",n);case 9:case"end":return r.stop()}},ma,this)}function ya(e,t,n){var a,r;return wn.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(An.c)(ga,e.followup.numMessages,t);case 2:return a=i.sent,r=a.map(function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}}),i.next=6,Object(An.f)(la.taskResult(e.job,r,n));case 6:case"end":return i.stop()}},Ea,this)}function Oa(e,t,n){var a,r;return wn.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(An.c)(ga,e.followup.numMessages,t);case 2:return a=i.sent,r=a.map(function(t,n){return{imageURL:t.objectURL,description:e.followup.descriptions[n]}}),i.next=6,Object(An.f)(la.finishJob(e.job,r,n));case 6:case"end":return i.stop()}},pa,this)}function va(e){var t={connection:e};return fetch("/api/config/connection/",{body:JSON.stringify(t),credentials:"same-origin",method:"PUT"}).then(function(e){return e.json()})}function xa(){return fetch("/api/config/connection/",{method:"GET"}).then(function(e){return e.json()})}var ja,Sa=wn.a.mark(Ta),Ca=wn.a.mark(Ia),Ra=wn.a.mark(wa),_a=wn.a.mark(Aa);function Ta(e){var t;return wn.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(An.c)(va,e.payload.params);case 2:return t=n.sent,n.next=5,Object(An.c)(Ia,t);case 5:case"end":return n.stop()}},Sa,this)}function Ia(e){return wn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("ok"!==e.status){t.next=5;break}return t.next=3,Object(An.f)(C.connected(e.connection.connection));case 3:t.next=7;break;case 5:return t.next=7,Object(An.f)(C.notConnected());case 7:case"end":return t.stop()}},Ca,this)}function wa(){var e;return wn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(An.h)(Zn.OPEN);case 3:return t.next=5,Object(An.c)(xa);case 5:return e=t.sent,t.next=8,Object(An.c)(Ia,e);case 8:t.next=0;break;case 10:case"end":return t.stop()}},Ra,this)}function Aa(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.i)(a.CONNECT,Ta);case 2:return e.next=4,Object(An.b)([wa()]);case 4:case"end":return e.stop()}},_a,this)}!function(e){e.FETCHED="CONFIG_FETCHED",e.FETCH="CONFIG_FETCH",e.FETCH_FAILED="CONFIG_FETCH_FAILED"}(ja||(ja={}));var Da={fetch:function(){return S(ja.FETCH)},fetched:function(e){return S(ja.FETCHED,{config:e})},fetchFailed:function(e,t,n){return S(ja.FETCH_FAILED,{msg:e,timestamp:t,id:n})}};function Fa(){return fetch("/api/config/",{method:"GET",credentials:"same-origin"}).then(function(e){return e.json()})}var Na=wn.a.mark(Ha),La=wn.a.mark(Ba),Ma=wn.a.mark(Wa),ka=wn.a.mark(Ua),Pa=wn.a.mark(Ga);function Ha(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.i)(Zn.OPEN,Ba);case 2:case"end":return e.stop()}},Na,this)}function Ba(){var e,t,n;return wn.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(An.f)(Da.fetch());case 2:return a.next=4,Object(An.c)(Fa);case 4:return e=a.sent,a.prev=5,t=Vn(e.config),a.next=9,Object(An.f)(Da.fetched(t));case 9:a.next=17;break;case 11:a.prev=11,a.t0=a.catch(5);try{window.localStorage.removeItem(Jn)}catch(r){}return n=Object.assign({},e.config,(e.config,{lastOpened:{},fileHistory:[]})),a.next=17,Object(An.f)(Da.fetched(n));case 17:case"end":return a.stop()}},La,this,[[5,11]])}function Wa(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(An.h)([Pt.CREATE,M.DIRECTORY_LISTING]);case 3:return e.next=5,Object(An.g)(function(e){return e.config});case 5:Xn(e.sent),e.next=0;break;case 9:case"end":return e.stop()}},Ma,this)}function Ua(){var e,t;return wn.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(An.c)(Ba);case 3:n.next=11;break;case 5:return n.prev=5,n.t0=n.catch(0),e=Date.now(),t=Qt()(),n.next=11,Object(An.f)(Da.fetchFailed("failed to fetch config: ".concat(n.t0.toString()),e,t));case 11:case"end":return n.stop()}},ka,this,[[0,5]])}function Ga(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.e)(Ua);case 2:return e.next=4,Object(An.e)(Ha);case 4:return e.next=6,Object(An.e)(Wa);case 6:case"end":return e.stop()}},Pa,this)}function Ka(e,t){return fetch("/api/datasets/".concat(e,"/"),{body:JSON.stringify(t),credentials:"same-origin",method:"PUT"}).then(function(e){return e.json()})}function za(e){return fetch("/api/datasets/".concat(e,"/"),{credentials:"same-origin",method:"DELETE"}).then(function(e){return e.json()})}function Ja(e){return fetch("/api/datasets/detect/?path=".concat(encodeURIComponent(e)),{credentials:"same-origin",method:"GET"}).then(function(e){return e.json()})}var Ya=wn.a.mark(Qa),Va=wn.a.mark(er),Xa=wn.a.mark(tr),qa=wn.a.mark(nr),Za=wn.a.mark(ar),$a=wn.a.mark(rr);function Qa(e){var t,n,a,r,i;return wn.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(An.c)(Ka,e.payload.dataset.id,{dataset:e.payload.dataset});case 3:if("ok"!==(t=c.sent).status){c.next=9;break}return c.next=7,Object(An.f)(Xt.created(t.details));case 7:c.next=14;break;case 9:if("error"!==t.status){c.next=14;break}return n=Date.now(),a=Qt()(),c.next=14,Object(An.f)(Xt.error(t.dataset,t.msg,n,a));case 14:c.next=22;break;case 16:return c.prev=16,c.t0=c.catch(0),r=Date.now(),i=Qt()(),c.next=22,Object(An.f)(Xt.error(e.payload.dataset.id,"Error loading dataset: ".concat(c.t0.toString()),r,i));case 22:case"end":return c.stop()}},Ya,this,[[0,16]])}function er(e){var t,n;return wn.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(An.c)(za,e.payload.dataset);case 3:a.next=11;break;case 5:return a.prev=5,a.t0=a.catch(0),t=Date.now(),n=Qt()(),a.next=11,Object(An.f)(Xt.error(e.payload.dataset,"Error closing dataset: ".concat(a.t0.toString()),t,n));case 11:case"end":return a.stop()}},Va,this,[[0,5]])}function tr(e){var t,n,a;return wn.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(An.g)(function(e){return e.config});case 2:if(t=r.sent,n=t.lastOpened[e]){r.next=25;break}return r.prev=5,r.next=8,Object(An.f)(Xt.detect(e));case 8:return r.next=10,Object(An.c)(Ja,e);case 10:if("ok"!==(a=r.sent).status){r.next=17;break}return n=a.datasetParams,r.next=15,Object(An.f)(Xt.detected(e,a.datasetParams));case 15:r.next=19;break;case 17:return r.next=19,Object(An.f)(Xt.detectFailed(e));case 19:r.next=25;break;case 21:return r.prev=21,r.t0=r.catch(5),r.next=25,Object(An.f)(Xt.detectFailed(e));case 25:return r.next=27,Object(An.f)(Xt.open(e,n));case 27:case"end":return r.stop()}},Xa,this,[[5,21]])}function nr(e){var t;return wn.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.payload.path,n.next=3,Object(An.c)(tr,t);case 3:case"end":return n.stop()}},qa,this)}function ar(e){var t,n;return wn.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(An.g)(function(e){return e.config});case 2:return t=a.sent,n=Yn(t,e.payload.path,e.payload.name),a.next=6,Object(An.c)(tr,n);case 6:case"end":return a.stop()}},Za,this)}function rr(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.i)(Pt.CREATE,Qa);case 2:return e.next=4,Object(An.i)(Pt.DELETE,er);case 4:return e.next=6,Object(An.i)(M.SELECT,ar);case 6:return e.next=8,Object(An.i)(M.SELECT_FULL_PATH,nr);case 8:case"end":return e.stop()}},$a,this)}var ir=wn.a.mark(cr);function cr(){return wn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(An.b)([Ga(),fa(),zn(),rr(),Aa(),na()]);case 2:case"end":return e.stop()}},ir,this)}var lr={byId:{},ids:[]};var or,sr={isOpen:!1,isLoading:!0,path:"/",drives:[],places:{},files:[],dirs:[]};!function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.READY="ready",e.WAITING="waiting"}(or||(or={}));var ur={status:or.WAITING};var dr={status:"unknown"};var mr={version:"",revision:"",localCores:0,cwd:"/",separator:"/",lastOpened:{},fileHistory:[],haveConfig:!1};var Er={byId:{},ids:[]};var pr={busy:!1,busyPath:"",formVisible:!1,formPath:"/",formInitialParams:void 0};var hr={byId:{},ids:[]};var fr={byId:{},ids:[]};var br=Object(o.c)({analyses:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ct.CREATED:return Mt(e,t.payload.analysis.id,t.payload.analysis);case ct.PREPARE_RUN:var n=t.payload,a=n.jobIndex,r=n.id,i=e.byId[r],c=i.jobs[a],l=Object(Ce.a)(i.jobHistory);if(void 0!==c){var o=l[a]?l[a]:[];l[a]=[c].concat(Object(Ce.a)(o))}var s=Object(Ce.a)(i.jobs);return s[a]=t.payload.job,Lt(e,t.payload.id,{jobs:s,jobHistory:l});case ct.REMOVED:return kt(e,function(e){return e.id!==t.payload.id});case Pt.DELETE:return kt(e,function(e){return e.dataset!==t.payload.dataset})}return e},channelStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ur;switch((arguments.length>1?arguments[1]:void 0).type){case Zn.OPEN:return{status:or.CONNECTED};case Zn.INITIAL_STATE:return{status:or.READY};case Zn.CLOSE:return{status:or.WAITING}}return e},clusterConnection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.NOT_CONNECTED:return{status:"disconnected"};case a.CONNECTED:return{status:"connected",params:t.payload.params}}return e},datasets:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Er,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case Zn.INITIAL_STATE:var r=a.payload.datasets.map(function(e){return Object.assign({},e,{status:F.OPEN})});return{byId:(e=r,t=function(e){return e.id},e.reduce(function(e,n){return Object.assign(e,Object(A.a)({},t(n),n))},{})),ids:r.map(function(e){return e.id})};case Pt.CREATE:var i=Object(k.a)({},a.payload.dataset,{status:F.OPENING});return Mt(n,a.payload.dataset.id,i);case Pt.CREATED:var c=Object.assign({},a.payload.dataset,{status:F.OPEN});return Lt(n,a.payload.dataset.id,c);case Pt.ERROR:return kt(n,function(e){return e.id!==a.payload.dataset});case Pt.DELETE:return Lt(n,a.payload.dataset,{status:F.DELETING});case Pt.DELETED:return kt(n,function(e){return e.id!==a.payload.dataset})}return n},openDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Pt.OPEN:return Object(k.a)({},e,{formVisible:!0,formPath:t.payload.path,formInitialParams:t.payload.initialParams});case Pt.CANCEL_OPEN:case Pt.CREATE:return Object(k.a)({},e,{formVisible:!1});case Pt.DETECT:return Object(k.a)({},e,{busyPath:t.payload.path,busy:!0});case Pt.DETECTED:case Pt.DETECT_FAILED:return Object(k.a)({},e,{busyPath:"",busy:!1})}return e},jobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Tn.CREATE:return Mt(e,t.payload.id,{id:t.payload.id,dataset:t.payload.dataset,running:ye.CREATING,status:Oe.CREATING,results:[],startTimestamp:t.payload.timestamp});case Zn.JOB_STARTED:return Lt(e,t.payload.job,{running:ye.RUNNING,status:Oe.IN_PROGRESS,startTimestamp:t.payload.timestamp});case Zn.TASK_RESULT:return Lt(e,t.payload.job,{results:t.payload.results});case Zn.FINISH_JOB:var n=t.payload,a=n.job,r=n.timestamp,i=n.results;return Lt(e,a,{running:ye.DONE,status:Oe.SUCCESS,results:i,endTimestamp:r});case Zn.JOB_ERROR:var c=t.payload,l=c.job,o=c.timestamp;return Lt(e,l,{running:ye.DONE,status:Oe.ERROR,endTimestamp:o})}return e},errors:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M.ERROR:case Pt.ERROR:case Zn.ERROR:case ct.ERROR:case Zn.JOB_ERROR:return Mt(e,t.payload.id,{id:t.payload.id,msg:t.payload.msg,timestamp:t.payload.timestamp});case Zn.OPEN:return hr;case nn.DISMISS:return kt(e,function(e){return e.id!==t.payload.id})}return e},config:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mr,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case ja.FETCHED:return Object.assign({},n.payload.config,{haveConfig:!0});case M.DIRECTORY_LISTING:return Object.assign({},t,{cwd:n.payload.path});case Pt.CREATE:var a=Object.assign({},t.lastOpened,Object(A.a)({},n.payload.dataset.params.path,n.payload.dataset.params)),r=(e=[n.payload.dataset.params.path].concat(Object(Ce.a)(t.fileHistory)),e.reduce(function(e,t){return-1===e.indexOf(t)?[].concat(Object(Ce.a)(e),[t]):e},[])).slice(0,11);return Object.assign({},t,{lastOpened:a,fileHistory:r})}return t},browser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ja.FETCHED:return Object.assign({},e,{path:t.payload.config.cwd});case M.OPEN:return Object.assign({},e,{isOpen:!0});case M.CANCEL:return Object.assign({},e,{isOpen:!1});case M.LIST_DIRECTORY:return Object.assign({},e,{isLoading:!0});case M.DIRECTORY_LISTING:var n=t.payload.places.reduce(function(e,t){return Object.assign({},e,Object(A.a)({},t.key,t))},{});return Object.assign({},e,{isLoading:!1,path:t.payload.path,files:t.payload.files,dirs:t.payload.dirs,drives:t.payload.drives,places:n});case M.SELECT_FULL_PATH:case M.SELECT:return Object.assign({},e,{isLoading:!1,isOpen:!1})}return e}}),gr=Object(s.c)(),yr=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.d,Or=Object(o.e)(br,yr(Object(o.a)(gr)));c.render(r.createElement(l.a,{store:Or},r.createElement(Cn,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/static",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/static","/service-worker.js");Rn?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):_n(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):_n(e)})}}(),gr.run(cr)}},[[338,2,1]]]);
//# sourceMappingURL=main.fd336d8b.chunk.js.map